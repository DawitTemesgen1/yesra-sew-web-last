// Simple date utility functions to replace date-fns

export const formatDistanceToNow = (date, options = {}) => {
  const now = new Date();
  const targetDate = new Date(date);
  const diffInSeconds = Math.floor((now - targetDate) / 1000);
  
  if (diffInSeconds < 60) {
    return 'just now';
  }
  
  const diffInMinutes = Math.floor(diffInSeconds / 60);
  if (diffInMinutes < 60) {
    return diffInMinutes === 1 ? '1 minute ago' : `${diffInMinutes} minutes ago`;
  }
  
  const diffInHours = Math.floor(diffInMinutes / 60);
  if (diffInHours < 24) {
    return diffInHours === 1 ? '1 hour ago' : `${diffInHours} hours ago`;
  }
  
  const diffInDays = Math.floor(diffInHours / 24);
  if (diffInDays < 30) {
    return diffInDays === 1 ? '1 day ago' : `${diffInDays} days ago`;
  }
  
  const diffInMonths = Math.floor(diffInDays / 30);
  if (diffInMonths < 12) {
    return diffInMonths === 1 ? '1 month ago' : `${diffInMonths} months ago`;
  }
  
  const diffInYears = Math.floor(diffInMonths / 12);
  return diffInYears === 1 ? '1 year ago' : `${diffInYears} years ago`;
};

export const format = (date, formatString) => {
  const d = new Date(date);
  
  if (formatString === 'PP') {
    return d.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric'
    });
  }
  
  if (formatString === 'PPP') {
    return d.toLocaleDateString('en-US', {
      weekday: 'long',
      month: 'long',
      day: 'numeric',
      year: 'numeric'
    });
  }
  
  return d.toLocaleDateString();
};

export const isValid = (date) => {
  return date instanceof Date && !isNaN(date);
};

export const addDays = (date, days) => {
  const result = new Date(date);
  result.setDate(result.getDate() + days);
  return result;
};

export const subDays = (date, days) => {
  const result = new Date(date);
  result.setDate(result.getDate() - days);
  return result;
};

export const startOfDay = (date) => {
  const result = new Date(date);
  result.setHours(0, 0, 0, 0);
  return result;
};

export const endOfDay = (date) => {
  const result = new Date(date);
  result.setHours(23, 59, 59, 999);
  return result;
};
// Mock admin service for testing without backend
const mockAdminService = {
  getDashboardStats: async () => {
    // Simulate API delay
    await new Promise(resolve => setTimeout(resolve, 500));
    return {
      stats: {
        totalListings: 150,
        pendingReview: 23,
        approvedListings: 120,
        rejectedListings: 7,
        totalUsers: 450,
        activeUsers: 320,
        revenue: 25000
      },
      listings: [
        // Homes
        {
          id: 1,
          title: 'Modern Apartment in Bole',
          category: 'home',
          user: 'John Doe',
          email: 'john@example.com',
          status: 'pending',
          created_at: '2024-01-15',
          price: 15000,
          views: 234,
          inquiries: 12
        },
        {
          id: 2,
          title: 'Luxury Villa in Addis Ababa',
          category: 'home',
          user: 'Sarah Johnson',
          email: 'sarah@example.com',
          status: 'approved',
          created_at: '2024-01-14',
          price: 25000,
          views: 567,
          inquiries: 28
        },
        {
          id: 3,
          title: 'Cozy Studio in Kazanchis',
          category: 'home',
          user: 'Michael Brown',
          email: 'michael@example.com',
          status: 'approved',
          created_at: '2024-01-13',
          price: 8000,
          views: 189,
          inquiries: 15
        },
        // Cars
        {
          id: 4,
          title: 'Toyota Corolla 2018',
          category: 'car',
          user: 'Jane Smith',
          email: 'jane@example.com',
          status: 'approved',
          created_at: '2024-01-14',
          price: 850000,
          views: 456,
          inquiries: 23
        },
        {
          id: 5,
          title: 'Honda Civic 2020',
          category: 'car',
          user: 'David Wilson',
          email: 'david@example.com',
          status: 'pending',
          created_at: '2024-01-12',
          price: 1200000,
          views: 234,
          inquiries: 12
        },
        {
          id: 6,
          title: 'Nissan Sentra 2017',
          category: 'car',
          user: 'Emily Davis',
          email: 'emily@example.com',
          status: 'approved',
          created_at: '2024-01-11',
          price: 650000,
          views: 189,
          inquiries: 8
        },
        // Jobs
        {
          id: 7,
          title: 'Senior Software Developer',
          category: 'job',
          user: 'TechHub Ethiopia',
          email: 'hr@techhub.et',
          status: 'approved',
          created_at: '2024-01-10',
          price: 'Birr 25,000-35,000',
          views: 567,
          applications: 45
        },
        {
          id: 8,
          title: 'Marketing Manager',
          category: 'job',
          user: 'Ethio Telecom',
          email: 'careers@ethiotelecom.et',
          status: 'pending',
          created_at: '2024-01-09',
          price: 'Birr 18,000-22,000',
          views: 234,
          applications: 28
        },
        {
          id: 9,
          title: 'Financial Analyst',
          category: 'job',
          user: 'Commercial Bank of Ethiopia',
          email: 'jobs@cbe.et',
          status: 'approved',
          created_at: '2024-01-08',
          price: 'Birr 15,000-20,000',
          views: 189,
          applications: 31
        }
      ],
      users: [
        {
          id: 1,
          name: 'John Doe',
          email: 'john@example.com',
          status: 'active',
          registered_at: '2024-01-10',
          listings_count: 5
        },
        {
          id: 2,
          name: 'Jane Smith',
          email: 'jane@example.com',
          status: 'active',
          registered_at: '2024-01-12',
          listings_count: 3
        }
      ],
      tenders: [
        {
          id: 1,
          title: 'Government Construction Project',
          category: 'Construction',
          status: 'pending',
          created_at: '2024-01-15',
          deadline: '2024-02-15',
          budget: 5000000,
          views: 234,
          applications: 12
        },
        {
          id: 2,
          title: 'School Renovation Tender',
          category: 'Education',
          status: 'approved',
          created_at: '2024-01-14',
          deadline: '2024-01-30',
          budget: 1200000,
          views: 456,
          applications: 23
        },
        {
          id: 3,
          title: 'Road Construction Project',
          category: 'Infrastructure',
          status: 'pending',
          created_at: '2024-01-13',
          deadline: '2024-03-01',
          budget: 8500000,
          views: 189,
          applications: 8
        },
        {
          id: 4,
          title: 'Hospital Equipment Supply',
          category: 'Healthcare',
          status: 'rejected',
          created_at: '2024-01-12',
          deadline: '2024-02-20',
          budget: 650000,
          views: 145,
          applications: 6
        },
        {
          id: 5,
          title: 'IT Infrastructure Development',
          category: 'Technology',
          status: 'approved',
          created_at: '2024-01-11',
          deadline: '2024-02-28',
          budget: 2300000,
          views: 312,
          applications: 15
        }
      ],
      financial: {
        totalRevenue: 25000,
        monthlyRevenue: 8500,
        pendingPayouts: 5000,
        completedPayouts: 20000,
        transactions: []
      },
      analytics: {
        pageViews: 12500,
        uniqueVisitors: 3400,
        conversionRate: 3.2,
        topCategories: [],
        userGrowth: []
      },
      settings: {
        siteMaintenance: false,
        allowRegistrations: true,
        requireApproval: true,
        maxListingsPerUser: 10
      }
    };
  },

  getPendingListings: async () => {
    await new Promise(resolve => setTimeout(resolve, 300));
    return {
      listings: [
        {
          id: 1,
          title: 'Modern Apartment in Bole',
          category: 'Real Estate',
          user: 'John Doe',
          email: 'john@example.com',
          status: 'pending',
          created_at: '2024-01-15',
          price: 15000
        },
        {
          id: 2,
          title: 'Toyota Corolla 2018',
          category: 'Cars',
          user: 'Jane Smith',
          email: 'jane@example.com',
          status: 'pending',
          created_at: '2024-01-14',
          price: 850000
        }
      ]
    };
  },

  getAllUsers: async () => {
    await new Promise(resolve => setTimeout(resolve, 400));
    return {
      users: [
        {
          id: 1,
          name: 'John Doe',
          email: 'john@example.com',
          role: 'user',
          status: 'active',
          created_at: '2024-01-10'
        },
        {
          id: 2,
          name: 'Jane Smith',
          email: 'jane@example.com',
          role: 'user',
          status: 'active',
          created_at: '2024-01-12'
        }
      ]
    };
  },

  updateListingStatus: async (listingId, statusId, reason, adminNotes) => {
    await new Promise(resolve => setTimeout(resolve, 200));
    return { success: true };
  },

  updateUserStatus: async (userId, status, reason) => {
    await new Promise(resolve => setTimeout(resolve, 200));
    return { success: true };
  },

  deleteUser: async (userId) => {
    await new Promise(resolve => setTimeout(resolve, 200));
    return { success: true };
  }
};

export default mockAdminService;
import { apiService } from '../api';

// Data service for handling data transformations and business logic
export const dataService = {
  // Transform listing data for frontend
  transformListing: (listing) => {
    return {
      id: listing.uuid,
      title: listing.title,
      description: listing.description,
      price: listing.price,
      type: listing.type,
      location: listing.location,
      category: listing.category_name,
      categoryId: listing.category_id,
      images: listing.images ? JSON.parse(listing.images) : [],
      contactName: listing.contact_name,
      contactEmail: listing.contact_email,
      contactPhone: listing.contact_phone,
      status: listing.status,
      isFeatured: listing.is_featured,
      isUrgent: listing.is_urgent,
      views: listing.views,
      createdAt: listing.created_at,
      updatedAt: listing.updated_at,
      expiresAt: listing.expires_at,
      specs: listing.specs || {},
      userId: listing.user_id,
      isFavorited: listing.is_favorited || false,
      user: {
        id: listing.user_id,
        firstName: listing.first_name,
        lastName: listing.last_name,
        avatar: listing.avatar_url,
      },
    };
  },

  // Transform user data for frontend
  transformUser: (user) => {
    return {
      id: user.uuid,
      firstName: user.first_name,
      lastName: user.last_name,
      email: user.email,
      phone: user.phone,
      avatar: user.avatar_url,
      bio: user.bio,
      location: user.location,
      isVerified: user.is_verified,
      isPremium: user.is_premium,
      isActive: user.is_active,
      emailVerifiedAt: user.email_verified_at,
      phoneVerifiedAt: user.phone_verified_at,
      lastLoginAt: user.last_login_at,
      createdAt: user.created_at,
      premiumExpiresAt: user.premium_expires_at,
    };
  },

  // Transform category data for frontend
  transformCategory: (category) => {
    return {
      id: category.id,
      name: category.name,
      slug: category.slug,
      description: category.description,
      icon: category.icon,
      imageUrl: category.image_url,
      parentId: category.parent_id,
      sortOrder: category.sort_order,
      isActive: category.is_active,
      listingsCount: category.listings_count || 0,
      subcategoriesCount: category.subcategories_count || 0,
      subcategories: category.subcategories || [],
    };
  },

  // Transform notification data for frontend
  transformNotification: (notification) => {
    return {
      id: notification.id,
      type: notification.type,
      title: notification.title,
      message: notification.message,
      data: notification.data ? JSON.parse(notification.data) : {},
      isRead: notification.is_read,
      readAt: notification.read_at,
      createdAt: notification.created_at,
    };
  },

  // Transform chat room data for frontend
  transformChatRoom: (chatRoom) => {
    return {
      id: chatRoom.id,
      uuid: chatRoom.uuid,
      participant1Id: chatRoom.participant1_id,
      participant2Id: chatRoom.participant2_id,
      listingId: chatRoom.listing_id,
      lastMessageAt: chatRoom.last_message_at,
      lastMessagePreview: chatRoom.last_message_preview,
      createdAt: chatRoom.created_at,
      otherUser: {
        id: chatRoom.other_user_id,
        firstName: chatRoom.other_user_first_name,
        lastName: chatRoom.other_user_last_name,
        avatar: chatRoom.other_user_avatar_url,
      },
      listing: chatRoom.listing_id ? {
        id: chatRoom.listing_id,
        title: chatRoom.listing_title,
        uuid: chatRoom.listing_uuid,
      } : null,
      unreadCount: chatRoom.unread_count || 0,
    };
  },

  // Transform chat message data for frontend
  transformChatMessage: (message) => {
    return {
      id: message.id,
      roomId: message.room_id,
      senderId: message.sender_id,
      message: message.message,
      messageType: message.message_type,
      isRead: message.is_read,
      readAt: message.read_at,
      createdAt: message.created_at,
      sender: {
        id: message.sender_id,
        firstName: message.first_name,
        lastName: message.last_name,
        avatar: message.avatar_url,
      },
    };
  },

  // Transform payment transaction data for frontend
  transformPaymentTransaction: (transaction) => {
    return {
      id: transaction.uuid,
      type: transaction.type,
      amount: transaction.amount,
      currency: transaction.currency,
      method: transaction.method,
      status: transaction.status,
      gatewayTransactionId: transaction.gateway_transaction_id,
      userId: transaction.user_id,
      listingId: transaction.listing_id,
      createdAt: transaction.created_at,
      updatedAt: transaction.updated_at,
      completedAt: transaction.completed_at,
      listing: transaction.listing_title ? {
        id: transaction.listing_id,
        title: transaction.listing_title,
        uuid: transaction.listing_uuid,
      } : null,
      user: {
        id: transaction.user_id,
        firstName: transaction.first_name,
        lastName: transaction.last_name,
        email: transaction.email,
      },
    };
  },

  // Transform report data for frontend
  transformReport: (report) => {
    return {
      id: report.id,
      listingId: report.listing_id,
      reporterId: report.reporter_id,
      reason: report.reason,
      description: report.description,
      status: report.status,
      adminNotes: report.admin_notes,
      createdAt: report.created_at,
      updatedAt: report.updated_at,
      listing: {
        id: report.listing_id,
        title: report.listing_title,
        uuid: report.listing_uuid,
      },
      reporter: {
        id: report.reporter_id,
        firstName: report.reporter_first_name,
        email: report.reporter_email,
      },
      owner: {
        id: report.owner_id,
        firstName: report.owner_first_name,
        email: report.owner_email,
      },
    };
  },

  // Get listings with transformation
  getListings: async (params = {}) => {
    const response = await apiService.listings.getAll(params);
    const listings = response.data.data.listings.map(dataService.transformListing);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        listings,
      },
    };
  },

  // Get single listing with transformation
  getListing: async (id) => {
    const response = await apiService.listings.getById(id);
    const listing = dataService.transformListing(response.data.data.listing);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        listing,
      },
    };
  },

  // Get categories with transformation
  getCategories: async (params = {}) => {
    const response = await apiService.categories.getAll(params);
    const categories = response.data.data.categories.map(dataService.transformCategory);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        categories,
      },
    };
  },

  // Get user profile with transformation
  getUserProfile: async () => {
    const response = await apiService.users.getProfile();
    const user = dataService.transformUser(response.data.data.user);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        user,
      },
    };
  },

  // Get notifications with transformation
  getNotifications: async (params = {}) => {
    const response = await apiService.users.getNotifications(params);
    const notifications = response.data.data.notifications.map(dataService.transformNotification);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        notifications,
      },
    };
  },

  // Get chat rooms with transformation
  getChatRooms: async (params = {}) => {
    const response = await apiService.chat.getRooms(params);
    const rooms = response.data.data.rooms.map(dataService.transformChatRoom);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        rooms,
      },
    };
  },

  // Get chat messages with transformation
  getChatMessages: async (roomId, params = {}) => {
    const response = await apiService.chat.getRoom(roomId, params);
    const messages = response.data.data.messages.map(dataService.transformChatMessage);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        messages,
      },
    };
  },

  // Get payment history with transformation
  getPaymentHistory: async (params = {}) => {
    const response = await apiService.payments.getHistory(params);
    const transactions = response.data.data.transactions.map(dataService.transformPaymentTransaction);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        transactions,
      },
    };
  },

  // Create listing with proper data formatting
  createListing: async (formData) => {
    const response = await apiService.listings.create(formData);
    const listing = dataService.transformListing(response.data.data.listing);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        listing,
      },
    };
  },

  // Update listing with proper data formatting
  updateListing: async (id, formData) => {
    const response = await apiService.listings.update(id, formData);
    const listing = dataService.transformListing(response.data.data.listing);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        listing,
      },
    };
  },

  // Toggle favorite with proper response handling
  toggleFavorite: async (id) => {
    const response = await apiService.listings.toggleFavorite(id);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        isFavorited: response.data.data.is_favorited,
      },
    };
  },

  // Send message with proper data formatting
  sendMessage: async (roomId, messageData) => {
    const response = await apiService.chat.sendMessage(roomId, messageData);
    const message = dataService.transformChatMessage(response.data.data.message);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        message,
      },
    };
  },

  // Create chat room with proper data formatting
  createChatRoom: async (roomData) => {
    const response = await apiService.chat.createRoom(roomData);
    const room = dataService.transformChatRoom(response.data.data.room);
    
    return {
      ...response.data,
      data: {
        ...response.data.data,
        room,
      },
    };
  },
};

export default dataService;
// API service for connecting to Yesra Sew backend
const API_BASE_URL = process.env.REACT_APP_API_URL || 'https://api.yesrasewsolution.com';

class ApiService {
  constructor() {
    this.baseURL = API_BASE_URL;
    this.token = localStorage.getItem('accessToken'); // Updated to match backend
  }

  // Helper method to make API requests
  async request(endpoint, options = {}) {
    const url = `${this.baseURL}${endpoint}`;
    const config = {
      headers: {
        'Content-Type': 'application/json',
        ...(this.token && { Authorization: `Bearer ${this.token}` }),
        ...options.headers,
      },
      ...options,
    };

    try {
      const response = await fetch(url, config);
      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || 'API request failed');
      }

      return data;
    } catch (error) {
      throw error;
    }
  }

  // Set authentication token
  setToken(token) {
    this.token = token;
    if (token) {
      localStorage.setItem('accessToken', token); // Updated to match backend
    } else {
      localStorage.removeItem('accessToken');
    }
  }

  // Clear authentication token
  clearToken() {
    this.token = null;
    localStorage.removeItem('accessToken'); // Updated to match backend
  }

  // Authentication endpoints
  async register(userData) {
    const response = await this.request('/auth/register', {
      method: 'POST',
      body: JSON.stringify(userData),
    });

    // If registration returns a token, store it
    if (response.token) {
      this.setToken(response.token);
    }

    return response;
  }

  async login(credentials) {
    const response = await this.request('/auth/login', {
      method: 'POST',
      body: JSON.stringify(credentials),
    });

    // Store token if login successful
    if (response.token) {
      this.setToken(response.token);
    }

    return response;
  }

  async verifyOtp(identifier, otp) {
    const response = await this.request('/auth/verify-otp', {
      method: 'POST',
      body: JSON.stringify({ identifier, otp }),
    });

    // Store token if OTP verification successful
    if (response.token) {
      this.setToken(response.token);
    }

    return response;
  }

  async resendOtp(identifier) {
    return this.request('/auth/resend-otp', {
      method: 'POST',
      body: JSON.stringify({ identifier }),
    });
  }

  async forgotPassword(email) {
    return this.request('/auth/forgot-password', {
      method: 'POST',
      body: JSON.stringify({ email }),
    });
  }

  async resetPassword(token, newPassword) {
    return this.request('/auth/reset-password', {
      method: 'POST',
      body: JSON.stringify({ token, password: newPassword }),
    });
  }

  async getCurrentUser() {
    return this.request('/users/profile'); // Updated to match backend
  }

  // Listings endpoints
  async getListings(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/listings?${queryString}`);
  }

  async getListingById(id) {
    return this.request(`/listings/${id}`);
  }

  async createListing(listingData) {
    return this.request('/listings', { // Updated to match backend
      method: 'POST',
      body: JSON.stringify(listingData),
    });
  }

  async updateListing(id, listingData) {
    return this.request(`/listings/${id}`, {
      method: 'PUT',
      body: JSON.stringify(listingData),
    });
  }

  async deleteListing(id) {
    return this.request(`/listings/${id}`, {
      method: 'DELETE',
    });
  }

  async applyForListing(id, applicationData) {
    return this.request(`/listings/${id}/apply`, {
      method: 'POST',
      body: JSON.stringify(applicationData),
    });
  }

  async getListingComments(id) {
    return this.request(`/listings/${id}/comments`);
  }

  async addListingComment(id, comment) {
    return this.request(`/listings/${id}/comments`, {
      method: 'POST',
      body: JSON.stringify({ comment }),
    });
  }

  // Categories endpoints
  async getCategories() {
    return this.request('/categories');
  }

  async getCategoryById(id) {
    return this.request(`/categories/${id}`);
  }

  // Profile endpoints
  async getProfile() {
    return this.request('/profile');
  }

  async updateProfile(profileData) {
    return this.request('/profile', {
      method: 'PUT',
      body: JSON.stringify(profileData),
    });
  }

  // Favorites endpoints
  async toggleFavorite(listingId) {
    return this.request(`/listings/${listingId}/favorite`, {
      method: 'POST',
    });
  }

  async getFavorites() {
    return this.request('/profile/favorites');
  }

  // Upload endpoint
  async uploadFile(file) {
    const formData = new FormData();
    formData.append('file', file);

    return this.request('/upload', {
      method: 'POST',
      headers: {
        // Remove Content-Type to let browser set it with boundary
        'Authorization': this.token ? `Bearer ${this.token}` : undefined,
      },
      body: formData,
    });
  }

  // Analytics endpoints
  async getUserAnalytics() {
    return this.request('/profile/analytics');
  }

  async getUserStats() {
    return this.request('/profile/stats');
  }

  async getDashboardData() {
    return this.request('/profile/dashboard');
  }

  // Public endpoints
  async getPublicListings(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/public/listings?${queryString}`);
  }

  async getPublicCategories() {
    return this.request('/public/categories');
  }

  async getSystemConfig() {
    return this.request('/public/config');
  }
  // ==========================================
  // Chat Methods
  // ==========================================

  async getConversations() {
    return this.request('/chat/conversations');
  }

  async getMessages(conversationId) {
    return this.request(`/chat/conversations/${conversationId}/messages`);
  }

  async startConversation(participantId) {
    return this.request('/chat/conversations', {
      method: 'POST',
      body: JSON.stringify({ participantId }),
    });
  }

  async sendMessage(conversationId, message) {
    return this.request(`/chat/conversations/${conversationId}/messages`, {
      method: 'POST',
      body: JSON.stringify({ message }),
    });
  }

  async getUnreadMessageCount() {
    const data = await this.request('/chat/unread-count');
    return data.unread_count || 0;
  }

  // ==========================================
  // Notification Methods
  // ==========================================

  async getNotifications() {
    return this.request('/notifications');
  }

  async markNotificationAsRead(notificationId) {
    return this.request(`/notifications/${notificationId}/read`, {
      method: 'PATCH',
    });
  }

  async markAllNotificationsAsRead() {
    return this.request('/notifications/mark-all-read', {
      method: 'POST',
    });
  }

  async getUnreadNotificationCount() {
    const data = await this.request('/notifications/unread-count');
    return data.unread_count || 0;
  }

  // ==========================================
  // Subscription Methods
  // ==========================================

  async updateSubscription(plan) {
    return this.request('/users/subscription', {
      method: 'PUT',
      body: JSON.stringify({ plan }),
    });
  }

  // ==========================================
  // Payment Methods
  // ==========================================

  async initializePayment({ planName, amount, txRef }) {
    return this.request('/payments/initialize', {
      method: 'POST',
      body: JSON.stringify({ planName, amount, txRef }),
    });
  }

  async verifyPayment(txRef) {
    return this.request(`/payments/verify/${txRef}`, {
      method: 'POST',
    });
  }

  async getPaymentStatus(txRef) {
    return this.request(`/payments/status/${txRef}`);
  }

  async getPaymentHistory(limit = 20) {
    return this.request(`/payments/history?limit=${limit}`);
  }

  // ==========================================
  // Application Methods
  // ==========================================

  async getMyApplications() {
    return this.request('/users/applications');
  }

  // ==========================================
  // Membership & Subscription Methods
  // ==========================================

  async getMembershipPlans() {
    return this.request('/membership/plans');
  }

  async createMembershipPlan(planData) {
    return this.request('/membership/plans', {
      method: 'POST',
      body: JSON.stringify(planData),
    });
  }

  async updateMembershipPlan(id, planData) {
    return this.request(`/membership/plans/${id}`, {
      method: 'PUT',
      body: JSON.stringify(planData),
    });
  }

  async deleteMembershipPlan(id) {
    return this.request(`/membership/plans/${id}`, {
      method: 'DELETE',
    });
  }

  async getUserSubscriptions(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/membership/subscriptions?${queryString}`);
  }

  async getAllSubscriptions(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/membership/subscriptions/all?${queryString}`);
  }

  async createSubscription(subscriptionData) {
    return this.request('/membership/subscriptions', {
      method: 'POST',
      body: JSON.stringify(subscriptionData),
    });
  }

  async updateSubscription(id, subscriptionData) {
    return this.request(`/membership/subscriptions/${id}`, {
      method: 'PUT',
      body: JSON.stringify(subscriptionData),
    });
  }

  async cancelSubscription(id) {
    return this.request(`/membership/subscriptions/${id}`, {
      method: 'DELETE',
    });
  }

  async getSubscriptionAnalytics() {
    return this.request('/membership/analytics');
  }

  // ==========================================
  // Company Management Methods (Admin)
  // ==========================================

  async getAllCompanies(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/companies/admin/all?${queryString}`);
  }

  async getCompanyById(id) {
    return this.request(`/companies/admin/${id}`);
  }

  async updateCompanyVerification(id, verificationData) {
    return this.request(`/companies/admin/${id}/verification`, {
      method: 'PUT',
      body: JSON.stringify(verificationData),
    });
  }

  async updateCompanyStatus(id, statusData) {
    return this.request(`/companies/admin/${id}/status`, {
      method: 'PUT',
      body: JSON.stringify(statusData),
    });
  }

  async getCompanyAnalytics() {
    return this.request('/companies/admin/analytics');
  }

  async getCompanyListings(id, params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/companies/admin/${id}/listings?${queryString}`);
  }

  // ==========================================
  // Template Management Methods (Admin)
  // ==========================================

  async getAllTemplates(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/admin/templates?${queryString}`);
  }

  async getTemplateById(id) {
    return this.request(`/admin/templates/${id}`);
  }

  async createTemplate(templateData) {
    return this.request('/admin/templates', {
      method: 'POST',
      body: JSON.stringify(templateData),
    });
  }

  async updateTemplate(id, templateData) {
    return this.request(`/admin/templates/${id}`, {
      method: 'PUT',
      body: JSON.stringify(templateData),
    });
  }

  async deleteTemplate(id) {
    return this.request(`/admin/templates/${id}`, {
      method: 'DELETE',
    });
  }

  async getTemplatesByType(type) {
    return this.request(`/admin/templates/type/${type}`);
  }

  async duplicateTemplate(id, name) {
    return this.request(`/admin/templates/${id}/duplicate`, {
      method: 'POST',
      body: JSON.stringify({ name }),
    });
  }

  // ==========================================
  // Admin Dashboard Methods
  // ==========================================

  // ==========================================
  // Admin Dashboard Methods
  // ==========================================

  async getDashboardStats() {
    return this.request('/admin/dashboard');
  }

  async getGrowthMetrics(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/analytics/users?${queryString}`);
  }

  async getTopCategories() {
    // Top categories are included in the analytics dashboard endpoint
    const data = await this.request('/analytics/dashboard');
    return { data: { data: data.data.top_categories } };
  }

  async getSystemHealth() {
    return this.request('/analytics/system');
  }

  // Admin Management Methods
  async getAdminListings(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/admin/listings?${queryString}`);
  }

  async getAdminUsers(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/admin/users?${queryString}`);
  }

  async getAdminTransactions(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/admin/transactions?${queryString}`);
  }

  async getAdminReports(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/admin/reports?${queryString}`);
  }

  // ==========================================
  // Price Alert Methods
  // ==========================================

  async getPriceAlerts(listingId) {
    return this.request(`/listings/${listingId}/price-alerts`);
  }

  async setPriceAlert(listingId, alertData) {
    return this.request(`/listings/${listingId}/price-alerts`, {
      method: 'POST',
      body: JSON.stringify(alertData),
    });
  }

  async removePriceAlert(listingId) {
    return this.request(`/listings/${listingId}/price-alerts`, {
      method: 'DELETE',
    });
  }

  async getAllPriceAlerts() {
    return this.request('/users/price-alerts');
  }

  // ==========================================
  // Saved Searches Methods
  // ==========================================

  async saveSearch(searchData) {
    return this.request('/users/saved-searches', {
      method: 'POST',
      body: JSON.stringify(searchData),
    });
  }

  async getSavedSearches() {
    return this.request('/users/saved-searches');
  }

  async deleteSavedSearch(searchId) {
    return this.request(`/users/saved-searches/${searchId}`, {
      method: 'DELETE',
    });
  }

  async updateSavedSearch(searchId, searchData) {
    return this.request(`/users/saved-searches/${searchId}`, {
      method: 'PUT',
      body: JSON.stringify(searchData),
    });
  }

  // ==========================================
  // Review & Rating Methods
  // ==========================================

  async getUserReviews(userId) {
    return this.request(`/users/${userId}/reviews`);
  }

  async createReview(userId, reviewData) {
    return this.request(`/users/${userId}/reviews`, {
      method: 'POST',
      body: JSON.stringify(reviewData),
    });
  }

  async updateReview(reviewId, reviewData) {
    return this.request(`/reviews/${reviewId}`, {
      method: 'PUT',
      body: JSON.stringify(reviewData),
    });
  }

  async deleteReview(reviewId) {
    return this.request(`/reviews/${reviewId}`, {
      method: 'DELETE',
    });
  }

  async getListingReviews(listingId) {
    return this.request(`/listings/${listingId}/reviews`);
  }

  // ==========================================
  // Analytics & Insights Methods
  // ==========================================

  async getListingAnalytics(listingId) {
    return this.request(`/listings/${listingId}/analytics`);
  }

  async getUserAnalytics() {
    return this.request('/users/analytics');
  }

  async getMarketTrends(category) {
    const params = category ? `?category=${category}` : '';
    return this.request(`/public/market-trends${params}`);
  }

  async getPriceComparison(listingId) {
    return this.request(`/listings/${listingId}/price-comparison`);
  }

  // ==========================================
  // Recommendation Methods
  // ==========================================

  async getRecommendedListings() {
    return this.request('/users/recommendations');
  }

  async getSimilarListings(listingId) {
    return this.request(`/listings/${listingId}/similar`);
  }

  async getTrendingListings() {
    return this.request('/public/trending');
  }

  // ==========================================
  // Trust & Verification Methods
  // ==========================================

  async verifyPhoneNumber(phoneData) {
    return this.request('/verification/phone', {
      method: 'POST',
      body: JSON.stringify(phoneData),
    });
  }

  async verifyEmail(emailData) {
    return this.request('/verification/email', {
      method: 'POST',
      body: JSON.stringify(emailData),
    });
  }

  async verifyIdentity(identityData) {
    return this.request('/verification/identity', {
      method: 'POST',
      body: JSON.stringify(identityData),
    });
  }

  async getVerificationStatus() {
    return this.request('/verification/status');
  }

  async reportUser(userId, reportData) {
    return this.request(`/users/${userId}/report`, {
      method: 'POST',
      body: JSON.stringify(reportData),
    });
  }

  async reportListing(listingId, reportData) {
    return this.request(`/listings/${listingId}/report`, {
      method: 'POST',
      body: JSON.stringify(reportData),
    });
  }

  // ==========================================
  // Backend-Specific Endpoints
  // ==========================================

  // Categories
  async getCategories(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/categories?${queryString}`);
  }

  async getCategoryTree() {
    return this.request('/categories/tree/all');
  }

  // Favorites
  async toggleFavorite(listingId) {
    return this.request(`/listings/${listingId}/favorite`, {
      method: 'POST',
    });
  }

  async getFavorites(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/users/favorites?${queryString}`);
  }

  // Chat
  async getChatRooms(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/chat/rooms?${queryString}`);
  }

  async getChatRoom(roomId, params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/chat/rooms/${roomId}?${queryString}`);
  }

  async createChatRoom(roomData) {
    return this.request('/chat/rooms', {
      method: 'POST',
      body: JSON.stringify(roomData),
    });
  }

  async sendMessage(roomId, messageData) {
    return this.request(`/chat/rooms/${roomId}/messages`, {
      method: 'POST',
      body: JSON.stringify(messageData),
    });
  }

  // Notifications
  async getNotifications(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/notifications?${queryString}`);
  }

  async markNotificationRead(id) {
    return this.request(`/notifications/${id}/read`, {
      method: 'PUT',
    });
  }

  async deleteNotification(id) {
    return this.request(`/notifications/${id}`, {
      method: 'DELETE',
    });
  }

  // Payments
  async createPaymentIntent(paymentData) {
    return this.request('/payments/create-intent', {
      method: 'POST',
      body: JSON.stringify(paymentData),
    });
  }

  async getPaymentHistory(params = {}) {
    const queryString = new URLSearchParams(params).toString();
    return this.request(`/payments/history?${queryString}`);
  }

  // File Upload
  async uploadFile(file, type = 'general') {
    const formData = new FormData();
    formData.append('file', file);

    return this.request(`/upload/${type}`, {
      method: 'POST',
      headers: {}, // Let browser set multipart/form-data
      body: formData,
    });
  }

  // Health Check
  async healthCheck() {
    return this.request('/health', { baseURL: this.baseURL.replace('/api', '') });
  }
}

// Create and export a singleton instance
const apiService = new ApiService();
export default apiService;
import api from './api';

const adminService = {
  // Dashboard
  getDashboardStats: async () => {
    const response = await api.get('/admin/dashboard/stats');
    return response.data;
  },

  getPendingListings: async (params = {}) => {
    const response = await api.get('/admin/verification/pending', { params });
    return response.data;
  },

  getAllUsers: async (params = {}) => {
    const response = await api.get('/admin/users', { params });
    return response.data;
  },

  updateListingStatus: async (listingId, statusId, reason, adminNotes) => {
    const response = await api.put(`/admin/verification/${listingId}/status`, {
      statusId,
      reason,
      adminNotes
    });
    return response.data;
  },

  updateUserStatus: async (userId, status, reason) => {
    const response = await api.put(`/admin/users/${userId}/status`, { status, reason });
    return response.data;
  },

  deleteUser: async (userId) => {
    const response = await api.delete(`/admin/users/${userId}`);
    return response.data;
  },

  // Analytics
  getAnalytics: async () => {
    const response = await api.get('/admin/analytics');
    return response.data;
  },

  getRevenueAnalytics: async (params = {}) => {
    const response = await api.get('/admin/analytics/revenue', { params });
    return response.data;
  },

  getUserGrowth: async (params = {}) => {
    const response = await api.get('/admin/analytics/user-growth', { params });
    return response.data;
  },

  getCategoryPerformance: async (params = {}) => {
    const response = await api.get('/admin/analytics/categories', { params });
    return response.data;
  },

  // System Settings
  getSystemSettings: async () => {
    const response = await api.get('/admin/settings');
    return response.data;
  },

  updateSystemSettings: async (settings) => {
    const response = await api.put('/admin/settings', settings);
    return response.data;
  },

  // Communication
  sendAnnouncement: async (announcement) => {
    const response = await api.post('/admin/announcements', announcement);
    return response.data;
  },

  getAnnouncements: async (params = {}) => {
    const response = await api.get('/admin/announcements', { params });
    return response.data;
  },

  // Financial
  getTransactions: async (params = {}) => {
    const response = await api.get('/admin/transactions', { params });
    return response.data;
  },

  getRevenue: async (params = {}) => {
    const response = await api.get('/admin/revenue', { params });
    return response.data;
  },

  getPayouts: async (params = {}) => {
    const response = await api.get('/admin/payouts', { params });
    return response.data;
  },

  // Content Moderation
  getReportedListings: async (params = {}) => {
    const response = await api.get('/admin/reports/listings', { params });
    return response.data;
  },

  getFlaggedUsers: async (params = {}) => {
    const response = await api.get('/admin/reports/users', { params });
    return response.data;
  },

  updateReportStatus: async (reportId, status) => {
    const response = await api.put(`/admin/reports/${reportId}`, { status });
    return response.data;
  },

  // Categories
  getCategories: async (params = {}) => {
    const response = await api.get('/admin/categories', { params });
    return response.data;
  },

  createCategory: async (category) => {
    const response = await api.post('/admin/categories', category);
    return response.data;
  },

  updateCategory: async (categoryId, category) => {
    const response = await api.put(`/admin/categories/${categoryId}`, category);
    return response.data;
  },

  deleteCategory: async (categoryId) => {
    const response = await api.delete(`/admin/categories/${categoryId}`);
    return response.data;
  },

  // Membership Plans
  getMembershipPlans: async (params = {}) => {
    const response = await api.get('/admin/membership-plans', { params });
    return response.data;
  },

  createMembershipPlan: async (plan) => {
    const response = await api.post('/admin/membership-plans', plan);
    return response.data;
  },

  updateMembershipPlan: async (planId, plan) => {
    const response = await api.put(`/admin/membership-plans/${planId}`, plan);
    return response.data;
  },

  deleteMembershipPlan: async (planId) => {
    const response = await api.delete(`/admin/membership-plans/${planId}`);
    return response.data;
  },

  // Featured Listings
  getFeaturedListings: async (params = {}) => {
    const response = await api.get('/admin/featured-listings', { params });
    return response.data;
  },

  featureListing: async (listingId, duration) => {
    const response = await api.post(`/admin/listings/${listingId}/feature`, { duration });
    return response.data;
  },

  unfeatureListing: async (listingId) => {
    const response = await api.delete(`/admin/listings/${listingId}/feature`);
    return response.data;
  },

  // Reviews
  getPendingReviews: async (params = {}) => {
    const response = await api.get('/admin/reviews/pending', { params });
    return response.data;
  },

  approveReview: async (reviewId) => {
    const response = await api.put(`/admin/reviews/${reviewId}/approve`);
    return response.data;
  },

  rejectReview: async (reviewId) => {
    const response = await api.put(`/admin/reviews/${reviewId}/reject`);
    return response.data;
  },

  // User Roles
  getUserRoles: async (params = {}) => {
    const response = await api.get('/admin/user-roles', { params });
    return response.data;
  },

  updateUserRole: async (userId, roleId) => {
    const response = await api.put(`/admin/users/${userId}/role`, { role_id: roleId });
    return response.data;
  },

  getPermissions: async (params = {}) => {
    const response = await api.get('/admin/permissions', { params });
    return response.data;
  },

  updatePermissions: async (roleId, permissions) => {
    const response = await api.put(`/admin/roles/${roleId}/permissions`, { permissions });
    return response.data;
  },

  // Email Templates
  getEmailTemplates: async (params = {}) => {
    const response = await api.get('/admin/email-templates', { params });
    return response.data;
  },

  createEmailTemplate: async (template) => {
    const response = await api.post('/admin/email-templates', template);
    return response.data;
  },

  updateEmailTemplate: async (templateId, template) => {
    const response = await api.put(`/admin/email-templates/${templateId}`, template);
    return response.data;
  },

  deleteEmailTemplate: async (templateId) => {
    const response = await api.delete(`/admin/email-templates/${templateId}`);
    return response.data;
  },

  // Backup
  createBackup: async () => {
    const response = await api.post('/admin/backup/create');
    return response.data;
  },

  getBackups: async (params = {}) => {
    const response = await api.get('/admin/backups', { params });
    return response.data;
  },

  restoreBackup: async (backupId) => {
    const response = await api.post(`/admin/backup/${backupId}/restore`);
    return response.data;
  },

  // Security
  getSecuritySettings: async () => {
    const response = await api.get('/admin/security');
    return response.data;
  },

  updateSecuritySettings: async (settings) => {
    const response = await api.put('/admin/security', settings);
    return response.data;
  },

  getSecurityLogs: async (params = {}) => {
    const response = await api.get('/admin/security/logs', { params });
    return response.data;
  },

  // API Management
  getApiKeys: async (params = {}) => {
    const response = await api.get('/admin/api-keys', { params });
    return response.data;
  },

  createApiKey: async (keyData) => {
    const response = await api.post('/admin/api-keys', keyData);
    return response.data;
  },

  deleteApiKey: async (keyId) => {
    const response = await api.delete(`/admin/api-keys/${keyId}`);
    return response.data;
  },

  getApiUsage: async (params = {}) => {
    const response = await api.get('/admin/api-usage', { params });
    return response.data;
  },

  // SEO & Marketing
  getSeoSettings: async () => {
    const response = await api.get('/admin/seo');
    return response.data;
  },

  updateSeoSettings: async (settings) => {
    const response = await api.put('/admin/seo', settings);
    return response.data;
  },

  getMarketingCampaigns: async (params = {}) => {
    const response = await api.get('/admin/campaigns', { params });
    return response.data;
  },

  createCampaign: async (campaign) => {
    const response = await api.post('/admin/campaigns', campaign);
    return response.data;
  },

  // Support
  getSupportTickets: async (params = {}) => {
    const response = await api.get('/admin/support/tickets', { params });
    return response.data;
  },

  updateTicketStatus: async (ticketId, status) => {
    const response = await api.put(`/admin/support/tickets/${ticketId}`, { status });
    return response.data;
  },

  getKnowledgeBase: async (params = {}) => {
    const response = await api.get('/admin/knowledge-base', { params });
    return response.data;
  },

  createKnowledgeArticle: async (article) => {
    const response = await api.post('/admin/knowledge-base', article);
    return response.data;
  },

  // Advanced Analytics
  getRealTimeMetrics: async () => {
    const response = await api.get('/admin/analytics/realtime');
    return response.data;
  },

  getTopPages: async (params = {}) => {
    const response = await api.get('/admin/analytics/top-pages', { params });
    return response.data;
  },

  // Multi-tenancy
  getTenants: async (params = {}) => {
    const response = await api.get('/admin/tenants', { params });
    return response.data;
  },

  createTenant: async (tenant) => {
    const response = await api.post('/admin/tenants', tenant);
    return response.data;
  },

  getResourceAllocation: async () => {
    const response = await api.get('/admin/resource-allocation');
    return response.data;
  },

  // Workflow Automation
  getAutomationRules: async (params = {}) => {
    const response = await api.get('/admin/automation/rules', { params });
    return response.data;
  },

  createAutomationRule: async (rule) => {
    const response = await api.post('/admin/automation/rules', rule);
    return response.data;
  },

  updateAutomationRule: async (ruleId, rule) => {
    const response = await api.put(`/admin/automation/rules/${ruleId}`, rule);
    return response.data;
  },

  getAutomationHistory: async (params = {}) => {
    const response = await api.get('/admin/automation/history', { params });
    return response.data;
  },

  // Mobile App
  getAppVersions: async (params = {}) => {
    const response = await api.get('/admin/mobile/versions', { params });
    return response.data;
  },

  releaseAppVersion: async (version) => {
    const response = await api.post('/admin/mobile/release', version);
    return response.data;
  },

  getAppAnalytics: async (params = {}) => {
    const response = await api.get('/admin/mobile/analytics', { params });
    return response.data;
  },

  // Legal & Compliance
  getComplianceDocuments: async (params = {}) => {
    const response = await api.get('/admin/compliance/documents', { params });
    return response.data;
  },

  uploadComplianceDocument: async (document) => {
    const response = await api.post('/admin/compliance/documents', document);
    return response.data;
  },

  getAuditTrail: async (params = {}) => {
    const response = await api.get('/admin/compliance/audit-trail', { params });
    return response.data;
  }
};

export default adminService;
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import {
  Box, Typography, TextField, Button, Card, CardContent,
  Container, Alert, AlertTitle, InputAdornment, IconButton
} from '@mui/material';
import { Visibility, VisibilityOff, Lock, AdminPanelSettings } from '@mui/icons-material';
import toast from 'react-hot-toast';

const AdminLogin = () => {
  const navigate = useNavigate();
  const [credentials, setCredentials] = useState({
    username: '',
    password: ''
  });
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleChange = (e) => {
    setCredentials({
      ...credentials,
      [e.target.name]: e.target.value
    });
    setError('');
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!credentials.username || !credentials.password) {
      setError('Please enter both username and password');
      return;
    }

    setLoading(true);
    setError('');

    try {
      // Simple admin authentication (in production, this should connect to a real backend)
      if (credentials.username === 'admin' && credentials.password === 'admin123') {
        toast.success('Login successful!');
        // Store admin session (in production, use proper JWT tokens)
        localStorage.setItem('adminAuth', 'true');
        localStorage.setItem('adminUser', credentials.username);
        navigate('/admin-panel/dashboard');
      } else {
        setError('Invalid credentials. Please try again.');
        toast.error('Login failed');
      }
    } catch (error) {
      console.error('Login error:', error);
      setError('An error occurred during login. Please try again.');
      toast.error('Login failed');
    } finally {
      setLoading(false);
    }
  };

  return (
    <Container maxWidth="sm">
      <Box sx={{ 
        minHeight: '100vh', 
        display: 'flex', 
        alignItems: 'center', 
        justifyContent: 'center',
        py: 4
      }}>
        <Card sx={{ width: '100%', maxWidth: 400 }}>
          <CardContent sx={{ p: 4 }}>
            {/* Header */}
            <Box sx={{ textAlign: 'center', mb: 4 }}>
              <AdminPanelSettings sx={{ 
                fontSize: 48, 
                color: 'primary.main', 
                mb: 2 
              }} />
              <Typography variant="h4" gutterBottom fontWeight="bold">
                Admin Panel
              </Typography>
              <Typography variant="body2" color="text.secondary">
                Enter your credentials to access the admin dashboard
              </Typography>
            </Box>

            {/* Error Alert */}
            {error && (
              <Alert severity="error" sx={{ mb: 3 }}>
                <AlertTitle>Login Error</AlertTitle>
                {error}
              </Alert>
            )}

            {/* Login Form */}
            <form onSubmit={handleSubmit}>
              <TextField
                fullWidth
                label="Username"
                name="username"
                value={credentials.username}
                onChange={handleChange}
                margin="normal"
                variant="outlined"
                required
                disabled={loading}
                autoComplete="username"
              />
              
              <TextField
                fullWidth
                label="Password"
                name="password"
                type={showPassword ? 'text' : 'password'}
                value={credentials.password}
                onChange={handleChange}
                margin="normal"
                variant="outlined"
                required
                disabled={loading}
                autoComplete="current-password"
                InputProps={{
                  endAdornment: (
                    <IconButton
                      edge="end"
                      onClick={() => setShowPassword(!showPassword)}
                      disabled={loading}
                    >
                      {showPassword ? <VisibilityOff /> : <Visibility />}
                    </IconButton>
                  ),
                }}
              />

              <Button
                type="submit"
                fullWidth
                variant="contained"
                size="large"
                sx={{ mt: 3, mb: 2 }}
                disabled={loading}
                startIcon={<Lock />}
              >
                {loading ? 'Signing in...' : 'Sign In'}
              </Button>
            </form>

            {/* Demo Credentials */}
            <Box sx={{ mt: 3, p: 2, bgcolor: 'grey.50', borderRadius: 1 }}>
              <Typography variant="caption" color="text.secondary" display="block" gutterBottom>
                <strong>Demo Credentials:</strong>
              </Typography>
              <Typography variant="caption" color="text.secondary" display="block">
                Username: <code>admin</code>
              </Typography>
              <Typography variant="caption" color="text.secondary" display="block">
                Password: <code>admin123</code>
              </Typography>
            </Box>
          </CardContent>
        </Card>
      </Box>
    </Container>
  );
};

export default AdminLogin;
import React, { useState, useEffect } from 'react';
import {
  Container, Grid, Card, Typography, Box, Chip, Button, TextField,
  InputAdornment, IconButton, useTheme, useMediaQuery, Stack,
  CircularProgress, Alert
} from '@mui/material';
import {
  Search, Clear, VerifiedUser, GridView, Architecture,
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import { useNavigate } from 'react-router-dom';
import apiService from '../services/api';

// Import Love Features
import SmartSearch from '../components/SmartSearch';
import LiveActivityIndicators from '../components/LiveActivityIndicators';
// SavedSearches removed for now

const TendersPage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('All');
  const [tenders, setTenders] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // Fetch tenders from backend
  useEffect(() => {
    const fetchTenders = async () => {
      try {
        setLoading(true);
        const params = {
          category: 'tenders',
          type: selectedCategory !== 'All' ? selectedCategory : undefined,
          search: searchQuery || undefined
        };
        const response = await apiService.getListings(params);
        setTenders(response.listings || response || []);
      } catch (err) {
        setError('Failed to load tenders');
      } finally {
        setLoading(false);
      }
    };

    fetchTenders();
  }, [selectedCategory, searchQuery]);

  const getDaysAgo = (date) => {
    const diff = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));
    if (diff === 0) return 'Just now';
    if (diff === 1) return '1 day ago';
    return `${diff} days ago`;
  };

  // Handle loading and error states
  if (loading) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  if (error) {
    return (
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Alert severity="error">{error}</Alert>
      </Container>
    );
  }

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: isMobile ? 10 : 0 }}>
      {/* Hero Section */}
      <Box sx={{
        height: isMobile ? 600 : 650,
        position: 'relative',
        backgroundImage: 'url(https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=1080)',
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: 'white',
        '&::before': {
          content: '""',
          position: 'absolute',
          top: 0, left: 0, right: 0, bottom: 0,
          background: 'linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.4), transparent)',
        }
      }}>
        <Container maxWidth="lg" sx={{ position: 'relative', zIndex: 1, textAlign: 'center' }}>
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}>
            <Typography variant={isMobile ? "h2" : "h1"} sx={{
              fontFamily: 'Playfair Display, serif',
              fontWeight: 700,
              mb: 1,
              color: theme.palette.secondary.main,
              fontSize: isMobile ? '3.25rem' : '4.5rem'
            }}>
              Tenders
            </Typography>
            <Typography variant={isMobile ? "h5" : "h4"} sx={{
              fontFamily: 'Playfair Display, serif',
              fontStyle: 'italic',
              mb: 3,
              opacity: 0.7
            }}>
              Government & Private Sector
            </Typography>
            <Typography variant={isMobile ? "body1" : "h6"} sx={{
              mb: 4,
              maxWidth: 600,
              mx: 'auto',
              opacity: 0.8,
              lineHeight: 1.6
            }}>
              Discover verified tender opportunities from government and private organizations across Ethiopia
            </Typography>

            <Box sx={{ maxWidth: 600, mx: 'auto' }}>
              <SmartSearch 
                onSearch={(query) => setSearchQuery(query)}
                placeholder="Search tenders..."
              />
            </Box>
          </motion.div>
        </Container>
      </Box>

      {/* Categories */}
      <Box sx={{ bgcolor: 'background.default', pt: 3, pb: 1 }}>
        <Box sx={{
          overflowX: 'auto',
          px: 3,
          '&::-webkit-scrollbar': { display: 'none' },
          msOverflowStyle: 'none',
          scrollbarWidth: 'none'
        }}>
          <Stack direction="row" spacing={1.5} sx={{ minWidth: 'max-content' }}>
            {['All', 'Construction', 'Technology', 'Healthcare', 'Energy', 'Education', 'Logistics', 'Agriculture'].map((category) => {
              const isSelected = selectedCategory === category;
              return (
                <Chip
                  key={category}
                  label={category}
                  onClick={() => setSelectedCategory(category)}
                  sx={{
                    bgcolor: isSelected ? 'primary.main' : 'background.paper',
                    color: isSelected ? 'primary.contrastText' : 'text.primary',
                    borderRadius: '25px',
                    px: 2,
                    py: 2.8,
                    border: isSelected ? 'none' : `1px solid ${theme.palette.divider}`,
                    fontWeight: 500,
                    fontSize: '0.8125rem',
                    boxShadow: isSelected ? `0 4px 8px ${alpha(theme.palette.primary.main, 0.3)}` : 'none',
                    '&:hover': {
                      bgcolor: isSelected ? 'primary.dark' : alpha(theme.palette.text.primary, 0.04)
                    }
                  }}
                />
              );
            })}
          </Stack>
        </Box>
      </Box>

      {/* Header */}
      <Container maxWidth="lg" sx={{ mt: 3, mb: 2 }}>
        <Stack direction="row" justifyContent="space-between" alignItems="flex-start">
          <Box>
            <Typography variant="h5" fontWeight="bold" gutterBottom>
              Active Tenders
            </Typography>
            <Box sx={{ width: 40, height: 3, bgcolor: 'primary.main', borderRadius: 1 }} />
          </Box>
          <Box sx={{ textAlign: 'right' }}>
            <Typography variant="body2" color="text.secondary" fontWeight={500}>
              {tenders.length} Results
            </Typography>
            <Typography variant="caption" color="primary.main" fontWeight={600}>
              Gov't & Private
            </Typography>
          </Box>
        </Stack>
      </Container>

      {/* Tenders Grid */}
      <Container maxWidth="lg" sx={{ pb: 4 }}>
        <Grid container spacing={2.5}>
          {tenders.map((tender, index) => (
            <Grid item xs={12} sm={6} lg={4} key={tender.id}>
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.1, duration: 0.4 }}
              >
              <Card
                onClick={() => navigate(`/listings/${tender.id}`)}
                sx={{
                  borderRadius: 4,
                  overflow: 'hidden',
                  cursor: 'pointer',
                  border: `1px solid ${alpha(theme.palette.divider, 0.5)}`,
                  transition: 'all 0.3s ease',
                  '&:hover': {
                    transform: 'translateY(-4px)',
                    boxShadow: `0 12px 40px ${alpha(theme.palette.common.black, 0.1)}`
                  }
                }}
              >
                {/* Image */}
                <Box sx={{ position: 'relative', height: 140 }}>
                  <Box
                    component="img"
                    src={tender.images?.[0] || tender.image || 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=500'}
                    alt={tender.title}
                    sx={{ width: '100%', height: '100%', objectFit: 'cover' }}
                  />
                  {/* Verified Badge */}
                  <Box sx={{
                    position: 'absolute',
                    top: 12,
                    left: 12,
                    bgcolor: 'primary.main',
                    borderRadius: 1.5,
                    px: 1,
                    py: 0.5,
                    display: 'flex',
                    alignItems: 'center',
                    gap: 0.5
                  }}>
                    <VerifiedUser sx={{ fontSize: 12, color: 'white' }} />
                    <Typography variant="caption" sx={{ color: 'white', fontWeight: 600, fontSize: '0.625rem' }}>
                      Verified
                    </Typography>
                  </Box>
                  {/* Days Ago */}
                  <Box sx={{
                    position: 'absolute',
                    bottom: 12,
                    left: 12,
                    bgcolor: alpha('#000', 0.7),
                    borderRadius: 1.5,
                    px: 1,
                    py: 0.5
                  }}>
                    <Typography variant="caption" sx={{ color: 'white', fontWeight: 600, fontSize: '0.625rem' }}>
                      {getDaysAgo(tender.created_at)}
                    </Typography>
                  </Box>
                </Box>

                {/* Content */}
                <Box sx={{ p: 2 }}>
                  <Typography variant="caption" sx={{
                    color: 'text.secondary',
                    fontWeight: 600,
                    letterSpacing: 1,
                    fontSize: '0.625rem'
                  }}>
                    {(tender.type || tender.category || 'General').toUpperCase()}
                  </Typography>
                  <Typography variant="h6" sx={{
                    fontWeight: 'bold',
                    mt: 0.75,
                    mb: 1.5,
                    lineHeight: 1.3,
                    display: '-webkit-box',
                    WebkitLineClamp: 2,
                    WebkitBoxOrient: 'vertical',
                    overflow: 'hidden',
                    minHeight: 48
                  }}>
                    {tender.title}
                  </Typography>

                  <Stack direction="row" justifyContent="space-between" alignItems="flex-end">
                    <Box>
                      <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.625rem' }}>
                        Est. Budget
                      </Typography>
                      <Typography variant="body2" fontWeight="bold" color="#27AE60">
                        {tender.price ? `ETB ${tender.price.toLocaleString()}` : 'Tender'}
                      </Typography>
                    </Box>
                    <Button
                      variant="contained"
                      size="small"
                      sx={{
                        borderRadius: 2,
                        px: 2,
                        py: 1,
                        fontSize: '0.75rem',
                        fontWeight: 600,
                        background: 'linear-gradient(135deg, #D4AF37, #B8860B)',
                        boxShadow: `0 4px 8px ${alpha('#D4AF37', 0.3)}`,
                        '&:hover': {
                          background: 'linear-gradient(135deg, #B8860B, #D4AF37)',
                        }
                      }}
                    >
                      Bid Now
                    </Button>
                  </Stack>
                </Box>
              </Card>
            </motion.div>
          </Grid>
        ))}
      </Grid>
    </Container>
  </Box>
);
};

export default TendersPage;
import React, { useState } from 'react';
import {
    Container, Typography, Box, Paper, List, ListItem, ListItemIcon, ListItemText,
    ListItemSecondaryAction, Switch, Divider, Button, Dialog, DialogTitle,
    DialogContent, DialogActions, TextField, useTheme, useMediaQuery, IconButton
} from '@mui/material';
import {
    Notifications, Lock, Language, DarkMode, Delete, Help, Info,
    ChevronRight, Security, Email, Phone
} from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';

const SettingsPage = () => {
    const theme = useTheme();
    const isMobile = useMediaQuery(theme.breakpoints.down('md'));
    const navigate = useNavigate();

    const [notifications, setNotifications] = useState({
        email: true,
        push: true,
        marketing: false
    });

    const [darkMode, setDarkMode] = useState(false);
    const [language, setLanguage] = useState('English');
    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);

    const handleToggle = (key) => {
        setNotifications({ ...notifications, [key]: !notifications[key] });
    };

    const SettingSection = ({ title, children }) => (
        <Box sx={{ mb: 4 }}>
            <Typography variant="h6" fontWeight="bold" gutterBottom color="primary" sx={{ mb: 2 }}>
                {title}
            </Typography>
            <Paper variant="outlined" sx={{ borderRadius: 3, overflow: 'hidden' }}>
                <List disablePadding>
                    {children}
                </List>
            </Paper>
        </Box>
    );

    return (
        <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: 8 }}>
            <Box sx={{ bgcolor: 'primary.main', color: 'white', py: 6 }}>
                <Container maxWidth="lg">
                    <Typography variant={isMobile ? "h4" : "h3"} fontWeight="bold" gutterBottom>
                        Settings
                    </Typography>
                    <Typography variant="body1" sx={{ opacity: 0.9 }}>
                        Manage your app preferences and account security
                    </Typography>
                </Container>
            </Box>

            <Container maxWidth="md" sx={{ mt: -4 }}>
                <Paper sx={{ p: { xs: 2, md: 4 }, borderRadius: 4 }}>

                    <SettingSection title="Account Security">
                        <ListItem button onClick={() => navigate('/change-password')}>
                            <ListItemIcon><Lock color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="Change Password"
                                secondary="Update your password securely"
                            />
                            <ChevronRight color="action" />
                        </ListItem>
                        <Divider />
                        <ListItem button>
                            <ListItemIcon><Security color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="Two-Factor Authentication"
                                secondary="Add an extra layer of security"
                            />
                            <Switch edge="end" />
                        </ListItem>
                    </SettingSection>

                    <SettingSection title="Notifications">
                        <ListItem>
                            <ListItemIcon><Email color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="Email Notifications"
                                secondary="Receive updates via email"
                            />
                            <Switch
                                edge="end"
                                checked={notifications.email}
                                onChange={() => handleToggle('email')}
                            />
                        </ListItem>
                        <Divider />
                        <ListItem>
                            <ListItemIcon><Notifications color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="Push Notifications"
                                secondary="Receive updates on your device"
                            />
                            <Switch
                                edge="end"
                                checked={notifications.push}
                                onChange={() => handleToggle('push')}
                            />
                        </ListItem>
                        <Divider />
                        <ListItem>
                            <ListItemIcon><Info color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="Marketing Emails"
                                secondary="Receive offers and promotions"
                            />
                            <Switch
                                edge="end"
                                checked={notifications.marketing}
                                onChange={() => handleToggle('marketing')}
                            />
                        </ListItem>
                    </SettingSection>

                    <SettingSection title="Preferences">
                        <ListItem button>
                            <ListItemIcon><Language color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="Language"
                                secondary={language}
                            />
                            <ChevronRight color="action" />
                        </ListItem>
                        <Divider />
                        <ListItem>
                            <ListItemIcon><DarkMode color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="Dark Mode"
                                secondary="Toggle dark theme"
                            />
                            <Switch
                                edge="end"
                                checked={darkMode}
                                onChange={() => setDarkMode(!darkMode)}
                            />
                        </ListItem>
                    </SettingSection>

                    <SettingSection title="Support & About">
                        <ListItem button>
                            <ListItemIcon><Help color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="Help Center"
                                secondary="FAQs and support"
                            />
                            <ChevronRight color="action" />
                        </ListItem>
                        <Divider />
                        <ListItem button>
                            <ListItemIcon><Info color="primary" /></ListItemIcon>
                            <ListItemText
                                primary="About Yesira Sew"
                                secondary="Version 1.0.0"
                            />
                            <ChevronRight color="action" />
                        </ListItem>
                    </SettingSection>

                    <Box sx={{ mt: 4, pt: 4, borderTop: `1px solid ${theme.palette.divider}` }}>
                        <Button
                            variant="outlined"
                            color="error"
                            startIcon={<Delete />}
                            onClick={() => setDeleteDialogOpen(true)}
                            fullWidth
                        >
                            Delete Account
                        </Button>
                    </Box>

                </Paper>
            </Container>

            {/* Delete Account Dialog */}
            <Dialog open={deleteDialogOpen} onClose={() => setDeleteDialogOpen(false)}>
                <DialogTitle sx={{ color: 'error.main' }}>Delete Account?</DialogTitle>
                <DialogContent>
                    <Typography>
                        Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently lost.
                    </Typography>
                </DialogContent>
                <DialogActions>
                    <Button onClick={() => setDeleteDialogOpen(false)}>Cancel</Button>
                    <Button color="error" variant="contained" onClick={() => setDeleteDialogOpen(false)}>
                        Delete Permanently
                    </Button>
                </DialogActions>
            </Dialog>
        </Box>
    );
};

export default SettingsPage;
import React, { useState } from 'react';
import {
  Container, Paper, Typography, TextField, Button, Box, Link, Divider,
  CircularProgress, useTheme, useMediaQuery, Stack, IconButton, InputAdornment,
  Alert, Snackbar, FormControlLabel, Checkbox, Grid, ToggleButton, ToggleButtonGroup
} from '@mui/material';
import {
  Visibility, VisibilityOff, Email, Lock, Person, ArrowBack, CheckCircle, Phone,
  Business
} from '@mui/icons-material';
import { useNavigate, Link as RouterLink } from 'react-router-dom';
import { motion } from 'framer-motion';
import toast from 'react-hot-toast';
import { alpha } from '@mui/material/styles';

const RegisterPage = () => {
  const navigate = useNavigate();
  const theme = useTheme();
  const [registerType, setRegisterType] = useState('email');
  const [accountType, setAccountType] = useState('individual');
  const [formData, setFormData] = useState({ 
    firstName: '', 
    lastName: '', 
    email: '', 
    phone: '',
    password: '', 
    confirmPassword: '',
    companyName: ''
  });
  const [loading, setLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [errors, setErrors] = useState({});
  const [showSuccess, setShowSuccess] = useState(false);
  const [agreeTerms, setAgreeTerms] = useState(false);

  const validateForm = () => {
    const newErrors = {};
    
    if (accountType === 'individual') {
      if (!formData.firstName.trim()) {
        newErrors.firstName = 'First name is required';
      }
      
      if (!formData.lastName.trim()) {
        newErrors.lastName = 'Last name is required';
      }
    } else {
      if (!formData.companyName.trim()) {
        newErrors.companyName = 'Company name is required';
      }
    }
    
    if (registerType === 'email') {
      if (!formData.email.trim()) {
        newErrors.email = 'Email is required';
      } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
        newErrors.email = 'Email is invalid';
      }
    } else {
      if (!formData.phone.trim()) {
        newErrors.phone = 'Phone number is required';
      } else if (!/^\+251\s?9\d{2}\s?\d{6}$/.test(formData.phone.replace(/\s/g, ''))) {
        newErrors.phone = 'Please enter a valid Ethiopian phone number';
      }
    }
    
    if (!formData.password.trim()) {
      newErrors.password = 'Password is required';
    } else if (formData.password.length < 6) {
      newErrors.password = 'Password must be at least 6 characters';
    }
    
    if (!formData.confirmPassword.trim()) {
      newErrors.confirmPassword = 'Please confirm your password';
    } else if (formData.password !== formData.confirmPassword) {
      newErrors.confirmPassword = 'Passwords do not match';
    }
    
    if (!agreeTerms) {
      newErrors.terms = 'You must agree to the terms and conditions';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) return;
    
    setLoading(true);
    
    // Simulate API call
    setTimeout(() => {
      setLoading(false);
      setShowSuccess(true);
      toast.success('Account created successfully!');
      
      // Store mock token
      localStorage.setItem('token', 'mock-jwt-token');
      
      setTimeout(() => {
        navigate('/');
      }, 1500);
    }, 2000);
  };

  return (
    <Box sx={{ 
      bgcolor: 'background.default', 
      minHeight: '100vh',
      backgroundImage: {
        xs: 'linear-gradient(rgba(255,255,255,0.92), rgba(255,255,255,0.92)), url("https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1080")',
        md: 'linear-gradient(rgba(255,255,255,0.95), rgba(255,255,255,0.95)), url("https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1080")'
      },
      backgroundSize: 'cover',
      backgroundPosition: 'center',
      backgroundAttachment: 'fixed',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center'
    }}>
      {/* Header */}
      <Box sx={{ 
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        zIndex: 1,
        bgcolor: 'primary.main',
        color: 'white',
        py: 2,
        boxShadow: 2
      }}>
        <Container maxWidth="lg">
          <Box sx={{ display: 'flex', alignItems: 'center' }}>
            <IconButton 
              onClick={() => navigate('/')}
              sx={{ color: 'white', mr: 2 }}
            >
              <ArrowBack />
            </IconButton>
            <Typography variant="h6" fontWeight="bold">
              Create Account
            </Typography>
          </Box>
        </Container>
      </Box>

      <Container maxWidth="sm" sx={{ pt: 8, position: 'relative', zIndex: 1 }}>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
        >
          <Paper 
            sx={{ 
              p: { xs: 3, md: 4 }, 
              borderRadius: 4,
              boxShadow: `0 8px 32px ${alpha(theme.palette.common.black, 0.1)}`,
              backdropFilter: 'blur(10px)',
              backgroundColor: alpha(theme.palette.background.paper, 0.95),
              border: `1px solid ${alpha(theme.palette.divider, 0.1)}`,
            }}
          >
            {/* Logo/Brand Section */}
            <Box sx={{ textAlign: 'center', mb: 4 }}>
              <Box sx={{
                width: 80,
                height: 80,
                bgcolor: 'primary.main',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                mx: 'auto',
                mb: 2,
                boxShadow: `0 4px 20px ${alpha(theme.palette.primary.main, 0.3)}`
              }}>
                <Typography variant="h4" color="white" fontWeight="bold">
                  YS
                </Typography>
              </Box>
              <Typography variant="h4" fontWeight="bold" gutterBottom>
                Join Yesira Sew
              </Typography>
              <Typography variant="body2" color="text.secondary">
                Create your account to start posting and discovering amazing opportunities
              </Typography>
            </Box>

            {/* Register Type Toggle */}
            <Box sx={{ mb: 3 }}>
              <Typography variant="body2" color="text.secondary" gutterBottom>
                Register with
              </Typography>
              <ToggleButtonGroup
                value={registerType}
                exclusive
                onChange={(e, newType) => {
                  if (newType !== null) {
                    setRegisterType(newType);
                    setErrors({});
                  }
                }}
                sx={{ width: '100%' }}
              >
                <ToggleButton value="email" sx={{ flex: 1 }}>
                  <Stack direction="row" spacing={1} alignItems="center">
                    <Email sx={{ fontSize: 18 }} />
                    <Typography>Email</Typography>
                  </Stack>
                </ToggleButton>
                <ToggleButton value="phone" sx={{ flex: 1 }}>
                  <Stack direction="row" spacing={1} alignItems="center">
                    <Phone sx={{ fontSize: 18 }} />
                    <Typography>Phone</Typography>
                  </Stack>
                </ToggleButton>
              </ToggleButtonGroup>
            </Box>

            {/* Account Type Toggle */}
            <Box sx={{ mb: 3 }}>
              <Typography variant="body2" color="text.secondary" gutterBottom>
                Account type
              </Typography>
              <ToggleButtonGroup
                value={accountType}
                exclusive
                onChange={(e, newType) => {
                  if (newType !== null) {
                    setAccountType(newType);
                    setErrors({});
                  }
                }}
                sx={{ width: '100%' }}
              >
                <ToggleButton value="individual" sx={{ flex: 1 }}>
                  <Stack direction="row" spacing={1} alignItems="center">
                    <Person sx={{ fontSize: 18 }} />
                    <Typography>Individual</Typography>
                  </Stack>
                </ToggleButton>
                <ToggleButton value="company" sx={{ flex: 1 }}>
                  <Stack direction="row" spacing={1} alignItems="center">
                    <Business sx={{ fontSize: 18 }} />
                    <Typography>Company</Typography>
                  </Stack>
                </ToggleButton>
              </ToggleButtonGroup>
            </Box>

            <form onSubmit={handleSubmit}>
              <Stack spacing={3}>
                {/* Name Fields or Company Name */}
                {accountType === 'individual' ? (
                  <Grid container spacing={2}>
                    <Grid item xs={12} sm={6}>
                      <TextField
                        fullWidth
                        label="First Name"
                        value={formData.firstName}
                        onChange={(e) => setFormData({ ...formData, firstName: e.target.value })}
                        error={!!errors.firstName}
                        helperText={errors.firstName}
                        disabled={loading}
                        InputProps={{
                          startAdornment: (
                            <InputAdornment position="start">
                              <Person color="primary" />
                            </InputAdornment>
                          ),
                        }}
                        sx={{
                          '& .MuiOutlinedInput-root': {
                            borderRadius: 3,
                          },
                        }}
                      />
                    </Grid>
                    <Grid item xs={12} sm={6}>
                      <TextField
                        fullWidth
                        label="Last Name"
                        value={formData.lastName}
                        onChange={(e) => setFormData({ ...formData, lastName: e.target.value })}
                        error={!!errors.lastName}
                        helperText={errors.lastName}
                        disabled={loading}
                        sx={{
                          '& .MuiOutlinedInput-root': {
                            borderRadius: 3,
                          },
                        }}
                      />
                    </Grid>
                  </Grid>
                ) : (
                  <TextField
                    fullWidth
                    label="Company Name"
                    value={formData.companyName}
                    onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}
                    error={!!errors.companyName}
                    helperText={errors.companyName}
                    disabled={loading}
                    InputProps={{
                      startAdornment: (
                        <InputAdornment position="start">
                          <Business color="primary" />
                        </InputAdornment>
                      ),
                    }}
                    sx={{
                      '& .MuiOutlinedInput-root': {
                        borderRadius: 3,
                      },
                    }}
                  />
                )}
                
                {registerType === 'email' ? (
                  <TextField
                    fullWidth
                    label="Email Address"
                    type="email"
                    value={formData.email}
                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                    error={!!errors.email}
                    helperText={errors.email}
                    disabled={loading}
                    InputProps={{
                      startAdornment: (
                        <InputAdornment position="start">
                          <Email color="primary" />
                        </InputAdornment>
                      ),
                    }}
                    sx={{
                      '& .MuiOutlinedInput-root': {
                        borderRadius: 3,
                      },
                    }}
                  />
                ) : (
                  <TextField
                    fullWidth
                    label="Phone Number"
                    value={formData.phone}
                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                    error={!!errors.phone}
                    helperText={errors.phone || 'Format: +251 9XX XXX XXX'}
                    disabled={loading}
                    placeholder="+251 911 234 567"
                    InputProps={{
                      startAdornment: (
                        <InputAdornment position="start">
                          <Phone color="primary" />
                        </InputAdornment>
                      ),
                    }}
                    sx={{
                      '& .MuiOutlinedInput-root': {
                        borderRadius: 3,
                      },
                    }}
                  />
                )}
                
                <TextField
                  fullWidth
                  label="Password"
                  type={showPassword ? 'text' : 'password'}
                  value={formData.password}
                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}
                  error={!!errors.password}
                  helperText={errors.password}
                  disabled={loading}
                  InputProps={{
                    startAdornment: (
                      <InputAdornment position="start">
                        <Lock color="primary" />
                      </InputAdornment>
                    ),
                    endAdornment: (
                      <InputAdornment position="end">
                        <IconButton
                          onClick={() => setShowPassword(!showPassword)}
                          edge="end"
                          disabled={loading}
                        >
                          {showPassword ? <VisibilityOff /> : <Visibility />}
                        </IconButton>
                      </InputAdornment>
                    ),
                  }}
                  sx={{
                    '& .MuiOutlinedInput-root': {
                      borderRadius: 3,
                    },
                  }}
                />
                
                <TextField
                  fullWidth
                  label="Confirm Password"
                  type={showConfirmPassword ? 'text' : 'password'}
                  value={formData.confirmPassword}
                  onChange={(e) => setFormData({ ...formData, confirmPassword: e.target.value })}
                  error={!!errors.confirmPassword}
                  helperText={errors.confirmPassword}
                  disabled={loading}
                  InputProps={{
                    startAdornment: (
                      <InputAdornment position="start">
                        <Lock color="primary" />
                      </InputAdornment>
                    ),
                    endAdornment: (
                      <InputAdornment position="end">
                        <IconButton
                          onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                          edge="end"
                          disabled={loading}
                        >
                          {showConfirmPassword ? <VisibilityOff /> : <Visibility />}
                        </IconButton>
                      </InputAdornment>
                    ),
                  }}
                  sx={{
                    '& .MuiOutlinedInput-root': {
                      borderRadius: 3,
                    },
                  }}
                />

                {/* Terms and Conditions */}
                <Box>
                  <FormControlLabel
                    control={
                      <Checkbox
                        checked={agreeTerms}
                        onChange={(e) => setAgreeTerms(e.target.checked)}
                        color="primary"
                        disabled={loading}
                      />
                    }
                    label={
                      <Typography variant="body2">
                        I agree to the{' '}
                        <Link 
                          href="#" 
                          color="primary"
                          sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
                        >
                          Terms of Service
                        </Link>
                        {' '}and{' '}
                        <Link 
                          href="#" 
                          color="primary"
                          sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
                        >
                          Privacy Policy
                        </Link>
                      </Typography>
                    }
                  />
                  {errors.terms && (
                    <Typography variant="caption" color="error" sx={{ mt: 1, display: 'block' }}>
                      {errors.terms}
                    </Typography>
                  )}
                </Box>

                <Button
                  type="submit"
                  fullWidth
                  variant="contained"
                  size="large"
                  disabled={loading}
                  sx={{
                    py: 1.5,
                    borderRadius: 3,
                    textTransform: 'none',
                    fontWeight: 600,
                    fontSize: '1rem',
                    background: `linear-gradient(135deg, ${theme.palette.primary.main}, ${theme.palette.primary.dark})`,
                    '&:hover': {
                      background: `linear-gradient(135deg, ${theme.palette.primary.dark}, ${theme.palette.primary.main})`,
                    },
                  }}
                >
                  {loading ? (
                    <>
                      <CircularProgress size={20} sx={{ mr: 1, color: 'white' }} />
                      Creating Account...
                    </>
                  ) : (
                    'Create Account'
                  )}
                </Button>
              </Stack>
            </form>

            <Divider sx={{ my: 3 }}>
              <Typography variant="body2" color="text.secondary">
                OR
              </Typography>
            </Divider>

            <Stack spacing={2}>
              <Button
                fullWidth
                variant="outlined"
                size="large"
                startIcon={
                  <Box sx={{ width: 20, height: 20, bgcolor: '#4285F4', borderRadius: '50%' }} />
                }
                sx={{
                  py: 1.5,
                  borderRadius: 3,
                  textTransform: 'none',
                  fontWeight: 600,
                  borderColor: alpha(theme.palette.text.primary, 0.2),
                }}
              >
                Sign up with Google
              </Button>
              
              <Button
                fullWidth
                variant="outlined"
                size="large"
                startIcon={
                  <Box sx={{ width: 20, height: 20, bgcolor: '#1877F2', borderRadius: '50%' }} />
                }
                sx={{
                  py: 1.5,
                  borderRadius: 3,
                  textTransform: 'none',
                  fontWeight: 600,
                  borderColor: alpha(theme.palette.text.primary, 0.2),
                }}
              >
                Sign up with Facebook
              </Button>
            </Stack>

            <Box sx={{ textAlign: 'center', mt: 3 }}>
              <Typography variant="body2" color="text.secondary">
                Already have an account?{' '}
                <Link 
                  component={RouterLink} 
                  to="/login"
                  color="primary"
                  fontWeight="600"
                  sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
                >
                  Sign In
                </Link>
              </Typography>
            </Box>
          </Paper>

          {/* Footer Links */}
          <Box sx={{ textAlign: 'center', mt: 3 }}>
            <Stack 
              direction={{ xs: 'column', sm: 'row' }} 
              spacing={2} 
              justifyContent="center"
              alignItems="center"
            >
              <Link 
                href="#" 
                color="text.secondary" 
                variant="caption"
                sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
              >
                Help Center
              </Link>
              <Typography variant="caption" color="text.secondary"></Typography>
              <Link 
                href="#" 
                color="text.secondary" 
                variant="caption"
                sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
              >
                Contact Support
              </Link>
            </Stack>
          </Box>
        </motion.div>
      </Container>

      {/* Success Snackbar */}
      <Snackbar
        open={showSuccess}
        autoHideDuration={3000}
        onClose={() => setShowSuccess(false)}
        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}
      >
        <Alert 
          onClose={() => setShowSuccess(false)} 
          severity="success"
          icon={<CheckCircle fontSize="inherit" />}
          sx={{ width: '100%' }}
        >
          Account created successfully! Redirecting to home...
        </Alert>
      </Snackbar>
    </Box>
  );
};

export default RegisterPage;
import React, { useState, useEffect } from 'react';
import {
  Container, Typography, Box, Grid, Card, CardContent, Button, Avatar,
  Chip, useTheme, alpha, useMediaQuery, Stack, Divider, Dialog, DialogTitle, DialogContent, TextField, DialogActions, Tabs, Tab, IconButton, CircularProgress, Alert, List, ListItemButton, ListItemAvatar, ListItemText, Badge
} from '@mui/material';
import {
  Person, Edit, LocationOn, Email, Phone, Settings, Favorite,
  ShoppingBag, History, Star, Shield, Verified, CameraAlt, CalendarToday, Logout, Description, Work, Chat, AttachMoney, Language
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { useNavigate } from 'react-router-dom';
import { formatDistanceToNow } from '../utils/dateUtils';
import apiService from '../services/api';
import toast from 'react-hot-toast';
import { useAuth } from '../context/AuthContext';

// Import Love Features
import TrustBadges from '../components/TrustBadges';
import UserReviews from '../components/UserReviews';
import GamificationRewards from '../components/GamificationRewards';
import LiveActivityIndicators from '../components/LiveActivityIndicators';
import QuickActionsToolbar from '../components/QuickActionsToolbar';

const ProfilePage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const { user: authUser, logout } = useAuth();
  const [activeTab, setActiveTab] = useState(0);
  const [editDialogOpen, setEditDialogOpen] = useState(false);
  const [user, setUser] = useState(null);
  const [userListings, setUserListings] = useState([]);
  const [userFavorites, setUserFavorites] = useState([]);
  const [userApplications, setUserApplications] = useState([]);
  const [userChats, setUserChats] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [editForm, setEditForm] = useState({});

  // Fetch user data and listings
  useEffect(() => {
    const fetchUserData = async () => {
      try {
        setLoading(true);

        // Fetch user profile
        const profileData = await apiService.getProfile();
        setUser(profileData);
        setEditForm(profileData);

        // Fetch user's listings
        const listingsData = await apiService.getListings({ author_id: authUser?.id });
        setUserListings(listingsData.listings || listingsData || []);

        // Fetch user's favorites
        const favoritesData = await apiService.getFavorites();
        setUserFavorites(favoritesData.listings || favoritesData || []);

        // Fetch user's applications
        try {
          const applicationsData = await apiService.getMyApplications();
          setUserApplications(applicationsData || []);
        } catch (e) {
        }

        // Fetch user's chats
        try {
          const chatsData = await apiService.getConversations();
          setUserChats(chatsData || []);
        } catch (e) {
        }

      } catch (err) {
        setError('Failed to load profile data');
      } finally {
        setLoading(false);
      }
    };

    if (authUser) {
      fetchUserData();
    }
  }, [authUser]);

  const handleSaveProfile = async () => {
    try {
      const updatedUser = await apiService.updateProfile(editForm);
      setUser(updatedUser);
      setEditDialogOpen(false);
      toast.success('Profile updated successfully!');
    } catch (error) {
      toast.error('Failed to update profile');
    }
  };

  const handleLogout = () => {
    logout();
    navigate('/');
  };

  const renderListings = () => (
    <Grid container spacing={3}>
      {userListings.length === 0 ? (
        <Grid item xs={12}>
          <Typography variant="body1" color="text.secondary" textAlign="center">
            You haven't posted any listings yet.
          </Typography>
        </Grid>
      ) : (
        userListings.map((listing) => (
          <Grid item xs={12} md={6} lg={4} key={listing.id}>
            <Card sx={{ height: '100%' }}>
              <CardContent>
                <Typography variant="h6" gutterBottom>
                  {listing.title}
                </Typography>
                <Typography variant="body2" color="text.secondary" gutterBottom>
                  {listing.description?.substring(0, 100)}...
                </Typography>
                <Stack direction="row" spacing={2} alignItems="center" sx={{ mt: 1 }}>
                  <Chip label={listing.status} size="small" color={listing.status === 'approved' ? 'success' : 'warning'} />
                  <Typography variant="caption" color="text.secondary">
                    Posted {listing.created_at ? formatDistanceToNow(new Date(listing.created_at), { addSuffix: true }) : 'recently'}
                  </Typography>
                </Stack>
              </CardContent>
            </Card>
          </Grid>
        ))
      )}
    </Grid>
  );

  const renderFavorites = () => (
    <Grid container spacing={3}>
      {userFavorites.length === 0 ? (
        <Grid item xs={12}>
          <Typography variant="body1" color="text.secondary" textAlign="center">
            You haven't favorited any listings yet.
          </Typography>
        </Grid>
      ) : (
        userFavorites.map((listing) => (
          <Grid item xs={12} md={6} lg={4} key={listing.id}>
            <Card sx={{ height: '100%' }}>
              <CardContent>
                <Typography variant="h6" gutterBottom>
                  {listing.title}
                </Typography>
                <Typography variant="body2" color="text.secondary" gutterBottom>
                  {listing.description?.substring(0, 100)}...
                </Typography>
                <Typography variant="caption" color="text.secondary">
                  Favorited {listing.favorited_at ? formatDistanceToNow(new Date(listing.favorited_at), { addSuffix: true }) : 'recently'}
                </Typography>
              </CardContent>
            </Card>
          </Grid>
        ))
      )}
    </Grid>
  );

  const renderApplications = () => (
    <Grid container spacing={3}>
      {userApplications.length === 0 ? (
        <Grid item xs={12}>
          <Typography variant="body1" color="text.secondary" textAlign="center">
            You haven't applied to any jobs yet.
          </Typography>
        </Grid>
      ) : (
        userApplications.map((app) => (
          <Grid item xs={12} md={6} key={app.id}>
            <Card>
              <CardContent>
                <Typography variant="h6" gutterBottom>
                  {app.job_title || 'Job Application'}
                </Typography>
                <Typography variant="body2" color="text.secondary" gutterBottom>
                  {app.company_name || 'Company'}
                </Typography>
                <Stack direction="row" spacing={2} alignItems="center" sx={{ mt: 1 }}>
                  <Chip label={app.status} size="small" color={app.status === 'accepted' ? 'success' : 'warning'} />
                  <Typography variant="caption" color="text.secondary">
                    Applied {app.created_at ? formatDistanceToNow(new Date(app.created_at), { addSuffix: true }) : 'recently'}
                  </Typography>
                </Stack>
              </CardContent>
            </Card>
          </Grid>
        ))
      )}
    </Grid>
  );

  const renderChats = () => (
    <List>
      {userChats.length === 0 ? (
        <Typography variant="body1" color="text.secondary" textAlign="center">No conversations yet.</Typography>
      ) : (
        userChats.map((chat) => {
          const otherParticipant = chat.participants?.find(p => p.id !== user?.id) || chat.participants?.[0];
          return (
            <ListItemButton key={chat.id} sx={{ borderRadius: 2, mb: 1 }} onClick={() => navigate('/chat')}>
              <ListItemAvatar>
                <Badge badgeContent={chat.unreadCount} color="error">
                  <Avatar src={otherParticipant?.avatarUrl}>{otherParticipant?.fullName?.[0]}</Avatar>
                </Badge>
              </ListItemAvatar>
              <ListItemText
                primary={otherParticipant?.fullName}
                secondary={chat.lastMessage?.content || 'No messages'}
                secondaryTypographyProps={{
                  noWrap: true,
                  sx: { maxWidth: 200 }
                }}
              />
              <Typography variant="caption" color="text.secondary">
                {chat.lastMessage?.createdAt ? formatDistanceToNow(new Date(chat.lastMessage.createdAt), { addSuffix: true }) : ''}
              </Typography>
            </ListItemButton>
          );
        })
      )}
    </List>
  );

  if (loading) {
    return (
      <Box display="flex" justifyContent="center" alignItems="center" minHeight="100vh">
        <CircularProgress />
      </Box>
    );
  }

  if (error || !user) {
    return (
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Alert severity="error">{error || 'User not found'}</Alert>
      </Container>
    );
  }

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: isMobile ? 10 : 4 }}>
      {/* Quick Actions Toolbar */}
      <QuickActionsToolbar />
      
      {/* Header */}
      <Box sx={{ bgcolor: 'primary.main', color: 'white', py: 6 }}>
        <Container maxWidth="lg">
          <Stack direction={{ xs: 'column', md: 'row' }} spacing={3} alignItems="center">
            <Box sx={{ position: 'relative' }}>
              <Avatar
                src={user.avatarUrl}
                sx={{
                  width: 120,
                  height: 120,
                  fontSize: '3rem',
                  bgcolor: 'white',
                  color: 'primary.main',
                  border: '4px solid white'
                }}
              >
                {user.fullName?.[0]}
              </Avatar>
              <IconButton
                sx={{
                  position: 'absolute',
                  bottom: 0,
                  right: 0,
                  bgcolor: 'white',
                  '&:hover': { bgcolor: 'grey.100' }
                }}
                size="small"
              >
                <CameraAlt color="primary" />
              </IconButton>
            </Box>
            <Box sx={{ flex: 1, textAlign: { xs: 'center', md: 'left' } }}>
              <Stack direction="row" spacing={1} alignItems="center" justifyContent={{ xs: 'center', md: 'flex-start' }}>
                <Typography variant="h4" fontWeight="bold">
                  {user.fullName}
                </Typography>
                {user.verified && <Verified sx={{ color: 'white' }} />}
              </Stack>
              <Typography variant="body1" sx={{ opacity: 0.9, mt: 0.5 }}>
                {user.bio || 'No bio provided'}
              </Typography>
              <Stack direction="row" spacing={2} sx={{ mt: 2 }} flexWrap="wrap" justifyContent={{ xs: 'center', md: 'flex-start' }}>
                <Stack direction="row" spacing={0.5} alignItems="center">
                  <LocationOn sx={{ fontSize: 18 }} />
                  <Typography variant="body2">{user.location || 'Location not set'}</Typography>
                </Stack>
                <Stack direction="row" spacing={0.5} alignItems="center">
                  <CalendarToday sx={{ fontSize: 18 }} />
                  <Typography variant="body2">Member since {user.createdAt ? new Date(user.createdAt).getFullYear() : '2024'}</Typography>
                </Stack>
                <Stack direction="row" spacing={0.5} alignItems="center">
                  <Star sx={{ fontSize: 18 }} />
                  <Typography variant="body2">{user.rating || '0.0'} ({user.reviewsCount || 0} reviews)</Typography>
                </Stack>
              </Stack>
            </Box>
            <Stack spacing={1}>
              <Button
                variant="contained"
                startIcon={<Edit />}
                onClick={() => setEditDialogOpen(true)}
                sx={{ bgcolor: 'white', color: 'primary.main', '&:hover': { bgcolor: 'grey.100' } }}
              >
                Edit Profile
              </Button>
              <Button
                variant="outlined"
                startIcon={<Logout />}
                onClick={handleLogout}
                sx={{ borderColor: 'white', color: 'white', '&:hover': { borderColor: 'white', bgcolor: alpha('#fff', 0.1) } }}
              >
                Logout
              </Button>
            </Stack>
          </Stack>
        </Container>
      </Box>

      <Container maxWidth="lg" sx={{ mt: 4 }}>
        {/* Trust Badges & Gamification Row */}
        <Grid container spacing={3} sx={{ mb: 4 }}>
          <Grid item xs={12} md={6}>
            <TrustBadges user={user} />
          </Grid>
          <Grid item xs={12} md={6}>
            <GamificationRewards userId={user.id} />
          </Grid>
        </Grid>

        {/* User Reviews Section */}
        <Box sx={{ mb: 4 }}>
          <UserReviews userId={user.id} userType="seller" />
        </Box>

        {/* Tabs */}
        <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 3 }}>
          <Tabs
            value={activeTab}
            onChange={(e, newValue) => setActiveTab(newValue)}
            variant={isMobile ? 'scrollable' : 'standard'}
            scrollButtons="auto"
          >
            <Tab icon={<Description />} label="My Listings" iconPosition="start" />
            <Tab icon={<Favorite />} label="Favorites" iconPosition="start" />
            <Tab icon={<Work />} label="Applications" iconPosition="start" />
            <Tab icon={<Chat />} label="Chats" iconPosition="start" />
            <Tab icon={<AttachMoney />} label="Pricing" iconPosition="start" onClick={() => navigate('/pricing')} />
          </Tabs>
        </Box>

        {/* Tab Content */}
        <Box sx={{ mt: 3 }}>
          {activeTab === 0 && renderListings()}
          {activeTab === 1 && renderFavorites()}
          {activeTab === 2 && renderApplications()}
          {activeTab === 3 && renderChats()}
        </Box>
      </Container>

      {/* Edit Profile Dialog */}
      <Dialog open={editDialogOpen} onClose={() => setEditDialogOpen(false)} maxWidth="sm" fullWidth>
        <DialogTitle>Edit Profile</DialogTitle>
        <DialogContent>
          <Stack spacing={2} sx={{ mt: 1 }}>
            <TextField
              fullWidth
              label="Full Name"
              value={editForm.fullName || ''}
              onChange={(e) => setEditForm({ ...editForm, fullName: e.target.value })}
            />
            <TextField
              fullWidth
              label="Email"
              type="email"
              value={editForm.email || ''}
              onChange={(e) => setEditForm({ ...editForm, email: e.target.value })}
              InputProps={{
                startAdornment: <Email sx={{ mr: 1, color: 'text.secondary' }} />
              }}
            />
            <TextField
              fullWidth
              label="Phone"
              value={editForm.phoneNumber || ''}
              onChange={(e) => setEditForm({ ...editForm, phoneNumber: e.target.value })}
              InputProps={{
                startAdornment: <Phone sx={{ mr: 1, color: 'text.secondary' }} />
              }}
            />
            <TextField
              fullWidth
              label="Location"
              value={editForm.location || ''}
              onChange={(e) => setEditForm({ ...editForm, location: e.target.value })}
              InputProps={{
                startAdornment: <LocationOn sx={{ mr: 1, color: 'text.secondary' }} />
              }}
            />
            <TextField
              fullWidth
              label="Bio"
              multiline
              rows={3}
              value={editForm.bio || ''}
              onChange={(e) => setEditForm({ ...editForm, bio: e.target.value })}
            />
            <TextField
              fullWidth
              label="Website"
              value={editForm.website || ''}
              onChange={(e) => setEditForm({ ...editForm, website: e.target.value })}
              InputProps={{
                startAdornment: <Language sx={{ mr: 1, color: 'text.secondary' }} />
              }}
            />
          </Stack>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setEditDialogOpen(false)}>Cancel</Button>
          <Button onClick={handleSaveProfile} variant="contained">Save Changes</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};
export default ProfilePage;
import React, { useState, useEffect } from 'react';
import {
    Box,
    Container,
    Typography,
    Card,
    CardContent,
    CardActions,
    Button,
    Grid,
    List,
    ListItem,
    ListItemIcon,
    ListItemText,
    Chip,
    CircularProgress,
    useTheme
} from '@mui/material';
import { CheckCircle, Star } from '@mui/icons-material';
import { useAuth } from '../context/AuthContext';
import apiService from '../services/api';
import toast from 'react-hot-toast';

const PricingPage = () => {
    const theme = useTheme();
    const { user, refreshUser } = useAuth();
    const [loadingPlan, setLoadingPlan] = useState(null);

    const plans = [
        {
            name: 'Free',
            price: '0 ETB',
            features: [
                'Post up to 3 listings',
                'Basic visibility',
                'Standard support'
            ],
            color: theme.palette.grey[500]
        },
        {
            name: 'Standard',
            price: '499 ETB',
            features: [
                'Post up to 10 listings',
                'Priority visibility',
                'Email support',
                'Analytics dashboard'
            ],
            recommended: true,
            color: theme.palette.primary.main
        },
        {
            name: 'Premium',
            price: '999 ETB',
            features: [
                'Unlimited listings',
                'Top of search results',
                '24/7 Priority support',
                'Advanced analytics',
                'Verified badge'
            ],
            color: theme.palette.secondary.main
        }
    ];

    const handlePlanSelect = async (plan) => {
        if (user?.subscription?.plan === plan.name) return;

        setLoadingPlan(plan.name);
        try {
            if (plan.name === 'Free') {
                await apiService.updateSubscription(plan.name);
                toast.success(`Successfully switched to ${plan.name} plan`);
                await refreshUser();
            } else {
                // Initialize payment
                const txRef = `tx-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
                const response = await apiService.initializePayment({
                    planName: plan.name,
                    amount: plan.price.replace(' ETB', ''),
                    txRef
                });

                if (response.checkoutUrl) {
                    window.location.href = response.checkoutUrl;
                } else {
                    // Fallback if no checkout URL (e.g. mock payment)
                    await apiService.updateSubscription(plan.name);
                    toast.success(`Successfully upgraded to ${plan.name} plan`);
                    await refreshUser();
                }
            }
        } catch (error) {
            toast.error(error.message || 'Failed to update plan');
        } finally {
            setLoadingPlan(null);
        }
    };

    return (
        <Container maxWidth="lg" sx={{ py: 8 }}>
            <Box textAlign="center" mb={8}>
                <Typography variant="h2" component="h1" gutterBottom fontWeight="bold">
                    Simple, Transparent Pricing
                </Typography>
                <Typography variant="h5" color="text.secondary">
                    Choose the plan that fits your needs
                </Typography>
            </Box>

            <Grid container spacing={4} alignItems="flex-end">
                {plans.map((plan) => (
                    <Grid item key={plan.name} xs={12} md={4}>
                        <Card
                            sx={{
                                height: '100%',
                                display: 'flex',
                                flexDirection: 'column',
                                position: 'relative',
                                border: plan.recommended ? `2px solid ${theme.palette.primary.main}` : 'none',
                                transform: plan.recommended ? 'scale(1.05)' : 'none',
                                transition: 'transform 0.3s ease-in-out',
                                '&:hover': {
                                    transform: plan.recommended ? 'scale(1.08)' : 'scale(1.03)',
                                    boxShadow: theme.shadows[10]
                                }
                            }}
                        >
                            {plan.recommended && (
                                <Chip
                                    label="Recommended"
                                    color="primary"
                                    sx={{
                                        position: 'absolute',
                                        top: 16,
                                        right: 16,
                                        fontWeight: 'bold'
                                    }}
                                />
                            )}
                            <CardContent sx={{ flexGrow: 1, p: 4 }}>
                                <Typography component="h2" variant="h4" color="text.primary" gutterBottom fontWeight="bold">
                                    {plan.name}
                                </Typography>
                                <Box sx={{ display: 'flex', alignItems: 'baseline', mb: 4 }}>
                                    <Typography component="h3" variant="h3" color="text.primary" fontWeight="bold">
                                        {plan.price}
                                    </Typography>
                                    <Typography variant="h6" color="text.secondary" sx={{ ml: 1 }}>
                                        /month
                                    </Typography>
                                </Box>
                                <List>
                                    {plan.features.map((feature) => (
                                        <ListItem key={feature} disableGutters>
                                            <ListItemIcon sx={{ minWidth: 40 }}>
                                                <CheckCircle color="primary" />
                                            </ListItemIcon>
                                            <ListItemText primary={feature} />
                                        </ListItem>
                                    ))}
                                </List>
                            </CardContent>
                            <CardActions sx={{ p: 4, pt: 0 }}>
                                <Button
                                    fullWidth
                                    variant={plan.recommended ? 'contained' : 'outlined'}
                                    size="large"
                                    onClick={() => handlePlanSelect(plan)}
                                    disabled={loadingPlan !== null || user?.subscription?.plan === plan.name}
                                    sx={{ py: 1.5 }}
                                >
                                    {loadingPlan === plan.name ? (
                                        <CircularProgress size={24} />
                                    ) : user?.subscription?.plan === plan.name ? (
                                        'Current Plan'
                                    ) : (
                                        'Choose Plan'
                                    )}
                                </Button>
                            </CardActions>
                        </Card>
                    </Grid>
                ))}
            </Grid>
        </Container>
    );
};

export default PricingPage;
import React, { useState } from 'react';
import {
  Container, Paper, Typography, Box, Stepper, Step, StepLabel, Button,
  Grid, TextField, MenuItem, FormControl, InputLabel, Select, Stack,
  Card, CardContent, IconButton, useTheme, useMediaQuery, InputAdornment
} from '@mui/material';
import {
  CloudUpload, Delete, DirectionsCar, Home, Work, Gavel,
  CheckCircle, ArrowBack, ArrowForward, AttachMoney, LocationOn
} from '@mui/icons-material';
import { motion, AnimatePresence } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import { useNavigate } from 'react-router-dom';
import toast from 'react-hot-toast';
import apiService from '../services/api';

const CATEGORIES = [
  { id: '1', label: 'Homes', icon: <Home sx={{ fontSize: 40 }} /> },
  { id: '2', label: 'Cars', icon: <DirectionsCar sx={{ fontSize: 40 }} /> },
  { id: '3', label: 'Jobs', icon: <Work sx={{ fontSize: 40 }} /> },
  { id: '4', label: 'Tenders', icon: <Gavel sx={{ fontSize: 40 }} /> }
];

const STEPS = ['Select Category', 'Basic Details', 'Specifics', 'Images', 'Review'];

const PostAdPage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const [activeStep, setActiveStep] = useState(0);
  const [loading, setLoading] = useState(false);

  const [formData, setFormData] = useState({
    category: '',
    title: '',
    price: '',
    location: '',
    description: '',
    // Specifics
    bedrooms: '',
    bathrooms: '',
    area: '',
    make: '',
    model: '',
    year: '',
    transmission: '',
    fuel: '',
    jobType: '',
    experience: '',
    deadline: '',
    // Images
    images: []
  });

  const handleNext = () => {
    if (activeStep === STEPS.length - 1) {
      handleSubmit();
    } else {
      setActiveStep((prev) => prev + 1);
    }
  };

  const handleBack = () => {
    setActiveStep((prev) => prev - 1);
  };

  const handleSubmit = async () => {
    setLoading(true);
    try {
      // Prepare data for API matching backend structure
      const listingData = {
        category_id: formData.category, // Backend expects category_id
        title: formData.title,
        description: formData.description,
        price: parseFloat(formData.price) || 0,
        city: formData.location, // Map location to city
        specific_location: formData.location,
        type: 'sale', // Default type
        // Add category-specific fields
        ...(formData.category === '1' && {
          bedrooms: parseInt(formData.bedrooms) || null,
          bathrooms: parseInt(formData.bathrooms) || null,
          area_sqft: parseInt(formData.area) || null,
          property_type: 'apartment', // Default property type
        }),
        ...(formData.category === '2' && {
          make: formData.make,
          model: formData.model,
          year: parseInt(formData.year) || new Date().getFullYear(),
          transmission: formData.transmission,
          fuel: formData.fuel
        }),
        ...(formData.category === '3' && {
          jobType: formData.jobType,
          experience: formData.experience,
          deadline: formData.deadline
        }),
        ...(formData.category === '4' && {
          deadline: formData.deadline
        })
      };

      // Send to backend
      const response = await apiService.createListing(listingData);
      
      setLoading(false);
      toast.success('Listing posted successfully! It will be reviewed shortly.');
      navigate('/profile');
    } catch (error) {
      setLoading(false);
      toast.error('Failed to post listing. Please try again.');
      console.error('Error posting listing:', error);
    }
  };

  const handleImageUpload = (e) => {
    const files = Array.from(e.target.files);
    const newImages = files.map(file => URL.createObjectURL(file));
    setFormData({ ...formData, images: [...formData.images, ...newImages] });
  };

  const removeImage = (index) => {
    const newImages = formData.images.filter((_, i) => i !== index);
    setFormData({ ...formData, images: newImages });
  };

  const renderCategorySelection = () => (
    <Grid container spacing={3}>
      {CATEGORIES.map((cat) => (
        <Grid item xs={6} md={3} key={cat.id}>
          <Card
            onClick={() => setFormData({ ...formData, category: cat.id })}
            sx={{
              cursor: 'pointer',
              textAlign: 'center',
              p: 3,
              border: formData.category === cat.id ? `2px solid ${theme.palette.primary.main}` : `1px solid ${theme.palette.divider}`,
              bgcolor: formData.category === cat.id ? alpha(theme.palette.primary.main, 0.05) : 'background.paper',
              transition: 'all 0.2s',
              '&:hover': { transform: 'translateY(-4px)', boxShadow: 4 }
            }}
          >
            <Box sx={{ color: formData.category === cat.id ? 'primary.main' : 'text.secondary', mb: 2 }}>
              {cat.icon}
            </Box>
            <Typography variant="h6" fontWeight="bold" color={formData.category === cat.id ? 'primary.main' : 'text.primary'}>
              {cat.label}
            </Typography>
          </Card>
        </Grid>
      ))}
    </Grid>
  );

  const renderBasicDetails = () => (
    <Stack spacing={3}>
      <TextField
        fullWidth
        label="Listing Title"
        value={formData.title}
        onChange={(e) => setFormData({ ...formData, title: e.target.value })}
        placeholder="e.g., 3 Bedroom Apartment in Bole"
      />
      <Grid container spacing={3}>
        <Grid item xs={12} md={6}>
          <TextField
            fullWidth
            label="Price"
            type="number"
            value={formData.price}
            onChange={(e) => setFormData({ ...formData, price: e.target.value })}
            InputProps={{
              startAdornment: <InputAdornment position="start">ETB</InputAdornment>
            }}
          />
        </Grid>
        <Grid item xs={12} md={6}>
          <TextField
            fullWidth
            label="Location"
            value={formData.location}
            onChange={(e) => setFormData({ ...formData, location: e.target.value })}
            InputProps={{
              startAdornment: <InputAdornment position="start"><LocationOn /></InputAdornment>
            }}
          />
        </Grid>
      </Grid>
      <TextField
        fullWidth
        label="Description"
        multiline
        rows={6}
        value={formData.description}
        onChange={(e) => setFormData({ ...formData, description: e.target.value })}
        placeholder="Describe your listing in detail..."
      />
    </Stack>
  );

  const renderSpecifics = () => {
    switch (formData.category) {
      case 'homes':
        return (
          <Grid container spacing={3}>
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                label="Bedrooms"
                type="number"
                value={formData.bedrooms}
                onChange={(e) => setFormData({ ...formData, bedrooms: e.target.value })}
              />
            </Grid>
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                label="Bathrooms"
                type="number"
                value={formData.bathrooms}
                onChange={(e) => setFormData({ ...formData, bathrooms: e.target.value })}
              />
            </Grid>
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                label="Area (sqm)"
                type="number"
                value={formData.area}
                onChange={(e) => setFormData({ ...formData, area: e.target.value })}
              />
            </Grid>
          </Grid>
        );
      case 'cars':
        return (
          <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                label="Make"
                value={formData.make}
                onChange={(e) => setFormData({ ...formData, make: e.target.value })}
              />
            </Grid>
            <Grid item xs={12} md={6}>
              <TextField
                fullWidth
                label="Model"
                value={formData.model}
                onChange={(e) => setFormData({ ...formData, model: e.target.value })}
              />
            </Grid>
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                label="Year"
                type="number"
                value={formData.year}
                onChange={(e) => setFormData({ ...formData, year: e.target.value })}
              />
            </Grid>
            <Grid item xs={12} md={4}>
              <FormControl fullWidth>
                <InputLabel>Transmission</InputLabel>
                <Select
                  value={formData.transmission}
                  label="Transmission"
                  onChange={(e) => setFormData({ ...formData, transmission: e.target.value })}
                >
                  <MenuItem value="Automatic">Automatic</MenuItem>
                  <MenuItem value="Manual">Manual</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={4}>
              <FormControl fullWidth>
                <InputLabel>Fuel Type</InputLabel>
                <Select
                  value={formData.fuel}
                  label="Fuel Type"
                  onChange={(e) => setFormData({ ...formData, fuel: e.target.value })}
                >
                  <MenuItem value="Petrol">Petrol</MenuItem>
                  <MenuItem value="Diesel">Diesel</MenuItem>
                  <MenuItem value="Electric">Electric</MenuItem>
                  <MenuItem value="Hybrid">Hybrid</MenuItem>
                </Select>
              </FormControl>
            </Grid>
          </Grid>
        );
      case 'jobs':
        return (
          <Grid container spacing={3}>
            <Grid item xs={12} md={6}>
              <FormControl fullWidth>
                <InputLabel>Job Type</InputLabel>
                <Select
                  value={formData.jobType}
                  label="Job Type"
                  onChange={(e) => setFormData({ ...formData, jobType: e.target.value })}
                >
                  <MenuItem value="Full-time">Full-time</MenuItem>
                  <MenuItem value="Part-time">Part-time</MenuItem>
                  <MenuItem value="Contract">Contract</MenuItem>
                  <MenuItem value="Freelance">Freelance</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={6}>
              <FormControl fullWidth>
                <InputLabel>Experience Level</InputLabel>
                <Select
                  value={formData.experience}
                  label="Experience Level"
                  onChange={(e) => setFormData({ ...formData, experience: e.target.value })}
                >
                  <MenuItem value="Entry">Entry Level</MenuItem>
                  <MenuItem value="Mid">Mid Level</MenuItem>
                  <MenuItem value="Senior">Senior Level</MenuItem>
                  <MenuItem value="Executive">Executive</MenuItem>
                </Select>
              </FormControl>
            </Grid>
          </Grid>
        );
      default:
        return (
          <Typography color="text.secondary" align="center">
            No specific details needed for this category.
          </Typography>
        );
    }
  };

  const renderImages = () => (
    <Box>
      <Box
        sx={{
          border: `2px dashed ${theme.palette.divider}`,
          borderRadius: 2,
          p: 4,
          textAlign: 'center',
          cursor: 'pointer',
          bgcolor: alpha(theme.palette.primary.main, 0.02),
          '&:hover': { bgcolor: alpha(theme.palette.primary.main, 0.05) }
        }}
        component="label"
      >
        <input
          type="file"
          hidden
          multiple
          accept="image/*"
          onChange={handleImageUpload}
        />
        <CloudUpload sx={{ fontSize: 48, color: 'primary.main', mb: 2 }} />
        <Typography variant="h6" gutterBottom>
          Click to upload images
        </Typography>
        <Typography variant="body2" color="text.secondary">
          JPG, PNG or GIF (Max 5MB)
        </Typography>
      </Box>

      {formData.images.length > 0 && (
        <Grid container spacing={2} sx={{ mt: 3 }}>
          {formData.images.map((img, index) => (
            <Grid item xs={6} sm={4} md={3} key={index}>
              <Box sx={{ position: 'relative', paddingTop: '100%' }}>
                <Box
                  component="img"
                  src={img}
                  sx={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    width: '100%',
                    height: '100%',
                    objectFit: 'cover',
                    borderRadius: 2
                  }}
                />
                <IconButton
                  size="small"
                  onClick={() => removeImage(index)}
                  sx={{
                    position: 'absolute',
                    top: 8,
                    right: 8,
                    bgcolor: 'error.main',
                    color: 'white',
                    '&:hover': { bgcolor: 'error.dark' }
                  }}
                >
                  <Delete fontSize="small" />
                </IconButton>
              </Box>
            </Grid>
          ))}
        </Grid>
      )}
    </Box>
  );

  const renderReview = () => (
    <Stack spacing={3}>
      <Card variant="outlined">
        <CardContent>
          <Typography variant="h6" gutterBottom color="primary">
            Basic Information
          </Typography>
          <Grid container spacing={2}>
            <Grid item xs={12} sm={6}>
              <Typography variant="subtitle2" color="text.secondary">Title</Typography>
              <Typography variant="body1">{formData.title}</Typography>
            </Grid>
            <Grid item xs={12} sm={6}>
              <Typography variant="subtitle2" color="text.secondary">Price</Typography>
              <Typography variant="body1">ETB {formData.price}</Typography>
            </Grid>
            <Grid item xs={12} sm={6}>
              <Typography variant="subtitle2" color="text.secondary">Category</Typography>
              <Typography variant="body1" sx={{ textTransform: 'capitalize' }}>{formData.category}</Typography>
            </Grid>
            <Grid item xs={12} sm={6}>
              <Typography variant="subtitle2" color="text.secondary">Location</Typography>
              <Typography variant="body1">{formData.location}</Typography>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      <Card variant="outlined">
        <CardContent>
          <Typography variant="h6" gutterBottom color="primary">
            Description
          </Typography>
          <Typography variant="body2" sx={{ whiteSpace: 'pre-line' }}>
            {formData.description}
          </Typography>
        </CardContent>
      </Card>

      {formData.images.length > 0 && (
        <Card variant="outlined">
          <CardContent>
            <Typography variant="h6" gutterBottom color="primary">
              Images ({formData.images.length})
            </Typography>
            <Stack direction="row" spacing={2} sx={{ overflowX: 'auto', pb: 1 }}>
              {formData.images.map((img, idx) => (
                <Box
                  key={idx}
                  component="img"
                  src={img}
                  sx={{ width: 100, height: 100, borderRadius: 1, objectFit: 'cover', flexShrink: 0 }}
                />
              ))}
            </Stack>
          </CardContent>
        </Card>
      )}
    </Stack>
  );

  const getStepContent = (step) => {
    switch (step) {
      case 0: return renderCategorySelection();
      case 1: return renderBasicDetails();
      case 2: return renderSpecifics();
      case 3: return renderImages();
      case 4: return renderReview();
      default: return 'Unknown step';
    }
  };

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: 8 }}>
      <Box sx={{ bgcolor: 'primary.main', color: 'white', py: 6 }}>
        <Container maxWidth="lg">
          <Typography variant={isMobile ? "h4" : "h3"} fontWeight="bold" gutterBottom>
            Post New Ad
          </Typography>
          <Typography variant="body1" sx={{ opacity: 0.9 }}>
            Reach thousands of buyers in minutes
          </Typography>
        </Container>
      </Box>

      <Container maxWidth="md" sx={{ mt: -4 }}>
        <Paper sx={{ p: { xs: 2, md: 4 }, borderRadius: 4 }}>
          <Stepper activeStep={activeStep} alternativeLabel sx={{ mb: 4 }}>
            {STEPS.map((label) => (
              <Step key={label}>
                <StepLabel>{label}</StepLabel>
              </Step>
            ))}
          </Stepper>

          <AnimatePresence mode="wait">
            <motion.div
              key={activeStep}
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
              transition={{ duration: 0.3 }}
            >
              <Box sx={{ minHeight: 300 }}>
                {getStepContent(activeStep)}
              </Box>
            </motion.div>
          </AnimatePresence>

          <Box sx={{ display: 'flex', justifyContent: 'space-between', mt: 6, pt: 2, borderTop: `1px solid ${theme.palette.divider}` }}>
            <Button
              disabled={activeStep === 0}
              onClick={handleBack}
              startIcon={<ArrowBack />}
              sx={{ px: 3 }}
            >
              Back
            </Button>
            <Button
              variant="contained"
              onClick={handleNext}
              endIcon={activeStep === STEPS.length - 1 ? <CheckCircle /> : <ArrowForward />}
              disabled={activeStep === 0 && !formData.category}
              sx={{ px: 4, borderRadius: 3 }}
            >
              {activeStep === STEPS.length - 1 ? (loading ? 'Posting...' : 'Post Ad') : 'Next'}
            </Button>
          </Box>
        </Paper>
      </Container>
    </Box>
  );
};

export default PostAdPage;
import React, { useState, useEffect } from 'react';
import {
    Container,
    Typography,
    List,
    ListItem,
    ListItemAvatar,
    ListItemText,
    Avatar,
    IconButton,
    Paper,
    Box,
    Button,
    Divider,
    CircularProgress
} from '@mui/material';
import {
    Notifications as NotificationsIcon,
    CheckCircle,
    Delete,
    Message,
    LocalOffer,
    Info
} from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';
import apiService from '../services/api';
import { formatDistanceToNow } from '../utils/dateUtils';

const NotificationsPage = () => {
    const navigate = useNavigate();
    const [notifications, setNotifications] = useState([]);
    const [loading, setLoading] = useState(true);

    useEffect(() => {
        fetchNotifications();
    }, []);

    const fetchNotifications = async () => {
        try {
            const data = await apiService.getNotifications();
            setNotifications(data);
        } catch (error) {
        } finally {
            setLoading(false);
        }
    };

    const handleMarkAllRead = async () => {
        try {
            await apiService.markAllNotificationsAsRead();
            setNotifications(notifications.map(n => ({ ...n, read: true })));
        } catch (error) {
        }
    };

    const handleNotificationClick = async (notification) => {
        if (!notification.read) {
            try {
                await apiService.markNotificationAsRead(notification.id);
                setNotifications(notifications.map(n =>
                    n.id === notification.id ? { ...n, read: true } : n
                ));
            } catch (error) {
            }
        }

        // Navigate based on type
        switch (notification.type) {
            case 'message':
                navigate('/chat');
                break;
            case 'listing_approved':
            case 'listing_rejected':
                navigate(`/listings/${notification.referenceId}`);
                break;
            default:
                // Do nothing or navigate to generic page
                break;
        }
    };

    const getIcon = (type) => {
        switch (type) {
            case 'message':
                return <Message color="primary" />;
            case 'listing_approved':
                return <CheckCircle color="success" />;
            case 'listing_rejected':
                return <Info color="error" />;
            case 'promotion':
                return <LocalOffer color="secondary" />;
            default:
                return <NotificationsIcon color="action" />;
        }
    };

    if (loading) {
        return (
            <Box display="flex" justifyContent="center" alignItems="center" minHeight="60vh">
                <CircularProgress />
            </Box>
        );
    }

    return (
        <Container maxWidth="md" sx={{ py: 4 }}>
            <Box display="flex" justifyContent="space-between" alignItems="center" mb={3}>
                <Typography variant="h4" fontWeight="bold">
                    Notifications
                </Typography>
                {notifications.some(n => !n.read) && (
                    <Button onClick={handleMarkAllRead} startIcon={<CheckCircle />}>
                        Mark all as read
                    </Button>
                )}
            </Box>

            <Paper elevation={0} variant="outlined">
                <List>
                    {notifications.length === 0 ? (
                        <Box p={4} textAlign="center">
                            <Typography color="text.secondary">No notifications yet</Typography>
                        </Box>
                    ) : (
                        notifications.map((notification, index) => (
                            <React.Fragment key={notification.id}>
                                {index > 0 && <Divider />}
                                <ListItem
                                    button
                                    onClick={() => handleNotificationClick(notification)}
                                    sx={{
                                        bgcolor: notification.read ? 'transparent' : 'action.hover',
                                        transition: 'background-color 0.3s'
                                    }}
                                >
                                    <ListItemAvatar>
                                        <Avatar sx={{ bgcolor: 'background.paper' }}>
                                            {getIcon(notification.type)}
                                        </Avatar>
                                    </ListItemAvatar>
                                    <ListItemText
                                        primary={
                                            <Typography variant="subtitle1" fontWeight={notification.read ? 'normal' : 'bold'}>
                                                {notification.title}
                                            </Typography>
                                        }
                                        secondary={
                                            <Box>
                                                <Typography variant="body2" color="text.secondary" component="span">
                                                    {notification.message}
                                                </Typography>
                                                <Typography variant="caption" display="block" color="text.disabled" mt={0.5}>
                                                    {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true })}
                                                </Typography>
                                            </Box>
                                        }
                                    />
                                </ListItem>
                            </React.Fragment>
                        ))
                    )}
                </List>
            </Paper>
        </Container>
    );
};

export default NotificationsPage;
import React, { useState } from 'react';
import {
  Container, Paper, Typography, TextField, Button, Box, Link, Divider,
  CircularProgress, useTheme, Stack, IconButton, InputAdornment,
  Alert, Snackbar, ToggleButton, ToggleButtonGroup, FormControlLabel, Checkbox
} from '@mui/material';
import {
  Visibility, VisibilityOff, Email, Lock, ArrowBack, CheckCircle, Phone,
  Business, Person
} from '@mui/icons-material';
import { useNavigate, Link as RouterLink } from 'react-router-dom';
import { motion } from 'framer-motion';
import toast from 'react-hot-toast';
import { alpha } from '@mui/material/styles';
import { apiService } from '../services/api';

const LoginPage = () => {
  const navigate = useNavigate();
  const theme = useTheme();
  const [loginType, setLoginType] = useState('email');
  const [formData, setFormData] = useState({ 
    email: '', 
    phone: '',
    password: '' 
  });
  const [loading, setLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  const [errors, setErrors] = useState({});
  const [showSuccess, setShowSuccess] = useState(false);
  const [rememberMe, setRememberMe] = useState(false);

  const validateForm = () => {
    const newErrors = {};
    
    if (loginType === 'email') {
      if (!formData.email.trim()) {
        newErrors.email = 'Email is required';
      } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
        newErrors.email = 'Email is invalid';
      }
    } else {
      if (!formData.phone.trim()) {
        newErrors.phone = 'Phone number is required';
      } else if (!/^\+251\s?9\d{2}\s?\d{6}$/.test(formData.phone.replace(/\s/g, ''))) {
        newErrors.phone = 'Please enter a valid Ethiopian phone number';
      }
    }
    
    if (!formData.password.trim()) {
      newErrors.password = 'Password is required';
    } else if (formData.password.length < 6) {
      newErrors.password = 'Password must be at least 6 characters';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) return;
    
    setLoading(true);
    
    try {
      // Call real login API
      const loginData = loginType === 'email' 
        ? { email: formData.email, password: formData.password }
        : { phone: formData.phone, password: formData.password };
      
      const response = await apiService.login(loginData);
      
      // Store real token
      localStorage.setItem('token', response.token);
      localStorage.setItem('user', JSON.stringify(response.user));
      
      setLoading(false);
      setShowSuccess(true);
      toast.success('Login successful!');
      
      setTimeout(() => {
        navigate('/');
      }, 1500);
    } catch (error) {
      setLoading(false);
      toast.error(error.message || 'Login failed. Please try again.');
      console.error('Login error:', error);
    }
  };

  return (
    <Box sx={{ 
      bgcolor: 'background.default', 
      minHeight: '100vh',
      backgroundImage: {
        xs: 'linear-gradient(rgba(255,255,255,0.92), rgba(255,255,255,0.92)), url("https://images.unsplash.com/photo-1557804506-669a67965ba0?q=80&w=1080")',
        md: 'linear-gradient(rgba(255,255,255,0.95), rgba(255,255,255,0.95)), url("https://images.unsplash.com/photo-1557804506-669a67965ba0?q=80&w=1080")'
      },
      backgroundSize: 'cover',
      backgroundPosition: 'center',
      backgroundAttachment: 'fixed',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center'
    }}>
      {/* Header */}
      <Box sx={{ 
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        zIndex: 1,
        bgcolor: 'primary.main',
        color: 'white',
        py: 2,
        boxShadow: 2
      }}>
        <Container maxWidth="lg">
          <Box sx={{ display: 'flex', alignItems: 'center' }}>
            <IconButton 
              onClick={() => navigate('/')}
              sx={{ color: 'white', mr: 2 }}
            >
              <ArrowBack />
            </IconButton>
            <Typography variant="h6" fontWeight="bold">
              Welcome Back
            </Typography>
          </Box>
        </Container>
      </Box>

      <Container maxWidth="sm" sx={{ pt: 8, position: 'relative', zIndex: 1 }}>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
        >
          <Paper 
            sx={{ 
              p: { xs: 3, md: 4 }, 
              borderRadius: 4,
              boxShadow: `0 8px 32px ${alpha(theme.palette.common.black, 0.1)}`,
              backdropFilter: 'blur(10px)',
              backgroundColor: alpha(theme.palette.background.paper, 0.95),
              border: `1px solid ${alpha(theme.palette.divider, 0.1)}`,
            }}
          >
            {/* Logo/Brand Section */}
            <Box sx={{ textAlign: 'center', mb: 4 }}>
              <Box sx={{
                width: 80,
                height: 80,
                bgcolor: 'primary.main',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                mx: 'auto',
                mb: 2,
                boxShadow: `0 4px 20px ${alpha(theme.palette.primary.main, 0.3)}`
              }}>
                <Typography variant="h4" color="white" fontWeight="bold">
                  YS
                </Typography>
              </Box>
              <Typography variant="h4" fontWeight="bold" gutterBottom>
                Sign In
              </Typography>
              <Typography variant="body2" color="text.secondary">
                Welcome back to Yesira Sew - Quality Gold
              </Typography>
            </Box>

            {/* Login Type Toggle */}
            <Box sx={{ mb: 4 }}>
              <Typography variant="body2" color="text.secondary" gutterBottom sx={{ textAlign: 'center', mb: 2 }}>
                Choose your login method
              </Typography>
              <ToggleButtonGroup
                value={loginType}
                exclusive
                onChange={(e, newType) => {
                  if (newType !== null) {
                    setLoginType(newType);
                    setErrors({});
                  }
                }}
                sx={{ 
                  width: '100%',
                  '& .MuiToggleButton-root': {
                    py: 2,
                    px: 3,
                    borderRadius: 3,
                    textTransform: 'none',
                    fontWeight: 600,
                    fontSize: '1rem',
                    border: `2px solid ${alpha(theme.palette.divider, 0.3)}`,
                    '&:not(:first-of-type)': {
                      ml: 1,
                    },
                    '&.Mui-selected': {
                      bgcolor: alpha(theme.palette.primary.main, 0.1),
                      color: 'primary.main',
                      borderColor: 'primary.main',
                      boxShadow: `0 4px 12px ${alpha(theme.palette.primary.main, 0.2)}`,
                    },
                    '&:hover': {
                      bgcolor: alpha(theme.palette.action.hover, 0.04),
                    }
                  }
                }}
              >
                <ToggleButton value="email" sx={{ flex: 1 }}>
                  <Stack direction="row" spacing={2} alignItems="center">
                    <Email sx={{ fontSize: 24 }} />
                    <Typography>Email</Typography>
                  </Stack>
                </ToggleButton>
                <ToggleButton value="phone" sx={{ flex: 1 }}>
                  <Stack direction="row" spacing={2} alignItems="center">
                    <Phone sx={{ fontSize: 24 }} />
                    <Typography>Phone</Typography>
                  </Stack>
                </ToggleButton>
              </ToggleButtonGroup>
            </Box>

            <form onSubmit={handleSubmit}>
              <Stack spacing={3}>
                {loginType === 'email' ? (
                  <TextField
                    fullWidth
                    label="Email Address"
                    type="email"
                    value={formData.email}
                    onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                    error={!!errors.email}
                    helperText={errors.email}
                    disabled={loading}
                    placeholder="Enter your email address"
                    InputProps={{
                      startAdornment: (
                        <InputAdornment position="start">
                          <Email color="primary" sx={{ fontSize: 20 }} />
                        </InputAdornment>
                      ),
                    }}
                    sx={{
                      '& .MuiOutlinedInput-root': {
                        borderRadius: 3,
                        fontSize: '1rem',
                        py: 1.5,
                      },
                      '& .MuiInputLabel-root': {
                        fontSize: '1rem',
                      }
                    }}
                  />
                ) : (
                  <TextField
                    fullWidth
                    label="Phone Number"
                    value={formData.phone}
                    onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                    error={!!errors.phone}
                    helperText={errors.phone || 'Format: +251 9XX XXX XXX'}
                    disabled={loading}
                    placeholder="+251 911 234 567"
                    InputProps={{
                      startAdornment: (
                        <InputAdornment position="start">
                          <Phone color="primary" sx={{ fontSize: 20 }} />
                        </InputAdornment>
                      ),
                    }}
                    sx={{
                      '& .MuiOutlinedInput-root': {
                        borderRadius: 3,
                        fontSize: '1rem',
                        py: 1.5,
                      },
                      '& .MuiInputLabel-root': {
                        fontSize: '1rem',
                      }
                    }}
                  />
                )}
                
                <TextField
                  fullWidth
                  label="Password"
                  type={showPassword ? 'text' : 'password'}
                  value={formData.password}
                  onChange={(e) => setFormData({ ...formData, password: e.target.value })}
                  error={!!errors.password}
                  helperText={errors.password}
                  disabled={loading}
                  placeholder="Enter your password"
                  InputProps={{
                    startAdornment: (
                      <InputAdornment position="start">
                        <Lock color="primary" sx={{ fontSize: 20 }} />
                      </InputAdornment>
                    ),
                    endAdornment: (
                      <InputAdornment position="end">
                        <IconButton
                          onClick={() => setShowPassword(!showPassword)}
                          edge="end"
                          disabled={loading}
                          sx={{ mr: 0.5 }}
                        >
                          {showPassword ? <VisibilityOff /> : <Visibility />}
                        </IconButton>
                      </InputAdornment>
                    ),
                  }}
                  sx={{
                    '& .MuiOutlinedInput-root': {
                      borderRadius: 3,
                      fontSize: '1rem',
                      py: 1.5,
                    },
                    '& .MuiInputLabel-root': {
                      fontSize: '1rem',
                    }
                  }}
                />

                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mt: 2 }}>
                  <FormControlLabel
                    control={
                      <Checkbox
                        checked={rememberMe}
                        onChange={(e) => setRememberMe(e.target.checked)}
                        color="primary"
                        disabled={loading}
                        size="small"
                      />
                    }
                    label="Remember me"
                    sx={{ '& .MuiFormControlLabel-label': { fontSize: '0.9rem' } }}
                  />
                  <Link 
                    component={RouterLink} 
                    to="/forgot-password"
                    color="primary"
                    sx={{ 
                      textDecoration: 'none', 
                      '&:hover': { textDecoration: 'underline' },
                      fontSize: '0.9rem',
                      fontWeight: 500
                    }}
                  >
                    Forgot password?
                  </Link>
                </Box>

                <Button
                  type="submit"
                  fullWidth
                  variant="contained"
                  size="large"
                  disabled={loading}
                  sx={{
                    py: 2,
                    borderRadius: 3,
                    textTransform: 'none',
                    fontWeight: 700,
                    fontSize: '1.1rem',
                    letterSpacing: 0.5,
                    background: `linear-gradient(135deg, ${theme.palette.primary.main}, ${theme.palette.primary.dark})`,
                    '&:hover': {
                      background: `linear-gradient(135deg, ${theme.palette.primary.dark}, ${theme.palette.primary.main})`,
                      transform: 'translateY(-1px)',
                      boxShadow: `0 8px 24px ${alpha(theme.palette.primary.main, 0.3)}`,
                    },
                    transition: 'all 0.3s ease',
                  }}
                >
                  {loading ? (
                    <>
                      <CircularProgress size={22} sx={{ mr: 1.5, color: 'white' }} />
                      Signing In...
                    </>
                  ) : (
                    'Sign In'
                  )}
                </Button>
              </Stack>
            </form>

            <Divider sx={{ my: 3 }}>
              <Typography variant="body2" color="text.secondary">
                OR
              </Typography>
            </Divider>

            <Stack spacing={2}>
              <Button
                fullWidth
                variant="outlined"
                size="large"
                startIcon={
                  <Box sx={{ width: 20, height: 20, bgcolor: '#4285F4', borderRadius: '50%' }} />
                }
                sx={{
                  py: 1.5,
                  borderRadius: 3,
                  textTransform: 'none',
                  fontWeight: 600,
                  borderColor: alpha(theme.palette.text.primary, 0.2),
                }}
              >
                Continue with Google
              </Button>
              
              <Button
                fullWidth
                variant="outlined"
                size="large"
                startIcon={
                  <Box sx={{ width: 20, height: 20, bgcolor: '#1877F2', borderRadius: '50%' }} />
                }
                sx={{
                  py: 1.5,
                  borderRadius: 3,
                  textTransform: 'none',
                  fontWeight: 600,
                  borderColor: alpha(theme.palette.text.primary, 0.2),
                }}
              >
                Continue with Facebook
              </Button>
            </Stack>

            <Box sx={{ textAlign: 'center', mt: 3 }}>
              <Typography variant="body2" color="text.secondary">
                Don't have an account?{' '}
                <Link 
                  component={RouterLink} 
                  to="/register"
                  color="primary"
                  fontWeight="600"
                  sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
                >
                  Create Account
                </Link>
              </Typography>
            </Box>
          </Paper>

          {/* Footer Links */}
          <Box sx={{ textAlign: 'center', mt: 3 }}>
            <Stack 
              direction={{ xs: 'column', sm: 'row' }} 
              spacing={2} 
              justifyContent="center"
              alignItems="center"
            >
              <Link 
                href="#" 
                color="text.secondary" 
                variant="caption"
                sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
              >
                Terms of Service
              </Link>
              <Typography variant="caption" color="text.secondary"></Typography>
              <Link 
                href="#" 
                color="text.secondary" 
                variant="caption"
                sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
              >
                Privacy Policy
              </Link>
              <Typography variant="caption" color="text.secondary"></Typography>
              <Link 
                href="#" 
                color="text.secondary" 
                variant="caption"
                sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
              >
                Help Center
              </Link>
            </Stack>
          </Box>
        </motion.div>
      </Container>

      {/* Success Snackbar */}
      <Snackbar
        open={showSuccess}
        autoHideDuration={3000}
        onClose={() => setShowSuccess(false)}
        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}
      >
        <Alert 
          onClose={() => setShowSuccess(false)} 
          severity="success"
          icon={<CheckCircle fontSize="inherit" />}
          sx={{ width: '100%' }}
        >
          Login successful! Redirecting to home...
        </Alert>
      </Snackbar>
    </Box>
  );
};

export default LoginPage;
import React, { useState, useEffect } from 'react';
import {
  Container, Typography, TextField, Button, Box, Grid, Card, CardContent,
  Chip, IconButton, Pagination, InputAdornment, FormControl, InputLabel,
  Select, MenuItem, Stack, Divider, Skeleton, useTheme, alpha, useMediaQuery
} from '@mui/material';
import {
  Search, Clear, GridView, ViewList, Favorite, FavoriteBorder,
  LocationOn, CalendarToday, Speed, LocalGasStation, Bed, Bathtub, SquareFoot
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { useNavigate } from 'react-router-dom';
import toast from 'react-hot-toast';
import apiService from '../services/api';

// Import Love Features
import SmartSearch from '../components/SmartSearch';
import LiveActivityIndicators from '../components/LiveActivityIndicators';

const SORT_OPTIONS = ['Newest', 'Price: Low to High', 'Price: High to Low', 'Most Popular'];

const ListingsPage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('All');
  const [sortBy, setSortBy] = useState('Newest');
  const [viewMode, setViewMode] = useState('grid');
  const [favorites, setFavorites] = useState([]);
  const [page, setPage] = useState(1);
  const [listings, setListings] = useState([]);
  const [categories, setCategories] = useState([]);
  const [loading, setLoading] = useState(true);
  const [totalPages, setTotalPages] = useState(1);

  // Fetch listings from backend
  const fetchListings = async () => {
    try {
      setLoading(true);
      const params = {
        page,
        limit: 12,
        search: searchQuery || undefined,
        category: selectedCategory !== 'All' ? selectedCategory : undefined,
        sortBy: sortBy === 'Newest' ? 'created_at' : sortBy === 'Price: Low to High' ? 'price_asc' : sortBy === 'Price: High to Low' ? 'price_desc' : 'created_at',
        sortOrder: sortBy === 'Price: Low to High' ? 'ASC' : 'DESC'
      };

      const response = await apiService.getListings(params);
      // Handle backend response structure
      const listingsData = response.data?.data?.listings || response.data?.listings || [];
      const paginationData = response.data?.data?.pagination || response.data?.pagination;
      
      setListings(listingsData);
      setTotalPages(paginationData?.totalPages || Math.ceil((paginationData?.total || 0) / 12));
    } catch (error) {
      console.error('Failed to load listings:', error);
      toast.error('Failed to load listings. Backend may not have data yet.');
      // Set empty state to prevent infinite loading
      setListings([]);
      setTotalPages(0);
    } finally {
      setLoading(false);
    }
  };

  // Fetch categories from backend
  const fetchCategories = async () => {
    try {
      const response = await apiService.getCategories();
      // Handle backend response structure
      const categoriesData = response.data?.data?.categories || response.data?.categories || [];
      setCategories(categoriesData);
    } catch (error) {
      // Fallback to default categories
      setCategories(['Jobs', 'Tenders', 'Homes', 'Cars']);
    }
  };

  // Toggle favorite status
  const toggleFavorite = async (listingId) => {
    try {
      await apiService.toggleFavorite(listingId);
      
      // Update local state
      setFavorites(prev =>
        prev.includes(listingId) 
          ? prev.filter(fav => fav !== listingId) 
          : [...prev, listingId]
      );
      
      // Update the listing's favorite status
      setListings(prev =>
        prev.map(listing =>
          listing.id === listingId
            ? { ...listing, is_favorited: !listing.is_favorited }
            : listing
        )
      );
      
      toast.success(favorites.includes(listingId) ? 'Removed from favorites' : 'Added to favorites');
    } catch (error) {
      toast.error('Failed to update favorite status');
    }
  };

  // Fetch data on component mount and when filters change
  useEffect(() => {
    fetchListings();
  }, [page, searchQuery, selectedCategory, sortBy]);

  useEffect(() => {
    fetchCategories();
  }, []);

  const getDaysAgo = (dateString) => {
    const date = new Date(dateString);
    const diff = Math.floor((new Date() - date) / (1000 * 60 * 60 * 24));
    if (diff === 0) return 'Today';
    if (diff === 1) return 'Yesterday';
    return `${diff} days ago`;
  };

  const renderSpecs = (listing) => {
    // Handle specs based on category from backend
    if (listing.category_name === 'Homes' || listing.category === 'Homes') {
      return (
        <Stack direction="row" spacing={1} flexWrap="wrap" useFlexGap>
          {listing.specs?.bedrooms && (
            <Stack direction="row" spacing={0.75} alignItems="center">
              <Bed sx={{ fontSize: 14, color: 'primary.main' }} />
              <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                {listing.specs.bedrooms} Beds
              </Typography>
            </Stack>
          )}
          {listing.specs?.bathrooms && (
            <Stack direction="row" spacing={0.75} alignItems="center">
              <Bathtub sx={{ fontSize: 14, color: 'primary.main' }} />
              <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                {listing.specs.bathrooms} Baths
              </Typography>
            </Stack>
          )}
          {listing.specs?.area && (
            <Stack direction="row" spacing={0.75} alignItems="center">
              <SquareFoot sx={{ fontSize: 14, color: 'primary.main' }} />
              <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                {listing.specs.area} Sq Ft
              </Typography>
            </Stack>
          )}
        </Stack>
      );
    } else if (listing.category_name === 'Cars' || listing.category === 'Cars') {
      return (
        <Stack direction="row" spacing={1} flexWrap="wrap" useFlexGap>
          {listing.specs?.year && (
            <Stack direction="row" spacing={0.75} alignItems="center">
              <CalendarToday sx={{ fontSize: 14, color: 'primary.main' }} />
              <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                {listing.specs.year}
              </Typography>
            </Stack>
          )}
          {listing.specs?.transmission && (
            <Stack direction="row" spacing={0.75} alignItems="center">
              <Speed sx={{ fontSize: 14, color: 'primary.main' }} />
              <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                {listing.specs.transmission}
              </Typography>
            </Stack>
          )}
          {listing.specs?.fuel && (
            <Stack direction="row" spacing={0.75} alignItems="center">
              <LocalGasStation sx={{ fontSize: 14, color: 'primary.main' }} />
              <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                {listing.specs.fuel}
              </Typography>
            </Stack>
          )}
        </Stack>
      );
    }
    return null;
  };

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: isMobile ? 10 : 4 }}>
      {/* Header */}
      <Box sx={{ bgcolor: 'primary.main', color: 'white', py: 6 }}>
        <Container maxWidth="lg">
          <Typography variant={isMobile ? "h4" : "h3"} fontWeight="bold" gutterBottom>
            All Listings
          </Typography>
          <Typography variant="body1" sx={{ opacity: 0.9 }}>
            Browse through {listings.length} available listings
          </Typography>
        </Container>
      </Box>

      <Container maxWidth="lg" sx={{ mt: -4 }}>
        {/* Search & Filter Card */}
        <Card sx={{
          p: 3,
          borderRadius: 4,
          boxShadow: `0 8px 32px ${alpha(theme.palette.common.black, 0.1)}`,
          mb: 3
        }}>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={5}>
              <SmartSearch 
                onSearch={(query) => setSearchQuery(query)}
                placeholder="Search listings..."
              />
            </Grid>
            <Grid item xs={12} sm={6} md={3}>
              <FormControl fullWidth>
                <InputLabel>Category</InputLabel>
                <Select value={selectedCategory} onChange={(e) => setSelectedCategory(e.target.value)} label="Category">
                  <MenuItem value="All">All Categories</MenuItem>
                  {categories.map(cat => (
                    <MenuItem key={cat.id || cat} value={cat.id || cat}>
                      {cat.name || cat}
                    </MenuItem>
                  ))}
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} sm={6} md={3}>
              <FormControl fullWidth>
                <InputLabel>Sort By</InputLabel>
                <Select value={sortBy} onChange={(e) => setSortBy(e.target.value)} label="Sort By">
                  {SORT_OPTIONS.map(opt => (
                    <MenuItem key={opt} value={opt}>{opt}</MenuItem>
                  ))}
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={1}>
              <Stack direction="row" spacing={1}>
                <IconButton
                  onClick={() => setViewMode('grid')}
                  sx={{
                    bgcolor: viewMode === 'grid' ? 'primary.main' : 'transparent',
                    color: viewMode === 'grid' ? 'white' : 'text.primary',
                    '&:hover': { bgcolor: viewMode === 'grid' ? 'primary.dark' : alpha(theme.palette.primary.main, 0.1) }
                  }}
                >
                  <GridView />
                </IconButton>
                <IconButton
                  onClick={() => setViewMode('list')}
                  sx={{
                    bgcolor: viewMode === 'list' ? 'primary.main' : 'transparent',
                    color: viewMode === 'list' ? 'white' : 'text.primary',
                    '&:hover': { bgcolor: viewMode === 'list' ? 'primary.dark' : alpha(theme.palette.primary.main, 0.1) }
                  }}
                >
                  <ViewList />
                </IconButton>
              </Stack>
            </Grid>
          </Grid>
        </Card>

        {/* Loading State */}
        {loading ? (
          <Grid container spacing={3}>
            {[...Array(6)].map((_, index) => (
              <Grid item xs={12} sm={6} md={4} key={index}>
                <Skeleton variant="rectangular" height={200} sx={{ borderRadius: 2, mb: 2 }} />
                <Skeleton variant="text" height={32} sx={{ mb: 1 }} />
                <Skeleton variant="text" height={24} sx={{ mb: 1 }} />
                <Skeleton variant="text" height={20} width="60%" />
              </Grid>
            ))}
          </Grid>
        ) : listings.length === 0 ? (
          <Box sx={{ textAlign: 'center', py: 8 }}>
            <Typography variant="h6" color="text.secondary" gutterBottom>
              No listings found
            </Typography>
            <Typography variant="body2" color="text.secondary" sx={{ mb: 3 }}>
              The database might be empty. Try adding some sample listings or check back later.
            </Typography>
            <Button 
              variant="contained" 
              onClick={() => navigate('/post-ad')}
              sx={{ borderRadius: 2 }}
            >
              Post First Listing
            </Button>
          </Box>
        ) : (
          <>
            {/* Listings Grid */}
            <Grid container spacing={3}>
              {listings.map((listing, index) => (
                <Grid item xs={12} sm={viewMode === 'grid' ? 6 : 12} md={viewMode === 'grid' ? 4 : 12} key={listing.id}>
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: index * 0.1, duration: 0.4 }}
                  >
                    <Card
                      onClick={() => navigate(`/listings/${listing.id}`)}
                      sx={{
                        borderRadius: 4,
                        overflow: 'hidden',
                        cursor: 'pointer',
                        transition: 'all 0.3s ease',
                        display: 'flex',
                        flexDirection: viewMode === 'list' ? 'row' : 'column',
                        height: viewMode === 'list' ? 'auto' : '100%',
                        '&:hover': {
                          transform: 'translateY(-4px)',
                          boxShadow: 4
                        }
                      }}
                    >
                      {/* Image Section */}
                      <Box sx={{
                        position: 'relative',
                        width: viewMode === 'list' ? 300 : '100%',
                        height: viewMode === 'list' ? 200 : 220,
                        flexShrink: 0
                      }}>
                        <Box
                          component="img"
                          src={listing.image_url || listing.image || 'https://images.unsplash.com/photo-1557804506-669a67965ba0?q=80&w=500'}
                          alt={listing.title}
                          sx={{ width: '100%', height: '100%', objectFit: 'cover' }}
                        />
                        {/* Category Badge */}
                        <Chip
                          label={listing.category_name || listing.category}
                          size="small"
                          sx={{
                            position: 'absolute',
                            top: 12,
                            left: 12,
                            bgcolor: alpha(theme.palette.background.paper, 0.95),
                            fontWeight: 600,
                            fontSize: '0.6875rem'
                          }}
                        />
                        {/* Days Ago Badge */}
                        <Chip
                          label={getDaysAgo(listing.created_at)}
                          size="small"
                          sx={{
                            position: 'absolute',
                            top: 12,
                            right: 12,
                            bgcolor: alpha('#000', 0.7),
                            color: 'white',
                            fontWeight: 600,
                            fontSize: '0.625rem'
                          }}
                        />
                        {/* Favorite Button */}
                        <IconButton
                          onClick={(e) => {
                            e.stopPropagation();
                            toggleFavorite(listing.id);
                          }}
                          sx={{
                            position: 'absolute',
                            bottom: 12,
                            left: 12,
                            bgcolor: alpha('#fff', 0.9),
                            '&:hover': { bgcolor: 'white' }
                          }}
                        >
                          {listing.is_favorited || favorites.includes(listing.id) ? (
                            <Favorite color="error" />
                          ) : (
                            <FavoriteBorder />
                          )}
                        </IconButton>
                      </Box>

                      {/* Content Section */}
                      <Box
                        sx={{
                          p: 2.5,
                          flex: 1,
                          display: 'flex',
                          flexDirection: 'column',
                          minHeight: viewMode === 'grid' ? { xs: 260, sm: 210 } : 'auto'
                        }}
                      >
                        <Stack direction="row" justifyContent="space-between" alignItems="flex-start" mb={1.5}>
                          <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.6875rem', fontWeight: 600 }}>
                            {listing.type}
                          </Typography>
                          <Stack direction="row" spacing={0.5} alignItems="center">
                            <CalendarToday sx={{ fontSize: 12, color: 'text.secondary' }} />
                            <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.625rem' }}>
                              {getDaysAgo(listing.created_at)}
                            </Typography>
                          </Stack>
                        </Stack>

                        <Typography variant="h6" sx={{
                          fontWeight: 'bold',
                          mb: 1.5,
                          fontSize: '1.05rem',
                          lineHeight: 1.4,
                          minHeight: 48,
                          overflow: 'hidden',
                          textOverflow: 'ellipsis',
                          display: '-webkit-box',
                          WebkitLineClamp: 2,
                          WebkitBoxOrient: 'vertical'
                        }}>
                          {listing.title}
                        </Typography>

                        <Stack direction="row" spacing={0.5} alignItems="center" mb={1.5}>
                          <LocationOn sx={{ fontSize: 16, color: 'text.secondary' }} />
                          <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.8125rem' }} noWrap>
                            {listing.location}
                          </Typography>
                        </Stack>

                        {/* Specs */}
                        {renderSpecs(listing) && (
                          <>
                            <Divider sx={{ my: 1.5 }} />
                            <Box sx={{ mb: 1.5 }}>
                              {renderSpecs(listing)}
                            </Box>
                          </>
                        )}

                        {/* Price */}
                        <Box sx={{ mt: 'auto' }}>
                          <Typography variant="h6" color="primary.main" fontWeight="bold" sx={{ fontSize: '1.25rem' }}>
                            ETB {listing.price}
                          </Typography>
                          {/* Live Activity Indicators */}
                          <LiveActivityIndicators listing={listing} compact />
                        </Box>
                      </Box>
                    </Card>
                  </motion.div>
                </Grid>
              ))}
            </Grid>

            {/* Empty State */}
            {listings.length === 0 && !loading && (
              <Box sx={{ textAlign: 'center', py: 8 }}>
                <Typography variant="h6" color="text.secondary" gutterBottom>
                  No listings found
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  Try adjusting your search or filters
                </Typography>
              </Box>
            )}

            {/* Pagination */}
            {totalPages > 1 && (
              <Box sx={{ display: 'flex', justifyContent: 'center', mt: 4 }}>
                <Pagination
                  count={totalPages}
                  page={page}
                  onChange={(e, value) => setPage(value)}
                  color="primary"
                  size={isMobile ? "small" : "medium"}
                />
              </Box>
            )}
          </>
        )}
      </Container>
    </Box>
  );
};

export default ListingsPage;
import React, { useState, useEffect } from 'react';
import {
  Container, Typography, Box, Chip, Button, IconButton, TextField,
  Avatar, Divider, Grid, Card, useTheme, useMediaQuery, Stack, Paper,
  CircularProgress, Alert, Dialog, DialogTitle, DialogContent, DialogActions
} from '@mui/material';
import {
  ArrowBack, Favorite, FavoriteBorder, Share, LocationOn, CalendarToday,
  Phone, Chat, Security, Verified, KingBed, Bathtub, SquareFoot,
  Speed, LocalGasStation, Settings, Star, Send
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import { useNavigate, useParams } from 'react-router-dom';
import apiService from '../services/api';
import toast from 'react-hot-toast';
import { formatDistanceToNow } from '../utils/dateUtils';

// Import Love Features
import PriceDropAlert from '../components/PriceDropAlert';
import UserReviews from '../components/UserReviews';
import TrustBadges from '../components/TrustBadges';
import LiveActivityIndicators from '../components/LiveActivityIndicators';
import QuickActionsToolbar from '../components/QuickActionsToolbar';
// SmartRecommendations removed for now
import WhatsAppShare from '../components/WhatsAppShare';

const ListingDetailPage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const { id } = useParams();
  const [currentImageIndex, setCurrentImageIndex] = useState(0);
  const [listing, setListing] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [isFavorite, setIsFavorite] = useState(false);
  const [showAllSpecs, setShowAllSpecs] = useState(false);
  const [comment, setComment] = useState('');
  const [comments, setComments] = useState([]);
  const [showPhoneDialog, setShowPhoneDialog] = useState(false);

  useEffect(() => {
    const fetchListing = async () => {
      try {
        setLoading(true);
        setError(null);
        const response = await apiService.getListingById(id);
        setListing(response.listing || response);
        setIsFavorite(response.listing?.is_favorited || response.is_favorited || false);

        // Fetch comments
        try {
          const commentsData = await apiService.getListingComments(id);
          setComments(commentsData || []);
        } catch (e) {
        }

      } catch (err) {
        setError('Failed to load listing details');
      } finally {
        setLoading(false);
      }
    };

    fetchListing();
  }, [id]);

  const getDaysAgo = (date) => {
    if (!date) return '';
    const diff = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));
    if (diff === 0) return 'Today';
    if (diff === 1) return 'Yesterday';
    return `${diff} days ago`;
  };

  const handleToggleFavorite = async () => {
    try {
      await apiService.toggleFavorite(id);
      setIsFavorite(!isFavorite);
      toast.success(isFavorite ? 'Removed from favorites' : 'Added to favorites');
    } catch (err) {
      toast.error('Failed to update favorite');
    }
  };

  const handleChatWithSeller = async () => {
    if (!listing?.author_id) {
      toast.error('Seller information not available');
      return;
    }
    try {
      await apiService.startConversation(listing.author_id);
      navigate('/chat');
    } catch (err) {
      toast.error('Failed to start chat');
    }
  };

  const handlePostComment = async () => {
    if (!comment.trim()) return;
    try {
      const newComment = await apiService.addListingComment(id, comment);
      setComments([...comments, newComment]);
      setComment('');
      toast.success('Comment posted');
    } catch (err) {
      toast.error('Failed to post comment');
    }
  };

  if (loading) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  if (error || !listing) {
    return (
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Alert severity="error">{error || 'Listing not found'}</Alert>
        <Button onClick={() => navigate(-1)} sx={{ mt: 2 }}>Go Back</Button>
      </Container>
    );
  }

  const images = listing.images || (listing.image ? [listing.image] : ['https://images.unsplash.com/photo-1560518883-ce09059eeffa?q=80&w=800']);
  const seller = listing.seller || { name: 'Unknown Seller', memberSince: 'N/A', rating: 0, reviews: 0, verified: false };
  const specs = listing.specs || {};

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: isMobile ? 10 : 0 }}>
      {/* Quick Actions Toolbar */}
      <QuickActionsToolbar listing={listing} />
      
      {/* Image Gallery Header */}
      <Box sx={{ position: 'relative', height: 400, bgcolor: 'grey.900' }}>
        {/* Main Image */}
        <Box
          component="img"
          src={images[currentImageIndex]}
          alt={listing.title}
          sx={{ width: '100%', height: '100%', objectFit: 'cover' }}
        />

        {/* Gradient Overlay */}
        <Box sx={{
          position: 'absolute',
          bottom: 0,
          left: 0,
          right: 0,
          height: 100,
          background: 'linear-gradient(to top, rgba(0,0,0,0.7), transparent)'
        }} />

        {/* Top Actions */}
        <Box sx={{ position: 'absolute', top: 16, left: 0, right: 0, px: 2, display: 'flex', justifyContent: 'space-between' }}>
          <IconButton
            onClick={() => navigate(-1)}
            sx={{
              bgcolor: alpha('#000', 0.3),
              color: 'white',
              backdropFilter: 'blur(10px)',
              '&:hover': { bgcolor: alpha('#000', 0.5) }
            }}
          >
            <ArrowBack />
          </IconButton>
          <Stack direction="row" spacing={1}>
            <IconButton
              onClick={handleToggleFavorite}
              sx={{
                bgcolor: alpha('#000', 0.3),
                color: 'white',
                backdropFilter: 'blur(10px)',
                '&:hover': { bgcolor: alpha('#000', 0.5) }
              }}
            >
              {isFavorite ? <Favorite sx={{ color: 'error.main' }} /> : <FavoriteBorder />}
            </IconButton>
            <IconButton
              sx={{
                bgcolor: alpha('#000', 0.3),
                color: 'white',
                backdropFilter: 'blur(10px)',
                '&:hover': { bgcolor: alpha('#000', 0.5) }
              }}
            >
              <Share />
            </IconButton>
          </Stack>
        </Box>

        {/* Image Counter */}
        {images.length > 1 && (
          <Chip
            label={`${currentImageIndex + 1} / ${images.length}`}
            size="small"
            sx={{
              position: 'absolute',
              top: 16,
              right: 16,
              bgcolor: alpha('#000', 0.6),
              color: 'white',
              fontWeight: 'bold'
            }}
          />
        )}

        {/* Thumbnail Gallery */}
        {images.length > 1 && (
          <Box sx={{
            position: 'absolute',
            bottom: 16,
            left: 0,
            right: 0,
            px: 2,
            display: 'flex',
            gap: 1.5,
            overflowX: 'auto',
            '&::-webkit-scrollbar': { display: 'none' }
          }}>
            {images.map((img, idx) => (
              <Box
                key={idx}
                onClick={() => setCurrentImageIndex(idx)}
                sx={{
                  width: 60,
                  height: 60,
                  borderRadius: 2,
                  overflow: 'hidden',
                  cursor: 'pointer',
                  border: currentImageIndex === idx ? `2px solid ${theme.palette.primary.main}` : `1px solid ${alpha('#fff', 0.5)}`,
                  boxShadow: currentImageIndex === idx ? `0 2px 8px ${alpha(theme.palette.primary.main, 0.3)}` : 'none',
                  flexShrink: 0
                }}
              >
                <Box component="img" src={img} alt={`Thumbnail ${idx + 1}`} sx={{ width: '100%', height: '100%', objectFit: 'cover' }} />
              </Box>
            ))}
          </Box>
        )}
      </Box>

      <Container maxWidth="lg" sx={{ mt: -6, position: 'relative', zIndex: 1 }}>
        {/* Main Info Card */}
        <Card sx={{ p: 3, borderRadius: 4, mb: 2, boxShadow: 3 }}>
          <Stack direction="row" spacing={1} mb={2} flexWrap="wrap" useFlexGap>
            <Chip
              label={(listing.type || 'For Sale').toUpperCase()}
              size="small"
              sx={{
                bgcolor: alpha(theme.palette.primary.main, 0.1),
                color: 'primary.main',
                fontWeight: 'bold'
              }}
            />
            <Chip
              label={listing.category || listing.category_name}
              size="small"
              sx={{
                bgcolor: alpha(theme.palette.secondary.main, 0.1),
                color: 'text.primary',
                fontWeight: 'bold'
              }}
            />
            <Typography variant="caption" color="text.secondary" sx={{ ml: 'auto !important', display: 'flex', alignItems: 'center' }}>
              Posted {getDaysAgo(listing.created_at || listing.createdAt)}
            </Typography>
          </Stack>

          <Typography variant="h4" fontWeight="bold" gutterBottom sx={{ fontSize: isMobile ? '1.5rem' : '2rem' }}>
            {listing.title}
          </Typography>

          <Stack direction="row" spacing={0.75} alignItems="center" mb={2}>
            <LocationOn sx={{ fontSize: 18, color: 'text.secondary' }} />
            <Typography variant="body1" color="text.secondary">
              {listing.location}
            </Typography>
          </Stack>

          <Typography variant="h3" color="primary.main" fontWeight="bold" sx={{ fontSize: isMobile ? '1.75rem' : '2.25rem' }}>
            ETB {listing.price}
          </Typography>

          {/* Live Activity Indicators */}
          <LiveActivityIndicators listing={listing} />
        </Card>

        {/* Quick Stats */}
        {(specs.bedrooms || specs.bathrooms || specs.area || specs.areaSqft) && (
          <Box sx={{ mb: 2, overflowX: 'auto', '&::-webkit-scrollbar': { display: 'none' } }}>
            <Stack direction="row" spacing={1.5} sx={{ minWidth: 'max-content' }}>
              {specs.bedrooms && (
                <Card sx={{ p: 2, minWidth: 100, textAlign: 'center' }}>
                  <KingBed sx={{ fontSize: 28, color: 'secondary.main', mb: 1 }} />
                  <Typography variant="caption" color="text.secondary" display="block">Bedrooms</Typography>
                  <Typography variant="body2" fontWeight="bold">{specs.bedrooms}</Typography>
                </Card>
              )}
              {specs.bathrooms && (
                <Card sx={{ p: 2, minWidth: 100, textAlign: 'center' }}>
                  <Bathtub sx={{ fontSize: 28, color: 'secondary.main', mb: 1 }} />
                  <Typography variant="caption" color="text.secondary" display="block">Bathrooms</Typography>
                  <Typography variant="body2" fontWeight="bold">{specs.bathrooms}</Typography>
                </Card>
              )}
              {(specs.area || specs.areaSqft) && (
                <Card sx={{ p: 2, minWidth: 100, textAlign: 'center' }}>
                  <SquareFoot sx={{ fontSize: 28, color: 'secondary.main', mb: 1 }} />
                  <Typography variant="caption" color="text.secondary" display="block">Area</Typography>
                  <Typography variant="body2" fontWeight="bold">{specs.area || specs.areaSqft} Sq Ft</Typography>
                </Card>
              )}
            </Stack>
          </Box>
        )}

        {/* Specifications */}
        {Object.keys(specs).length > 0 && (
          <Card sx={{ p: 3, borderRadius: 4, mb: 2 }}>
            <Stack direction="row" justifyContent="space-between" alignItems="center" mb={2}>
              <Typography variant="h6" fontWeight="bold">Specifications</Typography>
              <Button size="small" onClick={() => setShowAllSpecs(!showAllSpecs)}>
                {showAllSpecs ? 'Show Less' : 'Show All'}
              </Button>
            </Stack>
            <Grid container spacing={1.5}>
              {Object.entries(specs).slice(0, showAllSpecs ? undefined : 6).map(([key, value]) => (
                <Grid item xs={6} key={key}>
                  <Stack direction="row" justifyContent="space-between">
                    <Typography variant="body2" color="text.secondary" sx={{ textTransform: 'capitalize' }}>
                      {key.replace(/([A-Z])/g, ' $1').trim()}
                    </Typography>
                    <Typography variant="body2" fontWeight="600">{value}</Typography>
                  </Stack>
                </Grid>
              ))}
            </Grid>
          </Card>
        )}

        {/* Trust Badges & Price Alert */}
        <Grid container spacing={2} sx={{ mb: 2 }}>
          <Grid item xs={12} md={6}>
            <TrustBadges user={seller} />
          </Grid>
          <Grid item xs={12} md={6}>
            <PriceDropAlert listing={listing} />
          </Grid>
        </Grid>

        {/* Description */}
        <Card sx={{ p: 3, borderRadius: 4, mb: 2 }}>
          <Typography variant="h6" fontWeight="bold" gutterBottom>Description</Typography>
          <Typography variant="body1" color="text.secondary" sx={{ lineHeight: 1.8 }}>
            {listing.description}
          </Typography>
        </Card>

        {/* Seller Info */}
        <Card sx={{ p: 3, borderRadius: 4, mb: 2 }}>
          <Stack direction="row" spacing={2} alignItems="center" mb={2}>
            <Avatar sx={{ width: 60, height: 60, bgcolor: 'primary.main', fontSize: '1.5rem' }}>
              {seller.name?.[0] || 'U'}
            </Avatar>
            <Box flex={1}>
              <Stack direction="row" spacing={1} alignItems="center">
                <Typography variant="h6" fontWeight="bold">{seller.name}</Typography>
                {seller.verified && <Verified sx={{ fontSize: 18, color: 'primary.main' }} />}
              </Stack>
              <Typography variant="body2" color="text.secondary">
                Member since {seller.memberSince}
              </Typography>
              <Stack direction="row" spacing={0.5} alignItems="center" mt={0.5}>
                <Star sx={{ fontSize: 16, color: 'warning.main' }} />
                <Typography variant="body2" color="text.secondary">
                  {seller.rating} ({seller.reviews} reviews)
                </Typography>
              </Stack>
            </Box>
            <Button variant="outlined" size="small" sx={{ borderRadius: 5 }}>View Profile</Button>
          </Stack>

          <Divider sx={{ my: 2 }} />

          {/* Safety Tip */}
          <Paper sx={{
            p: 2,
            bgcolor: alpha(theme.palette.warning.main, 0.1),
            border: `1px solid ${alpha(theme.palette.warning.main, 0.3)}`,
            borderRadius: 3
          }}>
            <Stack direction="row" spacing={1.5}>
              <Security sx={{ color: 'warning.main', fontSize: 24 }} />
              <Box>
                <Typography variant="subtitle2" fontWeight="bold" gutterBottom>Safety Tips</Typography>
                <Typography variant="caption" color="text.secondary" display="block">
                   Meet in a safe public place
                </Typography>
                <Typography variant="caption" color="text.secondary" display="block">
                   Check the item before you buy
                </Typography>
                <Typography variant="caption" color="text.secondary">
                   Never pay in advance
                </Typography>
              </Box>
            </Stack>
          </Paper>
        </Card>

        {/* Comments Section */}
        <Card sx={{ p: 3, borderRadius: 4, mb: 2 }}>
          <Typography variant="h6" fontWeight="bold" gutterBottom>Comments</Typography>
          <Box sx={{ mb: 3 }}>
            {comments.length === 0 ? (
              <Typography variant="body2" color="text.secondary" sx={{ textAlign: 'center', py: 2 }}>
                No comments yet. Be the first to comment!
              </Typography>
            ) : (
              <Stack spacing={2}>
                {comments.map((c, i) => (
                  <Paper key={i} sx={{ p: 2, bgcolor: 'background.default' }}>
                    <Stack direction="row" spacing={2}>
                      <Avatar src={c.user?.avatar} sx={{ width: 32, height: 32 }}>{c.user?.name?.[0]}</Avatar>
                      <Box>
                        <Typography variant="subtitle2" fontWeight="bold">{c.user?.name}</Typography>
                        <Typography variant="body2">{c.content || c.comment}</Typography>
                        <Typography variant="caption" color="text.secondary">
                          {c.created_at ? formatDistanceToNow(new Date(c.created_at), { addSuffix: true }) : ''}
                        </Typography>
                      </Box>
                    </Stack>
                  </Paper>
                ))}
              </Stack>
            )}
          </Box>
          <Stack direction="row" spacing={2}>
            <TextField
              fullWidth
              multiline
              rows={2}
              placeholder="Add a comment..."
              value={comment}
              onChange={(e) => setComment(e.target.value)}
            />
            <Button variant="contained" disabled={!comment.trim()} onClick={handlePostComment} sx={{ alignSelf: 'flex-end' }}>
              Post
            </Button>
          </Stack>
        </Card>

        {/* User Reviews */}
        <UserReviews userId={listing.author_id || seller.id} userType="seller" />

      </Container>

      {/* Bottom Action Bar */}
      <Paper
        elevation={8}
        sx={{
          position: 'fixed',
          bottom: 0,
          left: 0,
          right: 0,
          p: 2,
          borderTop: `1px solid ${theme.palette.divider}`,
          zIndex: 1000
        }}
      >
        <Container maxWidth="lg">
          <Stack direction="row" spacing={2}>
            <Button
              variant="outlined"
              startIcon={<Phone />}
              fullWidth
              sx={{ borderRadius: 3, py: 1.5 }}
              onClick={() => setShowPhoneDialog(true)}
            >
              Call Seller
            </Button>
            <Button
              variant="contained"
              startIcon={<Chat />}
              fullWidth
              sx={{ borderRadius: 3, py: 1.5 }}
              onClick={handleChatWithSeller}
            >
              Chat with Seller
            </Button>
          </Stack>
        </Container>
      </Paper>

      {/* Phone Number Dialog */}
      <Dialog open={showPhoneDialog} onClose={() => setShowPhoneDialog(false)}>
        <DialogTitle>Seller Contact</DialogTitle>
        <DialogContent>
          <Typography variant="h6" align="center" sx={{ my: 2 }}>
            {listing.phone || seller.phone || 'Phone number not available'}
          </Typography>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setShowPhoneDialog(false)}>Close</Button>
          <Button variant="contained" href={`tel:${listing.phone || seller.phone}`} disabled={!listing.phone && !seller.phone}>
            Call Now
          </Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default ListingDetailPage;
import React, { useState, useEffect } from 'react';
import {
  Container, Typography, Box, Grid, Card, Chip,
  useTheme, useMediaQuery, Stack,
  CircularProgress, Alert
} from '@mui/material';
import {
  Business, LocationOn, Work
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import { useNavigate } from 'react-router-dom';
import apiService from '../services/api';

// Import Love Features
import SmartSearch from '../components/SmartSearch';
import LiveActivityIndicators from '../components/LiveActivityIndicators';
// SmartRecommendations and SavedSearches removed for now

const FILTERS = ['All Jobs', 'Full Time', 'Part Time', 'Remote', 'Internship', 'Contract'];

const JobsPage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedFilter, setSelectedFilter] = useState('All Jobs');
  const [jobs, setJobs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchJobs = async () => {
      try {
        setLoading(true);
        setError(null);
        const params = {
          category: 'jobs',
          type: selectedFilter !== 'All Jobs' ? selectedFilter : undefined,
          search: searchQuery || undefined
        };
        const response = await apiService.getListings(params);
        setJobs(response.listings || response || []);
      } catch (err) {
        setError('Failed to load jobs');
      } finally {
        setLoading(false);
      }
    };

    fetchJobs();
  }, [selectedFilter, searchQuery]);

  const getDaysAgo = (date) => {
    const diff = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));
    if (diff === 0) return 'Just now';
    if (diff < 1) {
      const hours = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60));
      return `${hours}h ago`;
    }
    return `${diff}d ago`;
  };

  if (loading) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  if (error) {
    return (
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Alert severity="error">{error}</Alert>
      </Container>
    );
  }

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: isMobile ? 10 : 0 }}>
      {/* Hero Section */}
      <Box sx={{
        height: isMobile ? 600 : 650,
        position: 'relative',
        backgroundImage: 'url(https://images.unsplash.com/photo-1521737604893-d14cc237f11d?q=80&w=1080)',
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: 'white',
        '&::before': {
          content: '""',
          position: 'absolute',
          top: 0, left: 0, right: 0, bottom: 0,
          background: 'linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.4), transparent)',
        }
      }}>
        <Container maxWidth="lg" sx={{ position: 'relative', zIndex: 1, textAlign: 'center' }}>
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}>
            <Typography variant={isMobile ? "h2" : "h1"} sx={{
              fontFamily: 'Playfair Display, serif',
              fontWeight: 700,
              mb: 1,
              color: theme.palette.secondary.main,
              fontSize: isMobile ? '3.25rem' : '4.5rem'
            }}>
              Jobs
            </Typography>
            <Typography variant={isMobile ? "h5" : "h4"} sx={{
              fontFamily: 'Playfair Display, serif',
              fontStyle: 'italic',
              mb: 3,
              opacity: 0.7
            }}>
              Career Opportunities
            </Typography>
            <Typography variant={isMobile ? "body1" : "h6"} sx={{
              mb: 4,
              maxWidth: 600,
              mx: 'auto',
              opacity: 0.8,
              lineHeight: 1.6
            }}>
              Find your dream job in Ethiopia's growing job market. Connect with top employers.
            </Typography>

            <Box sx={{ maxWidth: 600, mx: 'auto' }}>
              <SmartSearch 
                onSearch={(query) => setSearchQuery(query)}
                placeholder="Search jobs..."
              />
            </Box>
          </motion.div>
        </Container>
      </Box>

      {/* Filter Chips */}
      <Box sx={{ bgcolor: 'background.default', pt: 3, pb: 1 }}>
        <Box sx={{
          overflowX: 'auto',
          px: 3,
          '&::-webkit-scrollbar': { display: 'none' },
          msOverflowStyle: 'none',
          scrollbarWidth: 'none'
        }}>
          <Stack direction="row" spacing={1.25} sx={{ minWidth: 'max-content' }}>
            {FILTERS.map((filter) => {
              const isSelected = selectedFilter === filter;
              return (
                <Chip
                  key={filter}
                  label={filter}
                  onClick={() => setSelectedFilter(filter)}
                  sx={{
                    bgcolor: isSelected ? 'primary.main' : 'background.paper',
                    color: isSelected ? 'primary.contrastText' : 'text.primary',
                    borderRadius: '20px',
                    px: 2,
                    py: 2.8,
                    border: isSelected ? 'none' : `1px solid ${alpha(theme.palette.divider, 0.5)}`,
                    fontWeight: isSelected ? 600 : 'normal',
                    '&:hover': {
                      bgcolor: isSelected ? 'primary.dark' : alpha(theme.palette.text.primary, 0.04)
                    }
                  }}
                />
              );
            })}
          </Stack>
        </Box>
      </Box>

      {/* Jobs Grid */}
      <Container maxWidth="lg" sx={{ py: 3 }}>
        <Grid container spacing={3}>
          {jobs.map((job, index) => (
            <Grid item xs={12} lg={6} key={job.id}>
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.1, duration: 0.4 }}
              >
                <Card
                  onClick={() => navigate(`/listings/${job.id}`)}
                  sx={{
                    borderRadius: 4,
                    overflow: 'hidden',
                    cursor: 'pointer',
                    transition: 'all 0.3s ease',
                    '&:hover': {
                      transform: 'translateY(-4px)',
                      boxShadow: 4
                    }
                  }}
                >
                  <Box sx={{ display: 'flex', flexDirection: 'column', height: '100%' }}>
                    {/* Image Section */}
                    <Box sx={{ position: 'relative', height: 200 }}>
                      <Box
                        component="img"
                        src={job.image || job.images?.[0] || 'https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=500'}
                        alt={job.title}
                        sx={{ width: '100%', height: '100%', objectFit: 'cover' }}
                      />
                      
                      {/* Job Type Badge */}
                      <Box sx={{
                        position: 'absolute',
                        top: 12,
                        left: 12,
                        bgcolor: alpha(theme.palette.background.paper, 0.95),
                        borderRadius: '20px',
                        px: 1.5,
                        py: 0.75,
                        boxShadow: `0 2px 8px ${alpha('#000', 0.1)}`
                      }}>
                        <Typography variant="caption" sx={{ fontWeight: 700, fontSize: '0.6875rem' }}>
                          {job.type}
                        </Typography>
                      </Box>
                      
                      {/* Days Ago Badge */}
                      <Box sx={{
                        position: 'absolute',
                        top: 12,
                        right: 12,
                        bgcolor: alpha('#000', 0.7),
                        borderRadius: '20px',
                        px: 1.5,
                        py: 0.75
                      }}>
                        <Typography variant="caption" sx={{ color: 'white', fontWeight: 600, fontSize: '0.625rem' }}>
                          {getDaysAgo(job.created_at || job.createdAt)}
                        </Typography>
                      </Box>
                      
                      {/* Salary Badge */}
                      {job.price && job.price !== '0' && (
                        <Box sx={{
                          position: 'absolute',
                          bottom: 12,
                          right: 12,
                          bgcolor: 'primary.main',
                          borderRadius: '20px',
                          px: 1.5,
                          py: 0.75,
                          boxShadow: `0 2px 8px ${alpha(theme.palette.primary.main, 0.3)}`
                        }}>
                          <Typography variant="caption" sx={{ color: 'white', fontWeight: 'bold', fontSize: '0.8125rem' }}>
                            ETB {job.price}
                          </Typography>
                        </Box>
                      )}

                      {/* Live Activity Indicator */}
                      <Box sx={{ position: 'absolute', bottom: 12, left: 12 }}>
                        <LiveActivityIndicators listing={job} compact />
                      </Box>
                    </Box>

                    {/* Content Section */}
                    <Box sx={{ p: 2, flex: 1, display: 'flex', flexDirection: 'column', justifyContent: 'space-evenly' }}>
                      <Typography variant="h6" sx={{
                        fontFamily: 'Playfair Display, serif',
                        fontWeight: 'bold',
                        fontSize: '1.125rem',
                        mb: 1,
                        overflow: 'hidden',
                        textOverflow: 'ellipsis',
                        whiteSpace: 'nowrap'
                      }}>
                        {job.title}
                      </Typography>

                      <Stack direction="row" spacing={0.5} alignItems="center" mb={0.5}>
                        <Business sx={{ fontSize: 14, color: alpha(theme.palette.text.primary, 0.6) }} />
                        <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.75rem' }} noWrap>
                          {job.company || 'Unknown Company'}
                        </Typography>
                      </Stack>

                      <Stack direction="row" spacing={0.5} alignItems="center">
                        <LocationOn sx={{ fontSize: 14, color: alpha(theme.palette.text.primary, 0.6) }} />
                        <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.75rem' }} noWrap>
                          {job.location}
                        </Typography>
                      </Stack>
                    </Box>
                  </Box>
                </Card>
              </motion.div>
            </Grid>
          ))}
        </Grid>
      </Container>
    </Box>
  );
};

export default JobsPage;
import React, { useState, useEffect } from 'react';
import {
  Container, Typography, Box, Grid, Card, CardContent,
  TextField, Chip, Button, InputAdornment,
  useTheme, useMediaQuery, Stack, Divider, Paper,
  CircularProgress, Alert
} from '@mui/material';
import {
  Search, Bed, Bathtub, SquareFoot, LocationOn
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import { useNavigate } from 'react-router-dom';
import apiService from '../services/api';

// Import Love Features
import SmartSearch from '../components/SmartSearch';
import PriceDropAlert from '../components/PriceDropAlert';
import UserReviews from '../components/UserReviews';
import TrustBadges from '../components/TrustBadges';
import LiveActivityIndicators from '../components/LiveActivityIndicators';

const HomesPage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedListingType, setSelectedListingType] = useState('sell');
  const [properties, setProperties] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchProperties = async () => {
      try {
        setLoading(true);
        setError(null);
        const params = {
          category: 'homes',
          type: selectedListingType === 'sell' ? 'For Sale' : 'For Rent',
          search: searchQuery || undefined
        };
        const response = await apiService.getListings(params);
        setProperties(response.listings || response || []);
      } catch (err) {
        setError('Failed to load properties');
      } finally {
        setLoading(false);
      }
    };

    fetchProperties();
  }, [selectedListingType, searchQuery]);

  const handlePropertyClick = (propertyId) => {
    navigate(`/listings/${propertyId}`);
  };

  const getDaysAgo = (date) => {
    if (!date) return '';
    const difference = Date.now() - new Date(date).getTime();
    const days = Math.floor(difference / (1000 * 60 * 60 * 24));
    const hours = Math.floor(difference / (1000 * 60 * 60));

    if (days > 0) return `${days} days ago`;
    if (hours > 0) return `${hours} hours ago`;
    return 'Just now';
  };

  if (loading) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  if (error) {
    return (
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Alert severity="error">{error}</Alert>
      </Container>
    );
  }

  return (
    <Box sx={{
      bgcolor: 'background.default',
      minHeight: '100vh',
      pb: isMobile ? 10 : 0
    }}>
      {/* Hero Section */}
      <Box sx={{
        height: { xs: 500, md: 600 },
        position: 'relative',
        backgroundImage: 'url(https://images.unsplash.com/photo-1618220252344-8ec99ec624b1?q=80&w=1080)',
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: 'white',
        '&::before': {
          content: '""',
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          background: 'linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.4), transparent)',
        }
      }}>
        <Container maxWidth="lg" sx={{ position: 'relative', zIndex: 1, textAlign: 'center' }}>
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8 }}
          >
            <Typography
              variant={isMobile ? "h2" : "h1"}
              sx={{
                fontFamily: 'Playfair Display, serif',
                fontWeight: 700,
                mb: 1,
                color: theme.palette.secondary.main
              }}
            >
              Find Your Dream Home
            </Typography>
            <Typography
              variant={isMobile ? "h4" : "h3"}
              sx={{
                fontFamily: 'Playfair Display, serif',
                fontStyle: 'italic',
                mb: 3,
                opacity: 0.9
              }}
            >
              Quality Living Spaces
            </Typography>

            {/* Search Section */}
            <Box sx={{ maxWidth: 600, mx: 'auto' }}>
              <Paper
                sx={{
                  p: 1.5,
                  backgroundColor: 'rgba(255, 255, 255, 0.1)',
                  backdropFilter: 'blur(10px)',
                  borderRadius: 3,
                  border: '1px solid rgba(255, 255, 255, 0.2)',
                }}
              >
                <SmartSearch 
                  onSearch={(query) => setSearchQuery(query)}
                  placeholder="Search for your dream home..."
                />

                {/* Buy/Rent Toggle */}
                <Box
                  sx={{
                    display: 'flex',
                    backgroundColor: 'rgba(0, 0, 0, 0.2)',
                    borderRadius: 2,
                    overflow: 'hidden',
                  }}
                >
                  <Button
                    fullWidth
                    onClick={() => setSelectedListingType('sell')}
                    sx={{
                      py: 1.5,
                      backgroundColor: selectedListingType === 'sell' ? theme.palette.primary.main : 'transparent',
                      color: selectedListingType === 'sell' ? theme.palette.primary.contrastText : 'white',
                      borderRadius: 0,
                      textTransform: 'none',
                      fontWeight: 600,
                      '&:hover': {
                        backgroundColor: selectedListingType === 'sell' ? theme.palette.primary.dark : 'rgba(255, 255, 255, 0.1)',
                      },
                    }}
                  >
                    Buy
                  </Button>
                  <Divider orientation="vertical" flexItem sx={{ borderColor: 'rgba(255,255,255,0.2)' }} />
                  <Button
                    fullWidth
                    onClick={() => setSelectedListingType('rent')}
                    sx={{
                      py: 1.5,
                      backgroundColor: selectedListingType === 'rent' ? theme.palette.primary.main : 'transparent',
                      color: selectedListingType === 'rent' ? theme.palette.primary.contrastText : 'white',
                      borderRadius: 0,
                      textTransform: 'none',
                      fontWeight: 600,
                      '&:hover': {
                        backgroundColor: selectedListingType === 'rent' ? theme.palette.primary.dark : 'rgba(255, 255, 255, 0.1)',
                      },
                    }}
                  >
                    Rent
                  </Button>
                </Box>
              </Paper>
            </Box>
          </motion.div>
        </Container>
      </Box>

      {/* Featured Properties */}
      <Container maxWidth="lg" sx={{ py: 4 }}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
          <Typography variant={isMobile ? "h5" : "h4"} fontWeight="bold" color="text.primary">
            Featured Properties
          </Typography>
          <Typography variant="body2" color="text.secondary">
            {properties.length} properties found
          </Typography>
        </Box>

        {properties.length === 0 ? (
          <Typography variant="body1" color="text.secondary" textAlign="center" sx={{ py: 4 }}>
            No properties found
          </Typography>
        ) : (
          <Grid container spacing={{ xs: 2, md: 3 }}>
            {properties.map((property, index) => (
              <Grid item xs={12} md={6} key={property.id}>
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  whileInView={{ opacity: 1, y: 0 }}
                  transition={{ delay: index * 0.1, duration: 0.4 }}
                  viewport={{ once: true }}
                >
                  <Card
                    onClick={() => handlePropertyClick(property.id)}
                    sx={{
                      height: { xs: 280, md: 320 },
                      cursor: 'pointer',
                      borderRadius: 3,
                      overflow: 'hidden',
                      transition: 'all 0.3s ease',
                      border: `1px solid ${alpha(theme.palette.divider, 0.1)}`,
                      '&:hover': {
                        transform: 'translateY(-8px)',
                        boxShadow: `0 12px 40px ${alpha(theme.palette.primary.main, 0.15)}`,
                        borderColor: theme.palette.primary.main,
                      },
                    }}
                  >
                    {/* Property Image */}
                    <Box sx={{ position: 'relative', height: { xs: 180, md: 200 } }}>
                      {(property.image || property.images?.[0]) && (
                        <Box
                          component="img"
                          src={property.image || property.images?.[0]}
                          alt={property.title}
                          sx={{
                            width: '100%',
                            height: '100%',
                            objectFit: 'cover',
                          }}
                        />
                      )}

                      {/* Badges */}
                      <Box sx={{ position: 'absolute', top: 12, left: 12 }}>
                        <Chip
                          label={property.type}
                          size="small"
                          sx={{
                            backgroundColor: theme.palette.background.paper,
                            color: theme.palette.text.primary,
                            fontSize: '0.7rem',
                            fontWeight: 600,
                            borderRadius: '12px',
                          }}
                        />
                      </Box>

                      <Box sx={{ position: 'absolute', top: 12, right: 12 }}>
                        <Chip
                          label={getDaysAgo(property.created_at || property.createdAt)}
                          size="small"
                          sx={{
                            backgroundColor: 'rgba(0,0,0,0.7)',
                            color: 'white',
                            fontSize: '0.65rem',
                            fontWeight: 600,
                            borderRadius: '12px',
                          }}
                        />
                      </Box>

                      <Box sx={{ position: 'absolute', bottom: 12, right: 12 }}>
                        <Chip
                          label={`ETB ${property.price}`}
                          size="small"
                          sx={{
                            backgroundColor: theme.palette.primary.main,
                            color: theme.palette.primary.contrastText,
                            fontSize: '0.75rem',
                            fontWeight: 600,
                            borderRadius: '12px',
                          }}
                        />
                      </Box>
                    </Box>

                    {/* Property Details */}
                    <CardContent sx={{ p: 2 }}>
                      <Typography
                        variant="h6"
                        fontWeight="bold"
                        sx={{
                          mb: 1,
                          display: '-webkit-box',
                          WebkitLineClamp: 1,
                          WebkitBoxOrient: 'vertical',
                          overflow: 'hidden',
                        }}
                      >
                        {property.title}
                      </Typography>

                      <Box sx={{ display: 'flex', alignItems: 'center', mb: 1.5 }}>
                        <LocationOn sx={{ fontSize: 16, mr: 0.5, color: 'text.secondary' }} />
                        <Typography variant="body2" color="text.secondary" noWrap>
                          {property.location}
                        </Typography>
                      </Box>

                      <Divider sx={{ my: 1.5 }} />

                      <Box sx={{ display: 'flex', justifyContent: 'space-between' }}>
                        <Box sx={{ display: 'flex', alignItems: 'center' }}>
                          <Bed sx={{ fontSize: 16, mr: 0.5, color: 'primary.main' }} />
                          <Typography variant="body2" fontWeight="500">
                            {property.bedrooms || 0} Beds
                          </Typography>
                        </Box>

                        <Box sx={{ display: 'flex', alignItems: 'center' }}>
                          <Bathtub sx={{ fontSize: 16, mr: 0.5, color: 'primary.main' }} />
                          <Typography variant="body2" fontWeight="500">
                            {property.bathrooms || 0} Baths
                          </Typography>
                        </Box>

                        <Box sx={{ display: 'flex', alignItems: 'center' }}>
                          <SquareFoot sx={{ fontSize: 16, mr: 0.5, color: 'primary.main' }} />
                          <Typography variant="body2" fontWeight="500">
                            {property.areaSqft || 0} sqft
                          </Typography>
                        </Box>
                      </Box>
                    </CardContent>
                  </Card>
                </motion.div>
              </Grid>
            ))}
          </Grid>
        )}
      </Container>
    </Box>
  );
};
export default HomesPage;
import React, { useState, useEffect } from 'react';
import {
  Container, Typography, Box, Grid, Card, CardContent, TextField,
  Button, InputAdornment, IconButton, useTheme, useMediaQuery,
  Stack, CircularProgress, Alert,
} from '@mui/material';
import {
  Search, Work, Gavel, Apartment, DirectionsCar,
  LocationOn, VerifiedUser, Security, AutoAwesome,
  ArrowForward, Clear
} from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import apiService from '../services/api';

const HomePage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const [searchQuery, setSearchQuery] = useState('');
  const [categories, setCategories] = useState([]);
  const [featuredListings, setFeaturedListings] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // Fetch data from backend
  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        
        // Fetch categories and featured listings in parallel
        const [categoriesData, listingsData] = await Promise.all([
          apiService.getCategories().catch(() => ({ data: [] })),
          apiService.getListings({ limit: 8, sortBy: 'created_at', sortOrder: 'DESC' }).catch(() => ({ data: [] }))
        ]);
        
        // Handle backend response structure
        const categoriesResponse = categoriesData.data?.data?.categories || categoriesData.data?.categories || [];
        const listingsResponse = listingsData.data?.data?.listings || listingsData.data?.listings || [];
        
        setCategories(categoriesResponse);
        setFeaturedListings(listingsResponse);
        setError(null);
      } catch (err) {
        console.error('Failed to load homepage data:', err);
        setError('Backend may not have data yet. Showing default content.');
        // Set fallback data to prevent empty page
        setCategories([
          { id: 1, name: 'Jobs', icon: 'work' },
          { id: 2, name: 'Homes', icon: 'apartment' },
          { id: 3, name: 'Cars', icon: 'directions_car' },
          { id: 4, name: 'Tenders', icon: 'gavel' }
        ]);
        setFeaturedListings([]);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);

  const handleSearch = () => {
    if (searchQuery.trim()) {
      navigate(`/listings?search=${encodeURIComponent(searchQuery.trim())}`);
    }
  };

  // Get icon for category
  const getCategoryIcon = (categoryName) => {
    const icons = {
      'jobs': <Work fontSize="large" />,
      'tenders': <Gavel fontSize="large" />,
      'homes': <Apartment fontSize="large" />,
      'cars': <DirectionsCar fontSize="large" />,
    };
    return icons[categoryName?.toLowerCase()] || <Work fontSize="large" />;
  };

  if (loading) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  // Don't show error page - show homepage with fallback data
  if (error && categories.length === 0) {
    // Show error briefly but continue to render homepage
    setTimeout(() => setError(null), 3000);
  }

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh' }}>
      {/* Hero Section */}
      <Box sx={{
        height: { xs: 600, md: 650 },
        position: 'relative',
        backgroundImage: 'url(https://images.unsplash.com/photo-1556740738-b6a63e27c4df?q=80&w=1080)',
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: 'white',
        '&::before': {
          content: '""',
          position: 'absolute',
          top: 0, left: 0, right: 0, bottom: 0,
          background: 'linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.4), transparent)',
        }
      }}>
        <Container maxWidth="lg" sx={{ position: 'relative', zIndex: 1, textAlign: 'center' }}>
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}>
            <Typography variant={isMobile ? "h3" : "h1"} sx={{
              fontFamily: 'Playfair Display, serif',
              fontWeight: 700,
              mb: 1,
              color: theme.palette.secondary.main
            }}>
              Find Your Next Opportunity
            </Typography>
            <Typography variant={isMobile ? "h5" : "h4"} sx={{
              fontFamily: 'Playfair Display, serif',
              fontStyle: 'italic',
              mb: 3,
              opacity: 0.9
            }}>
              Jobs, Tenders, Homes & Cars
            </Typography>
            <Typography variant={isMobile ? "h6" : "h3"} sx={{
              fontWeight: 600,
              mb: 4,
              maxWidth: 800,
              mx: 'auto',
              lineHeight: 1.2
            }}>
              The Gateway to Ethiopian Modern Marketplace
            </Typography>

            <Box sx={{ maxWidth: 600, mx: 'auto' }}>
              <TextField
                fullWidth
                placeholder="What are you looking for?"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                variant="outlined"
                sx={{
                  bgcolor: 'white',
                  borderRadius: 3,
                  '& .MuiOutlinedInput-root': {
                    borderRadius: 3,
                    '& fieldset': { border: 'none' },
                  }
                }}
                InputProps={{
                  startAdornment: (
                    <InputAdornment position="start">
                      <Search color="primary" />
                    </InputAdornment>
                  ),
                  endAdornment: searchQuery && (
                    <InputAdornment position="end">
                      <IconButton onClick={() => setSearchQuery('')}>
                        <Clear />
                      </IconButton>
                    </InputAdornment>
                  )
                }}
              />
            </Box>
          </motion.div>
        </Container>
      </Box>

      {/* Popular Categories */}
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>
          <Typography variant={isMobile ? "h5" : "h4"} fontWeight="bold">
            Popular Categories
          </Typography>
        </Box>

        <Grid container spacing={3}>
          {categories.map((cat, i) => (
            <Grid item xs={6} md={3} key={cat.id}>
              <motion.div
                initial={{ opacity: 0, scale: 0.9 }}
                whileInView={{ opacity: 1, scale: 1 }}
                transition={{ delay: i * 0.1 }}
                viewport={{ once: true }}
              >
                <Card
                  onClick={() => navigate(`/${cat.name.toLowerCase()}`)}
                  sx={{
                    cursor: 'pointer',
                    borderRadius: 4,
                    height: 200,
                    position: 'relative',
                    overflow: 'hidden',
                    '&:hover': {
                      transform: 'translateY(-5px)',
                      boxShadow: 8
                    },
                    transition: '0.3s'
                  }}
                >
                  <Box sx={{
                    position: 'absolute',
                    top: 0, left: 0, right: 0, bottom: 0,
                    backgroundImage: `url(${cat.image || 'https://images.unsplash.com/photo-1556740738-b6a63e27c4df?q=80&w=1080'})`,
                    backgroundSize: 'cover',
                    backgroundPosition: 'center',
                  }} />
                  <Box sx={{
                    position: 'absolute',
                    top: 0, left: 0, right: 0, bottom: 0,
                    bgcolor: 'rgba(0,0,0,0.5)',
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    justifyContent: 'center',
                    color: 'white'
                  }}>
                    <Box sx={{ mb: 1 }}>{getCategoryIcon(cat.name)}</Box>
                    <Typography variant="h6" fontWeight="bold">{cat.name}</Typography>
                  </Box>
                </Card>
              </motion.div>
            </Grid>
          ))}
        </Grid>
      </Container>

      {/* Posts Section - Main Content */}
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>
          <Typography variant={isMobile ? "h5" : "h4"} fontWeight="bold">
            Latest Posts
          </Typography>
          <Button endIcon={<ArrowForward />} color="primary">View All Posts</Button>
        </Box>

        <Grid container spacing={3}>
          {featuredListings.length > 0 ? (
            featuredListings.map((listing, i) => (
              <Grid item xs={12} sm={6} md={4} lg={3} key={listing.id}>
                <motion.div
                  initial={{ opacity: 0, y: 30 }}
                  whileInView={{ opacity: 1, y: 0 }}
                  transition={{ delay: i * 0.1 }}
                  viewport={{ once: true }}
                >
                  <ListingCard key={listing.id} listing={listing} index={i} />
                </motion.div>
              </Grid>
            ))
          ) : (
            <Grid item xs={12}>
              <Box sx={{ textAlign: 'center', py: 8 }}>
                <Typography variant="h6" color="text.secondary" gutterBottom>
                  No listings available yet
                </Typography>
                <Typography variant="body2" color="text.secondary" sx={{ mb: 3 }}>
                  Be the first to post a listing!
                </Typography>
                <Button variant="contained" onClick={() => navigate('/post-ad')}>
                  Post First Listing
                </Button>
              </Box>
            </Grid>
          )}
        </Grid>
      </Container>

      {/* Recently Added */}
      <Box sx={{ bgcolor: 'background.paper', py: 6 }}>
        <Container maxWidth="lg">
          <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>
            <Typography variant={isMobile ? "h5" : "h4"} fontWeight="bold">
              Recently Added
            </Typography>
            <Button endIcon={<ArrowForward />} color="primary">View All</Button>
          </Box>

          <Box sx={{
            display: 'flex',
            overflowX: 'auto',
            pb: 2,
            gap: 3,
            '&::-webkit-scrollbar': { display: 'none' },
            msOverflowStyle: 'none',
            scrollbarWidth: 'none'
          }}>
            {featuredListings.slice(0, 4).map((listing, i) => (
              <ListingCard key={listing.id} listing={listing} index={i} />
            ))}
          </Box>
        </Container>
      </Box>

      {/* Premium Properties */}
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>
          <Typography variant={isMobile ? "h5" : "h4"} fontWeight="bold">
            Premium Properties
          </Typography>
          <Button endIcon={<ArrowForward />} color="primary">View All</Button>
        </Box>

        <Box sx={{
          display: 'flex',
          overflowX: 'auto',
          pb: 2,
          gap: 3,
          '&::-webkit-scrollbar': { display: 'none' }
        }}>
          {featuredListings.slice(4, 8).map((listing, i) => (
            <ListingCard key={listing.id} listing={listing} index={i} />
          ))}
        </Box>
      </Container>

      {/* Why Choose Us */}
      <Box sx={{ bgcolor: theme.palette.mode === 'dark' ? 'rgba(255,255,255,0.05)' : 'white', py: 8 }}>
        <Container maxWidth="lg">
          <Typography variant={isMobile ? "h4" : "h3"} fontWeight="bold" textAlign="center" mb={6}>
            Our Promise
          </Typography>

          <Grid container spacing={4}>
            <BenefitItem
              icon={<VerifiedUser sx={{ fontSize: 40, color: 'primary.main' }} />}
              title="Verified Quality"
              desc="Every listing is verified by our team to ensure the highest quality standards."
            />
            <BenefitItem
              icon={<Security sx={{ fontSize: 40, color: 'primary.main' }} />}
              title="Secure Transactions"
              desc="We provide a secure environment for all your business transactions."
            />
            <BenefitItem
              icon={<AutoAwesome sx={{ fontSize: 40, color: 'primary.main' }} />}
              title="Premium Experience"
              desc="Enjoy a seamless and premium user experience tailored for you."
            />
          </Grid>
        </Container>
      </Box>

      {/* Market Insights */}
      <Box sx={{ bgcolor: alpha(theme.palette.primary.main, 0.05), py: 8 }}>
        <Container maxWidth="lg">
          <Typography variant={isMobile ? "h4" : "h3"} fontWeight="bold" textAlign="center" mb={2}>
            Market Insights
          </Typography>
          <Typography variant="h6" textAlign="center" color="text.secondary" mb={6}>
            Stay updated with the latest trends in the Ethiopian market
          </Typography>

          <Grid container spacing={4}>
            <InsightItem
              title="Job Opportunities"
              value={featuredListings.filter(l => l.category === 'jobs' || l.type === 'jobs').length + '+'}
              desc="Active Listings"
              color="success.main"
            />
            <InsightItem
              title="Properties"
              value={featuredListings.filter(l => l.category === 'homes' || l.type === 'homes').length + '+'}
              desc="Available Properties"
              color="info.main"
            />
            <InsightItem
              title="Cars"
              value={featuredListings.filter(l => l.category === 'cars' || l.type === 'cars').length + '+'}
              desc="Available Cars"
              color="warning.main"
            />
          </Grid>
        </Container>
      </Box>
    </Box>
  );
};

// ListingCard Component
const ListingCard = ({ listing, index }) => {
  const navigate = useNavigate();

  // Handle real backend data structure
  const imageUrl = listing.images?.[0] || listing.image || 'https://images.unsplash.com/photo-1556740738-b6a63e27c4df?q=80&w=500';
  const title = listing.title || listing.name || 'Untitled Listing';
  const location = listing.location || `${listing.city || ''}, ${listing.country || 'Ethiopia'}`.replace(/^,\s/, '');
  const price = listing.price ? (listing.type === 'tender' ? 'Tender' : `ETB ${listing.price.toLocaleString()}`) : 'Price on request';

  return (
    <motion.div
      initial={{ opacity: 0, x: 50 }}
      whileInView={{ opacity: 1, x: 0 }}
      transition={{ delay: index * 0.1 }}
      viewport={{ once: true }}
    >
      <Card
        onClick={() => navigate(`/listings/${listing.id}`)}
        sx={{
          minWidth: 280,
          maxWidth: 280,
          borderRadius: 4,
          cursor: 'pointer',
          '&:hover': { transform: 'translateY(-5px)', boxShadow: 8 },
          transition: 'all 0.3s ease'
        }}
      >
        <Box sx={{ height: 160, overflow: 'hidden' }}>
          <Box
            component="img"
            src={imageUrl}
            alt={title}
            sx={{ width: '100%', height: '100%', objectFit: 'cover' }}
          />
        </Box>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" noWrap title={title}>
            {title}
          </Typography>
          <Stack direction="row" alignItems="center" spacing={0.5} sx={{ mt: 1, mb: 1, color: 'text.secondary' }}>
            <LocationOn fontSize="small" />
            <Typography variant="body2" noWrap>{location}</Typography>
          </Stack>
          <Typography variant="h6" color="primary" fontWeight="bold">
            {price}
          </Typography>
        </CardContent>
      </Card>
    </motion.div>
  );
};

const BenefitItem = ({ icon, title, desc }) => (
  <Grid item xs={12} md={4}>
    <Box sx={{ textAlign: 'center', p: 2 }}>
      <Box sx={{ mb: 2 }}>{icon}</Box>
      <Typography variant="h5" fontWeight="bold" gutterBottom>{title}</Typography>
      <Typography color="text.secondary">{desc}</Typography>
    </Box>
  </Grid>
);

const InsightItem = ({ title, value, desc, color }) => (
  <Grid item xs={12} md={4}>
    <Card sx={{ textAlign: 'center', p: 4, borderRadius: 4, borderTop: `4px solid`, borderColor: color }}>
      <Typography variant="h6" color="text.secondary" gutterBottom>{title}</Typography>
      <Typography variant="h3" fontWeight="bold" sx={{ color: color, my: 1 }}>{value}</Typography>
      <Typography variant="body1" fontWeight="medium">{desc}</Typography>
    </Card>
  </Grid>
);

export default HomePage;
import React, { useState, useEffect } from 'react';
import {
    Container, Grid, Card, Typography, Box, IconButton, useTheme, useMediaQuery, Stack, Divider,
    CircularProgress, Alert
} from '@mui/material';
import {
    Favorite, FavoriteBorder, LocationOn, CalendarToday, KingBed, Bathtub, SquareFoot,
    Speed, LocalGasStation, CalendarMonth, Delete
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import { useNavigate } from 'react-router-dom';
import apiService from '../services/api';

const FavoritesPage = () => {
    const theme = useTheme();
    const isMobile = useMediaQuery(theme.breakpoints.down('md'));
    const navigate = useNavigate();
    const [favorites, setFavorites] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);

    useEffect(() => {
        const fetchFavorites = async () => {
            try {
                setLoading(true);
                setError(null);
                const response = await apiService.getFavorites();
                setFavorites(response.favorites || response || []);
            } catch (err) {
                setError('Failed to load favorites');
            } finally {
                setLoading(false);
            }
        };

        fetchFavorites();
    }, []);

    const getDaysAgo = (date) => {
        const diff = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));
        if (diff === 0) return 'Today';
        if (diff === 1) return 'Yesterday';
        return `${diff} days ago`;
    };

    const removeFavorite = async (id) => {
        try {
            await apiService.toggleFavorite(id);
            setFavorites(prev => prev.filter(fav => fav.id !== id));
        } catch (err) {
            // Optionally show an error toast
        }
    };

    const renderSpecs = (listing) => {
        if (listing.category === 'Homes') {
            return (
                <Stack direction="row" spacing={1} flexWrap="wrap" useFlexGap>
                    <Stack direction="row" spacing={0.75} alignItems="center">
                        <KingBed sx={{ fontSize: 14, color: 'primary.main' }} />
                        <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {listing.bedrooms || 0} Beds
                        </Typography>
                    </Stack>
                    <Stack direction="row" spacing={0.75} alignItems="center">
                        <Bathtub sx={{ fontSize: 14, color: 'primary.main' }} />
                        <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {listing.bathrooms || 0} Baths
                        </Typography>
                    </Stack>
                    <Stack direction="row" spacing={0.75} alignItems="center">
                        <SquareFoot sx={{ fontSize: 14, color: 'primary.main' }} />
                        <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {listing.areaSqft || 0} Sq Ft
                        </Typography>
                    </Stack>
                </Stack>
            );
        } else if (listing.category === 'Cars') {
            return (
                <Stack direction="row" spacing={1} flexWrap="wrap" useFlexGap>
                    <Stack direction="row" spacing={0.75} alignItems="center">
                        <CalendarMonth sx={{ fontSize: 14, color: 'primary.main' }} />
                        <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {listing.year || 'N/A'}
                        </Typography>
                    </Stack>
                    <Stack direction="row" spacing={0.75} alignItems="center">
                        <Speed sx={{ fontSize: 14, color: 'primary.main' }} />
                        <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {listing.transmission || 'N/A'}
                        </Typography>
                    </Stack>
                    <Stack direction="row" spacing={0.75} alignItems="center">
                        <LocalGasStation sx={{ fontSize: 14, color: 'primary.main' }} />
                        <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {listing.fuel || 'N/A'}
                        </Typography>
                    </Stack>
                </Stack>
            );
        }
        return null;
    };

    if (loading) {
        return (
            <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
                <CircularProgress />
            </Box>
        );
    }

    if (error) {
        return (
            <Container maxWidth="lg" sx={{ py: 6 }}>
                <Alert severity="error">{error}</Alert>
            </Container>
        );
    }

    return (
        <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: isMobile ? 10 : 4 }}>
            {/* Header */}
            <Box sx={{ bgcolor: 'primary.main', color: 'white', py: 6 }}>
                <Container maxWidth="lg">
                    <Stack direction="row" spacing={2} alignItems="center">
                        <Favorite sx={{ fontSize: isMobile ? 32 : 40 }} />
                        <Box>
                            <Typography variant={isMobile ? "h4" : "h3"} fontWeight="bold" gutterBottom>
                                My Favorites
                            </Typography>
                            <Typography variant="body1" sx={{ opacity: 0.9 }}>
                                {favorites.length} saved {favorites.length === 1 ? 'listing' : 'listings'}
                            </Typography>
                        </Box>
                    </Stack>
                </Container>
            </Box>

            <Container maxWidth="lg" sx={{ mt: 4 }}>
                {favorites.length === 0 ? (
                    <Box sx={{ textAlign: 'center', py: 8 }}>
                        <FavoriteBorder sx={{ fontSize: 80, color: 'text.secondary', mb: 2 }} />
                        <Typography variant="h5" color="text.secondary" gutterBottom>
                            No favorites yet
                        </Typography>
                        <Typography variant="body1" color="text.secondary">
                            Start adding listings to your favorites to see them here
                        </Typography>
                    </Box>
                ) : (
                    <Grid container spacing={3}>
                        {favorites.map((listing, index) => (
                            <Grid item xs={12} sm={6} md={4} key={listing.id}>
                                <motion.div
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    transition={{ delay: index * 0.1, duration: 0.4 }}
                                >
                                    <Card
                                        onClick={() => navigate(`/listings/${listing.id}`)}
                                        sx={{
                                            borderRadius: 4,
                                            overflow: 'hidden',
                                            cursor: 'pointer',
                                            transition: 'all 0.3s ease',
                                            '&:hover': {
                                                transform: 'translateY(-4px)',
                                                boxShadow: 4
                                            }
                                        }}
                                    >
                                        <Box sx={{ display: 'flex', flexDirection: 'column' }}>
                                            {/* Image Section */}
                                            <Box sx={{ position: 'relative', height: 200 }}>
                                                <Box
                                                    component="img"
                                                    src={listing.image || listing.images?.[0] || 'https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?q=80&w=500'}
                                                    alt={listing.title}
                                                    sx={{ width: '100%', height: '100%', objectFit: 'cover' }}
                                                />
                                                {/* Category Badge - Top Left */}
                                                <Box sx={{
                                                    position: 'absolute',
                                                    top: 12,
                                                    left: 12,
                                                    bgcolor: theme.palette.background.paper,
                                                    borderRadius: '20px',
                                                    px: 1.5,
                                                    py: 0.75
                                                }}>
                                                    <Typography variant="caption" sx={{ fontWeight: 700, fontSize: '0.6875rem' }}>
                                                        {listing.category}
                                                    </Typography>
                                                </Box>
                                                {/* Days Ago Badge - Top Right */}
                                                <Box sx={{
                                                    position: 'absolute',
                                                    top: 12,
                                                    right: 12,
                                                    bgcolor: alpha('#000', 0.7),
                                                    borderRadius: '20px',
                                                    px: 1.5,
                                                    py: 0.75
                                                }}>
                                                    <Typography variant="caption" sx={{ color: 'white', fontWeight: 600, fontSize: '0.625rem' }}>
                                                        {getDaysAgo(listing.created_at || listing.createdAt)}
                                                    </Typography>
                                                </Box>
                                                {/* Remove Button - Bottom Left */}
                                                <IconButton
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        removeFavorite(listing.id);
                                                    }}
                                                    sx={{
                                                        position: 'absolute',
                                                        bottom: 12,
                                                        left: 12,
                                                        bgcolor: alpha('#fff', 0.9),
                                                        '&:hover': { bgcolor: 'white' },
                                                        width: 36,
                                                        height: 36
                                                    }}
                                                >
                                                    <Delete color="error" sx={{ fontSize: 20 }} />
                                                </IconButton>
                                            </Box>

                                            {/* Content Section */}
                                            <Box sx={{ p: 2 }}>
                                                <Typography variant="caption" color="text.secondary" sx={{ fontSize: '0.6875rem', fontWeight: 600, display: 'block', mb: 0.5 }}>
                                                    {listing.type}
                                                </Typography>

                                                <Typography variant="h6" sx={{
                                                    fontWeight: 'bold',
                                                    fontSize: '1.05rem',
                                                    mb: 1,
                                                    overflow: 'hidden',
                                                    textOverflow: 'ellipsis',
                                                    whiteSpace: 'nowrap'
                                                }}>
                                                    {listing.title}
                                                </Typography>

                                                <Stack direction="row" spacing={0.5} alignItems="center" mb={1}>
                                                    <LocationOn sx={{ fontSize: 14, color: 'text.secondary' }} />
                                                    <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.75rem' }} noWrap>
                                                        {listing.location}
                                                    </Typography>
                                                </Stack>

                                                <Divider sx={{ my: 1 }} />

                                                {/* Specs */}
                                                {renderSpecs(listing) && (
                                                    <Box sx={{ mb: 1 }}>
                                                        {renderSpecs(listing)}
                                                    </Box>
                                                )}

                                                <Typography variant="h6" color="primary.main" fontWeight="bold" sx={{ fontSize: '1.125rem', mt: 1 }}>
                                                    ETB {listing.price}
                                                </Typography>
                                            </Box>
                                        </Box>
                                    </Card>
                                </motion.div>
                            </Grid>
                        ))}
                    </Grid>
                )}
            </Container>
        </Box>
    );
};

export default FavoritesPage;
import React, { useState, useEffect } from 'react';
import {
  Container, Typography, Box, Grid, Card, CardContent, Button, Avatar,
  Chip, IconButton, useTheme, useMediaQuery, Stack, Divider, Paper,
  LinearProgress, List, ListItem, ListItemText, ListItemIcon, Tabs, Tab,
  CircularProgress, Alert
} from '@mui/material';
import {
  Person, Edit, Settings, NotificationsActive, FavoriteBorder, Visibility,
  PostAdd, Chat, Phone, Email, LocationOn, AccessTime, TrendingUp,
  Star, ArrowForward, Home, Work, DirectionsCar, Gavel, MoreVert,
  Delete, Share, CheckCircle, PendingActions, Error as ErrorIcon
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import { useNavigate } from 'react-router-dom';
import toast from 'react-hot-toast';
import apiService from '../services/api';
import { formatDistanceToNow } from '../utils/dateUtils';

const DashboardPage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();
  const [activeTab, setActiveTab] = useState(0);
  const [user, setUser] = useState(null);
  const [stats, setStats] = useState(null);
  const [userListings, setUserListings] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const [notifications, setNotifications] = useState([]);

  // Fetch dashboard data
  useEffect(() => {
    const fetchDashboardData = async () => {
      try {
        setLoading(true);

        // Fetch dashboard data from backend
        const dashboardData = await apiService.getDashboardData();
        setUser(dashboardData?.user || {
          name: 'User',
          email: '',
          phone: '',
          location: '',
          memberSince: '',
          verified: false,
          avatar: null,
          rating: 0,
          totalReviews: 0
        });
        setStats(dashboardData?.stats || {
          totalPosts: 0,
          activePosts: 0,
          totalViews: 0,
          responseRate: 0
        });
        setUserListings(dashboardData?.listings || []);

        // Fetch notifications
        try {
          const notificationsData = await apiService.getNotifications();
          setNotifications(notificationsData || []);
        } catch (e) {
        }

      } catch (err) {
        setError('Failed to load dashboard data');
      } finally {
        setLoading(false);
      }
    };

    fetchDashboardData();
  }, []);

  // Handle loading and error states
  if (loading) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  if (error) {
    return (
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Alert severity="error">{error}</Alert>
      </Container>
    );
  }

  // Handle tab change
  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  // Handle listing actions
  const handleEditListing = (listingId) => {
    navigate(`/listings/${listingId}/edit`);
  };

  const handleDeleteListing = async (listingId) => {
    try {
      await apiService.deleteListing(listingId);
      setUserListings(prev => prev.filter(listing => listing.id !== listingId));
      toast.success('Listing deleted successfully');
    } catch (error) {
      toast.error('Failed to delete listing');
    }
  };

  const handleShareListing = (id) => {
    navigator.clipboard.writeText(`${window.location.origin}/listings/${id}`);
    toast.success('Share link copied to clipboard');
  };

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'pending': return 'warning';
      case 'closed': return 'error';
      default: return 'default';
    }
  };

  const getStatusIcon = (status) => {
    switch (status) {
      case 'active': return <CheckCircle sx={{ fontSize: 16 }} />;
      case 'pending': return <PendingActions sx={{ fontSize: 16 }} />;
      case 'closed': return <ErrorIcon sx={{ fontSize: 16 }} />;
      default: return null;
    }
  };

  const getCategoryIcon = (category) => {
    switch (category) {
      case 'Homes': return <Home />;
      case 'Cars': return <DirectionsCar />;
      case 'Jobs': return <Work />;
      case 'Tenders': return <Gavel />;
      default: return <PostAdd />;
    }
  };

  const getDaysAgo = (date) => {
    if (!date) return '';
    const diff = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));
    if (diff === 0) return 'Today';
    if (diff === 1) return 'Yesterday';
    return `${diff} days ago`;
  };

  return (
    <Box sx={{
      bgcolor: 'background.default',
      minHeight: '100vh',
      backgroundImage: {
        xs: 'linear-gradient(rgba(255,255,255,0.92), rgba(255,255,255,0.92)), url("https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1080")',
        md: 'linear-gradient(rgba(255,255,255,0.95), rgba(255,255,255,0.95)), url("https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=1080")'
      },
      backgroundSize: 'cover',
      backgroundPosition: 'center',
      backgroundAttachment: 'fixed',
      pb: isMobile ? 10 : 0
    }}>
      {/* Header */}
      <Box sx={{
        bgcolor: 'primary.main',
        color: 'white',
        py: 3,
        position: 'relative',
        '&::after': {
          content: '""',
          position: 'absolute',
          bottom: 0,
          left: 0,
          right: 0,
          height: '4px',
          background: 'linear-gradient(90deg, #D4AF37, #B58E2A, #D4AF37)',
        }
      }}>
        <Container maxWidth="lg">
          <Stack direction="row" justifyContent="space-between" alignItems="center">
            <Typography variant="h4" fontWeight="bold">
              My Dashboard
            </Typography>
            <Stack direction="row" spacing={2}>
              <IconButton color="inherit" onClick={() => navigate('/notifications')}>
                <NotificationsActive />
              </IconButton>
              <IconButton color="inherit" onClick={() => navigate('/settings')}>
                <Settings />
              </IconButton>
            </Stack>
          </Stack>
        </Container>
      </Box>

      <Container maxWidth="lg" sx={{ py: 4 }}>
        {/* User Profile Card */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
        >
          <Card sx={{
            p: 3,
            borderRadius: 4,
            mb: 4,
            boxShadow: `0 8px 32px ${alpha(theme.palette.common.black, 0.1)}`,
            backdropFilter: 'blur(10px)',
            backgroundColor: alpha(theme.palette.background.paper, 0.95)
          }}>
            <Grid container spacing={3} alignItems="center">
              <Grid item xs={12} md={2}>
                <Avatar sx={{
                  width: 80,
                  height: 80,
                  bgcolor: 'primary.main',
                  fontSize: '2rem',
                  mx: 'auto',
                  boxShadow: `0 4px 20px ${alpha(theme.palette.primary.main, 0.3)}`
                }}>
                  {user.avatar || user.name?.[0]}
                </Avatar>
              </Grid>
              <Grid item xs={12} md={6}>
                <Stack spacing={1}>
                  <Stack direction="row" spacing={1} alignItems="center">
                    <Typography variant="h5" fontWeight="bold">
                      {user.name}
                    </Typography>
                    {user.verified && <CheckCircle sx={{ color: 'primary.main', fontSize: 24 }} />}
                  </Stack>
                  <Stack direction="row" spacing={2} alignItems="center" color="text.secondary">
                    <Stack direction="row" spacing={0.5} alignItems="center">
                      <Email sx={{ fontSize: 16 }} />
                      <Typography variant="body2">{user.email}</Typography>
                    </Stack>
                    <Stack direction="row" spacing={0.5} alignItems="center">
                      <Phone sx={{ fontSize: 16 }} />
                      <Typography variant="body2">{user.phone}</Typography>
                    </Stack>
                  </Stack>
                  <Stack direction="row" spacing={0.5} alignItems="center" color="text.secondary">
                    <LocationOn sx={{ fontSize: 16 }} />
                    <Typography variant="body2">{user.location}</Typography>
                  </Stack>
                  <Typography variant="body2" color="text.secondary">
                    Member since {user.memberSince}
                  </Typography>
                </Stack>
              </Grid>
              <Grid item xs={12} md={4}>
                <Box sx={{ textAlign: { xs: 'center', md: 'right' } }}>
                  <Stack direction="row" spacing={1} alignItems="center" justifyContent={{ xs: 'center', md: 'flex-end' }}>
                    <Star sx={{ color: 'warning.main', fontSize: 20 }} />
                    <Typography variant="h6" fontWeight="bold">
                      {user.rating}
                    </Typography>
                    <Typography variant="body2" color="text.secondary">
                      ({user.totalReviews} reviews)
                    </Typography>
                  </Stack>
                  <Button
                    variant="outlined"
                    sx={{ mt: 2, borderRadius: 3 }}
                    onClick={() => navigate('/profile')}
                  >
                    View Profile
                  </Button>
                </Box>
              </Grid>
            </Grid>
          </Card>
        </motion.div>

        {/* Statistics Cards */}
        <Grid container spacing={3} sx={{ mb: 4 }}>
          {[
            { label: 'Total Posts', value: stats.totalPosts, icon: <PostAdd />, color: 'primary' },
            { label: 'Active Posts', value: stats.activePosts, icon: <Visibility />, color: 'success' },
            { label: 'Total Views', value: stats.totalViews, icon: <TrendingUp />, color: 'info' },
            { label: 'Response Rate', value: `${stats.responseRate}%`, icon: <Chat />, color: 'warning' }
          ].map((stat, index) => (
            <Grid item xs={6} md={3} key={index}>
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.1, duration: 0.4 }}
              >
                <Card sx={{
                  p: 2,
                  textAlign: 'center',
                  borderRadius: 3,
                  border: `1px solid ${alpha(theme.palette[stat.color].main, 0.2)}`,
                  '&:hover': {
                    boxShadow: `0 4px 20px ${alpha(theme.palette[stat.color].main, 0.2)}`
                  }
                }}>
                  <Box sx={{ color: `${stat.color}.main`, mb: 1 }}>
                    {stat.icon}
                  </Box>
                  <Typography variant="h5" fontWeight="bold" color={`${stat.color}.main`}>
                    {stat.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {stat.label}
                  </Typography>
                </Card>
              </motion.div>
            </Grid>
          ))}
        </Grid>

        {/* Tabs */}
        <Paper sx={{ borderRadius: 4, mb: 3 }}>
          <Tabs
            value={activeTab}
            onChange={handleTabChange}
            variant={isMobile ? 'scrollable' : 'fullWidth'}
            scrollButtons="auto"
            sx={{
              '& .MuiTab-root': {
                textTransform: 'none',
                fontWeight: 600,
                minHeight: 60
              }
            }}
          >
            <Tab label="My Listings" />
            <Tab label="Activity" />
            <Tab label="Messages" />
            <Tab label="Settings" />
          </Tabs>
        </Paper>

        {/* Tab Content */}
        {activeTab === 0 && (
          <Box>
            <Typography variant="h6" fontWeight="bold" mb={3}>
              My Listings
            </Typography>
            {userListings.length === 0 ? (
              <Typography variant="body1" color="text.secondary" textAlign="center">No listings yet.</Typography>
            ) : (
              <Grid container spacing={3}>
                {userListings.map((listing, index) => (
                  <Grid item xs={12} md={6} key={listing.id}>
                    <motion.div
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: index * 0.1, duration: 0.4 }}
                    >
                      <Card sx={{
                        borderRadius: 3,
                        overflow: 'hidden',
                        '&:hover': {
                          boxShadow: `0 8px 32px ${alpha(theme.palette.common.black, 0.15)}`
                        }
                      }}>
                        <Box sx={{ display: 'flex', p: 2 }}>
                          <Box
                            component="img"
                            src={listing.image || listing.images?.[0] || 'https://via.placeholder.com/100'}
                            alt={listing.title}
                            sx={{
                              width: 100,
                              height: 100,
                              borderRadius: 2,
                              objectFit: 'cover',
                              flexShrink: 0
                            }}
                          />
                          <Box sx={{ flex: 1, ml: 2, minWidth: 0 }}>
                            <Stack spacing={1}>
                              <Stack direction="row" justifyContent="space-between" alignItems="flex-start">
                                <Box sx={{ flex: 1, minWidth: 0 }}>
                                  <Typography variant="h6" fontWeight="bold" noWrap>
                                    {listing.title}
                                  </Typography>
                                  <Stack direction="row" spacing={1} alignItems="center" sx={{ mt: 0.5 }}>
                                    {getCategoryIcon(listing.category)}
                                    <Typography variant="body2" color="text.secondary">
                                      {listing.category}
                                    </Typography>
                                    <Chip
                                      label={listing.status}
                                      size="small"
                                      color={getStatusColor(listing.status)}
                                      icon={getStatusIcon(listing.status)}
                                      sx={{ fontSize: '0.7rem' }}
                                    />
                                  </Stack>
                                </Box>
                                <IconButton size="small">
                                  <MoreVert />
                                </IconButton>
                              </Stack>

                              <Stack direction="row" spacing={0.5} alignItems="center" color="text.secondary">
                                <LocationOn sx={{ fontSize: 14 }} />
                                <Typography variant="caption">{listing.location}</Typography>
                              </Stack>

                              <Stack direction="row" spacing={2} alignItems="center">
                                <Typography variant="h6" color="primary.main" fontWeight="bold">
                                  ETB {listing.price}
                                </Typography>
                                <Typography variant="caption" color="text.secondary">
                                  {getDaysAgo(listing.postedAt)}
                                </Typography>
                              </Stack>

                              <Stack direction="row" spacing={2} alignItems="center">
                                <Stack direction="row" spacing={0.5} alignItems="center">
                                  <Visibility sx={{ fontSize: 16 }} />
                                  <Typography variant="caption">{listing.views}</Typography>
                                </Stack>
                                <Stack direction="row" spacing={0.5} alignItems="center">
                                  <Chat sx={{ fontSize: 16 }} />
                                  <Typography variant="caption">{listing.chats}</Typography>
                                </Stack>
                              </Stack>
                            </Stack>
                          </Box>
                        </Box>

                        <Divider />

                        <Box sx={{ p: 1, display: 'flex', justifyContent: 'space-between' }}>
                          <Stack direction="row" spacing={1}>
                            <Button
                              size="small"
                              variant="outlined"
                              onClick={() => handleEditListing(listing.id)}
                            >
                              Edit
                            </Button>
                            <Button
                              size="small"
                              variant="outlined"
                              color="info"
                              onClick={() => handleShareListing(listing.id)}
                            >
                              Share
                            </Button>
                          </Stack>
                          <Button
                            size="small"
                            variant="text"
                            color="error"
                            onClick={() => handleDeleteListing(listing.id)}
                          >
                            Delete
                          </Button>
                        </Box>
                      </Card>
                    </motion.div>
                  </Grid>
                ))}
              </Grid>
            )}
          </Box>
        )}

        {activeTab === 1 && (
          <Box>
            <Typography variant="h6" fontWeight="bold" mb={3}>
              Recent Activity
            </Typography>
            <Card sx={{ borderRadius: 3 }}>
              <List>
                {notifications.length === 0 ? (
                  <Typography variant="body2" color="text.secondary" sx={{ p: 2, textAlign: 'center' }}>No recent activity.</Typography>
                ) : (
                  notifications.map((notification) => (
                    <React.Fragment key={notification.id}>
                      <ListItem sx={{ py: 2 }}>
                        <ListItemIcon>
                          {notification.type === 'chat' && <Chat color="primary" />}
                          {notification.type === 'view' && <Visibility color="info" />}
                          {notification.type === 'favorite' && <FavoriteBorder color="error" />}
                          {notification.type === 'system' && <CheckCircle color="success" />}
                        </ListItemIcon>
                        <ListItemText
                          primary={notification.message || notification.title}
                          secondary={notification.created_at ? formatDistanceToNow(new Date(notification.created_at), { addSuffix: true }) : ''}
                          primaryTypographyProps={{
                            fontWeight: !notification.read ? 600 : 'normal',
                            color: !notification.read ? 'text.primary' : 'text.secondary'
                          }}
                        />
                        {!notification.read && (
                          <Box sx={{ width: 8, height: 8, bgcolor: 'primary.main', borderRadius: '50%' }} />
                        )}
                      </ListItem>
                      {notification.id < notifications.length && <Divider variant="inset" component="li" />}
                    </React.Fragment>
                  ))
                )}
              </List>
            </Card>
          </Box>
        )}

        {activeTab === 2 && (
          <Box>
            <Typography variant="h6" fontWeight="bold" mb={3}>
              Messages
            </Typography>
            <Card sx={{ borderRadius: 3, p: 3, textAlign: 'center' }}>
              <Chat sx={{ fontSize: 48, color: 'text.secondary', mb: 2 }} />
              <Typography variant="h6" color="text.secondary" gutterBottom>
                Manage your conversations
              </Typography>
              <Typography variant="body2" color="text.secondary" sx={{ mb: 3 }}>
                Go to the messages page to chat with buyers and sellers.
              </Typography>
              <Button variant="contained" onClick={() => navigate('/chat')}>
                Go to Messages
              </Button>
            </Card>
          </Box>
        )}

        {activeTab === 3 && (
          <Box>
            <Typography variant="h6" fontWeight="bold" mb={3}>
              Account Settings
            </Typography>
            <Card sx={{ borderRadius: 3, p: 3 }}>
              <Stack spacing={3}>
                <Button variant="outlined" startIcon={<Edit />} fullWidth onClick={() => navigate('/profile')}>
                  Edit Profile
                </Button>
                <Button variant="outlined" startIcon={<Settings />} fullWidth onClick={() => navigate('/settings')}>
                  Preferences
                </Button>
                <Button variant="outlined" startIcon={<NotificationsActive />} fullWidth onClick={() => navigate('/notifications')}>
                  Notification Settings
                </Button>
                <Divider />
                <Button variant="text" color="error" fullWidth onClick={() => {
                  localStorage.removeItem('token');
                  navigate('/');
                }}>
                  Sign Out
                </Button>
              </Stack>
            </Card>
          </Box>
        )}
      </Container>
    </Box>
  );
};

export default DashboardPage;
import React, { useState, useEffect, useRef } from 'react';
import {
    Box,
    Container,
    Grid,
    Paper,
    Typography,
    List,
    ListItem,
    ListItemAvatar,
    ListItemText,
    Avatar,
    TextField,
    IconButton,
    Divider,
    Badge,
    useTheme,
    useMediaQuery,
    CircularProgress
} from '@mui/material';
import { Send, ArrowBack, Search } from '@mui/icons-material';
import { useAuth } from '../context/AuthContext';
import apiService from '../services/api';
import { formatDistanceToNow } from '../utils/dateUtils';

const ChatPage = () => {
    const theme = useTheme();
    const isMobile = useMediaQuery(theme.breakpoints.down('md'));
    const { user } = useAuth();

    const [conversations, setConversations] = useState([]);
    const [selectedConversation, setSelectedConversation] = useState(null);
    const [messages, setMessages] = useState([]);
    const [newMessage, setNewMessage] = useState('');
    const [loading, setLoading] = useState(true);
    const [sending, setSending] = useState(false);

    const messagesEndRef = useRef(null);

    useEffect(() => {
        fetchConversations();
        const interval = setInterval(fetchConversations, 10000); // Poll every 10s
        return () => clearInterval(interval);
    }, []);

    useEffect(() => {
        if (selectedConversation) {
            fetchMessages(selectedConversation.id);
            const interval = setInterval(() => fetchMessages(selectedConversation.id), 5000); // Poll messages every 5s
            return () => clearInterval(interval);
        }
    }, [selectedConversation]);

    useEffect(() => {
        scrollToBottom();
    }, [messages]);

    const fetchConversations = async () => {
        try {
            const data = await apiService.getConversations();
            setConversations(data);
        } catch (error) {
        } finally {
            setLoading(false);
        }
    };

    const fetchMessages = async (conversationId) => {
        try {
            const data = await apiService.getMessages(conversationId);
            setMessages(data);
        } catch (error) {
        }
    };

    const handleSendMessage = async (e) => {
        e.preventDefault();
        if (!newMessage.trim() || !selectedConversation) return;

        setSending(true);
        try {
            await apiService.sendMessage(selectedConversation.id, newMessage);
            setNewMessage('');
            fetchMessages(selectedConversation.id);
            fetchConversations(); // Update last message in list
        } catch (error) {
        } finally {
            setSending(false);
        }
    };

    const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
    };

    const getOtherParticipant = (conversation) => {
        return conversation.participants.find(p => p.id !== user.id) || conversation.participants[0];
    };

    if (loading) {
        return (
            <Box display="flex" justifyContent="center" alignItems="center" minHeight="80vh">
                <CircularProgress />
            </Box>
        );
    }

    return (
        <Container maxWidth="xl" sx={{ py: 4, height: 'calc(100vh - 64px)' }}>
            <Paper sx={{ height: '100%', overflow: 'hidden', display: 'flex' }}>
                {/* Conversations List */}
                <Box
                    sx={{
                        width: isMobile && selectedConversation ? 0 : (isMobile ? '100%' : 350),
                        borderRight: `1px solid ${theme.palette.divider}`,
                        display: isMobile && selectedConversation ? 'none' : 'flex',
                        flexDirection: 'column'
                    }}
                >
                    <Box p={2} borderBottom={`1px solid ${theme.palette.divider}`}>
                        <Typography variant="h6" fontWeight="bold" gutterBottom>
                            Messages
                        </Typography>
                        <TextField
                            fullWidth
                            size="small"
                            placeholder="Search conversations..."
                            InputProps={{
                                startAdornment: <Search color="action" sx={{ mr: 1 }} />
                            }}
                        />
                    </Box>
                    <List sx={{ overflow: 'auto', flexGrow: 1 }}>
                        {conversations.map((conversation) => {
                            const otherUser = getOtherParticipant(conversation);
                            const isSelected = selectedConversation?.id === conversation.id;

                            return (
                                <React.Fragment key={conversation.id}>
                                    <ListItem
                                        button
                                        selected={isSelected}
                                        onClick={() => setSelectedConversation(conversation)}
                                        sx={{
                                            bgcolor: isSelected ? 'action.selected' : 'transparent',
                                            '&:hover': { bgcolor: 'action.hover' }
                                        }}
                                    >
                                        <ListItemAvatar>
                                            <Badge
                                                color="success"
                                                variant="dot"
                                                invisible={!otherUser.isOnline}
                                                overlap="circular"
                                                anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}
                                            >
                                                <Avatar src={otherUser.avatarUrl} alt={otherUser.fullName}>
                                                    {otherUser.fullName?.charAt(0)}
                                                </Avatar>
                                            </Badge>
                                        </ListItemAvatar>
                                        <ListItemText
                                            primary={
                                                <Box display="flex" justifyContent="space-between">
                                                    <Typography variant="subtitle2" fontWeight="bold" noWrap>
                                                        {otherUser.fullName}
                                                    </Typography>
                                                    {conversation.lastMessageAt && (
                                                        <Typography variant="caption" color="text.secondary">
                                                            {formatDistanceToNow(new Date(conversation.lastMessageAt), { addSuffix: false })}
                                                        </Typography>
                                                    )}
                                                </Box>
                                            }
                                            secondary={
                                                <Typography variant="body2" color="text.secondary" noWrap>
                                                    {conversation.lastMessage}
                                                </Typography>
                                            }
                                        />
                                    </ListItem>
                                    <Divider component="li" />
                                </React.Fragment>
                            );
                        })}
                        {conversations.length === 0 && (
                            <Box p={4} textAlign="center">
                                <Typography color="text.secondary">No conversations yet</Typography>
                            </Box>
                        )}
                    </List>
                </Box>

                {/* Chat Window */}
                <Box
                    sx={{
                        flexGrow: 1,
                        display: isMobile && !selectedConversation ? 'none' : 'flex',
                        flexDirection: 'column',
                        bgcolor: 'background.default'
                    }}
                >
                    {selectedConversation ? (
                        <>
                            {/* Chat Header */}
                            <Box
                                p={2}
                                bgcolor="background.paper"
                                borderBottom={`1px solid ${theme.palette.divider}`}
                                display="flex"
                                alignItems="center"
                            >
                                {isMobile && (
                                    <IconButton onClick={() => setSelectedConversation(null)} sx={{ mr: 1 }}>
                                        <ArrowBack />
                                    </IconButton>
                                )}
                                <Avatar
                                    src={getOtherParticipant(selectedConversation).avatarUrl}
                                    sx={{ mr: 2 }}
                                />
                                <Box>
                                    <Typography variant="subtitle1" fontWeight="bold">
                                        {getOtherParticipant(selectedConversation).fullName}
                                    </Typography>
                                    <Typography variant="caption" color="text.secondary">
                                        {getOtherParticipant(selectedConversation).isOnline ? 'Online' : 'Offline'}
                                    </Typography>
                                </Box>
                            </Box>

                            {/* Messages Area */}
                            <Box sx={{ flexGrow: 1, overflow: 'auto', p: 2 }}>
                                {messages.map((msg, index) => {
                                    const isMe = msg.senderId === user.id;
                                    return (
                                        <Box
                                            key={msg.id || index}
                                            display="flex"
                                            justifyContent={isMe ? 'flex-end' : 'flex-start'}
                                            mb={2}
                                        >
                                            <Paper
                                                sx={{
                                                    p: 1.5,
                                                    maxWidth: '70%',
                                                    bgcolor: isMe ? 'primary.main' : 'background.paper',
                                                    color: isMe ? 'primary.contrastText' : 'text.primary',
                                                    borderRadius: 2
                                                }}
                                            >
                                                <Typography variant="body1">{msg.content}</Typography>
                                                <Typography
                                                    variant="caption"
                                                    sx={{
                                                        display: 'block',
                                                        textAlign: 'right',
                                                        mt: 0.5,
                                                        opacity: 0.7
                                                    }}
                                                >
                                                    {formatDistanceToNow(new Date(msg.createdAt), { addSuffix: true })}
                                                </Typography>
                                            </Paper>
                                        </Box>
                                    );
                                })}
                                <div ref={messagesEndRef} />
                            </Box>

                            {/* Input Area */}
                            <Box
                                component="form"
                                onSubmit={handleSendMessage}
                                p={2}
                                bgcolor="background.paper"
                                borderTop={`1px solid ${theme.palette.divider}`}
                                display="flex"
                                alignItems="center"
                            >
                                <TextField
                                    fullWidth
                                    placeholder="Type a message..."
                                    variant="outlined"
                                    size="small"
                                    value={newMessage}
                                    onChange={(e) => setNewMessage(e.target.value)}
                                    sx={{ mr: 1 }}
                                />
                                <IconButton
                                    type="submit"
                                    color="primary"
                                    disabled={!newMessage.trim() || sending}
                                >
                                    {sending ? <CircularProgress size={24} /> : <Send />}
                                </IconButton>
                            </Box>
                        </>
                    ) : (
                        <Box
                            display="flex"
                            flexDirection="column"
                            justifyContent="center"
                            alignItems="center"
                            height="100%"
                            color="text.secondary"
                        >
                            <Typography variant="h5" gutterBottom>
                                Select a conversation
                            </Typography>
                            <Typography>
                                Choose a chat from the list to start messaging
                            </Typography>
                        </Box>
                    )}
                </Box>
            </Paper>
        </Container>
    );
};

export default ChatPage;
import React, { useState, useEffect } from 'react';
import {
  Container, Grid, Card, Typography, Box, Chip, TextField,
  InputAdornment, useTheme, useMediaQuery, Stack, Divider,
  CircularProgress, Alert
} from '@mui/material';
import {
  Search, DirectionsCar, LocationOn, Speed, LocalGasStation, CalendarToday
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { alpha } from '@mui/material/styles';
import { useNavigate } from 'react-router-dom';
import apiService from '../services/api';

// Import Love Features
import SmartSearch from '../components/SmartSearch';
import PriceDropAlert from '../components/PriceDropAlert';
import UserReviews from '../components/UserReviews';
import TrustBadges from '../components/TrustBadges';
import LiveActivityIndicators from '../components/LiveActivityIndicators';

const CAR_BRANDS = ['All Brands', 'Toyota', 'Hyundai', 'Nissan', 'Mitsubishi', 'Honda', 'Mercedes', 'BMW', 'Ford'];

const CarsPage = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const isDesktop = useMediaQuery(theme.breakpoints.up('lg'));
  const navigate = useNavigate();
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedBrand, setSelectedBrand] = useState('All Brands');
  const [listingType, setListingType] = useState('For Sale');
  const [cars, setCars] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchCars = async () => {
      try {
        setLoading(true);
        setError(null);
        const params = {
          category: 'cars',
          type: listingType,
          brand: selectedBrand !== 'All Brands' ? selectedBrand : undefined,
          search: searchQuery || undefined
        };
        const response = await apiService.getListings(params);
        setCars(response.listings || response || []);
      } catch (err) {
        setError('Failed to load cars');
      } finally {
        setLoading(false);
      }
    };

    fetchCars();
  }, [listingType, selectedBrand, searchQuery]);

  const getDaysAgo = (date) => {
    const diff = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60 * 24));
    if (diff === 0) return 'Just now';
    if (diff < 1) {
      const hours = Math.floor((new Date() - new Date(date)) / (1000 * 60 * 60));
      return `${hours}h ago`;
    }
    return `${diff}d ago`;
  };

  if (loading) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  if (error) {
    return (
      <Container maxWidth="lg" sx={{ py: 6 }}>
        <Alert severity="error">{error}</Alert>
      </Container>
    );
  }

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh', pb: isMobile ? 10 : 0 }}>
      {/* Hero Section */}
      <Box sx={{
        height: isMobile ? 600 : 650,
        position: 'relative',
        backgroundImage: 'url(https://images.unsplash.com/photo-1552519507-da3b142c6e3d?q=80&w=1080)',
        backgroundSize: 'cover',
        backgroundPosition: 'center',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        color: 'white',
        '&::before': {
          content: '""',
          position: 'absolute',
          top: 0, left: 0, right: 0, bottom: 0,
          background: 'linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.4), transparent)',
        }
      }}>
        <Container maxWidth="lg" sx={{ position: 'relative', zIndex: 1, textAlign: 'center' }}>
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }}>
            <Typography variant={isMobile ? "h2" : "h1"} sx={{
              fontFamily: 'Playfair Display, serif',
              fontWeight: 700,
              mb: 1,
              color: theme.palette.secondary.main,
              fontSize: isMobile ? '3.25rem' : '4.5rem'
            }}>
              Cars
            </Typography>
            <Typography variant={isMobile ? "h5" : "h4"} sx={{
              fontFamily: 'Playfair Display, serif',
              fontStyle: 'italic',
              mb: 3,
              opacity: 0.7
            }}>
              Buy & Rent Vehicles
            </Typography>
            <Typography variant={isMobile ? "body1" : "h6"} sx={{
              mb: 4,
              maxWidth: 600,
              mx: 'auto',
              opacity: 0.8,
              lineHeight: 1.6
            }}>
              Find your perfect car from our extensive collection of new and used vehicles
            </Typography>

            {/* Smart Search Box with Filters */}
            <Box sx={{
              maxWidth: 600,
              mx: 'auto',
              bgcolor: alpha(theme.palette.background.paper, 0.1),
              backdropFilter: 'blur(10px)',
              borderRadius: 4,
              p: 1.5
            }}>
              <SmartSearch 
                onSearch={(query) => setSearchQuery(query)}
                placeholder="Search cars by brand, model, or keyword..."
              />

              {/* For Sale / For Rent Toggle */}
              <Box sx={{
                bgcolor: alpha('#000', 0.2),
                borderRadius: 3,
                p: 0.5,
                display: 'flex'
              }}>
                {['For Sale', 'For Rent'].map((type) => (
                  <Box
                    key={type}
                    onClick={() => setListingType(type)}
                    sx={{
                      flex: 1,
                      py: 1.5,
                      textAlign: 'center',
                      borderRadius: 2.5,
                      cursor: 'pointer',
                      bgcolor: listingType === type ? 'primary.main' : 'transparent',
                      transition: 'all 0.2s',
                      '&:hover': {
                        bgcolor: listingType === type ? 'primary.dark' : alpha('#fff', 0.1)
                      }
                    }}
                  >
                    <Typography variant="body2" sx={{
                      fontWeight: 600,
                      color: listingType === type ? 'primary.contrastText' : 'white',
                      fontSize: '0.9375rem'
                    }}>
                      {type}
                    </Typography>
                  </Box>
                ))}
              </Box>
            </Box>
          </motion.div>
        </Container>
      </Box>

      {/* Brand Filters */}
      <Container maxWidth="lg" sx={{ mt: 3, mb: 2 }}>
        <Typography variant="body1" fontWeight="bold" mb={1.5}>
          Popular Brands
        </Typography>
        <Box sx={{
          overflowX: 'auto',
          '&::-webkit-scrollbar': { display: 'none' },
          msOverflowStyle: 'none',
          scrollbarWidth: 'none'
        }}>
          <Stack direction="row" spacing={1.25} sx={{ minWidth: 'max-content' }}>
            {CAR_BRANDS.map((brand) => {
              const isSelected = selectedBrand === brand;
              return (
                <Chip
                  key={brand}
                  label={brand}
                  onClick={() => setSelectedBrand(brand)}
                  sx={{
                    bgcolor: isSelected ? 'primary.main' : 'background.paper',
                    color: isSelected ? 'primary.contrastText' : 'text.primary',
                    borderRadius: '20px',
                    px: 2,
                    py: 2.8,
                    border: isSelected ? 'none' : `1px solid ${alpha(theme.palette.divider, 0.5)} `,
                    fontWeight: isSelected ? 600 : 'normal',
                    '&:hover': {
                      bgcolor: isSelected ? 'primary.dark' : alpha(theme.palette.text.primary, 0.04)
                    }
                  }}
                />
              );
            })}
          </Stack>
        </Box>
      </Container>

      {/* Cars Grid */}
      <Container maxWidth="lg" sx={{ pb: 4 }}>
        <Grid container spacing={3}>
          {cars.map((car, index) => (
            <Grid item xs={12} sm={6} lg={4} key={car.id}>
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.1, duration: 0.4 }}
              >
                <Card
                  onClick={() => navigate(`/listings/${car.id}`)}
                  sx={{
                    borderRadius: 4,
                    overflow: 'hidden',
                    cursor: 'pointer',
                    transition: 'all 0.3s ease',
                    '&:hover': {
                      transform: 'translateY(-4px)',
                      boxShadow: 4
                    }
                  }}
                >
                  <Box sx={{ display: 'flex', flexDirection: 'column' }}>
                    {/* Image Section - 60% */}
                    <Box sx={{ position: 'relative', height: 200 }}>
                      <Box
                        component="img"
                        src={car.image || car.images?.[0] || 'https://images.unsplash.com/photo-1552519507-da3b142c6e3d?q=80&w=500'}
                        alt={car.title}
                        sx={{ width: '100%', height: '100%', objectFit: 'cover' }}
                      />
                      {/* Type Badge - Top Left */}
                      <Box sx={{
                        position: 'absolute',
                        top: 12,
                        left: 12,
                        bgcolor: theme.palette.background.paper,
                        borderRadius: '20px',
                        px: 1.5,
                        py: 0.75
                      }}>
                        <Typography variant="caption" sx={{ fontWeight: 700, fontSize: '0.6875rem' }}>
                          {car.type}
                        </Typography>
                      </Box>
                      {/* Days Ago Badge - Top Right */}
                      <Box sx={{
                        position: 'absolute',
                        top: 12,
                        right: 12,
                        bgcolor: alpha('#000', 0.7),
                        borderRadius: '20px',
                        px: 1.5,
                        py: 0.75
                      }}>
                        <Typography variant="caption" sx={{ color: 'white', fontWeight: 600, fontSize: '0.625rem' }}>
                          {getDaysAgo(car.created_at || car.createdAt)}
                        </Typography>
                      </Box>
                      {/* Price Badge - Bottom Right */}
                      <Box sx={{
                        position: 'absolute',
                        bottom: 12,
                        right: 12,
                        bgcolor: 'primary.main',
                        borderRadius: '20px',
                        px: 1.5,
                        py: 0.75
                      }}>
                        <Typography variant="caption" sx={{ color: 'white', fontWeight: 'bold', fontSize: '0.8125rem' }}>
                          ETB {car.price}
                        </Typography>
                      </Box>
                      {/* Live Activity Indicators */}
                      <LiveActivityIndicators listing={car} compact />
                    </Box>

                    {/* Content Section - 40% */}
                    <Box sx={{ p: 2 }}>
                      <Typography variant="h6" sx={{
                        fontFamily: 'Playfair Display, serif',
                        fontWeight: 'bold',
                        fontSize: '1.125rem',
                        mb: 1,
                        overflow: 'hidden',
                        textOverflow: 'ellipsis',
                        whiteSpace: 'nowrap'
                      }}>
                        {car.title}
                      </Typography>

                      <Stack direction="row" spacing={0.5} alignItems="center" mb={1}>
                        <LocationOn sx={{ fontSize: 14, color: alpha(theme.palette.text.primary, 0.6) }} />
                        <Typography variant="body2" color="text.secondary" sx={{ fontSize: '0.75rem' }} noWrap>
                          {car.location}
                        </Typography>
                      </Stack>

                      <Divider sx={{ my: 1 }} />

                      {/* Specs */}
                      <Stack direction="row" spacing={1} flexWrap="wrap" useFlexGap>
                        <Stack direction="row" spacing={0.75} alignItems="center">
                          <Speed sx={{ fontSize: 14, color: 'primary.main' }} />
                          <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {car.transmission || 'N/A'}
                          </Typography>
                        </Stack>
                        <Stack direction="row" spacing={0.75} alignItems="center">
                          <LocalGasStation sx={{ fontSize: 14, color: 'primary.main' }} />
                          <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {car.fuel || 'N/A'}
                          </Typography>
                        </Stack>
                        <Stack direction="row" spacing={0.75} alignItems="center">
                          <CalendarToday sx={{ fontSize: 14, color: 'primary.main' }} />
                          <Typography variant="caption" color="text.secondary" fontWeight={500} sx={{ fontSize: '0.75rem' }}>
                            {car.year || 'N/A'}
                          </Typography>
                        </Stack>
                      </Stack>
                    </Box>
                  </Box>
                </Card>
              </motion.div>
            </Grid>
          ))}
        </Grid>
      </Container>
    </Box>
  );
};

export default CarsPage;
import React, { useState } from 'react';
import {
  Container, Paper, Typography, TextField, Button, Box, Link, Divider,
  CircularProgress, useTheme, Stack, IconButton, InputAdornment,
  Alert, Snackbar, ToggleButton, ToggleButtonGroup, FormControlLabel, Checkbox,
  Grid, Card, OutlinedInput, InputLabel, FormControl, FormHelperText
} from '@mui/material';
import {
  Visibility, VisibilityOff, Email, Lock, ArrowBack, CheckCircle, Phone,
  Business, Person, Sms, Timer, ExpandMore, ExpandLess, Link as LinkIcon
} from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import toast from 'react-hot-toast';
import { alpha } from '@mui/material/styles';
import apiService from '../services/api';

const AuthScreen = ({ initialMode = 'login' }) => {
  const navigate = useNavigate();
  const theme = useTheme();
  const [isLogin, setIsLogin] = useState(initialMode === 'login');
  const [authType, setAuthType] = useState('email'); // Default to email since phone not supported yet
  const [accountType, setAccountType] = useState('individual');
  const [showPassword, setShowPassword] = useState(true);
  const [showOptionalFields, setShowOptionalFields] = useState(false);
  const [showOtpInput, setShowOtpInput] = useState(false);
  const [otpCountdown, setOtpCountdown] = useState(0);
  const [canResendOtp, setCanResendOtp] = useState(false);
  const [termsAccepted, setTermsAccepted] = useState(false);
  const [loading, setLoading] = useState(false);
  const [errors, setErrors] = useState({});
  const [showSuccess, setShowSuccess] = useState(false);
  const [otpIdentifier, setOtpIdentifier] = useState('');

  const [formData, setFormData] = useState({
    fullName: '',
    email: '',
    phone: '',
    password: '',
    confirmPassword: '',
    otp: '',
    companyName: '',
    companyRole: '',
    website: ''
  });

  const startOtpTimer = () => {
    setOtpCountdown(60);
    setCanResendOtp(false);

    const interval = setInterval(() => {
      setOtpCountdown(prev => {
        if (prev <= 1) {
          clearInterval(interval);
          setCanResendOtp(true);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
  };

  const validateForm = () => {
    const newErrors = {};

    if (!isLogin && !showOtpInput) {
      if (!formData.fullName.trim()) {
        newErrors.fullName = 'Full name is required';
      }

      if (accountType === 'company') {
        if (!formData.companyName.trim()) {
          newErrors.companyName = 'Company name is required';
        }
        if (!formData.companyRole.trim()) {
          newErrors.companyRole = 'Your role is required';
        }
      }
    }

    if (!showOtpInput) {
      if (authType === 'email') {
        if (!formData.email.trim()) {
          newErrors.email = 'Email is required';
        } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
          newErrors.email = 'Email is invalid';
        }
      } else {
        if (!formData.phone.trim()) {
          newErrors.phone = 'Phone number is required';
        } else if (!/^\+251\s?9\d{2}\s?\d{6}$/.test(formData.phone.replace(/\s/g, ''))) {
          newErrors.phone = 'Please enter a valid Ethiopian phone number';
        }
      }

      if (!formData.password.trim()) {
        newErrors.password = 'Password is required';
      } else if (formData.password.length < 6) {
        newErrors.password = 'Password must be at least 6 characters';
      }

      if (!isLogin && !showOtpInput) {
        if (!formData.confirmPassword.trim()) {
          newErrors.confirmPassword = 'Please confirm your password';
        } else if (formData.password !== formData.confirmPassword) {
          newErrors.confirmPassword = 'Passwords do not match';
        }
      }
    } else {
      if (!formData.otp.trim()) {
        newErrors.otp = 'OTP code is required';
      } else if (formData.otp.length !== 6) {
        newErrors.otp = 'OTP must be 6 digits';
      }
    }

    if (!isLogin && !showOtpInput && !termsAccepted) {
      newErrors.terms = 'You must agree to the terms and conditions';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) return;
    
    setLoading(true);
    
    try {
      if (!isLogin && !showOtpInput) {
        // Registration
        const userData = {
          first_name: formData.fullName.split(' ')[0] || formData.fullName,
          last_name: formData.fullName.split(' ').slice(1).join(' ') || '',
          password: formData.password,
          account_type: accountType,
        };

        // Add email or phone based on auth type
        if (authType === 'email') {
          userData.email = formData.email;
        } else {
          userData.phone = formData.phone;
          // Phone registration needs email for now
          toast.error('Phone registration not supported yet. Please use email registration.');
          return;
        }

        // Add company fields if company account
        if (accountType === 'company') {
          userData.company_name = formData.companyName;
          userData.company_role = formData.companyRole;
        }

        // Add optional fields
        if (showOptionalFields) {
          if (formData.website) {
            userData.website = formData.website;
          }
        }

        const response = await apiService.register(userData);
        
        // If phone registration, show OTP input
        if (authType === 'phone' && !response.token) {
          const identifier = formData.phone;
          setOtpIdentifier(identifier);
          setShowOtpInput(true);
          startOtpTimer();
          toast.success('OTP sent to your phone!');
          return;
        }
        
        // Email registration successful or auto-login
        setShowSuccess(true);
        toast.success('Account created successfully!');
        
        setTimeout(() => {
          navigate('/');
        }, 1500);
        
      } else if (showOtpInput) {
        // OTP Verification
        if (!otpIdentifier) {
          toast.error('Identifier not found. Please try again.');
          setShowOtpInput(false);
          return;
        }
        
        const response = await apiService.verifyOtp(otpIdentifier, formData.otp);
        
        setShowSuccess(true);
        toast.success('Phone number verified successfully!');
        
        setTimeout(() => {
          navigate('/');
        }, 1500);
        
      } else {
        // Login
        const credentials = {
          password: formData.password,
        };

        // Backend only supports email login for now
        if (authType === 'email') {
          credentials.email = formData.email;
        } else {
          // For phone login, try to find user by phone and use their email
          toast.error('Phone login not supported yet. Please use email login.');
          return;
        }

        const response = await apiService.login(credentials);
        
        setShowSuccess(true);
        toast.success('Login successful!');
        
        setTimeout(() => {
          navigate('/');
        }, 1500);
      }
    } catch (error) {
      console.error('Auth error:', error);
      const errorMessage = error.response?.data?.message || error.message || 'Authentication failed. Please try again.';
      toast.error(errorMessage);
    } finally {
      setLoading(false);
    }
  };

  const toggleForm = () => {
    setIsLogin(!isLogin);
    setErrors({});
    setShowOtpInput(false);
    setOtpCountdown(0);
    setOtpIdentifier('');
  };

  const resendOtp = async () => {
    if (!canResendOtp || loading) return;
    setLoading(true);
    
    try {
      await apiService.resendOtp(otpIdentifier);
      startOtpTimer();
      toast.success('OTP resent successfully!');
    } catch (error) {
      toast.error(error.message || 'Failed to resend OTP. Please try again.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <Box sx={{
      bgcolor: 'background.default',
      minHeight: '100vh',
      backgroundImage: {
        xs: 'linear-gradient(rgba(255,255,255,0.92), rgba(255,255,255,0.92)), url("https://images.unsplash.com/photo-1557804506-669a67965ba0?q=80&w=1080")',
        md: 'linear-gradient(rgba(255,255,255,0.95), rgba(255,255,255,0.95)), url("https://images.unsplash.com/photo-1557804506-669a67965ba0?q=80&w=1080")'
      },
      backgroundSize: 'cover',
      backgroundPosition: 'center',
      backgroundAttachment: 'fixed',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center'
    }}>
      {/* Header */}
      <Box sx={{
        position: 'absolute',
        top: 0,
        left: 0,
        right: 0,
        zIndex: 1,
        bgcolor: 'primary.main',
        color: 'white',
        py: 2,
        boxShadow: 2
      }}>
        <Container maxWidth="lg">
          <Box sx={{ display: 'flex', alignItems: 'center' }}>
            <IconButton
              onClick={() => navigate('/')}
              sx={{ color: 'white', mr: 2 }}
            >
              <ArrowBack />
            </IconButton>
            <Typography variant="h6" fontWeight="bold">
              {isLogin ? 'Welcome Back' : 'Create Account'}
            </Typography>
          </Box>
        </Container>
      </Box>

      <Container maxWidth="sm" sx={{ pt: 8, pb: 8, position: 'relative', zIndex: 1 }}>
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.6 }}
        >
          <Paper
            sx={{
              p: { xs: 3, md: 4 },
              borderRadius: 4,
              boxShadow: `0 8px 32px ${alpha(theme.palette.common.black, 0.1)}`,
              backdropFilter: 'blur(10px)',
              backgroundColor: alpha(theme.palette.background.paper, 0.95),
              border: `1px solid ${alpha(theme.palette.divider, 0.1)}`,
            }}
          >
            {/* Logo/Brand Section */}
            <Box sx={{ textAlign: 'center', mb: 4 }}>
              <Box sx={{
                width: 80,
                height: 80,
                bgcolor: 'primary.main',
                borderRadius: '50%',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                mx: 'auto',
                mb: 2,
                boxShadow: `0 4px 20px ${alpha(theme.palette.primary.main, 0.3)}`
              }}>
                <Typography variant="h4" color="white" fontWeight="bold">
                  YS
                </Typography>
              </Box>
              <Typography variant="h4" fontWeight="bold" gutterBottom>
                {isLogin ? 'Sign In' : 'Create Account'}
              </Typography>
              <Typography variant="body2" color="text.secondary">
                {isLogin ? 'Welcome back to Yesira Sew - Quality Gold' : 'Join Yesira Sew - Quality Gold'}
              </Typography>
            </Box>

            <form onSubmit={handleSubmit}>
              <Stack spacing={3}>
                {/* Email/Phone Toggle */}
                <Box>
                  <Typography variant="body2" color="text.secondary" gutterBottom sx={{ textAlign: 'center', mb: 2 }}>
                    Choose your authentication method
                  </Typography>
                  <Stack direction="row" spacing={1}>
                    <Button
                      variant={authType === 'email' ? 'contained' : 'outlined'}
                      onClick={() => {
                        setAuthType('email');
                        setErrors({});
                        setShowOtpInput(false);
                        setOtpCountdown(0);
                        setOtpIdentifier('');
                      }}
                      sx={{ flex: 1, py: 2 }}
                    >
                      Email
                    </Button>
                    <Button
                      variant={authType === 'phone' ? 'contained' : 'outlined'}
                      onClick={() => {
                        setAuthType('phone');
                        setErrors({});
                        setShowOtpInput(false);
                        setOtpCountdown(0);
                        setOtpIdentifier('');
                      }}
                      sx={{ flex: 1, py: 2 }}
                    >
                      Phone
                    </Button>
                  </Stack>
                </Box>

                {/* Registration Fields */}
                {!isLogin && !showOtpInput && (
                  <>
                    {/* Full Name */}
                    <TextField
                      fullWidth
                      label="Full Name"
                      value={formData.fullName}
                      onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}
                      error={!!errors.fullName}
                      helperText={errors.fullName}
                      disabled={loading}
                      InputProps={{
                        startAdornment: (
                          <InputAdornment position="start">
                            <Person color="primary" />
                          </InputAdornment>
                        ),
                      }}
                    />

                    {/* Account Type Selection */}
                    <Box>
                      <Typography variant="body2" color="text.secondary" gutterBottom>
                        Account Type
                      </Typography>
                      <Grid container spacing={2}>
                        <Grid item xs={6}>
                          <Card
                            onClick={() => setAccountType('individual')}
                            sx={{
                              p: 2,
                              textAlign: 'center',
                              cursor: 'pointer',
                              border: accountType === 'individual' ? `2px solid ${theme.palette.primary.main}` : `1px solid ${theme.palette.divider}`,
                              bgcolor: accountType === 'individual' ? alpha(theme.palette.primary.main, 0.1) : 'background.paper',
                              '&:hover': { bgcolor: alpha(theme.palette.action.hover, 0.04) }
                            }}
                          >
                            <Person sx={{ fontSize: 32, color: accountType === 'individual' ? 'primary.main' : 'text.secondary', mb: 1 }} />
                            <Typography variant="subtitle2" fontWeight="bold">
                              Individual
                            </Typography>
                            <Typography variant="caption" color="text.secondary">
                              Personal account
                            </Typography>
                          </Card>
                        </Grid>
                        <Grid item xs={6}>
                          <Card
                            onClick={() => setAccountType('company')}
                            sx={{
                              p: 2,
                              textAlign: 'center',
                              cursor: 'pointer',
                              border: accountType === 'company' ? `2px solid ${theme.palette.primary.main}` : `1px solid ${theme.palette.divider}`,
                              bgcolor: accountType === 'company' ? alpha(theme.palette.primary.main, 0.1) : 'background.paper',
                              '&:hover': { bgcolor: alpha(theme.palette.action.hover, 0.04) }
                            }}
                          >
                            <Business sx={{ fontSize: 32, color: accountType === 'company' ? 'primary.main' : 'text.secondary', mb: 1 }} />
                            <Typography variant="subtitle2" fontWeight="bold">
                              Company
                            </Typography>
                            <Typography variant="caption" color="text.secondary">
                              Business account
                            </Typography>
                          </Card>
                        </Grid>
                      </Grid>
                    </Box>

                    {/* Company Fields */}
                    {accountType === 'company' && (
                      <AnimatePresence>
                        <motion.div
                          initial={{ opacity: 0, height: 0 }}
                          animate={{ opacity: 1, height: 'auto' }}
                          exit={{ opacity: 0, height: 0 }}
                          transition={{ duration: 0.3 }}
                        >
                          <Stack spacing={2}>
                            <TextField
                              fullWidth
                              label="Company Name"
                              value={formData.companyName}
                              onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}
                              error={!!errors.companyName}
                              helperText={errors.companyName}
                              disabled={loading}
                              InputProps={{
                                startAdornment: (
                                  <InputAdornment position="start">
                                    <Business color="primary" />
                                  </InputAdornment>
                                ),
                              }}
                            />
                            <TextField
                              fullWidth
                              label="Your Role"
                              value={formData.companyRole}
                              onChange={(e) => setFormData({ ...formData, companyRole: e.target.value })}
                              error={!!errors.companyRole}
                              helperText={errors.companyRole}
                              placeholder="e.g., CEO, Manager, HR"
                              disabled={loading}
                            />
                          </Stack>
                        </motion.div>
                      </AnimatePresence>
                    )}
                  </>
                )}

                {/* Email/Phone Field */}
                {!showOtpInput && (
                  authType === 'email' ? (
                    <TextField
                      fullWidth
                      label="Email Address"
                      type="email"
                      value={formData.email}
                      onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                      error={!!errors.email}
                      helperText={errors.email}
                      disabled={loading}
                      InputProps={{
                        startAdornment: (
                          <InputAdornment position="start">
                            <Email color="primary" />
                          </InputAdornment>
                        ),
                      }}
                    />
                  ) : (
                    <TextField
                      fullWidth
                      label="Phone Number"
                      value={formData.phone}
                      onChange={(e) => setFormData({ ...formData, phone: e.target.value })}
                      error={!!errors.phone}
                      helperText={errors.phone || 'Format: +251 9XX XXX XXX'}
                      disabled={loading}
                      placeholder="+251 911 234 567"
                      InputProps={{
                        startAdornment: (
                          <InputAdornment position="start">
                            <Phone color="primary" />
                          </InputAdornment>
                        ),
                      }}
                    />
                  )
                )}

                {/* OTP Section */}
                {showOtpInput && (
                  <AnimatePresence>
                    <motion.div
                      initial={{ opacity: 0, y: -20 }}
                      animate={{ opacity: 1, y: 0 }}
                      exit={{ opacity: 0, y: -20 }}
                      transition={{ duration: 0.3 }}
                    >
                      <Box sx={{
                        p: 2,
                        bgcolor: alpha(theme.palette.primary.main, 0.1),
                        borderRadius: 2,
                        border: `1px solid ${alpha(theme.palette.primary.main, 0.3)}`
                      }}>
                        <Stack direction="row" spacing={1} alignItems="center">
                          <Sms color="primary" />
                          <Typography variant="body2">
                            OTP sent to {otpIdentifier}
                          </Typography>
                        </Stack>
                        {otpCountdown > 0 && (
                          <Stack direction="row" spacing={1} alignItems="center" sx={{ mt: 1 }}>
                            <Timer sx={{ fontSize: 16, color: 'text.secondary' }} />
                            <Typography variant="caption" color="text.secondary">
                              Resend in {otpCountdown}s
                            </Typography>
                          </Stack>
                        )}
                      </Box>

                      <TextField
                        fullWidth
                        label="OTP Code"
                        value={formData.otp}
                        onChange={(e) => setFormData({ ...formData, otp: e.target.value })}
                        error={!!errors.otp}
                        helperText={errors.otp}
                        disabled={loading}
                        placeholder="Enter 6-digit code"
                        InputProps={{
                          startAdornment: (
                            <InputAdornment position="start">
                              <Lock color="primary" />
                            </InputAdornment>
                          ),
                          endAdornment: (
                            <InputAdornment position="end">
                              <Button
                                onClick={resendOtp}
                                disabled={!canResendOtp || loading}
                                size="small"
                              >
                                {loading ? <CircularProgress size={16} /> : 'Resend'}
                              </Button>
                            </InputAdornment>
                          ),
                        }}
                      />
                    </motion.div>
                  </AnimatePresence>
                )}

                {/* Password Field */}
                {!showOtpInput && (
                  <>
                    <TextField
                      fullWidth
                      label="Password"
                      type={showPassword ? 'text' : 'password'}
                      value={formData.password}
                      onChange={(e) => setFormData({ ...formData, password: e.target.value })}
                      error={!!errors.password}
                      helperText={errors.password}
                      disabled={loading}
                      InputProps={{
                        startAdornment: (
                          <InputAdornment position="start">
                            <Lock color="primary" />
                          </InputAdornment>
                        ),
                        endAdornment: (
                          <InputAdornment position="end">
                            <IconButton
                              onClick={() => setShowPassword(!showPassword)}
                              edge="end"
                              disabled={loading}
                            >
                              {showPassword ? <VisibilityOff /> : <Visibility />}
                            </IconButton>
                          </InputAdornment>
                        ),
                      }}
                    />

                    {/* Confirm Password */}
                    {!isLogin && (
                      <TextField
                        fullWidth
                        label="Confirm Password"
                        type={showPassword ? 'text' : 'password'}
                        value={formData.confirmPassword}
                        onChange={(e) => setFormData({ ...formData, confirmPassword: e.target.value })}
                        error={!!errors.confirmPassword}
                        helperText={errors.confirmPassword}
                        disabled={loading}
                        InputProps={{
                          startAdornment: (
                            <InputAdornment position="start">
                              <Lock color="primary" />
                            </InputAdornment>
                          ),
                        }}
                      />
                    )}
                  </>
                )}

                {/* Optional Fields */}
                    {!isLogin && (
                      <Box>
                        <Button
                          onClick={() => setShowOptionalFields(!showOptionalFields)}
                          startIcon={showOptionalFields ? <ExpandLess /> : <ExpandMore />}
                          sx={{ textTransform: 'none' }}
                        >
                          Additional Details
                        </Button>

                        <AnimatePresence>
                          {showOptionalFields && (
                            <motion.div
                              initial={{ opacity: 0, height: 0 }}
                              animate={{ opacity: 1, height: 'auto' }}
                              exit={{ opacity: 0, height: 0 }}
                              transition={{ duration: 0.3 }}
                            >
                              <Stack spacing={2} sx={{ mt: 2 }}>
                                <TextField
                                  fullWidth
                                  label="Company Name (Optional)"
                                  value={formData.companyName}
                                  onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}
                                  disabled={loading}
                                  InputProps={{
                                    startAdornment: (
                                      <InputAdornment position="start">
                                        <Business color="primary" />
                                      </InputAdornment>
                                    ),
                                  }}
                                />
                                <TextField
                                  fullWidth
                                  label="Website (Optional)"
                                  value={formData.website}
                                  onChange={(e) => setFormData({ ...formData, website: e.target.value })}
                                  disabled={loading}
                                  InputProps={{
                                    startAdornment: (
                                      <InputAdornment position="start">
                                        <LinkIcon color="primary" />
                                      </InputAdornment>
                                    ),
                                  }}
                                />
                              </Stack>
                            </motion.div>
                          )}
                        </AnimatePresence>
                      </Box>
                    )}

                    {/* Terms Checkbox */}
                    {!isLogin && (
                      <React.Fragment>
                        <FormControlLabel
                          control={
                            <Checkbox
                              checked={termsAccepted}
                              onChange={(e) => setTermsAccepted(e.target.checked)}
                              color="primary"
                              disabled={loading}
                            />
                          }
                          label={
                            <Typography variant="body2">
                              I agree to the{' '}
                              <Link href="#" color="primary" sx={{ textDecoration: 'none' }}>
                                Terms and Conditions
                              </Link>
                            </Typography>
                          }
                        />
                        {errors.terms && (
                          <Typography variant="caption" color="error">
                            {errors.terms}
                          </Typography>
                        )}
                      </React.Fragment>
                    )}

                    {/* Submit Button */}
                    <Button
                      type="submit"
                      fullWidth
                      variant="contained"
                      size="large"
                      disabled={loading}
                      sx={{
                        py: 2,
                        borderRadius: 3,
                        textTransform: 'none',
                        fontWeight: 700,
                        fontSize: '1.1rem',
                        letterSpacing: 0.5,
                        background: `linear-gradient(135deg, ${theme.palette.primary.main}, ${theme.palette.primary.dark})`,
                        '&:hover': {
                          background: `linear-gradient(135deg, ${theme.palette.primary.dark}, ${theme.palette.primary.main})`,
                          transform: 'translateY(-1px)',
                          boxShadow: `0 8px 24px ${alpha(theme.palette.primary.main, 0.3)}`,
                        },
                        transition: 'all 0.3s ease',
                      }}
                    >
                      {loading ? (
                        <>
                          <CircularProgress size={22} sx={{ mr: 1.5, color: 'white' }} />
                          {showOtpInput ? 'Verifying...' : isLogin ? 'Signing In...' : 'Creating Account...'}
                        </>
                      ) : (
                        showOtpInput ? 'Verify OTP' : (isLogin ? 'Sign In' : 'Create Account')
                      )}
                    </Button>

                    {/* Switch Auth Mode */}
                    {!showOtpInput && (
                      <Box sx={{ textAlign: 'center' }}>
                        <Typography variant="body2" color="text.secondary">
                          {isLogin ? "Don't have an account?" : "Already have an account?"}{' '}
                          <Link
                            component="button"
                            type="button"
                            onClick={toggleForm}
                            color="primary"
                            fontWeight="600"
                            sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
                          >
                            {isLogin ? 'Create Account' : 'Sign In'}
                          </Link>
                        </Typography>
                      </Box>
                    )}

                    {/* Forgot Password */}
                    {isLogin && !showOtpInput && (
                      <Box sx={{ textAlign: 'center' }}>
                        <Link
                          component="button"
                          type="button"
                          onClick={() => navigate('/forgot-password')}
                          color="primary"
                          sx={{ textDecoration: 'none', '&:hover': { textDecoration: 'underline' } }}
                        >
                          Forgot Password?
                        </Link>
                      </Box>
                    )}
                  </Stack>
            </form>
          </Paper>
        </motion.div>
      </Container>

      {/* Success Snackbar */}
      <Snackbar
        open={showSuccess}
        autoHideDuration={3000}
        onClose={() => setShowSuccess(false)}
        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}
      >
        <Alert
          onClose={() => setShowSuccess(false)}
          severity="success"
          icon={<CheckCircle fontSize="inherit" />}
          sx={{ width: '100%' }}
        >
          {isLogin ? 'Login successful! Redirecting...' : 'Account created successfully!'}
        </Alert>
      </Snackbar>
    </Box>
  );
};

export default AuthScreen;
import React, { useState, useEffect } from 'react';
import {
  Box, Container, Typography, Grid, Card, CardContent,
  Button, Avatar, Chip, Table, TableBody, TableCell,
  TableContainer, TableHead, TableRow, Paper, Tabs, Tab,
  TextField, Select, MenuItem, FormControl, InputLabel,
  Dialog, DialogTitle, DialogContent, DialogActions, CircularProgress
} from '@mui/material';
import {
  Dashboard as DashboardIcon, People, Assignment, Settings,
  Payments, Email, CheckCircle, Cancel as CancelIcon, AccessTime, Visibility, Edit,
  Delete, Search, Filter
} from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';
import adminService from '../services/adminService';
import toast from 'react-hot-toast';

const AdminDashboard = () => {
  const navigate = useNavigate();
  const [activeTab, setActiveTab] = useState(0);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [selectedItems, setSelectedItems] = useState([]);
  const [dialogOpen, setDialogOpen] = useState(false);
  const [loading, setLoading] = useState(true);

  // Real data states
  const [stats, setStats] = useState({
    totalListings: 0,
    pendingReview: 0,
    approvedListings: 0,
    rejectedListings: 0,
    totalUsers: 0,
    activeUsers: 0,
    revenue: 0
  });

  const [listings, setListings] = useState([]);
  const [users, setUsers] = useState([]);

  // Fetch data from backend
  useEffect(() => {
    const fetchData = async () => {
      try {
        setLoading(true);
        
        // Fetch dashboard stats
        const statsData = await adminService.getDashboardStats();
        setStats(statsData);

        // Fetch listings
        const listingsData = await adminService.getPendingListings();
        setListings(listingsData.listings || []);

        // Fetch users (we'll need to add this endpoint)
        try {
          const usersData = await adminService.getAllUsers();
          setUsers(usersData.users || []);
        } catch (error) {
          console.error('Error fetching users:', error);
          setUsers([]);
        }

      } catch (error) {
        console.error('Error fetching dashboard data:', error);
        toast.error('Failed to load dashboard data');
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);

  const getStatusColor = (status) => {
    const colors = {
      pending: 'warning',
      approved: 'success',
      rejected: 'error',
      active: 'success',
      inactive: 'default',
      verified: 'info'
    };
    return colors[status] || 'default';
  };

  const getStatusIcon = (status) => {
    const icons = {
      pending: <AccessTime />,
      approved: <CheckCircle />,
      rejected: <Cancel />,
      active: <CheckCircle />,
      inactive: <AccessTime />,
      verified: <CheckCircle />
    };
    return icons[status] || <AccessTime />;
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleSelectItem = (id) => {
    setSelectedItems(prev => 
      prev.includes(id) ? prev.filter(item => item !== id) : [...prev, id]
    );
  };

  const handleBulkAction = async (action) => {
    try {
      if (action === 'approve') {
        for (const listingId of selectedItems) {
          await adminService.updateListingStatus(listingId, 2, 'Approved by admin', '');
        }
        toast.success('Listings approved successfully');
      } else if (action === 'reject') {
        for (const listingId of selectedItems) {
          await adminService.updateListingStatus(listingId, 3, 'Rejected by admin', '');
        }
        toast.success('Listings rejected successfully');
      }
      
      // Refresh data
      const listingsData = await adminService.getPendingListings();
      setListings(listingsData.listings || []);
      
      setSelectedItems([]);
      setDialogOpen(false);
    } catch (error) {
      console.error('Error performing bulk action:', error);
      toast.error('Failed to perform action');
    }
  };

  const handleListingAction = async (listingId, action) => {
    try {
      if (action === 'approve') {
        await adminService.updateListingStatus(listingId, 2, 'Approved by admin', '');
        toast.success('Listing approved successfully');
      } else if (action === 'reject') {
        await adminService.updateListingStatus(listingId, 3, 'Rejected by admin', '');
        toast.success('Listing rejected successfully');
      }
      
      // Refresh data
      const listingsData = await adminService.getPendingListings();
      setListings(listingsData.listings || []);
    } catch (error) {
      console.error('Error performing listing action:', error);
      toast.error('Failed to perform action');
    }
  };

  const filteredListings = listings.filter(listing => {
    const matchesSearch = listing.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         listing.user.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesFilter = filterStatus === 'all' || listing.status === filterStatus;
    return matchesSearch && matchesFilter;
  });

  const tabContent = () => {
    switch (activeTab) {
      case 0: // Dashboard
        return (
          <Box>
            {/* Stats Cards */}
            <Grid container spacing={3} sx={{ mb: 4 }}>
              <Grid item xs={12} sm={6} md={3}>
                <Card>
                  <CardContent sx={{ textAlign: 'center' }}>
                    <Avatar sx={{ bgcolor: 'primary.main', mx: 'auto', mb: 2 }}>
                      <Assignment />
                    </Avatar>
                    <Typography variant="h4">{stats.totalListings}</Typography>
                    <Typography color="text.secondary">Total Listings</Typography>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} sm={6} md={3}>
                <Card>
                  <CardContent sx={{ textAlign: 'center' }}>
                    <Avatar sx={{ bgcolor: 'warning.main', mx: 'auto', mb: 2 }}>
                      <AccessTime />
                    </Avatar>
                    <Typography variant="h4">{stats.pendingReview}</Typography>
                    <Typography color="text.secondary">Pending Review</Typography>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} sm={6} md={3}>
                <Card>
                  <CardContent sx={{ textAlign: 'center' }}>
                    <Avatar sx={{ bgcolor: 'success.main', mx: 'auto', mb: 2 }}>
                      <People />
                    </Avatar>
                    <Typography variant="h4">{stats.totalUsers}</Typography>
                    <Typography color="text.secondary">Total Users</Typography>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} sm={6} md={3}>
                <Card>
                  <CardContent sx={{ textAlign: 'center' }}>
                    <Avatar sx={{ bgcolor: 'info.main', mx: 'auto', mb: 2 }}>
                      <Payments />
                    </Avatar>
                    <Typography variant="h4">ETB {stats.revenue.toLocaleString()}</Typography>
                    <Typography color="text.secondary">Revenue</Typography>
                  </CardContent>
                </Card>
              </Grid>
            </Grid>

            {/* Recent Activity */}
            <Card>
              <CardContent>
                <Typography variant="h6" gutterBottom>Recent Activity</Typography>
                <TableContainer>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell>Listing</TableCell>
                        <TableCell>User</TableCell>
                        <TableCell>Status</TableCell>
                        <TableCell>Date</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {listings.slice(0, 3).map(listing => (
                        <TableRow key={listing.id}>
                          <TableCell>{listing.title}</TableCell>
                          <TableCell>{listing.user}</TableCell>
                          <TableCell>
                            <Chip
                              size="small"
                              label={listing.status}
                              color={getStatusColor(listing.status)}
                              icon={getStatusIcon(listing.status)}
                            />
                          </TableCell>
                          <TableCell>{listing.date}</TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </CardContent>
            </Card>
          </Box>
        );

      case 1: // Listings
        return (
          <Box>
            {/* Search and Filter */}
            <Grid container spacing={2} sx={{ mb: 3 }}>
              <Grid item xs={12} md={6}>
                <TextField
                  fullWidth
                  placeholder="Search listings..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  InputProps={{ startAdornment: <Search /> }}
                />
              </Grid>
              <Grid item xs={12} md={3}>
                <FormControl fullWidth>
                  <InputLabel>Status</InputLabel>
                  <Select
                    value={filterStatus}
                    onChange={(e) => setFilterStatus(e.target.value)}
                  >
                    <MenuItem value="all">All Status</MenuItem>
                    <MenuItem value="pending">Pending</MenuItem>
                    <MenuItem value="approved">Approved</MenuItem>
                    <MenuItem value="rejected">Rejected</MenuItem>
                  </Select>
                </FormControl>
              </Grid>
              <Grid item xs={12} md={3}>
                <Button
                  variant="contained"
                  fullWidth
                  disabled={selectedItems.length === 0}
                  onClick={() => setDialogOpen(true)}
                  sx={{ height: '56px' }}
                >
                  Bulk Action ({selectedItems.length})
                </Button>
              </Grid>
            </Grid>

            {/* Listings Table */}
            <Card>
              <CardContent>
                <TableContainer>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell padding="checkbox">
                          <input
                            type="checkbox"
                            onChange={(e) => {
                              if (e.target.checked) {
                                setSelectedItems(filteredListings.map(l => l.id));
                              } else {
                                setSelectedItems([]);
                              }
                            }}
                          />
                        </TableCell>
                        <TableCell>Listing</TableCell>
                        <TableCell>Category</TableCell>
                        <TableCell>User</TableCell>
                        <TableCell>Price</TableCell>
                        <TableCell>Status</TableCell>
                        <TableCell>Actions</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {filteredListings.map(listing => (
                        <TableRow key={listing.id}>
                          <TableCell padding="checkbox">
                            <input
                              type="checkbox"
                              checked={selectedItems.includes(listing.id)}
                              onChange={() => handleSelectItem(listing.id)}
                            />
                          </TableCell>
                          <TableCell>
                            <Box>
                              <Typography variant="body2" fontWeight="medium">
                                {listing.title}
                              </Typography>
                              <Typography variant="caption" color="text.secondary">
                                {listing.views} views
                              </Typography>
                            </Box>
                          </TableCell>
                          <TableCell>
                            <Chip size="small" label={listing.category} />
                          </TableCell>
                          <TableCell>
                            <Box>
                              <Typography variant="body2">{listing.user}</Typography>
                              <Typography variant="caption" color="text.secondary">
                                {listing.email}
                              </Typography>
                            </Box>
                          </TableCell>
                          <TableCell>ETB {listing.price.toLocaleString()}</TableCell>
                          <TableCell>
                            <Chip
                              size="small"
                              label={listing.status}
                              color={getStatusColor(listing.status)}
                              icon={getStatusIcon(listing.status)}
                            />
                          </TableCell>
                          <TableCell>
                            <Button 
                              size="small" 
                              startIcon={<Visibility />}
                              onClick={() => navigate(`/listings/${listing.id}`)}
                            >
                              View
                            </Button>
                            {listing.status === 'pending' && (
                              <>
                                <Button 
                                  size="small" 
                                  color="success" 
                                  startIcon={<CheckCircle />}
                                  onClick={() => handleListingAction(listing.id, 'approve')}
                                  sx={{ ml: 1 }}
                                >
                                  Approve
                                </Button>
                                <Button 
                                  size="small" 
                                  color="error" 
                                  startIcon={<CancelIcon />}
                                  onClick={() => handleListingAction(listing.id, 'reject')}
                                  sx={{ ml: 1 }}
                                >
                                  Reject
                                </Button>
                              </>
                            )}
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </CardContent>
            </Card>
          </Box>
        );

      case 2: // Users
        return (
          <Box>
            <Card>
              <CardContent>
                <Typography variant="h6" gutterBottom>User Management</Typography>
                <TableContainer>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell>User</TableCell>
                        <TableCell>Type</TableCell>
                        <TableCell>Status</TableCell>
                        <TableCell>Listings</TableCell>
                        <TableCell>Joined</TableCell>
                        <TableCell>Actions</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {users.map(user => (
                        <TableRow key={user.id}>
                          <TableCell>
                            <Box>
                              <Typography variant="body2" fontWeight="medium">
                                {user.name}
                              </Typography>
                              <Typography variant="caption" color="text.secondary">
                                {user.email}
                              </Typography>
                            </Box>
                          </TableCell>
                          <TableCell>
                            <Chip size="small" label={user.type} />
                          </TableCell>
                          <TableCell>
                            <Chip
                              size="small"
                              label={user.status}
                              color={getStatusColor(user.status)}
                              icon={getStatusIcon(user.status)}
                            />
                          </TableCell>
                          <TableCell>{user.listings}</TableCell>
                          <TableCell>{user.joined}</TableCell>
                          <TableCell>
                            <Button size="small" startIcon={<Visibility />}>View</Button>
                            <Button size="small" color="error" startIcon={<Delete />} sx={{ ml: 1 }}>Remove</Button>
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </CardContent>
            </Card>
          </Box>
        );

      default:
        return <Typography>Tab content coming soon...</Typography>;
    }
  };

  if (loading) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh' }}>
      {/* Header */}
      <Box sx={{ bgcolor: 'primary.main', color: 'white', py: 3, mb: 3 }}>
        <Container maxWidth="lg">
          <Typography variant="h4" fontWeight="bold">
            Admin Dashboard
          </Typography>
          <Typography variant="body1" sx={{ opacity: 0.9 }}>
            Manage your marketplace with complete control
          </Typography>
        </Container>
      </Box>

      <Container maxWidth="lg">
        {/* Tabs */}
        <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 3 }}>
          <Tabs value={activeTab} onChange={handleTabChange}>
            <Tab icon={<DashboardIcon />} label="Dashboard" />
            <Tab icon={<Assignment />} label="Listings" />
            <Tab icon={<People />} label="Users" />
            <Tab icon={<Settings />} label="Settings" />
          </Tabs>
        </Box>

        {/* Tab Content */}
        {tabContent()}
      </Container>

      {/* Bulk Action Dialog */}
      <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)}>
        <DialogTitle>Bulk Action</DialogTitle>
        <DialogContent>
          <Typography>
            Perform action on {selectedItems.length} selected items
          </Typography>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setDialogOpen(false)}>Cancel</Button>
          <Button onClick={() => handleBulkAction('approve')} color="success">
            Approve
          </Button>
          <Button onClick={() => handleBulkAction('reject')} color="error">
            Reject
          </Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default AdminDashboard;
import React, { useState, useEffect } from 'react';
import {
  Box, Typography, Grid, Card, CardContent, Button, Avatar, Chip, Table, TableBody, TableCell,
  TableContainer, TableHead, TableRow, Paper, Tabs, Tab,
  TextField, Select, MenuItem, FormControl, InputLabel,
  Dialog, DialogTitle, DialogContent, DialogActions,
  LinearProgress, Alert, IconButton, Tooltip, Badge,
  Switch, FormControlLabel, Accordion, AccordionSummary,
  AccordionDetails, List, ListItem, ListItemText,
  ListItemIcon, Divider, Stack, Skeleton,
  useTheme, alpha, CircularProgress, Container
} from '@mui/material';
import {
  Dashboard as DashboardIcon, People, Assignment, Settings,
  Payment, Email, CheckCircle, Cancel, AccessTime, Visibility, Edit,
  Delete, Search, Filter, TrendingUp, TrendingDown,
  AttachMoney, ShoppingCart, Message, Notifications,
  Security, Storage, Speed, Analytics, Report,
  Download, Upload, Refresh, Block, VerifiedUser,
  Business, Person, Category, LocalOffer, Star,
  Warning, Info, ExpandMore, Send, Block as BlockIcon,
  AdminPanelSettings, DynamicForm, Group, FolderCopy,
  Campaign, AppSettingsAlt, SecurityRounded, Save,
  CardMembership, CardMembership as SubscriptionIcon, Share as ShareIcon
} from '@mui/icons-material';
import { useNavigate } from 'react-router-dom';

// Import new components
import AdminManagement from '../components/AdminManagement';
import CompanyManagement from '../components/CompanyManagement';
import TemplateManagement from '../components/TemplateManagement';
import MembershipSubscription from '../components/MembershipSubscription';

const AdminDashboard = () => {
  const navigate = useNavigate();
  const [activeTab, setActiveTab] = useState(0);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [selectedItems, setSelectedItems] = useState([]);
  const [dialogOpen, setDialogOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const [notifications, setNotifications] = useState(true);
  const [autoApprove, setAutoApprove] = useState(false);

  // Enhanced mock data
  const [stats] = useState({
    totalListings: 1234,
    pendingReview: 45,
    approvedListings: 890,
    rejectedListings: 67,
    totalUsers: 8912,
    activeUsers: 2341,
    revenue: 125600,
    todayRevenue: 12500,
    monthlyGrowth: 12.5,
    conversionRate: 3.2,
    avgResponseTime: 2.4,
    serverUptime: 99.9,
    storageUsed: 67.8,
    bandwidthUsed: 45.2
  });

  const [listings] = useState([
    { id: 1, title: 'Toyota V8 2022', category: 'Cars', user: 'John Doe', email: 'john@email.com', status: 'pending', price: 2500000, views: 234, likes: 45, shares: 12, featured: false, verified: false, date: '2024-01-15', location: 'Addis Ababa' },
    { id: 2, title: '3 Bedroom Apartment', category: 'Homes', user: 'Jane Smith', email: 'jane@email.com', status: 'pending', price: 15000, views: 156, likes: 23, shares: 8, featured: true, verified: true, date: '2024-01-14', location: 'Bole' },
    { id: 3, title: 'Software Developer', category: 'Jobs', user: 'Tech Corp', email: 'hr@techcorp.com', status: 'approved', price: 25000, views: 89, likes: 67, shares: 5, featured: false, verified: true, date: '2024-01-13', location: 'Kazanchis' },
    { id: 4, title: 'iPhone 13 Pro', category: 'Electronics', user: 'Mike Wilson', email: 'mike@email.com', status: 'rejected', price: 45000, views: 345, likes: 12, shares: 3, featured: false, verified: false, date: '2024-01-12', location: 'Mekelle' },
    { id: 5, title: 'Office Space for Rent', category: 'Commercial', user: 'Real Estate Co', email: 'info@realestate.com', status: 'pending', price: 5000, views: 67, likes: 8, shares: 2, featured: false, verified: false, date: '2024-01-11', location: 'Hawassa' }
  ]);

  const [users] = useState([
    { id: 1, name: 'John Doe', email: 'john@email.com', type: 'individual', status: 'active', listings: 5, joined: '2024-01-01', lastActive: '2024-01-15', verified: true, premium: false, rating: 4.5 },
    { id: 2, name: 'Jane Smith', email: 'jane@email.com', type: 'business', status: 'active', listings: 12, joined: '2024-01-02', lastActive: '2024-01-14', verified: true, premium: true, rating: 4.8 },
    { id: 3, name: 'Tech Corp', email: 'hr@techcorp.com', type: 'business', status: 'verified', listings: 8, joined: '2024-01-03', lastActive: '2024-01-13', verified: true, premium: true, rating: 4.9 },
    { id: 4, name: 'Spam User', email: 'spam@bad.com', type: 'individual', status: 'suspended', listings: 0, joined: '2024-01-10', lastActive: '2024-01-10', verified: false, premium: false, rating: 1.0 }
  ]);

  const [transactions] = useState([
    { id: 1, user: 'John Doe', amount: 2500, type: 'listing_fee', status: 'completed', date: '2024-01-15', method: 'telebirr' },
    { id: 2, user: 'Jane Smith', amount: 150, type: 'premium', status: 'completed', date: '2024-01-14', method: 'chappa' },
    { id: 3, user: 'Tech Corp', amount: 5000, type: 'featured', status: 'pending', date: '2024-01-13', method: 'bank' },
    { id: 4, user: 'Mike Wilson', amount: 100, type: 'verification', status: 'completed', date: '2024-01-12', method: 'telebirr' }
  ]);

  const [reports] = useState([
    { id: 1, type: 'spam', listing: 'Fake iPhone', reporter: 'User123', status: 'pending', date: '2024-01-15' },
    { id: 2, type: 'inappropriate', listing: 'Bad Content', reporter: 'User456', status: 'resolved', date: '2024-01-14' },
    { id: 3, type: 'fraud', listing: 'Scam Listing', reporter: 'User789', status: 'investigating', date: '2024-01-13' }
  ]);

  const getStatusColor = (status) => {
    const colors = {
      pending: 'warning',
      approved: 'success',
      rejected: 'error',
      active: 'success',
      inactive: 'default',
      verified: 'info',
      suspended: 'error',
      completed: 'success',
      investigating: 'warning',
      resolved: 'success'
    };
    return colors[status] || 'default';
  };

  const getStatusIcon = (status) => {
    const icons = {
      pending: <AccessTime />,
      approved: <CheckCircle />,
      rejected: <Cancel />,
      active: <CheckCircle />,
      inactive: <AccessTime />,
      verified: <VerifiedUser />,
      suspended: <BlockIcon />,
      completed: <CheckCircle />,
      investigating: <Warning />,
      resolved: <Info />
    };
    return icons[status] || <AccessTime />;
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleSelectItem = (id) => {
    setSelectedItems(prev =>
      prev.includes(id) ? prev.filter(item => item !== id) : [...prev, id]
    );
  };

  const handleBulkAction = (action) => {
    setSelectedItems([]);
    setDialogOpen(false);
  };

  const filteredListings = listings.filter(listing => {
    const matchesSearch = listing.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
      listing.user.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesFilter = filterStatus === 'all' || listing.status === filterStatus;
    return matchesSearch && matchesFilter;
  });

  const tabContent = () => {
    switch (activeTab) {
      case 0: // Dashboard
        return (
          <Box>
            {/* Enhanced Stats Cards */}
            <Grid container spacing={3} sx={{ mb: 4 }}>
              <Grid item xs={12} sm={6} md={3}>
                <Card sx={{ position: 'relative', overflow: 'hidden' }}>
                  <CardContent sx={{ textAlign: 'center' }}>
                    <Avatar sx={{ bgcolor: 'primary.main', mx: 'auto', mb: 2 }}>
                      <Assignment />
                    </Avatar>
                    <Typography variant="h4">{stats.totalListings}</Typography>
                    <Typography color="text.secondary">Total Listings</Typography>
                    <Box sx={{ mt: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'success.main' }}>
                      <TrendingUp fontSize="small" />
                      <Typography variant="caption" sx={{ ml: 0.5 }}>+12% this month</Typography>
                    </Box>
                  </CardContent>
                  <LinearProgress variant="determinate" value={67} sx={{ height: 3 }} />
                </Card>
              </Grid>
              <Grid item xs={12} sm={6} md={3}>
                <Card sx={{ position: 'relative', overflow: 'hidden' }}>
                  <CardContent sx={{ textAlign: 'center' }}>
                    <Avatar sx={{ bgcolor: 'warning.main', mx: 'auto', mb: 2 }}>
                      <AccessTime />
                    </Avatar>
                    <Typography variant="h4">{stats.pendingReview}</Typography>
                    <Typography color="text.secondary">Pending Review</Typography>
                    <Box sx={{ mt: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'warning.main' }}>
                      <TrendingDown fontSize="small" />
                      <Typography variant="caption" sx={{ ml: 0.5 }}>-5% this week</Typography>
                    </Box>
                  </CardContent>
                  <LinearProgress variant="determinate" value={45} sx={{ height: 3, bgcolor: 'warning.main' }} />
                </Card>
              </Grid>
              <Grid item xs={12} sm={6} md={3}>
                <Card sx={{ position: 'relative', overflow: 'hidden' }}>
                  <CardContent sx={{ textAlign: 'center' }}>
                    <Avatar sx={{ bgcolor: 'success.main', mx: 'auto', mb: 2 }}>
                      <People />
                    </Avatar>
                    <Typography variant="h4">{stats.totalUsers}</Typography>
                    <Typography color="text.secondary">Total Users</Typography>
                    <Box sx={{ mt: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'success.main' }}>
                      <TrendingUp fontSize="small" />
                      <Typography variant="caption" sx={{ ml: 0.5 }}>+18% this month</Typography>
                    </Box>
                  </CardContent>
                  <LinearProgress variant="determinate" value={82} sx={{ height: 3, bgcolor: 'success.main' }} />
                </Card>
              </Grid>
              <Grid item xs={12} sm={6} md={3}>
                <Card sx={{ position: 'relative', overflow: 'hidden' }}>
                  <CardContent sx={{ textAlign: 'center' }}>
                    <Avatar sx={{ bgcolor: 'info.main', mx: 'auto', mb: 2 }}>
                      <Payment />
                    </Avatar>
                    <Typography variant="h4">ETB {stats.revenue.toLocaleString()}</Typography>
                    <Typography color="text.secondary">Revenue</Typography>
                    <Box sx={{ mt: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'success.main' }}>
                      <TrendingUp fontSize="small" />
                      <Typography variant="caption" sx={{ ml: 0.5 }}>+25% this month</Typography>
                    </Box>
                  </CardContent>
                  <LinearProgress variant="determinate" value={91} sx={{ height: 3, bgcolor: 'info.main' }} />
                </Card>
              </Grid>
            </Grid>

            {/* System Health */}
            <Grid container spacing={3} sx={{ mb: 4 }}>
              <Grid item xs={12} md={6}>
                <Card>
                  <CardContent>
                    <Typography variant="h6" gutterBottom>System Health</Typography>
                    <Grid container spacing={2}>
                      <Grid item xs={6}>
                        <Box sx={{ textAlign: 'center', py: 2 }}>
                          <Speed sx={{ fontSize: 32, color: 'success.main', mb: 1 }} />
                          <Typography variant="h6">{stats.serverUptime}%</Typography>
                          <Typography variant="caption" color="text.secondary">Server Uptime</Typography>
                        </Box>
                      </Grid>
                      <Grid item xs={6}>
                        <Box sx={{ textAlign: 'center', py: 2 }}>
                          <Storage sx={{ fontSize: 32, color: 'warning.main', mb: 1 }} />
                          <Typography variant="h6">{stats.storageUsed}%</Typography>
                          <Typography variant="caption" color="text.secondary">Storage Used</Typography>
                        </Box>
                      </Grid>
                    </Grid>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} md={6}>
                <Card>
                  <CardContent>
                    <Typography variant="h6" gutterBottom>Performance Metrics</Typography>
                    <Grid container spacing={2}>
                      <Grid item xs={6}>
                        <Box sx={{ textAlign: 'center', py: 2 }}>
                          <TrendingUp sx={{ fontSize: 32, color: 'success.main', mb: 1 }} />
                          <Typography variant="h6">{stats.conversionRate}%</Typography>
                          <Typography variant="caption" color="text.secondary">Conversion Rate</Typography>
                        </Box>
                      </Grid>
                      <Grid item xs={6}>
                        <Box sx={{ textAlign: 'center', py: 2 }}>
                          <Message sx={{ fontSize: 32, color: 'info.main', mb: 1 }} />
                          <Typography variant="h6">{stats.avgResponseTime}h</Typography>
                          <Typography variant="caption" color="text.secondary">Avg Response</Typography>
                        </Box>
                      </Grid>
                    </Grid>
                  </CardContent>
                </Card>
              </Grid>
            </Grid>

            {/* Recent Activity & Quick Actions */}
            <Grid container spacing={3}>
              <Grid item xs={12} md={8}>
                <Card>
                  <CardContent>
                    <Typography variant="h6" gutterBottom>Recent Activity</Typography>
                    <List>
                      {listings.slice(0, 4).map(listing => (
                        <React.Fragment key={listing.id}>
                          <ListItem>
                            <ListItemIcon>
                              <Avatar sx={{ bgcolor: getStatusColor(listing.status) + '.main' }}>
                                {getStatusIcon(listing.status)}
                              </Avatar>
                            </ListItemIcon>
                            <ListItemText
                              primary={`${listing.title} - ${listing.user}`}
                              secondary={`${listing.category}  ${listing.date}`}
                            />
                            <Chip size="small" label={listing.status} color={getStatusColor(listing.status)} />
                          </ListItem>
                          <Divider variant="inset" component="li" />
                        </React.Fragment>
                      ))}
                    </List>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} md={4}>
                <Card>
                  <CardContent>
                    <Typography variant="h6" gutterBottom>Quick Actions</Typography>
                    <Stack spacing={2}>
                      <Button variant="contained" startIcon={<Refresh />} fullWidth>
                        Refresh Data
                      </Button>
                      <Button variant="outlined" startIcon={<Download />} fullWidth>
                        Export Report
                      </Button>
                      <Button variant="outlined" startIcon={<Notifications />} fullWidth>
                        Send Notification
                      </Button>
                      <Button variant="outlined" startIcon={<Security />} fullWidth>
                        Security Check
                      </Button>
                    </Stack>
                  </CardContent>
                </Card>
              </Grid>
            </Grid>
          </Box>
        );

      case 1: // Listings
        return (
          <Box>
            {/* Enhanced Search and Filter */}
            <Grid container spacing={2} sx={{ mb: 3 }}>
              <Grid item xs={12} md={4}>
                <TextField
                  fullWidth
                  placeholder="Search listings..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  InputProps={{ startAdornment: <Search /> }}
                />
              </Grid>
              <Grid item xs={12} md={2}>
                <FormControl fullWidth>
                  <InputLabel>Status</InputLabel>
                  <Select
                    value={filterStatus}
                    onChange={(e) => setFilterStatus(e.target.value)}
                  >
                    <MenuItem value="all">All Status</MenuItem>
                    <MenuItem value="pending">Pending</MenuItem>
                    <MenuItem value="approved">Approved</MenuItem>
                    <MenuItem value="rejected">Rejected</MenuItem>
                  </Select>
                </FormControl>
              </Grid>
              <Grid item xs={12} md={2}>
                <FormControl fullWidth>
                  <InputLabel>Category</InputLabel>
                  <Select defaultValue="all">
                    <MenuItem value="all">All Categories</MenuItem>
                    <MenuItem value="cars">Cars</MenuItem>
                    <MenuItem value="homes">Homes</MenuItem>
                    <MenuItem value="jobs">Jobs</MenuItem>
                    <MenuItem value="electronics">Electronics</MenuItem>
                  </Select>
                </FormControl>
              </Grid>
              <Grid item xs={12} md={2}>
                <Button
                  variant="contained"
                  fullWidth
                  disabled={selectedItems.length === 0}
                  onClick={() => setDialogOpen(true)}
                  sx={{ height: '56px' }}
                >
                  Bulk Action ({selectedItems.length})
                </Button>
              </Grid>
              <Grid item xs={12} md={2}>
                <Button variant="outlined" fullWidth startIcon={<Refresh />} sx={{ height: '56px' }}>
                  Refresh
                </Button>
              </Grid>
            </Grid>

            {/* Listings Table */}
            <Card>
              <CardContent>
                <TableContainer>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell padding="checkbox">
                          <input
                            type="checkbox"
                            onChange={(e) => {
                              if (e.target.checked) {
                                setSelectedItems(filteredListings.map(l => l.id));
                              } else {
                                setSelectedItems([]);
                              }
                            }}
                          />
                        </TableCell>
                        <TableCell>Listing</TableCell>
                        <TableCell>Category</TableCell>
                        <TableCell>User</TableCell>
                        <TableCell>Price</TableCell>
                        <TableCell>Engagement</TableCell>
                        <TableCell>Status</TableCell>
                        <TableCell>Actions</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {filteredListings.map(listing => (
                        <TableRow key={listing.id}>
                          <TableCell padding="checkbox">
                            <input
                              type="checkbox"
                              checked={selectedItems.includes(listing.id)}
                              onChange={() => handleSelectItem(listing.id)}
                            />
                          </TableCell>
                          <TableCell>
                            <Box>
                              <Typography variant="body2" fontWeight="medium">
                                {listing.title}
                              </Typography>
                              <Typography variant="caption" color="text.secondary">
                                {listing.location}  {listing.date}
                              </Typography>
                              <Box sx={{ mt: 1 }}>
                                {listing.featured && <Chip size="small" label="Featured" color="primary" sx={{ mr: 1 }} />}
                                {listing.verified && <Chip size="small" label="Verified" color="success" />}
                              </Box>
                            </Box>
                          </TableCell>
                          <TableCell>
                            <Chip size="small" label={listing.category} />
                          </TableCell>
                          <TableCell>
                            <Box>
                              <Typography variant="body2">{listing.user}</Typography>
                              <Typography variant="caption" color="text.secondary">
                                {listing.email}
                              </Typography>
                            </Box>
                          </TableCell>
                          <TableCell>ETB {listing.price.toLocaleString()}</TableCell>
                          <TableCell>
                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                              <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <Visibility fontSize="small" />
                                <Typography variant="caption">{listing.views}</Typography>
                              </Box>
                              <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <Star fontSize="small" />
                                <Typography variant="caption">{listing.likes}</Typography>
                              </Box>
                              <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <ShareIcon fontSize="small" />
                                <Typography variant="caption">{listing.shares}</Typography>
                              </Box>
                            </Box>
                          </TableCell>
                          <TableCell>
                            <Chip
                              size="small"
                              label={listing.status}
                              color={getStatusColor(listing.status)}
                              icon={getStatusIcon(listing.status)}
                            />
                          </TableCell>
                          <TableCell>
                            <Tooltip title="View">
                              <IconButton size="small"><Visibility /></IconButton>
                            </Tooltip>
                            <Tooltip title="Edit">
                              <IconButton size="small"><Edit /></IconButton>
                            </Tooltip>
                            <Tooltip title="Feature">
                              <IconButton size="small" color="primary"><Star /></IconButton>
                            </Tooltip>
                            <Tooltip title="Delete">
                              <IconButton size="small" color="error"><Delete /></IconButton>
                            </Tooltip>
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </CardContent>
            </Card>
          </Box>
        );

      case 2: // Users
        return (
          <Box>
            {/* User Search and Filter */}
            <Grid container spacing={2} sx={{ mb: 3 }}>
              <Grid item xs={12} md={4}>
                <TextField
                  fullWidth
                  placeholder="Search users..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  InputProps={{ startAdornment: <Search /> }}
                />
              </Grid>
              <Grid item xs={12} md={2}>
                <FormControl fullWidth>
                  <InputLabel>Type</InputLabel>
                  <Select defaultValue="all">
                    <MenuItem value="all">All Types</MenuItem>
                    <MenuItem value="individual">Individual</MenuItem>
                    <MenuItem value="business">Business</MenuItem>
                  </Select>
                </FormControl>
              </Grid>
              <Grid item xs={12} md={2}>
                <FormControl fullWidth>
                  <InputLabel>Status</InputLabel>
                  <Select defaultValue="all">
                    <MenuItem value="all">All Status</MenuItem>
                    <MenuItem value="active">Active</MenuItem>
                    <MenuItem value="suspended">Suspended</MenuItem>
                    <MenuItem value="verified">Verified</MenuItem>
                  </Select>
                </FormControl>
              </Grid>
              <Grid item xs={12} md={2}>
                <Button variant="contained" fullWidth startIcon={<Download />}>
                  Export Users
                </Button>
              </Grid>
              <Grid item xs={12} md={2}>
                <Button variant="outlined" fullWidth startIcon={<Refresh />}>
                  Refresh
                </Button>
              </Grid>
            </Grid>

            {/* Users Table */}
            <Card>
              <CardContent>
                <TableContainer>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell>User</TableCell>
                        <TableCell>Type</TableCell>
                        <TableCell>Status</TableCell>
                        <TableCell>Listings</TableCell>
                        <TableCell>Rating</TableCell>
                        <TableCell>Joined</TableCell>
                        <TableCell>Last Active</TableCell>
                        <TableCell>Actions</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {users.map(user => (
                        <TableRow key={user.id}>
                          <TableCell>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                              <Avatar sx={{ mr: 2, bgcolor: 'primary.main' }}>
                                {user.type === 'business' ? <Business /> : <Person />}
                              </Avatar>
                              <Box>
                                <Typography variant="body2" fontWeight="medium">
                                  {user.name}
                                </Typography>
                                <Typography variant="caption" color="text.secondary">
                                  {user.email}
                                </Typography>
                                <Box sx={{ mt: 0.5 }}>
                                  {user.verified && <Chip size="small" label="Verified" color="success" sx={{ mr: 1 }} />}
                                  {user.premium && <Chip size="small" label="Premium" color="primary" />}
                                </Box>
                              </Box>
                            </Box>
                          </TableCell>
                          <TableCell>
                            <Chip size="small" label={user.type} color={user.type === 'business' ? 'primary' : 'default'} />
                          </TableCell>
                          <TableCell>
                            <Chip
                              size="small"
                              label={user.status}
                              color={getStatusColor(user.status)}
                              icon={getStatusIcon(user.status)}
                            />
                          </TableCell>
                          <TableCell>{user.listings}</TableCell>
                          <TableCell>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                              <Star sx={{ fontSize: 16, color: 'warning.main', mr: 0.5 }} />
                              <Typography variant="body2">{user.rating}</Typography>
                            </Box>
                          </TableCell>
                          <TableCell>{user.joined}</TableCell>
                          <TableCell>{user.lastActive}</TableCell>
                          <TableCell>
                            <Tooltip title="View Profile">
                              <IconButton size="small"><Visibility /></IconButton>
                            </Tooltip>
                            <Tooltip title="Edit User">
                              <IconButton size="small"><Edit /></IconButton>
                            </Tooltip>
                            <Tooltip title="Suspend">
                              <IconButton size="small" color="error"><Block /></IconButton>
                            </Tooltip>
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </CardContent>
            </Card>
          </Box>
        );

      case 5: // Membership & Subscriptions
        return <MembershipSubscription />;

      case 6: // Reports
        return (
          <Box>
            <Grid container spacing={2} sx={{ mb: 3 }}>
              <Grid item xs={12} md={3}>
                <Card sx={{ textAlign: 'center', py: 2, bgcolor: 'warning.light' }}>
                  <Warning sx={{ fontSize: 32, color: 'warning.dark', mb: 1 }} />
                  <Typography variant="h5">{reports.filter(r => r.status === 'pending').length}</Typography>
                  <Typography variant="caption">Pending Reports</Typography>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ textAlign: 'center', py: 2, bgcolor: 'info.light' }}>
                  <Analytics sx={{ fontSize: 32, color: 'info.dark', mb: 1 }} />
                  <Typography variant="h5">{reports.filter(r => r.status === 'investigating').length}</Typography>
                  <Typography variant="caption">Under Investigation</Typography>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ textAlign: 'center', py: 2, bgcolor: 'success.light' }}>
                  <CheckCircle sx={{ fontSize: 32, color: 'success.dark', mb: 1 }} />
                  <Typography variant="h5">{reports.filter(r => r.status === 'resolved').length}</Typography>
                  <Typography variant="caption">Resolved</Typography>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ textAlign: 'center', py: 2, bgcolor: 'error.light' }}>
                  <Report sx={{ fontSize: 32, color: 'error.dark', mb: 1 }} />
                  <Typography variant="h5">{reports.length}</Typography>
                  <Typography variant="caption">Total Reports</Typography>
                </Card>
              </Grid>
            </Grid>

            <Card>
              <CardContent>
                <Typography variant="h6" gutterBottom>Content Reports</Typography>
                <TableContainer>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell>Report ID</TableCell>
                        <TableCell>Type</TableCell>
                        <TableCell>Listing</TableCell>
                        <TableCell>Reporter</TableCell>
                        <TableCell>Status</TableCell>
                        <TableCell>Date</TableCell>
                        <TableCell>Actions</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {reports.map(report => (
                        <TableRow key={report.id}>
                          <TableCell>#{report.id.toString().padStart(6, '0')}</TableCell>
                          <TableCell>
                            <Chip
                              size="small"
                              label={report.type}
                              color={report.type === 'spam' ? 'warning' : report.type === 'fraud' ? 'error' : 'default'}
                            />
                          </TableCell>
                          <TableCell>{report.listing}</TableCell>
                          <TableCell>{report.reporter}</TableCell>
                          <TableCell>
                            <Chip
                              size="small"
                              label={report.status}
                              color={getStatusColor(report.status)}
                              icon={getStatusIcon(report.status)}
                            />
                          </TableCell>
                          <TableCell>{report.date}</TableCell>
                          <TableCell>
                            <Tooltip title="Investigate">
                              <IconButton size="small"><Search /></IconButton>
                            </Tooltip>
                            <Tooltip title="Resolve">
                              <IconButton size="small" color="success"><CheckCircle /></IconButton>
                            </Tooltip>
                            <Tooltip title="Delete Content">
                              <IconButton size="small" color="error"><Delete /></IconButton>
                            </Tooltip>
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </CardContent>
            </Card>
          </Box>
        );

      case 8: // Companies
        return <CompanyManagement />;

      case 9: // Transactions
        return (
          <Box>
            <Grid container spacing={2} sx={{ mb: 3 }}>
              <Grid item xs={12} md={3}>
                <Card sx={{ textAlign: 'center', py: 2 }}>
                  <AttachMoney sx={{ fontSize: 32, color: 'success.main', mb: 1 }} />
                  <Typography variant="h5">ETB {stats.todayRevenue.toLocaleString()}</Typography>
                  <Typography variant="caption" color="text.secondary">Today's Revenue</Typography>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ textAlign: 'center', py: 2 }}>
                  <TrendingUp sx={{ fontSize: 32, color: 'primary.main', mb: 1 }} />
                  <Typography variant="h5">{stats.monthlyGrowth}%</Typography>
                  <Typography variant="caption" color="text.secondary">Monthly Growth</Typography>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ textAlign: 'center', py: 2 }}>
                  <ShoppingCart sx={{ fontSize: 32, color: 'warning.main', mb: 1 }} />
                  <Typography variant="h5">{transactions.length}</Typography>
                  <Typography variant="caption" color="text.secondary">Total Transactions</Typography>
                </Card>
              </Grid>
              <Grid item xs={12} md={3}>
                <Card sx={{ textAlign: 'center', py: 2 }}>
                  <Payment sx={{ fontSize: 32, color: 'info.main', mb: 1 }} />
                  <Typography variant="h5">ETB {(stats.revenue / 30).toFixed(0)}</Typography>
                  <Typography variant="caption" color="text.secondary">Daily Average</Typography>
                </Card>
              </Grid>
            </Grid>

            <Card>
              <CardContent>
                <Typography variant="h6" gutterBottom>Recent Transactions</Typography>
                <TableContainer>
                  <Table>
                    <TableHead>
                      <TableRow>
                        <TableCell>Transaction ID</TableCell>
                        <TableCell>User</TableCell>
                        <TableCell>Amount</TableCell>
                        <TableCell>Type</TableCell>
                        <TableCell>Method</TableCell>
                        <TableCell>Status</TableCell>
                        <TableCell>Date</TableCell>
                        <TableCell>Actions</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {transactions.map(transaction => (
                        <TableRow key={transaction.id}>
                          <TableCell>#{transaction.id.toString().padStart(6, '0')}</TableCell>
                          <TableCell>{transaction.user}</TableCell>
                          <TableCell>ETB {transaction.amount.toLocaleString()}</TableCell>
                          <TableCell>
                            <Chip size="small" label={transaction.type.replace('_', ' ')} />
                          </TableCell>
                          <TableCell>
                            <Chip size="small" label={transaction.method} variant="outlined" />
                          </TableCell>
                          <TableCell>
                            <Chip
                              size="small"
                              label={transaction.status}
                              color={getStatusColor(transaction.status)}
                              icon={getStatusIcon(transaction.status)}
                            />
                          </TableCell>
                          <TableCell>{transaction.date}</TableCell>
                          <TableCell>
                            <Tooltip title="View Details">
                              <IconButton size="small"><Visibility /></IconButton>
                            </Tooltip>
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </CardContent>
            </Card>
          </Box>
        );

      case 10: // Templates
        return <TemplateManagement />;

      case 11: // Admin Management
        return <AdminManagement />;

      case 12: // Settings
        return (
          <Box>
            <Grid container spacing={3}>
              <Grid item xs={12} md={6}>
                <Card>
                  <CardContent>
                    <Typography variant="h6" gutterBottom>General Settings</Typography>
                    <Stack spacing={3}>
                      <FormControlLabel
                        control={<Switch checked={notifications} onChange={(e) => setNotifications(e.target.checked)} />}
                        label="Enable Email Notifications"
                      />
                      <FormControlLabel
                        control={<Switch checked={autoApprove} onChange={(e) => setAutoApprove(e.target.checked)} />}
                        label="Auto-approve Verified Users"
                      />
                      <FormControlLabel
                        control={<Switch defaultChecked />}
                        label="Enable User Registration"
                      />
                      <FormControlLabel
                        control={<Switch defaultChecked />}
                        label="Require Email Verification"
                      />
                      <FormControlLabel
                        control={<Switch defaultChecked />}
                        label="Enable Featured Listings"
                      />
                    </Stack>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12} md={6}>
                <Card>
                  <CardContent>
                    <Typography variant="h6" gutterBottom>System Configuration</Typography>
                    <Stack spacing={3}>
                      <TextField
                        fullWidth
                        label="Site Name"
                        defaultValue="Yesra Sew"
                      />
                      <TextField
                        fullWidth
                        label="Admin Email"
                        defaultValue="admin@yesrasew.com"
                      />
                      <TextField
                        fullWidth
                        label="Max Listings per User"
                        type="number"
                        defaultValue="10"
                      />
                      <TextField
                        fullWidth
                        label="Featured Listing Price (ETB)"
                        type="number"
                        defaultValue="500"
                      />
                      <Button variant="contained" startIcon={<Save />}>
                        Save Settings
                      </Button>
                    </Stack>
                  </CardContent>
                </Card>
              </Grid>
              <Grid item xs={12}>
                <Card>
                  <CardContent>
                    <Typography variant="h6" gutterBottom>System Maintenance</Typography>
                    <Grid container spacing={2}>
                      <Grid item xs={12} md={3}>
                        <Button variant="outlined" fullWidth startIcon={<Refresh />}>
                          Clear Cache
                        </Button>
                      </Grid>
                      <Grid item xs={12} md={3}>
                        <Button variant="outlined" fullWidth startIcon={<Download />}>
                          Backup Database
                        </Button>
                      </Grid>
                      <Grid item xs={12} md={3}>
                        <Button variant="outlined" fullWidth startIcon={<Upload />}>
                          Restore Database
                        </Button>
                      </Grid>
                      <Grid item xs={12} md={3}>
                        <Button variant="outlined" color="error" fullWidth startIcon={<Delete />}>
                          Clean Old Data
                        </Button>
                      </Grid>
                    </Grid>
                  </CardContent>
                </Card>
              </Grid>
            </Grid>
          </Box>
        );

      default:
        return <Typography>Tab content coming soon...</Typography>;
    }
  };

  return (
    <Box sx={{ bgcolor: 'background.default', minHeight: '100vh' }}>
      {/* Header */}
      <Box sx={{ bgcolor: 'primary.main', color: 'white', py: 3, mb: 3 }}>
        <Container maxWidth="lg">
          <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <Box>
              <Typography variant="h4" fontWeight="bold">
                Admin Panel
              </Typography>
              <Typography variant="body1" sx={{ opacity: 0.9 }}>
                Complete marketplace management system
              </Typography>
            </Box>
            <Box sx={{ display: 'flex', gap: 2 }}>
              <Badge badgeContent={stats.pendingReview} color="error">
                <IconButton sx={{ color: 'white' }}>
                  <Notifications />
                </IconButton>
              </Badge>
              <IconButton sx={{ color: 'white' }}>
                <Refresh />
              </IconButton>
            </Box>
          </Box>
        </Container>
      </Box>

      <Container maxWidth="lg">
        {/* Enhanced Tabs */}
        <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 3 }}>
          <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable" scrollButtons="auto">
            <Tab icon={<DashboardIcon />} label="Dashboard" />
            <Tab icon={<Assignment />} label="Listings" />
            <Tab icon={<People />} label="Users" />
            <Tab icon={<Business />} label="Companies" />
            <Tab icon={<CardMembership />} label="Membership" />
            <Tab icon={<Payment />} label="Transactions" />
            <Tab icon={<Report />} label="Reports" />
            <Tab icon={<DynamicForm />} label="Templates" />
            <Tab icon={<AdminPanelSettings />} label="Admin Mgmt" />
            <Tab icon={<Settings />} label="Settings" />
          </Tabs>
        </Box>

        {/* Tab Content */}
        {loading ? (
          <Box sx={{ display: 'flex', justifyContent: 'center', py: 4 }}>
            <CircularProgress />
          </Box>
        ) : (
          tabContent()
        )}
      </Container>

      {/* Bulk Action Dialog */}
      <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)} maxWidth="sm" fullWidth>
        <DialogTitle>Bulk Action Confirmation</DialogTitle>
        <DialogContent>
          <Typography>
            Are you sure you want to perform an action on {selectedItems.length} selected items?
          </Typography>
          <Typography variant="body2" color="text.secondary" sx={{ mt: 1 }}>
            This action cannot be undone.
          </Typography>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setDialogOpen(false)}>Cancel</Button>
          <Button onClick={() => handleBulkAction('approve')} color="success">
            Approve Selected
          </Button>
          <Button onClick={() => handleBulkAction('reject')} color="error">
            Reject Selected
          </Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default AdminDashboard;
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

// Translation resources
const resources = {
    en: {
        translation: {
            // Navigation
            home: 'Home',
            listings: 'Listings',
            homes: 'Homes',
            cars: 'Cars',
            jobs: 'Jobs',
            tenders: 'Tenders',
            favorites: 'Favorites',
            profile: 'Profile',
            dashboard: 'Dashboard',
            chat: 'Messages',
            notifications: 'Notifications',
            pricing: 'Pricing',
            settings: 'Settings',
            logout: 'Logout',
            login: 'Login',
            register: 'Register',

            // Common
            search: 'Search',
            filter: 'Filter',
            sort: 'Sort',
            viewAll: 'View All',
            loadMore: 'Load More',
            noResults: 'No results found',
            loading: 'Loading...',
            error: 'Error',
            success: 'Success',
            save: 'Save',
            cancel: 'Cancel',
            delete: 'Delete',
            edit: 'Edit',
            share: 'Share',
            apply: 'Apply',
            submit: 'Submit',

            // Listing
            forSale: 'For Sale',
            forRent: 'For Rent',
            price: 'Price',
            location: 'Location',
            category: 'Category',
            description: 'Description',
            specifications: 'Specifications',
            contactSeller: 'Contact Seller',
            callSeller: 'Call Seller',
            chatWithSeller: 'Chat with Seller',
            addToFavorites: 'Add to Favorites',
            removeFromFavorites: 'Remove from Favorites',

            // Profile
            myListings: 'My Listings',
            myFavorites: 'My Favorites',
            myApplications: 'My Applications',
            editProfile: 'Edit Profile',
            memberSince: 'Member since',
            verified: 'Verified',

            // Messages
            noMessages: 'No messages yet',
            typeMessage: 'Type a message...',
            send: 'Send',

            // Notifications
            noNotifications: 'No notifications yet',
            markAllAsRead: 'Mark all as read',

            // Admin Dashboard
            adminDashboard: 'Admin Dashboard',
            manageMarketplace: 'Manage your marketplace with complete control',
            totalListings: 'Total Listings',
            pendingReview: 'Pending Review',
            approvedListings: 'Approved Listings',
            rejectedListings: 'Rejected Listings',
            totalUsers: 'Total Users',
            activeUsers: 'Active Users',
            revenue: 'Revenue',
            listingsManagement: 'Listings Management',
            userManagement: 'User Management',
            systemSettings: 'System Settings',
            analytics: 'Analytics',
            approve: 'Approve',
            reject: 'Reject',
            view: 'View',
            edit: 'Edit',
            delete: 'Delete',
            bulkAction: 'Bulk Action',
            selectAll: 'Select All',
            searchListings: 'Search listings...',
            searchUsers: 'Search users...',
            filterByStatus: 'Filter by status',
            all: 'All',
            pending: 'Pending',
            approved: 'Approved',
            rejected: 'Rejected',
            active: 'Active',
            inactive: 'Inactive',
            verified: 'Verified',
            individual: 'Individual',
            business: 'Business',
            listings: 'Listings',
            joined: 'Joined',
            actions: 'Actions',
            status: 'Status',
            user: 'User',
            category: 'Category',
            price: 'Price',
            date: 'Date',
            views: 'Views',
            performAction: 'Perform action on selected items',
            loadingData: 'Loading data...',
            failedToLoadData: 'Failed to load dashboard data',
            listingApproved: 'Listing approved successfully',
            listingRejected: 'Listing rejected successfully',
            listingsApproved: 'Listings approved successfully',
            listingsRejected: 'Listings rejected successfully',
            failedToPerformAction: 'Failed to perform action',
            refresh: 'Refresh',
            selectedItems: 'selected items',
            comingSoon: 'Coming Soon',
            title: 'Title',

            // Analytics
            revenueAnalytics: 'Revenue Analytics',
            quickStats: 'Quick Stats',
            avgListingPrice: 'Average Listing Price',
            conversionRate: 'Conversion Rate',
            activeCategories: 'Active Categories',
            userGrowth: 'User Growth',
            categoryPerformance: 'Category Performance',
            chartComingSoon: 'Chart coming soon',

            // System Settings
            generalSettings: 'General Settings',
            siteMaintenance: 'Site Maintenance',
            siteOnline: 'Site Online',
            userRegistration: 'User Registration',
            allowNewRegistrations: 'Allow New Registrations',
            listingApproval: 'Listing Approval',
            requireAdminApproval: 'Require Admin Approval',
            siteName: 'Site Name',
            siteDescription: 'Site Description',
            saveSettings: 'Save Settings',
            systemInfo: 'System Information',
            serverStatus: 'Server Status',
            online: 'Online',
            databaseStatus: 'Database Status',
            connected: 'Connected',
            lastBackup: 'Last Backup',
            storageUsed: 'Storage Used',

            // Communication
            sendAnnouncement: 'Send Announcement',
            announcementTitle: 'Announcement Title',
            enterTitle: 'Enter title',
            announcementMessage: 'Announcement Message',
            enterMessage: 'Enter message',
            sendTo: 'Send To',
            allUsers: 'All Users',
            activeUsers: 'Active Users',
            verifiedUsers: 'Verified Users',
            schedule: 'Schedule',
            recentAnnouncements: 'Recent Announcements',
            systemMaintenanceScheduled: 'System Maintenance Scheduled',
            sentTo: 'Sent to',
            users: 'users',
            hoursAgo: 'hours ago',

            // Financial
            totalRevenue: 'Total Revenue',
            pendingPayouts: 'Pending Payouts',
            commissionEarned: 'Commission Earned',
            recentTransactions: 'Recent Transactions',
            transactionId: 'Transaction ID',
            type: 'Type',
            amount: 'Amount',
            completed: 'Completed',
            listingFee: 'Listing Fee',

            // Moderation
            reportedListings: 'Reported Listings',
            reason: 'Reason',
            reportedBy: 'Reported By',
            flaggedUsers: 'Flagged Users',
            reports: 'Reports',
            underReview: 'Under Review',
            inappropriate: 'Inappropriate',
            communication: 'Communication',
            financial: 'Financial',
            moderation: 'Moderation',

            // Category Management
            addNewCategory: 'Add New Category',
            categoryName: 'Category Name',
            enterCategoryName: 'Enter category name',
            categoryDescription: 'Category Description',
            enterCategoryDescription: 'Enter category description',
            parentCategory: 'Parent Category',
            none: 'None',
            categoryIcon: 'Category Icon',
            enterIconName: 'Enter icon name',
            addCategory: 'Add Category',
            existingCategories: 'Existing Categories',
            categories: 'Categories',

            // Membership Plans
            createNewPlan: 'Create New Plan',
            planName: 'Plan Name',
            enterPlanName: 'Enter plan name',
            planPrice: 'Plan Price',
            planDuration: 'Plan Duration',
            planFeatures: 'Plan Features',
            enterFeatures: 'Enter features (one per line)',
            createPlan: 'Create Plan',
            existingPlans: 'Existing Plans',
            membership: 'Membership',

            // Audit Logs
            auditLogs: 'Audit Logs',
            timestamp: 'Timestamp',
            admin: 'Admin',
            action: 'Action',
            target: 'Target',
            ipAddress: 'IP Address',
            failed: 'Failed',

            // Featured Listings
            featureNewListing: 'Feature New Listing',
            searchListings: 'Search listings',
            enterListingIdOrTitle: 'Enter listing ID or title',
            featureDuration: 'Feature Duration',
            day: 'day',
            days: 'days',
            featureListing: 'Feature Listing',
            currentlyFeatured: 'Currently Featured',
            expires: 'Expires',

            // Reviews Management
            pendingReviews: 'Pending Reviews',
            reviewer: 'Reviewer',
            rating: 'Rating',
            reportedReviews: 'Reported Reviews',
            reviews: 'Reviews',

            // Detailed Analytics
            detailedAnalytics: 'Detailed Analytics',
            userEngagement: 'User Engagement',
            fromLastMonth: 'from last month',
            avgSessionDuration: 'Avg Session Duration',
            bounceRate: 'Bounce Rate',
            topCategories: 'Top Categories',
            percentage: 'Percentage',

            // User Roles
            userRoles: 'User Roles',
            role: 'Role',
            permissions: 'Permissions',
            permissionSettings: 'Permission Settings',
            requireEmailVerification: 'Require Email Verification',
            allowGuestPosting: 'Allow Guest Posting',
            enableUserReports: 'Enable User Reports',
            autoApproveVerifiedUsers: 'Auto-approve Verified Users',
            savePermissions: 'Save Permissions',

            // Additional
            ipAddress: 'IP Address',
            reviewer: 'Reviewer',

            // New Tab Labels
            featured: 'Featured',
            reviews: 'Reviews',
            reports: 'Reports',
            roles: 'Roles',

            // Email Templates
            emailTemplates: 'Email Templates',
            templateName: 'Template Name',
            type: 'Type',
            lastUsed: 'Last Used',
            createNewTemplate: 'Create New Template',
            enterTemplateName: 'Enter template name',
            templateType: 'Template Type',
            welcomeEmail: 'Welcome Email',
            listingNotification: 'Listing Notification',
            paymentNotification: 'Payment Notification',
            emailContent: 'Email Content',
            enterEmailContent: 'Enter email content',
            saveTemplate: 'Save Template',

            // Backup & Recovery
            backup: 'Backup',
            backupSettings: 'Backup Settings',
            autoBackup: 'Auto Backup',
            backupFrequency: 'Backup Frequency',
            hourly: 'Hourly',
            daily: 'Daily',
            weekly: 'Weekly',
            monthly: 'Monthly',
            backupLocation: 'Backup Location',
            createBackupNow: 'Create Backup Now',
            restoreBackup: 'Restore Backup',
            recentBackups: 'Recent Backups',
            fileName: 'File Name',
            size: 'Size',

            // Security Settings
            security: 'Security',
            securitySettings: 'Security Settings',
            twoFactorAuth: 'Two-Factor Authentication',
            sessionTimeout: 'Session Timeout',
            ipWhitelist: 'IP Whitelist',
            maxLoginAttempts: 'Max Login Attempts',
            sessionTimeoutMinutes: 'Session Timeout (Minutes)',
            saveSecuritySettings: 'Save Security Settings',
            securityLogs: 'Security Logs',
            event: 'Event',

            // API Management
            api: 'API',
            apiKeys: 'API Keys',
            generateNewApiKey: 'Generate New API Key',
            keyName: 'Key Name',
            permissions: 'Permissions',
            created: 'Created',
            apiUsage: 'API Usage',
            todayRequests: "Today's Requests",
            fromYesterday: 'from yesterday',
            rateLimit: 'Rate Limit',
            requestsPerHour: 'requests per hour',

            // SEO & Marketing
            seoMarketing: 'SEO & Marketing',
            seoSettings: 'SEO Settings',
            metaTitle: 'Meta Title',
            metaDescription: 'Meta Description',
            metaKeywords: 'Meta Keywords',
            enableSitemap: 'Enable Sitemap',
            saveSeoSettings: 'Save SEO Settings',
            marketingCampaigns: 'Marketing Campaigns',
            campaign: 'Campaign',
            performance: 'Performance',

            // Support & Helpdesk
            support: 'Support',
            supportTickets: 'Support Tickets',
            ticketId: 'Ticket ID',
            subject: 'Subject',
            priority: 'Priority',
            knowledgeBase: 'Knowledge Base',
            addNewArticle: 'Add New Article',
            article: 'Article',
            views: 'Views',

            // Advanced Analytics
            advancedAnalytics: 'Advanced Analytics',
            realTimeMetrics: 'Real-time Metrics',
            activeUsersNow: 'Active Users Now',
            pageViewsPerMinute: 'Page Views per Minute',
            fromLastHour: 'from last hour',
            avgTimeOnSite: 'Avg Time on Site',
            topPages: 'Top Pages',

            // Multi-tenancy
            multiTenancy: 'Multi-tenancy',
            tenantManagement: 'Tenant Management',
            createNewTenant: 'Create New Tenant',
            tenant: 'Tenant',
            resourceAllocation: 'Resource Allocation',
            totalStorageUsed: 'Total Storage Used',
            utilized: 'utilized',
            apiCallsToday: 'API Calls Today',
            bandwidthUsage: 'Bandwidth Usage',

            // Workflow Automation
            automation: 'Automation',
            automationRules: 'Automation Rules',
            createNewRule: 'Create New Rule',
            rule: 'Rule',
            trigger: 'Trigger',
            action: 'Action',
            automationHistory: 'Automation History',
            result: 'Result',
            duration: 'Duration',

            // Mobile App Management
            mobileApp: 'Mobile App',
            appVersions: 'App Versions',
            releaseNewVersion: 'Release New Version',
            version: 'Version',
            platform: 'Platform',
            appAnalytics: 'App Analytics',
            dailyActiveUsers: 'Daily Active Users',
            fromLastWeek: 'from last week',
            appCrashRate: 'App Crash Rate',
            avgRating: 'Avg Rating',

            // Legal & Compliance
            legalCompliance: 'Legal & Compliance',
            complianceDocuments: 'Compliance Documents',
            uploadDocument: 'Upload Document',
            document: 'Document',
            expires: 'Expires',
            auditTrail: 'Audit Trail',

            // Drawer Navigation
            adminPanel: 'Admin Panel',
            version: 'Version',
            performActionOnItems: 'Perform action on {{count}} selected items',

            // Success Messages
            categoryCreated: 'Category created successfully',
            categoryUpdated: 'Category updated successfully',
            categoryDeleted: 'Category deleted successfully',
            membershipPlanCreated: 'Membership plan created successfully',
            announcementSent: 'Announcement sent successfully',
            settingsUpdated: 'Settings updated successfully',
            emailTemplateCreated: 'Email template created successfully',
            backupCreated: 'Backup created successfully',
            securitySettingsUpdated: 'Security settings updated successfully',
            apiKeyCreated: 'API key created successfully',
            seoSettingsUpdated: 'SEO settings updated successfully',
            campaignCreated: 'Campaign created successfully',
            ticketStatusUpdated: 'Ticket status updated successfully',
            knowledgeArticleCreated: 'Knowledge article created successfully',
            tenantCreated: 'Tenant created successfully',
            automationRuleCreated: 'Automation rule created successfully',
            appVersionReleased: 'App version released successfully',
            complianceDocumentUploaded: 'Compliance document uploaded successfully',

            // Error Messages
            failedToCreateCategory: 'Failed to create category',
            failedToUpdateCategory: 'Failed to update category',
            failedToDeleteCategory: 'Failed to delete category',
            failedToCreateMembershipPlan: 'Failed to create membership plan',
            failedToSendAnnouncement: 'Failed to send announcement',
            failedToUpdateSettings: 'Failed to update settings',
            failedToCreateEmailTemplate: 'Failed to create email template',
            failedToCreateBackup: 'Failed to create backup',
            failedToUpdateSecuritySettings: 'Failed to update security settings',
            failedToCreateApiKey: 'Failed to create API key',
            failedToUpdateSeoSettings: 'Failed to update SEO settings',
            failedToCreateCampaign: 'Failed to create campaign',
            failedToUpdateTicketStatus: 'Failed to update ticket status',
            failedToCreateKnowledgeArticle: 'Failed to create knowledge article',
            failedToCreateTenant: 'Failed to create tenant',
            failedToCreateAutomationRule: 'Failed to create automation rule',
            failedToReleaseAppVersion: 'Failed to release app version',
            failedToUploadComplianceDocument: 'Failed to upload compliance document',
        }
    },
    am: {
        translation: {
            // Navigation
            home: '',
            listings: '',
            homes: '',
            cars: '',
            jobs: '',
            tenders: '',
            favorites: '',
            profile: '',
            dashboard: '',
            chat: '',
            notifications: '',
            pricing: '',
            settings: '',
            logout: '',
            login: '',
            register: '',

            // Common
            search: '',
            filter: '',
            sort: '',
            viewAll: ' ',
            loadMore: ' ',
            noResults: '  ',
            loading: ' ...',
            error: '',
            success: '',
            save: '',
            cancel: '',
            delete: '',
            edit: '',
            share: '',
            apply: '',
            submit: '',

            // Listing
            forSale: '',
            forRent: '',
            price: '',
            location: '',
            category: '',
            description: '',
            specifications: '',
            contactSeller: ' ',
            callSeller: ' ',
            chatWithSeller: '  ',
            addToFavorites: '  ',
            removeFromFavorites: ' ',

            // Profile
            myListings: ' ',
            myFavorites: ' ',
            myApplications: ' ',
            editProfile: ' ',
            memberSince: ' ',
            verified: '',

            // Messages
            noMessages: '  ',
            typeMessage: ' ...',
            send: '',

            // Notifications
            noNotifications: '  ',
            markAllAsRead: '   ',

            // Admin Dashboard
            adminDashboard: ' ',
            manageMarketplace: '   ',
            totalListings: ' ',
            pendingReview: ' ',
            approvedListings: ' ',
            rejectedListings: ' ',
            totalUsers: ' ',
            activeUsers: ' ',
            revenue: '',
            listingsManagement: ' ',
            userManagement: ' ',
            systemSettings: ' ',
            analytics: '',
            approve: '',
            reject: '',
            view: '',
            edit: '',
            delete: '',
            bulkAction: ' ',
            selectAll: ' ',
            searchListings: ' ...',
            searchUsers: ' ...',
            filterByStatus: ' ',
            all: '',
            pending: ' ',
            approved: '',
            rejected: '',
            active: '',
            inactive: ' ',
            verified: '',
            individual: '',
            business: '',
            listings: '',
            joined: '',
            actions: '',
            status: '',
            user: '',
            category: '',
            price: '',
            date: '',
            views: '',
            performAction: '   ',
            loadingData: '  ...',
            failedToLoadData: '   ',
            listingApproved: '  ',
            listingRejected: '  ',
            listingsApproved: '  ',
            listingsRejected: '  ',
            failedToPerformAction: '  ',
            refresh: ' ',
            selectedItems: ' ',
            comingSoon: ' ',
            title: '',
        }
    },
    om: {
        translation: {
            // Navigation
            home: 'Mana',
            listings: 'Beeksisa',
            homes: 'Manneen',
            cars: 'Konkolaatota',
            jobs: 'Hojii',
            tenders: 'Gabaa',
            favorites: 'Jaallatamoo',
            profile: 'Ibsa',
            dashboard: 'Gabatee',
            chat: 'Ergaa',
            notifications: 'Beeksisa',
            pricing: 'Gatii',
            settings: 'Qindaa\'ina',
            logout: 'Ba\'i',
            login: 'Seeni',
            register: 'Galmaa\'i',

            // Common
            search: 'Barbaadi',
            filter: 'Filannoo',
            sort: 'Tartiiba',
            viewAll: 'Hunda Ilaali',
            loadMore: 'Dabalataa Fe\'i',
            noResults: 'Bu\'aan hin argamne',
            loading: 'Fe\'aa jira...',
            error: 'Dogoggora',
            success: 'Milkaa\'ina',
            save: 'Olkaa\'i',
            cancel: 'Dhiisi',
            delete: 'Haqi',
            edit: 'Gulaal',
            share: 'Qoodi',
            apply: 'Iyyannoo',
            submit: 'Ergi',

            // Listing
            forSale: 'Gurgurtaaf',
            forRent: 'Kirayiif',
            price: 'Gatii',
            location: 'Bakka',
            category: 'Ramaddii',
            description: 'Ibsa',
            specifications: 'Ibsa Bal\'aa',
            contactSeller: 'Gurgurtaa Qunnamti',
            callSeller: 'Gurgurtaa Bilbili',
            chatWithSeller: 'Gurgurtaa Waliin Haasa\'i',
            addToFavorites: 'Gara Jaallatamoo Itti Dabali',
            removeFromFavorites: 'Jaallatamoo Irraa Haqi',

            // Profile
            myListings: 'Beeksisa Koo',
            myFavorites: 'Jaallatamoo Koo',
            myApplications: 'Iyyannoo Koo',
            editProfile: 'Ibsa Gulaal',
            memberSince: 'Miseensa Erga',
            verified: 'Mirkaneeffame',

            // Messages
            noMessages: 'Ergaan hin jiru',
            typeMessage: 'Ergaa barreessi...',
            send: 'Ergi',

            // Notifications
            noNotifications: 'Beeksisni hin jiru',
            markAllAsRead: 'Hunda akka dubbifametti mallattoo godhi',
        }
    },
    ti: {
        translation: {
            // Navigation
            home: ' ',
            listings: '',
            homes: '',
            cars: '',
            jobs: '',
            tenders: '',
            favorites: '',
            profile: '',
            dashboard: '',
            chat: '',
            notifications: '',
            pricing: '',
            settings: '',
            logout: '',
            login: '',
            register: '',

            // Common
            search: '',
            filter: '',
            sort: '',
            viewAll: ' ',
            loadMore: ' ',
            noResults: ' ',
            loading: ' ...',
            error: '',
            success: '',
            save: '',
            cancel: '',
            delete: '',
            edit: '',
            share: '',
            apply: '',
            submit: '',

            // Listing
            forSale: '',
            forRent: '',
            price: '',
            location: '',
            category: '',
            description: '',
            specifications: '',
            contactSeller: ' ',
            callSeller: ' ',
            chatWithSeller: '  ',
            addToFavorites: '  ',
            removeFromFavorites: '  ',

            // Profile
            myListings: '',
            myFavorites: '',
            myApplications: '',
            editProfile: ' ',
            memberSince: ' ',
            verified: '',

            // Messages
            noMessages: ' ',
            typeMessage: ' ...',
            send: '',

            // Notifications
            noNotifications: ' ',
            markAllAsRead: '    ',
        }
    }
};

i18n
    .use(LanguageDetector)
    .use(initReactI18next)
    .init({
        resources,
        fallbackLng: 'en',
        debug: false,
        interpolation: {
            escapeValue: false,
        },
        detection: {
            order: ['localStorage', 'navigator'],
            caches: ['localStorage'],
        }
    });

export default i18n;
import { useState, useEffect, useCallback } from 'react';
import { apiService } from '../api';

// Generic API hook
export const useApi = (apiCall, dependencies = []) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const execute = useCallback(async (...args) => {
    try {
      setLoading(true);
      setError(null);
      const response = await apiCall(...args);
      setData(response.data);
      return response;
    } catch (err) {
      setError(err.response?.data?.message || err.message);
      throw err;
    } finally {
      setLoading(false);
    }
  }, [apiCall]);

  useEffect(() => {
    execute();
  }, dependencies);

  return { data, loading, error, execute };
};

// Listings hook
export const useListings = (params = {}) => {
  return useApi(() => apiService.listings.getAll(params), [JSON.stringify(params)]);
};

// Single listing hook
export const useListing = (id) => {
  return useApi(() => apiService.listings.getById(id), [id]);
};

// Categories hook
export const useCategories = (params = {}) => {
  return useApi(() => apiService.categories.getAll(params), [JSON.stringify(params)]);
};

// Category tree hook
export const useCategoryTree = () => {
  return useApi(() => apiService.categories.getTree(), []);
};

// User favorites hook
export const useUserFavorites = (params = {}) => {
  return useApi(() => apiService.users.getFavorites(params), [JSON.stringify(params)]);
};

// User reviews hook
export const useUserReviews = (params = {}) => {
  return useApi(() => apiService.users.getReviews(params), [JSON.stringify(params)]);
};

// Notifications hook
export const useNotifications = (params = {}) => {
  return useApi(() => apiService.users.getNotifications(params), [JSON.stringify(params)]);
};

// Chat rooms hook
export const useChatRooms = (params = {}) => {
  return useApi(() => apiService.chat.getRooms(params), [JSON.stringify(params)]);
};

// Chat messages hook
export const useChatMessages = (roomId, params = {}) => {
  return useApi(() => apiService.chat.getRoom(roomId, params), [roomId, JSON.stringify(params)]);
};

// Payment history hook
export const usePaymentHistory = (params = {}) => {
  return useApi(() => apiService.payments.getHistory(params), [JSON.stringify(params)]);
};

// Admin dashboard hook
export const useAdminDashboard = () => {
  return useApi(() => apiService.admin.getDashboard(), []);
};

// Admin users hook
export const useAdminUsers = (params = {}) => {
  return useApi(() => apiService.admin.getUsers(params), [JSON.stringify(params)]);
};

// Admin listings hook
export const useAdminListings = (params = {}) => {
  return useApi(() => apiService.admin.getListings(params), [JSON.stringify(params)]);
};

// Admin transactions hook
export const useAdminTransactions = (params = {}) => {
  return useApi(() => apiService.admin.getTransactions(params), [JSON.stringify(params)]);
};

// Admin reports hook
export const useAdminReports = (params = {}) => {
  return useApi(() => apiService.admin.getReports(params), [JSON.stringify(params)]);
};

// Analytics dashboard hook
export const useAnalyticsDashboard = (params = {}) => {
  return useApi(() => apiService.analytics.getDashboard(params), [JSON.stringify(params)]);
};

// Mutations hook
export const useMutation = (apiCall) => {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const mutate = useCallback(async (...args) => {
    try {
      setLoading(true);
      setError(null);
      const response = await apiCall(...args);
      return response;
    } catch (err) {
      setError(err.response?.data?.message || err.message);
      throw err;
    } finally {
      setLoading(false);
    }
  }, [apiCall]);

  return { mutate, loading, error };
};

// Specific mutation hooks
export const useCreateListing = () => {
  return useMutation((formData) => apiService.listings.create(formData));
};

export const useUpdateListing = () => {
  return useMutation((id, formData) => apiService.listings.update(id, formData));
};

export const useDeleteListing = () => {
  return useMutation((id) => apiService.listings.delete(id));
};

export const useToggleFavorite = () => {
  return useMutation((id) => apiService.listings.toggleFavorite(id));
};

export const useCreatePaymentIntent = () => {
  return useMutation((paymentData) => apiService.payments.createIntent(paymentData));
};

export const useSendMessage = () => {
  return useMutation((roomId, messageData) => apiService.chat.sendMessage(roomId, messageData));
};

export const useCreateChatRoom = () => {
  return useMutation((roomData) => apiService.chat.createRoom(roomData));
};

export const useUpdateUserStatus = () => {
  return useMutation((id, statusData) => apiService.admin.updateUserStatus(id, statusData));
};

export const useUpdateListingStatus = () => {
  return useMutation((id, statusData) => apiService.admin.updateListingStatus(id, statusData));
};
import React, { createContext, useContext, useState, useEffect } from 'react';
import apiService from '../services/api';

const AuthContext = createContext();

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  // Check if user is authenticated on mount
  useEffect(() => {
    const checkAuth = async () => {
      const token = localStorage.getItem('token');
      if (token) {
        try {
          const response = await apiService.getCurrentUser();
          setUser(response.user || response.data);
          setIsAuthenticated(true);
        } catch (error) {
          // Clear invalid token
          apiService.clearToken();
          setUser(null);
          setIsAuthenticated(false);
        }
      }
      setLoading(false);
    };

    checkAuth();
  }, []);

  const login = async (credentials) => {
    try {
      const response = await apiService.login(credentials);
      setUser(response.user || response.data);
      setIsAuthenticated(true);
      return response;
    } catch (error) {
      throw error;
    }
  };

  const register = async (userData) => {
    try {
      const response = await apiService.register(userData);
      if (response.user || response.data) {
        setUser(response.user || response.data);
        setIsAuthenticated(true);
      }
      return response;
    } catch (error) {
      throw error;
    }
  };

  const logout = () => {
    apiService.clearToken();
    setUser(null);
    setIsAuthenticated(false);
  };

  const updateUser = (userData) => {
    setUser(prev => ({ ...prev, ...userData }));
  };

  const value = {
    user,
    loading,
    isAuthenticated,
    login,
    register,
    logout,
    updateUser
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

export default AuthContext;
import React from 'react';
import { AuthProvider } from './AuthContext';
import { FallbackAuthProvider } from './FallbackAuthContext';

const SafeAuthProvider = ({ children }) => {
  return (
    <React.Suspense fallback={<FallbackAuthProvider>{children}</FallbackAuthProvider>}>
      <ErrorBoundary fallback={<FallbackAuthProvider>{children}</FallbackAuthProvider>}>
        <AuthProvider>{children}</AuthProvider>
      </ErrorBoundary>
    </React.Suspense>
  );
};

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error('AuthProvider Error:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback;
    }

    return this.props.children;
  }
}

export default SafeAuthProvider;
// Export all context providers from here
export { AuthProvider, useAuth } from './AuthContext';
export { default as AuthContext } from './AuthContext';
import React, { createContext, useContext, useState } from 'react';

// Fallback AuthContext for when backend is not available
const FallbackAuthContext = createContext();

export const FallbackAuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);

  const login = async (credentials) => {
    try {
      setIsLoading(true);
      setError(null);
      // Mock login for development
      const mockUser = {
        id: '1',
        firstName: 'Demo',
        lastName: 'User',
        email: credentials.email,
        avatar: null,
      };
      setUser(mockUser);
      setIsAuthenticated(true);
      return { success: true, user: mockUser };
    } catch (err) {
      setError('Login failed');
      return { success: false, error: 'Login failed' };
    } finally {
      setIsLoading(false);
    }
  };

  const register = async (userData) => {
    try {
      setIsLoading(true);
      setError(null);
      // Mock registration for development
      const mockUser = {
        id: '1',
        firstName: userData.firstName,
        lastName: userData.lastName,
        email: userData.email,
        avatar: null,
      };
      setUser(mockUser);
      setIsAuthenticated(true);
      return { success: true, user: mockUser };
    } catch (err) {
      setError('Registration failed');
      return { success: false, error: 'Registration failed' };
    } finally {
      setIsLoading(false);
    }
  };

  const logout = () => {
    setUser(null);
    setIsAuthenticated(false);
    setError(null);
  };

  const value = {
    user,
    isAuthenticated,
    isLoading,
    error,
    login,
    register,
    logout,
    sendOTP: async () => ({ success: true }),
    verifyOTP: async () => ({ success: true }),
    forgotPassword: async () => ({ success: true }),
    resetPassword: async () => ({ success: true }),
    updateProfile: async () => ({ success: true, user }),
    changePassword: async () => ({ success: true }),
    uploadAvatar: async () => ({ success: true, user }),
    clearError: () => setError(null),
  };

  return (
    <FallbackAuthContext.Provider value={value}>
      {children}
    </FallbackAuthContext.Provider>
  );
};

export const useFallbackAuth = () => {
  const context = useContext(FallbackAuthContext);
  if (!context) {
    throw new Error('useFallbackAuth must be used within a FallbackAuthProvider');
  }
  return context;
};

export default FallbackAuthContext;
import React, { createContext, useContext, useReducer, useEffect } from 'react';
import apiService from '../services/api';

// Initial state
const initialState = {
  user: null,
  isAuthenticated: false,
  isLoading: true,
  error: null,
  tokens: {
    accessToken: null,
    refreshToken: null,
  },
};

// Action types
const AUTH_ACTIONS = {
  LOGIN_START: 'LOGIN_START',
  LOGIN_SUCCESS: 'LOGIN_SUCCESS',
  LOGIN_FAILURE: 'LOGIN_FAILURE',
  LOGOUT: 'LOGOUT',
  REGISTER_START: 'REGISTER_START',
  REGISTER_SUCCESS: 'REGISTER_SUCCESS',
  REGISTER_FAILURE: 'REGISTER_FAILURE',
  LOAD_USER_START: 'LOAD_USER_START',
  LOAD_USER_SUCCESS: 'LOAD_USER_SUCCESS',
  LOAD_USER_FAILURE: 'LOAD_USER_FAILURE',
  UPDATE_USER: 'UPDATE_USER',
  CLEAR_ERROR: 'CLEAR_ERROR',
};

// Reducer
const authReducer = (state, action) => {
  switch (action.type) {
    case AUTH_ACTIONS.LOGIN_START:
    case AUTH_ACTIONS.REGISTER_START:
    case AUTH_ACTIONS.LOAD_USER_START:
      return {
        ...state,
        isLoading: true,
        error: null,
      };

    case AUTH_ACTIONS.LOGIN_SUCCESS:
    case AUTH_ACTIONS.REGISTER_SUCCESS:
      return {
        ...state,
        user: action.payload.user,
        tokens: action.payload.tokens,
        isAuthenticated: true,
        isLoading: false,
        error: null,
      };

    case AUTH_ACTIONS.LOAD_USER_SUCCESS:
      return {
        ...state,
        user: action.payload,
        isAuthenticated: true,
        isLoading: false,
        error: null,
      };

    case AUTH_ACTIONS.LOGIN_FAILURE:
    case AUTH_ACTIONS.REGISTER_FAILURE:
    case AUTH_ACTIONS.LOAD_USER_FAILURE:
      return {
        ...state,
        user: null,
        tokens: { accessToken: null, refreshToken: null },
        isAuthenticated: false,
        isLoading: false,
        error: action.payload,
      };

    case AUTH_ACTIONS.LOGOUT:
      return {
        ...state,
        user: null,
        tokens: { accessToken: null, refreshToken: null },
        isAuthenticated: false,
        isLoading: false,
        error: null,
      };

    case AUTH_ACTIONS.UPDATE_USER:
      return {
        ...state,
        user: { ...state.user, ...action.payload },
      };

    case AUTH_ACTIONS.CLEAR_ERROR:
      return {
        ...state,
        error: null,
      };

    default:
      return state;
  }
};

// Create context
const AuthContext = createContext();

// Auth provider component
export const AuthProvider = ({ children }) => {
  const [state, dispatch] = useReducer(authReducer, initialState);

  // Load user on mount
  useEffect(() => {
    const loadUser = async () => {
      const accessToken = localStorage.getItem('accessToken');
      const refreshToken = localStorage.getItem('refreshToken');

      if (accessToken && refreshToken) {
        try {
          dispatch({ type: AUTH_ACTIONS.LOAD_USER_START });
          const response = await apiService.users.getProfile();
          dispatch({ 
            type: AUTH_ACTIONS.LOAD_USER_SUCCESS, 
            payload: response.data.data.user 
          });
        } catch (error) {
          // Token invalid, clear storage
          localStorage.removeItem('accessToken');
          localStorage.removeItem('refreshToken');
          dispatch({ 
            type: AUTH_ACTIONS.LOAD_USER_FAILURE, 
            payload: 'Session expired' 
          });
        }
      } else {
        dispatch({ type: AUTH_ACTIONS.LOAD_USER_SUCCESS, payload: null });
      }
    };

    loadUser();
  }, []);

  // Login function
  const login = async (credentials) => {
    try {
      dispatch({ type: AUTH_ACTIONS.LOGIN_START });
      const response = await apiService.auth.login(credentials);
      const { user, tokens } = response.data.data;

      // Store tokens
      localStorage.setItem('accessToken', tokens.accessToken);
      localStorage.setItem('refreshToken', tokens.refreshToken);

      dispatch({ 
        type: AUTH_ACTIONS.LOGIN_SUCCESS, 
        payload: { user, tokens } 
      });

      return { success: true, user };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Login failed';
      dispatch({ 
        type: AUTH_ACTIONS.LOGIN_FAILURE, 
        payload: errorMessage 
      });
      return { success: false, error: errorMessage };
    }
  };

  // Register function
  const register = async (userData) => {
    try {
      dispatch({ type: AUTH_ACTIONS.REGISTER_START });
      const response = await apiService.auth.register(userData);
      const { user, tokens } = response.data.data;

      // Store tokens
      localStorage.setItem('accessToken', tokens.accessToken);
      localStorage.setItem('refreshToken', tokens.refreshToken);

      dispatch({ 
        type: AUTH_ACTIONS.REGISTER_SUCCESS, 
        payload: { user, tokens } 
      });

      return { success: true, user };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Registration failed';
      dispatch({ 
        type: AUTH_ACTIONS.REGISTER_FAILURE, 
        payload: errorMessage 
      });
      return { success: false, error: errorMessage };
    }
  };

  // Logout function
  const logout = async () => {
    try {
      await apiService.auth.logout();
    } catch (error) {
      // Continue with logout even if API call fails
      console.error('Logout API error:', error);
    }

    // Clear storage
    localStorage.removeItem('accessToken');
    localStorage.removeItem('refreshToken');

    dispatch({ type: AUTH_ACTIONS.LOGOUT });
  };

  // Send OTP
  const sendOTP = async (email, type = 'email_verification') => {
    try {
      const response = await apiService.auth.sendOTP(email, type);
      return { success: true, data: response.data.data };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Failed to send OTP';
      return { success: false, error: errorMessage };
    }
  };

  // Verify OTP
  const verifyOTP = async (email, code, type = 'email_verification') => {
    try {
      const response = await apiService.auth.verifyOTP(email, code, type);
      return { success: true, data: response.data.data };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Failed to verify OTP';
      return { success: false, error: errorMessage };
    }
  };

  // Forgot password
  const forgotPassword = async (email) => {
    try {
      const response = await apiService.auth.forgotPassword(email);
      return { success: true, data: response.data.data };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Failed to send reset email';
      return { success: false, error: errorMessage };
    }
  };

  // Reset password
  const resetPassword = async (email, code, password) => {
    try {
      const response = await apiService.auth.resetPassword(email, code, password);
      return { success: true, data: response.data.data };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Failed to reset password';
      return { success: false, error: errorMessage };
    }
  };

  // Update user profile
  const updateProfile = async (userData) => {
    try {
      const response = await apiService.users.updateProfile(userData);
      const updatedUser = response.data.data.user;
      
      dispatch({ 
        type: AUTH_ACTIONS.UPDATE_USER, 
        payload: updatedUser 
      });

      return { success: true, user: updatedUser };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Failed to update profile';
      return { success: false, error: errorMessage };
    }
  };

  // Change password
  const changePassword = async (passwordData) => {
    try {
      const response = await apiService.users.changePassword(passwordData);
      return { success: true, data: response.data.data };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Failed to change password';
      return { success: false, error: errorMessage };
    }
  };

  // Upload avatar
  const uploadAvatar = async (file) => {
    try {
      const formData = new FormData();
      formData.append('avatar', file);

      const response = await apiService.users.uploadAvatar(formData);
      const updatedUser = response.data.data.user;
      
      dispatch({ 
        type: AUTH_ACTIONS.UPDATE_USER, 
        payload: updatedUser 
      });

      return { success: true, user: updatedUser };
    } catch (error) {
      const errorMessage = error.response?.data?.message || 'Failed to upload avatar';
      return { success: false, error: errorMessage };
    }
  };

  // Clear error
  const clearError = () => {
    dispatch({ type: AUTH_ACTIONS.CLEAR_ERROR });
  };

  const value = {
    ...state,
    login,
    register,
    logout,
    sendOTP,
    verifyOTP,
    forgotPassword,
    resetPassword,
    updateProfile,
    changePassword,
    uploadAvatar,
    clearError,
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
};

// Custom hook to use auth context
export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};

export default AuthContext;
// WhatsApp Share Component
import React, { useState } from 'react';
import {
  Button, Box, Typography, Snackbar, Alert, Tooltip
} from '@mui/material';
import {
  WhatsApp, Share, ContentCopy, CheckCircle
} from '@mui/icons-material';
import { motion } from 'framer-motion';

const WhatsAppShare = ({ listing }) => {
  const [copied, setCopied] = useState(false);
  const [snackbarOpen, setSnackbarOpen] = useState(false);

  const formatListingMessage = () => {
    const message = ` ${listing.title}

 Price: ${listing.price ? `${listing.price.toLocaleString()} ETB` : 'Contact for price'}
 Location: ${listing.location || 'Not specified'}
 Posted on YesraSew

${listing.description ? `${listing.description.substring(0, 200)}...` : ''}

 View details: ${window.location.origin}/listings/${listing.id}

#YesraSew #Ethiopia #Classifieds #${listing.category?.replace(/\s+/g, '') || 'Marketplace'}`;

    return message;
  };

  const shareViaWhatsApp = () => {
    const message = formatListingMessage();
    const encodedMessage = encodeURIComponent(message);
    const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
    
    window.open(whatsappUrl, '_blank');
    
    // Track share event
    if (window.gtag) {
      window.gtag('event', 'share', {
        method: 'whatsapp',
        content_type: 'listing',
        item_id: listing.id
      });
    }
  };

  const copyToClipboard = async () => {
    const message = formatListingMessage();
    
    try {
      await navigator.clipboard.writeText(message);
      setCopied(true);
      setSnackbarOpen(true);
      
      // Reset copied state after 2 seconds
      setTimeout(() => setCopied(false), 2000);
      
      // Track copy event
      if (window.gtag) {
        window.gtag('event', 'copy', {
          content_type: 'listing',
          item_id: listing.id
        });
      }
    } catch (error) {
    }
  };

  const shareViaSystem = async () => {
    const message = formatListingMessage();
    const shareData = {
      title: listing.title,
      text: message,
      url: `${window.location.origin}/listings/${listing.id}`
    };

    try {
      if (navigator.share) {
        await navigator.share(shareData);
      } else {
        // Fallback to copying to clipboard
        copyToClipboard();
      }
    } catch (error) {
    }
  };

  return (
    <>
      <Box sx={{ mb: 2 }}>
        <Typography variant="h6" sx={{ mb: 2, display: 'flex', alignItems: 'center' }}>
          <Share sx={{ mr: 1 }} />
          Share Listing
        </Typography>

        <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>
          <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
            <Button
              variant="contained"
              startIcon={<WhatsApp />}
              onClick={shareViaWhatsApp}
              sx={{
                bgcolor: '#25D366',
                '&:hover': { bgcolor: '#128C7E' },
                color: 'white',
                fontWeight: 'bold'
              }}
            >
              WhatsApp
            </Button>
          </motion.div>

          <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
            <Button
              variant="outlined"
              startIcon={copied ? <CheckCircle /> : <ContentCopy />}
              onClick={copyToClipboard}
              color={copied ? 'success' : 'primary'}
            >
              {copied ? 'Copied!' : 'Copy Link'}
            </Button>
          </motion.div>

          {navigator.share && (
            <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
              <Tooltip title="Share via system share dialog">
                <Button
                  variant="outlined"
                  startIcon={<Share />}
                  onClick={shareViaSystem}
                >
                  Share
                </Button>
              </Tooltip>
            </motion.div>
          )}
        </Box>

        <Box sx={{ mt: 2, p: 1.5, bgcolor: 'grey.50', borderRadius: 1 }}>
          <Typography variant="caption" color="text.secondary">
             Share on WhatsApp to reach more buyers in Ethiopia
          </Typography>
        </Box>
      </Box>

      <Snackbar
        open={snackbarOpen}
        autoHideDuration={2000}
        onClose={() => setSnackbarOpen(false)}
        anchorOrigin={{ vertical: 'bottom', horizontal: 'center' }}
      >
        <Alert severity="success" onClose={() => setSnackbarOpen(false)}>
          Listing copied to clipboard!
        </Alert>
      </Snackbar>
    </>
  );
};

export default WhatsAppShare;
// User Reviews & Ratings Component
import React, { useState, useEffect } from 'react';
import {
  Card, CardContent, Typography, Box, Rating, Avatar, Chip,
  Button, Dialog, DialogTitle, DialogContent, DialogActions,
  TextField, List, ListItem, ListItemText, Divider, Alert
} from '@mui/material';
import {
  Star, RateReview, Person, ThumbUp, ThumbDown, Report
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import apiService from '../services/api';
import toast from 'react-hot-toast';

const UserReviews = ({ userId, userType = 'seller' }) => {
  const [reviews, setReviews] = useState([]);
  const [averageRating, setAverageRating] = useState(0);
  const [totalReviews, setTotalReviews] = useState(0);
  const [dialogOpen, setDialogOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const [formData, setFormData] = useState({
    rating: 5,
    comment: '',
    transaction_id: ''
  });

  useEffect(() => {
    fetchReviews();
  }, [userId]);

  const fetchReviews = async () => {
    try {
      const response = await apiService.getUserReviews(userId);
      const reviewsData = response.data || [];
      setReviews(reviewsData);
      
      if (reviewsData.length > 0) {
        const total = reviewsData.reduce((sum, review) => sum + review.rating, 0);
        const average = total / reviewsData.length;
        setAverageRating(average);
        setTotalReviews(reviewsData.length);
      }
    } catch (error) {
    }
  };

  const handleSubmitReview = async () => {
    if (!formData.comment.trim()) {
      toast.error('Please write a review comment');
      return;
    }

    setLoading(true);
    try {
      await apiService.createReview(userId, formData);
      toast.success('Review submitted successfully!');
      setDialogOpen(false);
      setFormData({
        rating: 5,
        comment: '',
        transaction_id: ''
      });
      fetchReviews();
    } catch (error) {
      toast.error('Failed to submit review');
    } finally {
      setLoading(false);
    }
  };

  const formatDate = (date) => {
    const now = new Date();
    const reviewDate = new Date(date);
    const diffInDays = Math.floor((now - reviewDate) / (1000 * 60 * 60 * 24));
    
    if (diffInDays === 0) return 'Today';
    if (diffInDays === 1) return 'Yesterday';
    if (diffInDays < 7) return `${diffInDays} days ago`;
    if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;
    return `${Math.floor(diffInDays / 30)} months ago`;
  };

  const getRatingDistribution = () => {
    const distribution = [0, 0, 0, 0, 0];
    reviews.forEach(review => {
      distribution[5 - review.rating]++;
    });
    return distribution;
  };

  const ratingDistribution = getRatingDistribution();

  return (
    <Card sx={{ mb: 2 }}>
      <CardContent>
        <Box sx={{ display: 'flex', alignItems: 'center', mb: 3 }}>
          <Star color="primary" sx={{ mr: 1 }} />
          <Typography variant="h6" sx={{ flexGrow: 1 }}>
            Reviews & Ratings
          </Typography>
          <Button
            variant="contained"
            startIcon={<RateReview />}
            onClick={() => setDialogOpen(true)}
            size="small"
          >
            Write Review
          </Button>
        </Box>

        {totalReviews === 0 ? (
          <Alert severity="info">
            <Typography variant="body2">
              Be the first to review this {userType}!
            </Typography>
          </Alert>
        ) : (
          <Box sx={{ mb: 3 }}>
            {/* Rating Summary */}
            <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
              <Box sx={{ textAlign: 'center', mr: 3 }}>
                <Typography variant="h3" color="primary">
                  {averageRating.toFixed(1)}
                </Typography>
                <Rating value={averageRating} precision={0.1} readOnly />
                <Typography variant="caption" color="text.secondary">
                  {totalReviews} reviews
                </Typography>
              </Box>
              
              <Box sx={{ flexGrow: 1 }}>
                {[5, 4, 3, 2, 1].map((rating) => (
                  <Box key={rating} sx={{ display: 'flex', alignItems: 'center', mb: 0.5 }}>
                    <Typography variant="body2" sx={{ width: 40 }}>
                      {rating} 
                    </Typography>
                    <Box sx={{ flexGrow: 1, mx: 1 }}>
                      <Box
                        sx={{
                          height: 8,
                          bgcolor: 'grey.200',
                          borderRadius: 4,
                          overflow: 'hidden'
                        }}
                      >
                        <Box
                          sx={{
                            height: '100%',
                            width: `${(ratingDistribution[5 - rating] / totalReviews) * 100}%`,
                            bgcolor: 'primary.main'
                          }}
                        />
                      </Box>
                    </Box>
                    <Typography variant="body2" sx={{ width: 30, textAlign: 'right' }}>
                      {ratingDistribution[5 - rating]}
                    </Typography>
                  </Box>
                ))}
              </Box>
            </Box>
          </Box>
        )}

        {/* Reviews List */}
        {reviews.length > 0 && (
          <List>
            {reviews.map((review, index) => (
              <motion.div
                key={review.id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.1 }}
              >
                <ListItem alignItems="flex-start" sx={{ px: 0 }}>
                  <Avatar sx={{ mr: 2 }}>
                    <Person />
                  </Avatar>
                  <ListItemText
                    primary={
                      <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                        <Typography variant="subtitle1" sx={{ flexGrow: 1 }}>
                          {review.reviewer_name || 'Anonymous'}
                        </Typography>
                        <Rating value={review.rating} size="small" readOnly />
                        <Typography variant="caption" color="text.secondary" sx={{ ml: 1 }}>
                          {formatDate(review.created_at)}
                        </Typography>
                      </Box>
                    }
                    secondary={
                      <Box>
                        <Typography variant="body2" color="text.primary" sx={{ mb: 1 }}>
                          {review.comment}
                        </Typography>
                        {review.transaction_id && (
                          <Chip
                            label="Verified Purchase"
                            size="small"
                            color="success"
                            sx={{ mr: 1 }}
                          />
                        )}
                        <Box sx={{ display: 'flex', gap: 1, mt: 1 }}>
                          <Button size="small" startIcon={<ThumbUp />}>
                            Helpful
                          </Button>
                          <Button size="small" startIcon={<Report />} color="error">
                            Report
                          </Button>
                        </Box>
                      </Box>
                    }
                  />
                </ListItem>
                {index < reviews.length - 1 && <Divider sx={{ my: 2 }} />}
              </motion.div>
            ))}
          </List>
        )}

        {/* Review Dialog */}
        <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)} maxWidth="sm" fullWidth>
          <DialogTitle>
            Write a Review
          </DialogTitle>
          <DialogContent>
            <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
              Share your experience with this {userType}
            </Typography>

            <Box sx={{ mb: 3, textAlign: 'center' }}>
              <Typography variant="subtitle1" sx={{ mb: 1 }}>
                Rating
              </Typography>
              <Rating
                value={formData.rating}
                onChange={(event, newValue) => {
                  setFormData({ ...formData, rating: newValue });
                }}
                size="large"
              />
            </Box>

            <TextField
              fullWidth
              label="Your Review"
              multiline
              rows={4}
              value={formData.comment}
              onChange={(e) => setFormData({ ...formData, comment: e.target.value })}
              placeholder="Describe your experience with this seller/listing..."
              sx={{ mb: 2 }}
            />

            <TextField
              fullWidth
              label="Transaction ID (Optional)"
              value={formData.transaction_id}
              onChange={(e) => setFormData({ ...formData, transaction_id: e.target.value })}
              placeholder="If this was a verified transaction"
            />

            <Alert severity="info" sx={{ mt: 2 }}>
              <Typography variant="caption">
                Your review helps other users make informed decisions. Please be honest and constructive.
              </Typography>
            </Alert>
          </DialogContent>
          <DialogActions>
            <Button onClick={() => setDialogOpen(false)}>Cancel</Button>
            <Button
              onClick={handleSubmitReview}
              variant="contained"
              disabled={loading || !formData.comment.trim()}
            >
              Submit Review
            </Button>
          </DialogActions>
        </Dialog>
      </CardContent>
    </Card>
  );
};

export default UserReviews;
// Trust Badges & Verification Component
import React, { useState, useEffect } from 'react';
import {
  Box, Typography, Chip, Avatar, useTheme, alpha, Tooltip,
  Dialog, DialogTitle, DialogContent, DialogActions, Button, List, ListItem, ListItemText, ListItemIcon, Alert
} from '@mui/material';
import {
  Verified, Shield, Star, Person, CheckCircle, Security, Phone, Email, Fingerprint, Badge, VerifiedUser
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import apiService from '../services/api';
import toast from 'react-hot-toast';

const TrustBadges = ({ user, showActions = true }) => {
  const [verificationStatus, setVerificationStatus] = useState({});
  const [dialogOpen, setDialogOpen] = useState(false);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchVerificationStatus();
  }, [user?.id]);

  const fetchVerificationStatus = async () => {
    try {
      const response = await apiService.getVerificationStatus();
      setVerificationStatus(response.data || {});
    } catch (error) {
    }
  };

  const handleVerifyPhone = async () => {
    setLoading(true);
    try {
      await apiService.verifyPhoneNumber({ phone_number: user.phone_number });
      toast.success('Verification code sent to your phone!');
      setDialogOpen(false);
    } catch (error) {
      toast.error('Failed to send verification code');
    } finally {
      setLoading(false);
    }
  };

  const handleVerifyEmail = async () => {
    setLoading(true);
    try {
      await apiService.verifyEmail({ email: user.email });
      toast.success('Verification email sent!');
      setDialogOpen(false);
    } catch (error) {
      toast.error('Failed to send verification email');
    } finally {
      setLoading(false);
    }
  };

  const handleVerifyIdentity = async () => {
    setLoading(true);
    try {
      await apiService.verifyIdentity({
        full_name: user.full_name,
        id_type: 'national_id',
        id_number: '',
        id_document_url: ''
      });
      toast.success('Identity verification initiated!');
      setDialogOpen(false);
    } catch (error) {
      toast.error('Failed to initiate identity verification');
    } finally {
      setLoading(false);
    }
  };

  const getVerificationLevel = () => {
    const verifiedCount = [
      verificationStatus.phone_verified,
      verificationStatus.email_verified,
      verificationStatus.identity_verified,
      verificationStatus.business_verified
    ].filter(Boolean).length;

    if (verifiedCount === 0) return { level: 'Basic', color: 'default', icon: <Person /> };
    if (verifiedCount === 1) return { level: 'Verified', color: 'info', icon: <CheckCircle /> };
    if (verifiedCount === 2) return { level: 'Trusted', color: 'success', icon: <Shield /> };
    if (verifiedCount === 3) return { level: 'Premium', color: 'warning', icon: <Star /> };
    return { level: 'Elite', color: 'secondary', icon: <Badge /> };
  };

  const verificationLevel = getVerificationLevel();

  const badges = [
    {
      id: 'phone',
      label: 'Phone Verified',
      icon: <Phone />,
      verified: verificationStatus.phone_verified,
      color: 'success',
      description: 'Phone number has been verified'
    },
    {
      id: 'email',
      label: 'Email Verified',
      icon: <Email />,
      verified: verificationStatus.email_verified,
      color: 'success',
      description: 'Email address has been verified'
    },
    {
      id: 'identity',
      label: 'Identity Verified',
      icon: <Fingerprint />,
      verified: verificationStatus.identity_verified,
      color: 'warning',
      description: 'Government ID has been verified'
    },
    {
      id: 'business',
      label: 'Business Verified',
      icon: <Security />,
      verified: verificationStatus.business_verified,
      color: 'primary',
      description: 'Business documents have been verified'
    },
    {
      id: 'premium',
      label: 'Premium Member',
      icon: <Star />,
      verified: user.subscription_plan !== 'Free',
      color: 'warning',
      description: 'Premium subscription member'
    },
    {
      id: 'top_rated',
      label: 'Top Rated',
      icon: <Badge />,
      verified: user.rating >= 4.5,
      color: 'secondary',
      description: 'Maintains excellent ratings'
    }
  ];

  const verificationActions = [
    {
      title: 'Phone Verification',
      description: 'Verify your phone number to build trust',
      icon: <Phone />,
      action: handleVerifyPhone,
      disabled: verificationStatus.phone_verified,
      completed: verificationStatus.phone_verified
    },
    {
      title: 'Email Verification',
      description: 'Verify your email address for security',
      icon: <Email />,
      action: handleVerifyEmail,
      disabled: verificationStatus.email_verified,
      completed: verificationStatus.email_verified
    },
    {
      title: 'Identity Verification',
      description: 'Upload government ID for maximum trust',
      icon: <Fingerprint />,
      action: handleVerifyIdentity,
      disabled: verificationStatus.identity_verified,
      completed: verificationStatus.identity_verified
    }
  ];

  return (
    <Box>
      {/* Verification Level Badge */}
      <motion.div
        initial={{ scale: 0.8, opacity: 0 }}
        animate={{ scale: 1, opacity: 1 }}
        transition={{ type: 'spring', stiffness: 200 }}
      >
        <Chip
          label={verificationLevel.level}
          color={verificationLevel.color}
          variant="outlined"
          icon={verificationLevel.icon}
          sx={{ mb: 2, fontSize: '0.875rem', fontWeight: 'bold' }}
        />
      </motion.div>

      {/* Trust Badges Grid */}
      <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, mb: 2 }}>
        {badges.map((badge, index) => (
          badge.verified && (
            <motion.div
              key={badge.id}
              initial={{ opacity: 0, scale: 0.8 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: index * 0.1 }}
            >
              <Tooltip title={badge.description}>
                <Chip
                  label={badge.label}
                  color={badge.color}
                  size="small"
                  icon={badge.icon}
                  variant="outlined"
                  sx={{ fontSize: '0.75rem' }}
                />
              </Tooltip>
            </motion.div>
          )
        ))}
      </Box>

      {/* Trust Score */}
      {user.rating && (
        <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
          <Typography variant="body2" color="text.secondary" sx={{ mr: 1 }}>
            Trust Score:
          </Typography>
          <Typography variant="h6" color="primary" sx={{ mr: 1 }}>
            {user.rating.toFixed(1)}
          </Typography>
          <Typography variant="caption" color="text.secondary">
            ({user.reviews_count || 0} reviews)
          </Typography>
        </Box>
      )}

      {/* Verification Actions */}
      {showActions && (
        <Box>
          <Button
            variant="outlined"
            startIcon={<VerifiedUser />}
            onClick={() => setDialogOpen(true)}
            size="small"
            sx={{ mb: 1 }}
          >
            Get Verified
          </Button>

          <Typography variant="caption" color="text.secondary">
            Complete verification to build trust and increase visibility
          </Typography>
        </Box>
      )}

      {/* Verification Dialog */}
      <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)} maxWidth="sm" fullWidth>
        <DialogTitle>
          <Box sx={{ display: 'flex', alignItems: 'center' }}>
            <VerifiedUser sx={{ mr: 1 }} />
            Get Verified - Build Trust
          </Box>
        </DialogTitle>
        <DialogContent>
          <Alert severity="info" sx={{ mb: 2 }}>
            <Typography variant="body2">
              Verified sellers get 3x more responses and sell faster!
            </Typography>
          </Alert>

          <List>
            {verificationActions.map((action, index) => (
              <motion.div
                key={action.title}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: index * 0.1 }}
              >
                <ListItem
                  sx={{
                    border: 1,
                    borderColor: 'divider',
                    borderRadius: 1,
                    mb: 1,
                    opacity: action.completed ? 0.6 : 1
                  }}
                >
                  <ListItemIcon>
                    {action.completed ? (
                      <CheckCircle color="success" />
                    ) : (
                      action.icon
                    )}
                  </ListItemIcon>
                  <ListItemText
                    primary={
                      <Typography variant="subtitle1">
                        {action.title}
                        {action.completed && (
                          <Chip
                            label="Completed"
                            color="success"
                            size="small"
                            sx={{ ml: 1 }}
                          />
                        )}
                      </Typography>
                    }
                    secondary={action.description}
                  />
                  {!action.completed && (
                    <Button
                      variant="outlined"
                      onClick={action.action}
                      disabled={loading}
                      size="small"
                    >
                      Verify
                    </Button>
                  )}
                </ListItem>
              </motion.div>
            ))}
          </List>

          <Alert severity="warning" sx={{ mt: 2 }}>
            <Typography variant="caption">
              Your information is kept secure and only used for verification purposes.
            </Typography>
          </Alert>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setDialogOpen(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default TrustBadges;
import React, { useState } from 'react';
import {
  Box, Typography, Card, CardContent, Grid, TextField, Select,
  MenuItem, Button, Switch, FormControlLabel, Accordion, AccordionSummary,
  AccordionDetails, List, ListItem, ListItemText, ListItemIcon,
  IconButton, Chip, Dialog, DialogTitle, DialogContent, DialogActions
} from '@mui/material';
import {
  DynamicForm, Person, Settings, Email, Sms, NotificationsActive,
  ExpandMore, Add, Edit, Delete, Save, Preview, Code
} from '@mui/icons-material';

const TemplateManagement = () => {
  const [activeTab, setActiveTab] = useState(0);
  const [postTemplates, setPostTemplates] = useState([
    {
      id: 1,
      name: 'Car Listing Template',
      category: 'Cars',
      fields: [
        { id: 'make', label: 'Make', type: 'text', required: true },
        { id: 'model', label: 'Model', type: 'text', required: true },
        { id: 'year', label: 'Year', type: 'number', required: true },
        { id: 'mileage', label: 'Mileage', type: 'number', required: false },
        { id: 'condition', label: 'Condition', type: 'dropdown', options: ['New', 'Used'], required: true }
      ],
      active: true
    },
    {
      id: 2,
      name: 'Property Listing Template',
      category: 'Homes',
      fields: [
        { id: 'bedrooms', label: 'Bedrooms', type: 'number', required: true },
        { id: 'bathrooms', label: 'Bathrooms', type: 'number', required: true },
        { id: 'area', label: 'Area (sqm)', type: 'number', required: true },
        { id: 'furnished', label: 'Furnished', type: 'checkbox', required: false },
        { id: 'parking', label: 'Parking Available', type: 'checkbox', required: false }
      ],
      active: true
    }
  ]);

  const [profileTemplates, setProfileTemplates] = useState([
    {
      id: 1,
      name: 'Individual Profile Template',
      fields: [
        { id: 'firstName', label: 'First Name', type: 'text', required: true },
        { id: 'lastName', label: 'Last Name', type: 'text', required: true },
        { id: 'phone', label: 'Phone', type: 'text', required: true },
        { id: 'bio', label: 'Bio', type: 'text', required: false },
        { id: 'profilePicture', label: 'Profile Picture', type: 'file', required: false }
      ],
      active: true
    },
    {
      id: 2,
      name: 'Business Profile Template',
      fields: [
        { id: 'companyName', label: 'Company Name', type: 'text', required: true },
        { id: 'businessType', label: 'Business Type', type: 'dropdown', options: ['PLC', 'Sole Proprietor', 'Partnership'], required: true },
        { id: 'tinNumber', label: 'TIN Number', type: 'text', required: true },
        { id: 'licenseNumber', label: 'License Number', type: 'text', required: true },
        { id: 'logo', label: 'Company Logo', type: 'file', required: false }
      ],
      active: true
    }
  ]);

  const [communicationTemplates, setCommunicationTemplates] = useState([
    {
      id: 1,
      name: 'Welcome Email',
      type: 'email',
      subject: 'Welcome to Yesra Sew!',
      content: 'Dear {{name}}, welcome to our platform...',
      variables: ['name', 'email'],
      active: true
    },
    {
      id: 2,
      name: 'Listing Approved SMS',
      type: 'sms',
      content: 'Your listing "{{title}}" has been approved!',
      variables: ['title', 'category'],
      active: true
    },
    {
      id: 3,
      name: 'Payment Confirmation',
      type: 'email',
      subject: 'Payment Confirmation',
      content: 'Your payment of ETB {{amount}} has been received...',
      variables: ['amount', 'service'],
      active: false
    }
  ]);

  const renderFieldEditor = (field, index, templateType) => (
    <Card key={field.id} sx={{ mb: 2 }}>
      <CardContent>
        <Grid container spacing={2}>
          <Grid item xs={12} md={3}>
            <TextField
              fullWidth
              label="Field Label"
              value={field.label}
              onChange={(e) => updateField(templateType, index, 'label', e.target.value)}
              size="small"
            />
          </Grid>
          <Grid item xs={12} md={2}>
            <Select
              fullWidth
              value={field.type}
              onChange={(e) => updateField(templateType, index, 'type', e.target.value)}
              size="small"
            >
              <MenuItem value="text">Text</MenuItem>
              <MenuItem value="number">Number</MenuItem>
              <MenuItem value="dropdown">Dropdown</MenuItem>
              <MenuItem value="checkbox">Checkbox</MenuItem>
              <MenuItem value="file">File</MenuItem>
            </Select>
          </Grid>
          <Grid item xs={12} md={2}>
            <FormControlLabel
              control={
                <Switch
                  checked={field.required}
                  onChange={(e) => updateField(templateType, index, 'required', e.target.checked)}
                />
              }
              label="Required"
            />
          </Grid>
          <Grid item xs={12} md={3}>
            {field.type === 'dropdown' && (
              <TextField
                fullWidth
                label="Options (comma separated)"
                value={field.options?.join(', ') || ''}
                onChange={(e) => updateField(templateType, index, 'options', e.target.value.split(',').map(o => o.trim()))}
                size="small"
              />
            )}
          </Grid>
          <Grid item xs={12} md={2}>
            <IconButton color="error" onClick={() => removeField(templateType, index)}>
              <Delete />
            </IconButton>
          </Grid>
        </Grid>
      </CardContent>
    </Card>
  );

  const updateField = (templateType, fieldIndex, property, value) => {
    if (templateType === 'post') {
      const updated = [...postTemplates];
      updated[0].fields[fieldIndex][property] = value;
      setPostTemplates(updated);
    } else if (templateType === 'profile') {
      const updated = [...profileTemplates];
      updated[0].fields[fieldIndex][property] = value;
      setProfileTemplates(updated);
    }
  };

  const removeField = (templateType, index) => {
    if (templateType === 'post') {
      const updated = [...postTemplates];
      updated[0].fields.splice(index, 1);
      setPostTemplates(updated);
    } else if (templateType === 'profile') {
      const updated = [...profileTemplates];
      updated[0].fields.splice(index, 1);
      setProfileTemplates(updated);
    }
  };

  return (
    <Box>
      <Typography variant="h6" gutterBottom>Template Management</Typography>
      
      <Grid container spacing={3}>
        {/* Post Templates */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="subtitle1" gutterBottom>Post Templates</Typography>
              <List>
                {postTemplates.map(template => (
                  <ListItem key={template.id}>
                    <ListItemIcon><DynamicForm /></ListItemIcon>
                    <ListItemText
                      primary={template.name}
                      secondary={`${template.category}  ${template.fields.length} fields`}
                    />
                    <IconButton size="small"><Edit /></IconButton>
                  </ListItem>
                ))}
              </List>
              <Button variant="contained" fullWidth startIcon={<Add />}>
                Add Post Template
              </Button>
            </CardContent>
          </Card>
        </Grid>

        {/* Profile Templates */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="subtitle1" gutterBottom>Profile Templates</Typography>
              <List>
                {profileTemplates.map(template => (
                  <ListItem key={template.id}>
                    <ListItemIcon><Person /></ListItemIcon>
                    <ListItemText
                      primary={template.name}
                      secondary={`${template.fields.length} fields`}
                    />
                    <IconButton size="small"><Edit /></IconButton>
                  </ListItem>
                ))}
              </List>
              <Button variant="contained" fullWidth startIcon={<Add />}>
                Add Profile Template
              </Button>
            </CardContent>
          </Card>
        </Grid>

        {/* Communication Templates */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="subtitle1" gutterBottom>Communication Templates</Typography>
              <List>
                {communicationTemplates.map(template => (
                  <ListItem key={template.id}>
                    <ListItemIcon>
                      {template.type === 'email' ? <Email /> : <Sms />}
                    </ListItemIcon>
                    <ListItemText
                      primary={template.name}
                      secondary={template.type}
                    />
                    <IconButton size="small"><Edit /></IconButton>
                  </ListItem>
                ))}
              </List>
              <Button variant="contained" fullWidth startIcon={<Add />}>
                Add Communication Template
              </Button>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Template Editor */}
      <Grid container spacing={3} sx={{ mt: 2 }}>
        <Grid item xs={12}>
          <Card>
            <CardContent>
              <Typography variant="subtitle1" gutterBottom>Template Editor</Typography>
              
              <Accordion>
                <AccordionSummary expandIcon={<ExpandMore />}>
                  <Typography>Car Listing Template - Field Editor</Typography>
                </AccordionSummary>
                <AccordionDetails>
                  {postTemplates[0]?.fields.map((field, index) => 
                    renderFieldEditor(field, index, 'post')
                  )}
                  <Button
                    variant="outlined"
                    startIcon={<Add />}
                    onClick={() => {
                      const newField = {
                        id: Date.now().toString(),
                        label: 'New Field',
                        type: 'text',
                        required: false
                      };
                      const updated = [...postTemplates];
                      updated[0].fields.push(newField);
                      setPostTemplates(updated);
                    }}
                  >
                    Add Field
                  </Button>
                </AccordionDetails>
              </Accordion>

              <Accordion>
                <AccordionSummary expandIcon={<ExpandMore />}>
                  <Typography>Email Template Editor</Typography>
                </AccordionSummary>
                <AccordionDetails>
                  <Grid container spacing={2}>
                    <Grid item xs={12} md={6}>
                      <TextField
                        fullWidth
                        label="Subject"
                        defaultValue="Welcome to Yesra Sew!"
                        size="small"
                      />
                    </Grid>
                    <Grid item xs={12}>
                      <TextField
                        fullWidth
                        multiline
                        rows={4}
                        label="Email Content"
                        defaultValue="Dear {{name}}, welcome to our platform..."
                      />
                    </Grid>
                    <Grid item xs={12}>
                      <Typography variant="caption" color="text.secondary">
                        Available variables: {'{{name}}'}, {'{{email}}'}, {'{{listing_title}}'}
                      </Typography>
                    </Grid>
                  </Grid>
                </AccordionDetails>
              </Accordion>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
};

export default TemplateManagement;
import React, { useEffect, useState } from 'react';
import { Box, Typography, CircularProgress } from '@mui/material';
import { motion, AnimatePresence } from 'framer-motion';
import logo from '../assets/logo.png';

const SplashScreen = ({ onFinish }) => {
    const [progress, setProgress] = useState(0);

    useEffect(() => {
        const timer = setInterval(() => {
            setProgress((prevProgress) => {
                if (prevProgress >= 100) {
                    clearInterval(timer);
                    setTimeout(() => onFinish(), 500);
                    return 100;
                }
                return prevProgress + 10;
            });
        }, 100);

        return () => clearInterval(timer);
    }, [onFinish]);

    return (
        <AnimatePresence>
            <motion.div
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                exit={{ opacity: 0 }}
                transition={{ duration: 0.5 }}
            >
                <Box
                    sx={{
                        position: 'fixed',
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        justifyContent: 'center',
                        background: 'linear-gradient(135deg, #D4AF37 0%, #F4E5C2 100%)',
                        zIndex: 9999
                    }}
                >
                    <motion.div
                        initial={{ scale: 0.5, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        transition={{
                            duration: 0.8,
                            ease: [0.6, -0.05, 0.01, 0.99]
                        }}
                    >
                        <Box
                            component="img"
                            src={logo}
                            alt="Yesra Sew Logo"
                            sx={{
                                width: { xs: 150, sm: 200 },
                                height: { xs: 150, sm: 200 },
                                mb: 4,
                                filter: 'drop-shadow(0 8px 16px rgba(0,0,0,0.2))'
                            }}
                        />
                    </motion.div>

                    <motion.div
                        initial={{ y: 20, opacity: 0 }}
                        animate={{ y: 0, opacity: 1 }}
                        transition={{ delay: 0.3, duration: 0.6 }}
                    >
                        <Typography
                            variant="h3"
                            sx={{
                                fontFamily: 'Playfair Display, serif',
                                fontWeight: 'bold',
                                color: 'white',
                                mb: 1,
                                textShadow: '0 2px 4px rgba(0,0,0,0.2)',
                                fontSize: { xs: '2rem', sm: '3rem' }
                            }}
                        >
                            Yesra Sew
                        </Typography>
                    </motion.div>

                    <motion.div
                        initial={{ y: 20, opacity: 0 }}
                        animate={{ y: 0, opacity: 1 }}
                        transition={{ delay: 0.5, duration: 0.6 }}
                    >
                        <Typography
                            variant="h6"
                            sx={{
                                color: 'rgba(255,255,255,0.9)',
                                mb: 4,
                                fontStyle: 'italic',
                                fontSize: { xs: '1rem', sm: '1.25rem' }
                            }}
                        >
                              - Your Marketplace
                        </Typography>
                    </motion.div>

                    <motion.div
                        initial={{ scale: 0.8, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        transition={{ delay: 0.7, duration: 0.5 }}
                    >
                        <Box sx={{ position: 'relative', display: 'inline-flex' }}>
                            <CircularProgress
                                variant="determinate"
                                value={progress}
                                size={60}
                                thickness={4}
                                sx={{
                                    color: 'white',
                                    '& .MuiCircularProgress-circle': {
                                        strokeLinecap: 'round'
                                    }
                                }}
                            />
                            <Box
                                sx={{
                                    top: 0,
                                    left: 0,
                                    bottom: 0,
                                    right: 0,
                                    position: 'absolute',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center'
                                }}
                            >
                                <Typography
                                    variant="caption"
                                    component="div"
                                    sx={{ color: 'white', fontWeight: 'bold' }}
                                >
                                    {`${Math.round(progress)}%`}
                                </Typography>
                            </Box>
                        </Box>
                    </motion.div>
                </Box>
            </motion.div>
        </AnimatePresence>
    );
};

export default SplashScreen;
// Real-time Notifications Component
import React, { useState, useEffect } from 'react';
import {
  Badge, IconButton, Popover, List, ListItem, ListItemText,
  Typography, Box, Button, Chip, Divider
} from '@mui/material';
import {
  Notifications, Favorite, Search, Chat, Star
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import apiService from '../services/api';
import toast from 'react-hot-toast';

const RealTimeNotifications = () => {
  const [notifications, setNotifications] = useState([]);
  const [unreadCount, setUnreadCount] = useState(0);
  const [anchorEl, setAnchorEl] = useState(null);

  useEffect(() => {
    fetchNotifications();
    // Poll for new notifications every 30 seconds
    const interval = setInterval(fetchNotifications, 30000);
    return () => clearInterval(interval);
  }, []);

  const fetchNotifications = async () => {
    try {
      const response = await apiService.getNotifications();
      setNotifications(response.data || []);
      setUnreadCount(response.data?.filter(n => !n.is_read).length || 0);
    } catch (error) {
    }
  };

  const markAsRead = async (notificationId) => {
    try {
      await apiService.markNotificationAsRead(notificationId);
      fetchNotifications();
    } catch (error) {
    }
  };

  const getNotificationIcon = (type) => {
    switch (type) {
      case 'listing': return <Favorite color="error" />;
      case 'chat': return <Chat color="primary" />;
      case 'search': return <Search color="action" />;
      case 'system': return <Star color="warning" />;
      default: return <Notifications />;
    }
  };

  const formatTime = (date) => {
    const now = new Date();
    const notificationTime = new Date(date);
    const diffInMinutes = Math.floor((now - notificationTime) / (1000 * 60));
    
    if (diffInMinutes < 1) return 'Just now';
    if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
    if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)}h ago`;
    return `${Math.floor(diffInMinutes / 1440)}d ago`;
  };

  return (
    <>
      <IconButton
        onClick={(e) => setAnchorEl(e.currentTarget)}
        sx={{ position: 'relative' }}
      >
        <Badge badgeContent={unreadCount} color="error" max={99}>
          <Notifications />
        </Badge>
      </IconButton>

      <Popover
        open={Boolean(anchorEl)}
        anchorEl={anchorEl}
        onClose={() => setAnchorEl(null)}
        anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}
        transformOrigin={{ vertical: 'top', horizontal: 'right' }}
        PaperProps={{
          sx: { width: 360, maxHeight: 500 }
        }}
      >
        <Box sx={{ p: 2, borderBottom: 1, borderColor: 'divider' }}>
          <Typography variant="h6">Notifications</Typography>
          {unreadCount > 0 && (
            <Chip
              label={`${unreadCount} new`}
              color="primary"
              size="small"
              sx={{ ml: 1 }}
            />
          )}
        </Box>

        <List sx={{ maxHeight: 400, overflow: 'auto' }}>
          {notifications.length === 0 ? (
            <ListItem>
              <ListItemText
                primary="No notifications"
                secondary="You're all caught up!"
              />
            </ListItem>
          ) : (
            notifications.map((notification, index) => (
              <motion.div
                key={notification.id}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: index * 0.1 }}
              >
                <ListItem
                  onClick={() => markAsRead(notification.id)}
                  sx={{
                    cursor: 'pointer',
                    bgcolor: notification.is_read ? 'transparent' : 'action.hover',
                    '&:hover': { bgcolor: 'action.selected' }
                  }}
                >
                  <Box sx={{ mr: 2 }}>
                    {getNotificationIcon(notification.type)}
                  </Box>
                  <ListItemText
                    primary={notification.title}
                    secondary={
                      <Box>
                        <Typography variant="body2" color="text.secondary">
                          {notification.message}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {formatTime(notification.created_at)}
                        </Typography>
                      </Box>
                    }
                  />
                </ListItem>
                {index < notifications.length - 1 && <Divider />}
              </motion.div>
            ))
          )}
        </List>

        {notifications.length > 0 && (
          <Box sx={{ p: 2, borderTop: 1, borderColor: 'divider' }}>
            <Button
              fullWidth
              variant="outlined"
              onClick={async () => {
                try {
                  await apiService.markAllNotificationsAsRead();
                  fetchNotifications();
                  toast.success('All notifications marked as read');
                } catch (error) {
                }
              }}
            >
              Mark All as Read
            </Button>
          </Box>
        )}
      </Popover>
    </>
  );
};

export default RealTimeNotifications;
// Quick Actions Toolbar Component
import React, { useState, useRef, useEffect } from 'react';
import {
  Box, Button, Typography, SpeedDial, SpeedDialIcon, SpeedDialAction,
  Fab, Tooltip, useTheme, useMediaQuery, IconButton, Collapse
} from '@mui/material';
import {
  Add, Camera, Phone, Message, Share, Favorite, LocationOn,
  Star, Search, Filter, Compare, Bookmark, Report, Help,
  ExpandMore, ExpandLess
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import { useNavigate } from 'react-router-dom';

const QuickActionsToolbar = ({ listing, user, onAction }) => {
  const [speedDialOpen, setSpeedDialOpen] = useState(false);
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [isDragging, setIsDragging] = useState(false);
  const [isDesktopExpanded, setIsDesktopExpanded] = useState(true);
  const dragRef = useRef(null);
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const navigate = useNavigate();

  const handleQuickAction = (action) => {
    switch (action) {
      case 'post':
        navigate('/post-ad');
        break;
      case 'scan':
        console.log('Camera feature coming soon!');
        break;
      case 'call':
        if (listing?.phone_number) {
          window.location.href = `tel:${listing.phone_number}`;
        } else {
          console.log('Phone number not available');
        }
        break;
      case 'chat':
        if (listing?.author_id) {
          navigate(`/chat/${listing.author_id}`);
        } else {
          console.log('Chat not available');
        }
        break;
      case 'share':
        if (navigator.share) {
          navigator.share({
            title: listing?.title || 'Check this out!',
            text: listing?.description || 'Found this on YesraSew',
            url: window.location.href
          });
        } else {
          navigator.clipboard.writeText(window.location.href);
          console.log('Link copied to clipboard!');
        }
        break;
      case 'favorite':
        // Toggle favorite logic
        if (onAction) {
          onAction('favorite', listing);
        }
        break;
      case 'location':
        if (listing?.location) {
          window.open(`https://maps.google.com/?q=${encodeURIComponent(listing.location)}`);
        } else {
          console.log('Location not available');
        }
        break;
      case 'review':
        navigate(`/listings/${listing?.id}/review`);
        break;
      case 'search':
        navigate('/search');
        break;
      case 'filter':
        // Open filter dialog
        if (onAction) {
          onAction('filter');
        }
        break;
      case 'compare':
        navigate('/compare');
        break;
      case 'bookmark':
        if (onAction) {
          onAction('bookmark', listing);
        }
        break;
      case 'report':
        if (listing?.id) {
          navigate(`/report/listing/${listing.id}`);
        } else {
          console.log('Report not available');
        }
        break;
      case 'help':
        navigate('/help');
        break;
      default:
        break;
    }
    setSpeedDialOpen(false);
  };

  const quickActions = [
    { icon: <Add />, name: 'Post Ad', action: 'post', color: 'primary' },
    { icon: <Camera />, name: 'Scan QR', action: 'scan', color: 'secondary' },
    { icon: <Phone />, name: 'Call Seller', action: 'call', color: 'success', listingOnly: true },
    { icon: <Message />, name: 'Chat', action: 'chat', color: 'info', listingOnly: true },
    { icon: <Share />, name: 'Share', action: 'share', color: 'default' },
    { icon: <Favorite />, name: 'Save', action: 'favorite', color: 'error', listingOnly: true },
    { icon: <LocationOn />, name: 'Location', action: 'location', color: 'warning', listingOnly: true },
    { icon: <Star />, name: 'Review', action: 'review', color: 'warning', listingOnly: true },
    { icon: <Search />, name: 'Search', action: 'search', color: 'primary' },
    { icon: <Filter />, name: 'Filter', action: 'filter', color: 'secondary' },
    { icon: <Compare />, name: 'Compare', action: 'compare', color: 'info' },
    { icon: <Bookmark />, name: 'Bookmark', action: 'bookmark', color: 'success' },
    { icon: <Report />, name: 'Report', action: 'report', color: 'error', listingOnly: true },
    { icon: <Help />, name: 'Help', action: 'help', color: 'default' }
  ];

  const filteredActions = listing 
    ? quickActions.filter(action => !action.listingOnly || action.listingOnly)
    : quickActions.filter(action => !action.listingOnly);

  // Draggable functionality
  const handleMouseDown = (e) => {
    if (isDragging) return;
    setIsDragging(true);
    e.preventDefault();
  };

  const handleMouseMove = (e) => {
    if (!isDragging) return;
    
    const newX = e.clientX - window.innerWidth + 60; // Position from right edge
    const newY = e.clientY - window.innerHeight + 100; // Position from bottom edge
    
    // Constrain to screen bounds
    const maxX = 0;
    const maxY = 0;
    const minX = -window.innerWidth + 100;
    const minY = -window.innerHeight + 200;
    
    setPosition({
      x: Math.max(minX, Math.min(maxX, newX)),
      y: Math.max(minY, Math.min(maxY, newY))
    });
  };

  const handleMouseUp = () => {
    setIsDragging(false);
  };

  useEffect(() => {
    if (isDragging) {
      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
      return () => {
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
      };
    }
  }, [isDragging]);

  // Mobile Floating Action Button
  if (isMobile) {
    return (
      <Box 
        ref={dragRef}
        sx={{ 
          position: 'fixed', 
          bottom: 100, 
          right: 20, 
          zIndex: 1000,
          cursor: isDragging ? 'grabbing' : 'grab',
          transform: `translate(${position.x}px, ${position.y}px)`,
          transition: isDragging ? 'none' : 'all 0.3s ease',
          '&:hover': {
            transform: `translate(${position.x}px, ${position.y}px) scale(1.02)`
          }
        }}
        onMouseDown={handleMouseDown}
      >
        <SpeedDial
          ariaLabel="Quick actions"
          icon={<SpeedDialIcon />}
          onClose={() => setSpeedDialOpen(false)}
          onOpen={() => setSpeedDialOpen(true)}
          open={speedDialOpen}
          direction="up"
        >
          {filteredActions.map((action) => (
            <SpeedDialAction
              key={action.name}
              icon={action.icon}
              tooltipTitle={action.name}
              onClick={() => handleQuickAction(action.action)}
              FabProps={{
                sx: {
                  bgcolor: `${action.color}.main`,
                  '&:hover': {
                    bgcolor: `${action.color}.dark`,
                  }
                }
              }}
            />
          ))}
        </SpeedDial>
      </Box>
    );
  }

  // Desktop Toolbar
  return (
    <Box sx={{ 
      position: isMobile ? 'fixed' : 'sticky',
      bottom: isMobile ? 60 : 'auto',
      top: isMobile ? 'auto' : 80,
      right: isMobile ? 20 : 'auto',
      left: isMobile ? 'auto' : 0,
      width: isMobile ? 'auto' : '100%',
      zIndex: 1000,
      p: 2,
      bgcolor: 'background.paper',
      borderRadius: isMobile ? 2 : 0,
      boxShadow: 3,
      display: 'flex',
      flexDirection: isMobile ? 'column' : 'column',
      gap: 1,
      justifyContent: isMobile ? 'center' : 'space-between'
    }}>
      {/* Desktop Header with Toggle */}
      {!isMobile && (
        <Box sx={{ 
          display: 'flex', 
          alignItems: 'center', 
          justifyContent: 'space-between',
          pb: 1,
          borderBottom: '1px solid',
          borderColor: 'divider'
        }}>
          <Typography variant="h6" sx={{ fontSize: '1rem', fontWeight: 600 }}>
            Quick Actions
          </Typography>
          <IconButton
            onClick={() => setIsDesktopExpanded(!isDesktopExpanded)}
            size="small"
            sx={{
              transition: 'transform 0.2s ease',
              transform: isDesktopExpanded ? 'rotate(180deg)' : 'rotate(0deg)'
            }}
          >
            <ExpandMore />
          </IconButton>
        </Box>
      )}

      {/* Collapsible Content */}
      <Collapse in={isDesktopExpanded || isMobile} timeout={300}>
        <Box sx={{ 
          display: 'flex', 
          flexDirection: isMobile ? 'column' : 'row',
          gap: 1,
          justifyContent: isMobile ? 'center' : 'space-between'
        }}>
          {/* Primary Actions */}
          <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>
            <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
              <Button
                variant="contained"
                startIcon={<Add />}
                onClick={() => handleQuickAction('post')}
                sx={{ borderRadius: 3 }}
              >
                Post Ad
              </Button>
            </motion.div>

            <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
              <Button
                variant="outlined"
                startIcon={<Search />}
                onClick={() => handleQuickAction('search')}
                sx={{ borderRadius: 3 }}
              >
                Search
              </Button>
            </motion.div>

            <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
              <Button
                variant="outlined"
                startIcon={<Filter />}
                onClick={() => handleQuickAction('filter')}
                sx={{ borderRadius: 3 }}
              >
                Filter
              </Button>
            </motion.div>
          </Box>

          {/* Secondary Actions */}
          <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>
            {listing && (
              <>
                <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
                  <Tooltip title="Call Seller">
                    <Button
                      variant="outlined"
                      startIcon={<Phone />}
                      onClick={() => handleQuickAction('call')}
                      sx={{ borderRadius: 3, minWidth: 'auto' }}
                    >
                      Call
                    </Button>
                  </Tooltip>
                </motion.div>

                <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
                  <Tooltip title="Chat with Seller">
                    <Button
                      variant="outlined"
                      startIcon={<Message />}
                      onClick={() => handleQuickAction('chat')}
                      sx={{ borderRadius: 3, minWidth: 'auto' }}
                    >
                      Chat
                    </Button>
                  </Tooltip>
                </motion.div>

                <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
                  <Tooltip title="Save Listing">
                    <Button
                      variant="outlined"
                      startIcon={<Favorite />}
                      onClick={() => handleQuickAction('favorite')}
                      sx={{ borderRadius: 3, minWidth: 'auto' }}
                    >
                      Save
                    </Button>
                  </Tooltip>
                </motion.div>

                <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
                  <Tooltip title="Share Listing">
                    <Button
                      variant="outlined"
                      startIcon={<Share />}
                      onClick={() => handleQuickAction('share')}
                      sx={{ borderRadius: 3, minWidth: 'auto' }}
                    >
                      Share
                    </Button>
                  </Tooltip>
                </motion.div>
              </>
            )}

            <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
              <Tooltip title="Compare Items">
                <Button
                  variant="outlined"
                  startIcon={<Compare />}
                  onClick={() => handleQuickAction('compare')}
                  sx={{ borderRadius: 3, minWidth: 'auto' }}
                >
                  Compare
                </Button>
              </Tooltip>
            </motion.div>

            <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
              <Tooltip title="Get Help">
                <Button
                  variant="outlined"
                  startIcon={<Help />}
                  onClick={() => handleQuickAction('help')}
                  sx={{ borderRadius: 3, minWidth: 'auto' }}
                >
                  Help
                </Button>
              </Tooltip>
            </motion.div>
          </Box>
        </Box>
      </Collapse>
    </Box>
  );
};

// Quick Action Button Component (for individual use)
export const QuickActionButton = ({ 
  action, 
  icon, 
  label, 
  color = 'primary',
  variant = 'contained',
  size = 'medium',
  onClick,
  ...props 
}) => {
  return (
    <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }}>
      <Button
        variant={variant}
        color={color}
        size={size}
        startIcon={icon}
        onClick={onClick}
        sx={{ borderRadius: 3, ...props.sx }}
        {...props}
      >
        {label}
      </Button>
    </motion.div>
  );
};

export default QuickActionsToolbar;
// Price Drop Alert Component
import React, { useState, useEffect } from 'react';
import {
  Card, CardContent, Typography, Chip, Button, Box, Alert,
  Dialog, DialogTitle, DialogContent, DialogActions, TextField
} from '@mui/material';
import {
  TrendingDown, Notifications, Search, Star
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import apiService from '../services/api';
import toast from 'react-hot-toast';

const PriceDropAlert = ({ listing, onSetAlert }) => {
  const [alertSet, setAlertSet] = useState(false);
  const [targetPrice, setTargetPrice] = useState('');
  const [dialogOpen, setDialogOpen] = useState(false);
  const [loading, setLoading] = useState(false);

  const currentPrice = parseFloat(listing.price);
  const priceDrop = listing.original_price ? 
    ((listing.original_price - currentPrice) / listing.original_price * 100).toFixed(1) : 0;

  useEffect(() => {
    checkExistingAlert();
  }, [listing.id]);

  const checkExistingAlert = async () => {
    try {
      // Check if user has existing price alert for this listing
      const response = await apiService.getPriceAlerts(listing.id);
      if (response.data && response.data.length > 0) {
        setAlertSet(true);
        setTargetPrice(response.data[0].target_price);
      }
    } catch (error) {
    }
  };

  const handleSetAlert = async () => {
    if (!targetPrice || parseFloat(targetPrice) >= currentPrice) {
      toast.error('Please enter a target price lower than current price');
      return;
    }

    setLoading(true);
    try {
      await apiService.setPriceAlert(listing.id, {
        target_price: parseFloat(targetPrice),
        notification_method: 'push'
      });
      setAlertSet(true);
      setDialogOpen(false);
      toast.success('Price drop alert set successfully!');
    } catch (error) {
      toast.error('Failed to set price alert');
    } finally {
      setLoading(false);
    }
  };

  const handleRemoveAlert = async () => {
    try {
      await apiService.removePriceAlert(listing.id);
      setAlertSet(false);
      setTargetPrice('');
      toast.success('Price alert removed');
    } catch (error) {
      toast.error('Failed to remove price alert');
    }
  };

  return (
    <>
      {priceDrop > 0 && (
        <motion.div
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ type: 'spring', stiffness: 200 }}
        >
          <Alert
            severity="success"
            icon={<TrendingDown />}
            sx={{ mb: 2 }}
            action={
              <Chip
                label={`-${priceDrop}%`}
                color="success"
                size="small"
                sx={{ fontWeight: 'bold' }}
              />
            }
          >
            <Typography variant="body2">
              Price dropped by {priceDrop}%! Save {listing.original_price - currentPrice} ETB
            </Typography>
          </Alert>
        </motion.div>
      )}

      <Card sx={{ mb: 2, bgcolor: 'background.paper' }}>
        <CardContent>
          <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
            <TrendingDown color="primary" sx={{ mr: 1 }} />
            <Typography variant="h6" sx={{ flexGrow: 1 }}>
              Price Drop Alert
            </Typography>
            {alertSet && (
              <Chip
                label="Active"
                color="success"
                size="small"
                icon={<Notifications />}
              />
            )}
          </Box>

          <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
            {alertSet 
              ? `We'll notify you when price drops below ${targetPrice} ETB`
              : `Get notified when this ${listing.category?.toLowerCase() || 'item'} drops below your target price`
            }
          </Typography>

          <Typography variant="h4" color="primary" sx={{ mb: 2 }}>
            {currentPrice.toLocaleString()} ETB
          </Typography>

          {!alertSet ? (
            <Button
              variant="contained"
              fullWidth
              startIcon={<Notifications />}
              onClick={() => setDialogOpen(true)}
              sx={{ mb: 1 }}
            >
              Set Price Alert
            </Button>
          ) : (
            <Box>
              <Button
                variant="outlined"
                fullWidth
                onClick={() => setDialogOpen(true)}
                sx={{ mb: 1 }}
              >
                Edit Alert
              </Button>
              <Button
                variant="text"
                fullWidth
                color="error"
                onClick={handleRemoveAlert}
              >
                Remove Alert
              </Button>
            </Box>
          )}

          <Box sx={{ mt: 2, p: 1, bgcolor: 'grey.50', borderRadius: 1 }}>
            <Typography variant="caption" color="text.secondary">
               Tip: Set a realistic target price. Most sellers negotiate 10-20% below asking price.
            </Typography>
          </Box>
        </CardContent>
      </Card>

      <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)} maxWidth="sm" fullWidth>
        <DialogTitle>
          Set Price Drop Alert
        </DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
            Current price: <strong>{currentPrice.toLocaleString()} ETB</strong>
          </Typography>

          <TextField
            fullWidth
            label="Target Price (ETB)"
            type="number"
            value={targetPrice}
            onChange={(e) => setTargetPrice(e.target.value)}
            placeholder="Enter your target price"
            helperText={`Must be less than ${currentPrice.toLocaleString()} ETB`}
            sx={{ mb: 2 }}
          />

          <Box sx={{ p: 2, bgcolor: 'grey.50', borderRadius: 1 }}>
            <Typography variant="body2" color="text.secondary">
               You'll receive a notification when the price drops to or below your target price.
            </Typography>
          </Box>
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setDialogOpen(false)}>Cancel</Button>
          <Button
            onClick={handleSetAlert}
            variant="contained"
            disabled={loading || !targetPrice || parseFloat(targetPrice) >= currentPrice}
          >
            {alertSet ? 'Update Alert' : 'Set Alert'}
          </Button>
        </DialogActions>
      </Dialog>
    </>
  );
};

export default PriceDropAlert;
import React, { useState } from 'react';
import {
  AppBar, Toolbar, Typography, IconButton, Menu, MenuItem, Box, 
  Button, Paper, useMediaQuery, useTheme, Avatar, Badge, Tooltip
} from '@mui/material';
import {
  Home, Work, Gavel, Apartment, DirectionsCar, 
  Add as AddIcon, Notifications, AccountCircle, 
  Language, DarkMode, LightMode
} from '@mui/icons-material';
import QuickActionsToolbar from './QuickActionsToolbar';
import { useNavigate, useLocation } from 'react-router-dom';
import { alpha } from '@mui/material/styles';
import { useAuth } from '../context/AuthContext';
import logo from '../assets/logo.png';

const Navbar = ({ activeTab, setActiveTab, themeMode, setThemeMode }) => {
  const theme = useTheme();
  const [anchorEl, setAnchorEl] = useState(null);
  const navigate = useNavigate();
  const location = useLocation();
  const isMobile = useMediaQuery(theme.breakpoints.down('md'));
  const { isAuthenticated, user, logout } = useAuth();

  const handleProfileMenuOpen = (event) => setAnchorEl(event.currentTarget);
  const handleMenuClose = () => setAnchorEl(null);

  const handleNav = (path, index) => {
    setActiveTab(index);
    navigate(path);
  };

  const handleLogout = () => {
    logout();
    handleMenuClose();
    navigate('/');
  };

  const getValue = () => {
    const path = location.pathname;
    if (path === '/') return 0;
    if (path === '/tenders') return 1;
    if (path === '/jobs') return 2;
    if (path === '/homes') return 3;
    if (path === '/cars') return 4;
    return 0;
  };

  const renderMenu = (
    <Menu
      anchorEl={anchorEl}
      open={Boolean(anchorEl)}
      onClose={handleMenuClose}
      transformOrigin={{ vertical: 'top', horizontal: 'right' }}
      PaperProps={{
        elevation: 4,
        sx: { borderRadius: 3, mt: 1.5, minWidth: 180 }
      }}
    >
      {isAuthenticated ? (
        <>
          <MenuItem onClick={() => { handleMenuClose(); navigate('/dashboard'); }}>
            <AccountCircle sx={{ mr: 1, fontSize: 20 }} /> Dashboard
          </MenuItem>
          <MenuItem onClick={() => { handleMenuClose(); navigate('/profile'); }}>
            <AccountCircle sx={{ mr: 1, fontSize: 20 }} /> Profile
          </MenuItem>
          <MenuItem onClick={handleLogout}>
            <AccountCircle sx={{ mr: 1, fontSize: 20 }} /> Logout
          </MenuItem>
        </>
      ) : (
        <>
          <MenuItem onClick={() => { handleMenuClose(); navigate('/login'); }}>
            <AccountCircle sx={{ mr: 1, fontSize: 20 }} /> Login
          </MenuItem>
          <MenuItem onClick={() => { handleMenuClose(); navigate('/register'); }}>
            <AddIcon sx={{ mr: 1, fontSize: 20 }} /> Register
          </MenuItem>
        </>
      )}
    </Menu>
  );

  const NavItem = ({ label, icon, index, path }) => {
    const isActive = activeTab === index;
    return (
      <Box
        onClick={() => handleNav(path, index)}
        sx={{
          display: 'flex',
          flexDirection: 'column',
          alignItems: 'center',
          justifyContent: 'center',
          flex: 1,
          cursor: 'pointer',
          color: isActive ? 'primary.main' : 'text.secondary',
          transition: 'all 0.2s',
          '&:active': { transform: 'scale(0.95)' }
        }}
      >
        {React.cloneElement(icon, { color: isActive ? 'primary' : 'inherit', sx: { fontSize: 24 } })}
        <Typography variant="caption" sx={{ fontSize: '0.65rem', mt: 0.5, fontWeight: isActive ? 600 : 400 }}>
          {label}
        </Typography>
      </Box>
    );
  };

  if (!isMobile) {
    return (
      <>
        <AppBar
          position="sticky"
          color="inherit"
          elevation={0}
          sx={{
            backdropFilter: 'blur(20px)',
            backgroundColor: alpha(theme.palette.background.paper, 0.8),
            borderBottom: `1px solid ${alpha(theme.palette.divider, 0.1)}`,
          }}
        >
          <Toolbar sx={{ minHeight: 80, px: { md: 4 } }}>
            <Box onClick={() => navigate('/')} sx={{ cursor: 'pointer', display: 'flex', alignItems: 'center', mr: 4 }}>
              <Box
                component="img"
                src={logo}
                sx={{ width: 40, height: 40, mr: 1.5, objectFit: 'contain' }}
                alt="Logo"
              />
              <Box>
                <Typography variant="h5" color="primary" sx={{ fontWeight: 800, lineHeight: 1, letterSpacing: '-0.5px' }}>
                  YesiraSew
                </Typography>
                <Typography variant="caption" sx={{ color: 'text.secondary', fontWeight: 500, letterSpacing: '1px' }}>
                  QUALITY GOLD
                </Typography>
              </Box>
            </Box>

            <Box sx={{ flexGrow: 1, display: 'flex', justifyContent: 'center', gap: 1 }}>
              {['Home', 'Tenders', 'Jobs', 'Homes', 'Cars'].map((label, idx) => {
                const isActive = activeTab === idx;
                return (
                  <Button
                    key={label}
                    onClick={() => handleNav(idx === 0 ? '/' : `/${label.toLowerCase()}`, idx)}
                    sx={{
                      color: isActive ? 'primary.main' : 'text.secondary',
                      fontWeight: isActive ? 700 : 500,
                      px: 2.5,
                      py: 1,
                      borderRadius: 3,
                      backgroundColor: isActive ? alpha(theme.palette.primary.main, 0.08) : 'transparent',
                      '&:hover': {
                        backgroundColor: isActive ? alpha(theme.palette.primary.main, 0.12) : alpha(theme.palette.text.primary, 0.04),
                      }
                    }}
                  >
                    {label}
                  </Button>
                );
              })}
            </Box>

            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1.5 }}>
              <Button
                variant="contained"
                startIcon={<AddIcon />}
                sx={{
                  borderRadius: 3,
                  px: 3,
                  py: 1.2,
                  boxShadow: `0 8px 20px ${alpha(theme.palette.primary.main, 0.3)}`,
                  fontWeight: 600
                }}
              >
                Post Ad
              </Button>

              <Box sx={{ borderLeft: `1px solid ${theme.palette.divider}`, height: 32, mx: 1 }} />

              <Tooltip title="Toggle Theme">
                <IconButton onClick={() => setThemeMode(themeMode === 'light' ? 'dark' : 'light')} sx={{ border: `1px solid ${theme.palette.divider}` }}>
                  {themeMode === 'light' ? <DarkMode fontSize="small" /> : <LightMode fontSize="small" />}
                </IconButton>
              </Tooltip>

              <IconButton onClick={() => navigate('/notifications')} sx={{ border: `1px solid ${theme.palette.divider}` }}>
                <Notifications fontSize="small" />
              </IconButton>

              <IconButton onClick={handleProfileMenuOpen} sx={{ p: 0.5, border: `2px solid ${alpha(theme.palette.primary.main, 0.2)}` }}>
                <AccountCircle fontSize="large" color="primary" />
              </IconButton>
            </Box>
          </Toolbar>
        </AppBar>
        {renderMenu}
      </>
    );
  }

  return (
    <>
      <AppBar
        position="fixed"
        elevation={0}
        sx={{
          bgcolor: 'transparent',
          backdropFilter: 'blur(10px)',
          background: `linear-gradient(to bottom, ${alpha(theme.palette.background.default, 0.9)}, ${alpha(theme.palette.background.default, 0.0)})`,
          color: 'text.primary',
          border: 'none',
          pointerEvents: 'none'
        }}
      >
        <Toolbar sx={{ justifyContent: 'space-between', pointerEvents: 'auto', px: 1 }}>
          <Box sx={{ display: 'flex', alignItems: 'center' }}>
            <Box
              component="img"
              src={logo}
              sx={{ width: 32, height: 32, mr: 0.5, objectFit: 'contain' }}
              alt="Logo"
            />
            <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-start' }}>
              <Typography variant="h6" sx={{ fontWeight: 800, color: 'primary.main', fontSize: '1.1rem', lineHeight: 1 }}>YesiraSew</Typography>
              <Typography variant="caption" sx={{ color: 'text.secondary', fontWeight: 500, fontSize: '0.6rem', letterSpacing: '0.5px', fontStyle: 'italic', mt: -0.5 }}>Purified Gold</Typography>
            </Box>
          </Box>

          <Box sx={{ display: 'flex', alignItems: 'center', gap: 0.5 }}>
            <IconButton size="small" color="inherit">
              <Language fontSize="small" />
            </IconButton>
            <IconButton size="small" color="inherit">
              <Badge badgeContent={3} color="error">
                <Notifications fontSize="small" />
              </Badge>
            </IconButton>
            <IconButton size="small" onClick={handleProfileMenuOpen} color="inherit">
              <AccountCircle fontSize="small" />
            </IconButton>
            <IconButton size="small" onClick={() => setThemeMode(themeMode === 'light' ? 'dark' : 'light')} color="inherit">
              {themeMode === 'light' ? <DarkMode fontSize="small" /> : <LightMode fontSize="small" />}
            </IconButton>
          </Box>
        </Toolbar>
      </AppBar>

      <Box sx={{ position: 'fixed', bottom: 0, left: 0, right: 0, zIndex: 1000 }}>
        {/* Fixed Post Ad Button */}
        <Box sx={{ position: 'absolute', bottom: 30, left: '50%', transform: 'translateX(-50%)', zIndex: 10 }}>
          <Button
            variant="contained"
            onClick={() => navigate('/listings/new')}
            sx={{
              borderRadius: '50%',
              width: 64,
              height: 64,
              minWidth: 64,
              boxShadow: `0 8px 24px ${alpha(theme.palette.primary.main, 0.5)}`,
              border: `4px solid ${theme.palette.background.paper}`,
              '&:hover': { transform: 'scale(1.05)' },
            }}
          >
            <AddIcon fontSize="large" />
          </Button>
        </Box>

        {/* QuickActionsToolbar at bottom right */}
        <QuickActionsToolbar listing={null} user={user} />

        {/* Static Bottom Navigation Toolbar */}
        <Paper
          elevation={24}
          sx={{
            borderRadius: '20px 20px 0 0',
            overflow: 'hidden',
            bgcolor: alpha(theme.palette.background.paper, 0.95),
            backdropFilter: 'blur(20px)',
            borderTop: `1px solid ${alpha(theme.palette.divider, 0.1)}`,
            height: 70,
            display: 'flex',
            alignItems: 'center',
            position: 'relative'
          }}
        >
          <Box sx={{ display: 'flex', width: '40%', justifyContent: 'space-around', pl: 2 }}>
            <NavItem label="Home" icon={<Home />} index={0} path="/" />
            <NavItem label="Tenders" icon={<Gavel />} index={1} path="/tenders" />
          </Box>

          {/* Center space for Post Ad button */}
          <Box sx={{ width: '20%', display: 'flex', justifyContent: 'center' }} />

          <Box sx={{ display: 'flex', width: '40%', justifyContent: 'space-around', pr: 2 }}>
            <NavItem label="Jobs" icon={<Work />} index={2} path="/jobs" />
            <NavItem label="Homes" icon={<Apartment />} index={3} path="/homes" />
            <NavItem label="Cars" icon={<DirectionsCar />} index={4} path="/cars" />
          </Box>
        </Paper>
      </Box>
      {renderMenu}
    </>
  );
};

export default Navbar;
import React, { useState } from 'react';
import {
  Box, Typography, Button, Card, CardContent, Chip,
  TextField, Grid, Stack, Divider,
  List, ListItem, ListItemText, ListItemIcon, Avatar, Select, MenuItem,
  FormControlLabel, Switch, Accordion, AccordionSummary, AccordionDetails,
  Table, TableBody, TableCell, TableContainer, TableHead, TableRow, IconButton, LinearProgress, Tabs, Tab
} from '@mui/material';
import {
  Star, Check, Search, TrendingUp, Cancel,
  CardMembership, AttachMoney,
  CheckCircle, AccessTime, Edit, Add,
  Refresh, Download, Visibility, Block,
  ExpandMore, Business, Person, Category
} from '@mui/icons-material';

const MembershipSubscription = () => {
  const [activeTab, setActiveTab] = useState(0);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [filterPlan, setFilterPlan] = useState('all');

  // Membership Plans
  const [membershipPlans] = useState([
    {
      id: 1,
      name: 'Basic',
      type: 'individual',
      price: 0,
      duration: 'lifetime',
      features: ['5 Listings', 'Basic Profile', 'Email Support'],
      listingsLimit: 5,
      featuredListings: 0,
      prioritySupport: false,
      verification: false,
      color: '#6c757d',
      icon: <Person />,
      active: true,
      usersCount: 1250
    },
    {
      id: 2,
      name: 'Premium',
      type: 'individual',
      price: 299,
      duration: 'monthly',
      features: ['25 Listings', 'Enhanced Profile', 'Priority Support', 'Verification Badge', '3 Featured Listings'],
      listingsLimit: 25,
      featuredListings: 3,
      prioritySupport: true,
      verification: true,
      color: '#28a745',
      icon: <Star />,
      active: true,
      usersCount: 450
    },
    {
      id: 3,
      name: 'Business',
      type: 'business',
      price: 999,
      duration: 'monthly',
      features: ['Unlimited Listings', 'Business Profile', 'Dedicated Support', 'Verification Badge', '10 Featured Listings', 'Analytics Dashboard'],
      listingsLimit: -1,
      featuredListings: 10,
      prioritySupport: true,
      verification: true,
      analytics: true,
      color: '#007bff',
      icon: <Business />,
      active: true,
      usersCount: 180
    },
    {
      id: 4,
      name: 'Enterprise',
      type: 'business',
      price: 2999,
      duration: 'monthly',
      features: ['Unlimited Everything', 'Custom Branding', '24/7 Phone Support', 'Priority Verification', 'Unlimited Featured', 'Advanced Analytics', 'API Access'],
      listingsLimit: -1,
      featuredListings: -1,
      prioritySupport: true,
      verification: true,
      analytics: true,
      apiAccess: true,
      customBranding: true,
      color: '#6f42c1',
      icon: <Category />,
      active: true,
      usersCount: 25
    }
  ]);

  // Active Subscriptions
  const [subscriptions, setSubscriptions] = useState([
    {
      id: 1,
      user: 'John Doe',
      email: 'john@email.com',
      plan: 'Premium',
      type: 'individual',
      status: 'active',
      startDate: '2024-01-01',
      endDate: '2024-02-01',
      autoRenew: true,
      paymentMethod: 'Telebirr',
      amount: 299,
      listingsUsed: 8,
      listingsLimit: 25,
      featuredUsed: 1,
      featuredLimit: 3
    },
    {
      id: 2,
      user: 'Jane Smith',
      email: 'jane@company.com',
      plan: 'Business',
      type: 'business',
      status: 'active',
      startDate: '2024-01-05',
      endDate: '2024-02-05',
      autoRenew: true,
      paymentMethod: 'Chappa',
      amount: 999,
      listingsUsed: 45,
      listingsLimit: -1,
      featuredUsed: 7,
      featuredLimit: 10
    },
    {
      id: 3,
      user: 'Tech Corp',
      email: 'hr@techcorp.com',
      plan: 'Enterprise',
      type: 'business',
      status: 'active',
      startDate: '2024-01-10',
      endDate: '2024-02-10',
      autoRenew: true,
      paymentMethod: 'Bank Transfer',
      amount: 2999,
      listingsUsed: 120,
      listingsLimit: -1,
      featuredUsed: 25,
      featuredLimit: -1
    },
    {
      id: 4,
      user: 'Mike Wilson',
      email: 'mike@email.com',
      plan: 'Basic',
      type: 'individual',
      status: 'expired',
      startDate: '2023-12-01',
      endDate: '2024-01-01',
      autoRenew: false,
      paymentMethod: 'Free',
      amount: 0,
      listingsUsed: 3,
      listingsLimit: 5,
      featuredUsed: 0,
      featuredLimit: 0
    }
  ]);

  // Subscription Analytics
  const [analytics] = useState({
    totalSubscriptions: 1880,
    activeSubscriptions: 1655,
    monthlyRevenue: 429700,
    yearlyRevenue: 5156400,
    churnRate: 2.3,
    conversionRate: 12.5,
    avgSubscriptionValue: 259.50
  });

  const getStatusColor = (status) => {
    const colors = {
      active: 'success',
      expired: 'error',
      cancelled: 'warning',
      pending: 'info'
    };
    return colors[status] || 'default';
  };

  const getStatusIcon = (status) => {
    const icons = {
      active: <CheckCircle />,
      expired: <Cancel />,
      cancelled: <Block />,
      pending: <AccessTime /> // Fixed: Using AccessTime instead of Clock
    };
    return icons[status] || <AccessTime />;
  };

  const filteredSubscriptions = subscriptions.filter(sub => {
    const matchesSearch = sub.user.toLowerCase().includes(searchTerm.toLowerCase()) ||
      sub.email.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesStatus = filterStatus === 'all' || sub.status === filterStatus;
    const matchesPlan = filterPlan === 'all' || sub.plan === filterPlan;
    return matchesSearch && matchesStatus && matchesPlan;
  });

  const renderMembershipPlans = () => (
    <Box>
      <Typography variant="h6" gutterBottom>Membership Plans</Typography>

      <Grid container spacing={3} sx={{ mb: 4 }}>
        {membershipPlans.map(plan => (
          <Grid item xs={12} md={6} lg={3} key={plan.id}>
            <Card sx={{
              height: '100%',
              display: 'flex',
              flexDirection: 'column',
              position: 'relative',
              border: plan.name === 'Premium' ? '2px solid #28a745' : '1px solid #e0e0e0',
              '&:hover': { transform: 'translateY(-5px)', boxShadow: 3 }
            }}>
              {plan.name === 'Premium' && (
                <Chip
                  label="POPULAR"
                  color="success"
                  size="small"
                  sx={{ position: 'absolute', top: -10, right: 20 }}
                />
              )}
              <CardContent sx={{ flexGrow: 1, textAlign: 'center' }}>
                <Avatar sx={{ bgcolor: plan.color, mx: 'auto', mb: 2, width: 56, height: 56 }}>
                  {plan.icon}
                </Avatar>
                <Typography variant="h5" fontWeight="bold" gutterBottom>
                  {plan.name}
                </Typography>
                <Typography variant="h4" color="primary.main" gutterBottom>
                  {plan.price === 0 ? 'Free' : `ETB ${plan.price}`}
                  <Typography variant="caption" display="block">
                    /{plan.duration}
                  </Typography>
                </Typography>
                <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
                  {plan.usersCount} users
                </Typography>
                <List dense>
                  {plan.features.map((feature, index) => (
                    <ListItem key={index} sx={{ px: 0 }}>
                      <ListItemIcon sx={{ minWidth: 24 }}>
                        <CheckCircle sx={{ fontSize: 16, color: 'success.main' }} />
                      </ListItemIcon>
                      <ListItemText primary={feature} />
                    </ListItem>
                  ))}
                </List>
              </CardContent>
              <Box sx={{ p: 2, mt: 'auto' }}>
                <Stack spacing={1}>
                  <Button variant="outlined" size="small" startIcon={<Edit />}>
                    Edit Plan
                  </Button>
                  <FormControlLabel
                    control={<Switch defaultChecked={plan.active} />}
                    label="Active"
                  />
                </Stack>
              </Box>
            </Card>
          </Grid>
        ))}
      </Grid>

      <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 2 }}>
        <Typography variant="h6">Plan Management</Typography>
        <Button variant="contained" startIcon={<Add />}>Add New Plan</Button>
      </Box>

      <Card>
        <CardContent>
          <Accordion>
            <AccordionSummary expandIcon={<ExpandMore />}>
              <Typography>Create Custom Plan</Typography>
            </AccordionSummary>
            <AccordionDetails>
              <Grid container spacing={2}>
                <Grid item xs={12} md={3}>
                  <TextField fullWidth label="Plan Name" placeholder="e.g., Silver" />
                </Grid>
                <Grid item xs={12} md={3}>
                  <Select fullWidth defaultValue="individual">
                    <MenuItem value="individual">Individual</MenuItem>
                    <MenuItem value="business">Business</MenuItem>
                  </Select>
                </Grid>
                <Grid item xs={12} md={3}>
                  <TextField fullWidth label="Price (ETB)" type="number" />
                </Grid>
                <Grid item xs={12} md={3}>
                  <Select fullWidth defaultValue="monthly">
                    <MenuItem value="monthly">Monthly</MenuItem>
                    <MenuItem value="yearly">Yearly</MenuItem>
                    <MenuItem value="lifetime">Lifetime</MenuItem>
                  </Select>
                </Grid>
                <Grid item xs={12}>
                  <TextField fullWidth multiline rows={3} label="Features (one per line)" />
                </Grid>
                <Grid item xs={12}>
                  <Button variant="contained" startIcon={<Add />}>Create Plan</Button>
                </Grid>
              </Grid>
            </AccordionDetails>
          </Accordion>
        </CardContent>
      </Card>
    </Box>
  );

  const renderActiveSubscriptions = () => (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 3 }}>
        <Typography variant="h6">Active Subscriptions</Typography>
        <Button variant="contained" startIcon={<Refresh />}>Refresh</Button>
      </Box>

      {/* Search and Filter */}
      <Grid container spacing={2} sx={{ mb: 3 }}>
        <Grid item xs={12} md={4}>
          <TextField
            fullWidth
            placeholder="Search subscriptions..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            InputProps={{ startAdornment: <Search /> }}
          />
        </Grid>
        <Grid item xs={12} md={3}>
          <Select fullWidth value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}>
            <MenuItem value="all">All Status</MenuItem>
            <MenuItem value="active">Active</MenuItem>
            <MenuItem value="expired">Expired</MenuItem>
            <MenuItem value="cancelled">Cancelled</MenuItem>
          </Select>
        </Grid>
        <Grid item xs={12} md={3}>
          <Select fullWidth value={filterPlan} onChange={(e) => setFilterPlan(e.target.value)}>
            <MenuItem value="all">All Plans</MenuItem>
            <MenuItem value="Basic">Basic</MenuItem>
            <MenuItem value="Premium">Premium</MenuItem>
            <MenuItem value="Business">Business</MenuItem>
            <MenuItem value="Enterprise">Enterprise</MenuItem>
          </Select>
        </Grid>
        <Grid item xs={12} md={2}>
          <Button variant="outlined" startIcon={<Download />} fullWidth>
            Export
          </Button>
        </Grid>
      </Grid>

      {/* Subscriptions Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>User</TableCell>
                  <TableCell>Plan</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Duration</TableCell>
                  <TableCell>Usage</TableCell>
                  <TableCell>Payment</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredSubscriptions.map(sub => (
                  <TableRow key={sub.id}>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center' }}>
                        <Avatar sx={{ mr: 2, bgcolor: 'primary.main' }}>
                          {sub.type === 'business' ? <Business /> : <Person />}
                        </Avatar>
                        <Box>
                          <Typography variant="body2" fontWeight="medium">
                            {sub.user}
                          </Typography>
                          <Typography variant="caption" color="text.secondary">
                            {sub.email}
                          </Typography>
                        </Box>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {sub.plan}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {sub.type}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        size="small"
                        label={sub.status}
                        color={getStatusColor(sub.status)}
                        icon={getStatusIcon(sub.status)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          {sub.startDate} to {sub.endDate}
                        </Typography>
                        <Box sx={{ display: 'flex', alignItems: 'center', mt: 0.5 }}>
                          <Switch size="small" checked={sub.autoRenew} />
                          <Typography variant="caption" sx={{ ml: 1 }}>
                            Auto-renew
                          </Typography>
                        </Box>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          Listings: {sub.listingsUsed}
                          {sub.listingsLimit === -1 ? ' ()' : `/${sub.listingsLimit}`}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          Featured: {sub.featuredUsed}
                          {sub.featuredLimit === -1 ? ' ()' : `/${sub.featuredLimit}`}
                        </Typography>
                        <LinearProgress
                          variant="determinate"
                          value={sub.listingsLimit === -1 ? 50 : (sub.listingsUsed / sub.listingsLimit) * 100}
                          sx={{ mt: 1, height: 4 }}
                        />
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          ETB {sub.amount}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {sub.paymentMethod}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <IconButton size="small" title="View Details">
                        <Visibility />
                      </IconButton>
                      <IconButton size="small" title="Edit Subscription">
                        <Edit />
                      </IconButton>
                      <IconButton size="small" title="Cancel" color="error">
                        <Block />
                      </IconButton>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>
    </Box>
  );

  const renderAnalytics = () => (
    <Box>
      <Typography variant="h6" gutterBottom>Subscription Analytics</Typography>

      {/* Analytics Cards */}
      <Grid container spacing={3} sx={{ mb: 4 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card sx={{ textAlign: 'center', py: 2 }}>
            <CardMembership sx={{ fontSize: 32, color: 'primary.main', mb: 1 }} />
            <Typography variant="h5">{analytics.totalSubscriptions.toLocaleString()}</Typography>
            <Typography variant="caption" color="text.secondary">Total Subscriptions</Typography>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card sx={{ textAlign: 'center', py: 2 }}>
            <CheckCircle sx={{ fontSize: 32, color: 'success.main', mb: 1 }} />
            <Typography variant="h5">{analytics.activeSubscriptions.toLocaleString()}</Typography>
            <Typography variant="caption" color="text.secondary">Active Subscriptions</Typography>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card sx={{ textAlign: 'center', py: 2 }}>
            <AttachMoney sx={{ fontSize: 32, color: 'info.main', mb: 1 }} />
            <Typography variant="h5">ETB {analytics.monthlyRevenue.toLocaleString()}</Typography>
            <Typography variant="caption" color="text.secondary">Monthly Revenue</Typography>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card sx={{ textAlign: 'center', py: 2 }}>
            <TrendingUp sx={{ fontSize: 32, color: 'warning.main', mb: 1 }} />
            <Typography variant="h5">{analytics.conversionRate}%</Typography>
            <Typography variant="caption" color="text.secondary">Conversion Rate</Typography>
          </Card>
        </Grid>
      </Grid>

      {/* Revenue Chart Placeholder */}
      <Grid container spacing={3}>
        <Grid item xs={12} md={8}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>Revenue Overview</Typography>
              <Box sx={{ height: 300, display: 'flex', alignItems: 'center', justifyContent: 'center', bgcolor: 'grey.100', borderRadius: 1 }}>
                <Typography color="text.secondary">Revenue Chart Component</Typography>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>Plan Distribution</Typography>
              {membershipPlans.map(plan => (
                <Box key={plan.id} sx={{ mb: 2 }}>
                  <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 0.5 }}>
                    <Typography variant="body2">{plan.name}</Typography>
                    <Typography variant="body2">{plan.usersCount}</Typography>
                  </Box>
                  <LinearProgress
                    variant="determinate"
                    value={(plan.usersCount / analytics.totalSubscriptions) * 100}
                    sx={{ height: 6 }}
                  />
                </Box>
              ))}
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );

  return (
    <Box>
      <Typography variant="h6" gutterBottom>Membership & Subscriptions</Typography>

      <Tabs value={activeTab} onChange={(e, v) => setActiveTab(v)} sx={{ mb: 3 }}>
        <Tab icon={<CardMembership />} label="Plans" />
        <Tab icon={<CardMembership />} label="Subscriptions" />
        <Tab icon={<TrendingUp />} label="Analytics" />
      </Tabs>

      {activeTab === 0 && renderMembershipPlans()}
      {activeTab === 1 && renderActiveSubscriptions()}
      {activeTab === 2 && renderAnalytics()}
    </Box>
  );
};

export default MembershipSubscription;
// Live Activity Indicators Component
import React, { useState, useEffect } from 'react';
import {
  Box, Typography, Chip, Avatar, Tooltip, Badge
} from '@mui/material';
import {
  Visibility, People, TrendingUp, AccessTime, LocationOn
} from '@mui/icons-material';
import { motion } from 'framer-motion';

const LiveActivityIndicators = ({ listing }) => {
  const [viewers, setViewers] = useState(0);
  const [recentViews, setRecentViews] = useState(0);
  const [trending, setTrending] = useState(false);

  useEffect(() => {
    // Simulate real-time data (in production, this would come from WebSocket or API)
    const simulateLiveActivity = () => {
      setViewers(Math.floor(Math.random() * 10) + 1);
      setRecentViews(Math.floor(Math.random() * 50) + 10);
      setTrending(Math.random() > 0.7);
    };

    simulateLiveActivity();
    const interval = setInterval(simulateLiveActivity, 30000); // Update every 30 seconds

    return () => clearInterval(interval);
  }, [listing.id]);

  const getActivityLevel = () => {
    if (viewers > 7) return { level: 'High', color: 'success' };
    if (viewers > 3) return { level: 'Medium', color: 'warning' };
    return { level: 'Low', color: 'default' };
  };

  const activityLevel = getActivityLevel();

  return (
    <Box sx={{ mb: 2 }}>
      <Typography variant="subtitle2" sx={{ mb: 1, display: 'flex', alignItems: 'center' }}>
        <Visibility sx={{ mr: 1, fontSize: 20 }} />
        Live Activity
      </Typography>

      <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, alignItems: 'center' }}>
        {/* Current Viewers */}
        <motion.div
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ type: 'spring', stiffness: 200 }}
        >
          <Tooltip title="People viewing this right now">
            <Chip
              icon={<People />}
              label={`${viewers} viewing`}
              color={activityLevel.color}
              variant="outlined"
              size="small"
              sx={{ fontSize: '0.75rem' }}
            />
          </Tooltip>
        </motion.div>

        {/* Recent Activity */}
        <motion.div
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ type: 'spring', stiffness: 200, delay: 0.1 }}
        >
          <Tooltip title="Views in the last hour">
            <Chip
              icon={<TrendingUp />}
              label={`${recentViews} recent views`}
              color="info"
              variant="outlined"
              size="small"
              sx={{ fontSize: '0.75rem' }}
            />
          </Tooltip>
        </motion.div>

        {/* Trending Badge */}
        {trending && (
          <motion.div
            initial={{ scale: 0, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            transition={{ type: 'spring', stiffness: 200, delay: 0.2 }}
          >
            <Tooltip title="This listing is trending!">
              <Chip
                label=" Trending"
                color="error"
                variant="filled"
                size="small"
                sx={{ fontSize: '0.75rem', fontWeight: 'bold' }}
              />
            </Tooltip>
          </motion.div>
        )}

        {/* Activity Level */}
        <motion.div
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ type: 'spring', stiffness: 200, delay: 0.3 }}
        >
          <Tooltip title={`Activity level: ${activityLevel.level}`}>
            <Chip
              label={`${activityLevel.level} activity`}
              color={activityLevel.color}
              variant="outlined"
              size="small"
              sx={{ fontSize: '0.75rem' }}
            />
          </Tooltip>
        </motion.div>
      </Box>

      {/* Activity Message */}
      {viewers > 5 && (
        <motion.div
          initial={{ opacity: 0, y: -10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.4 }}
        >
          <Typography variant="caption" color="text.secondary" sx={{ mt: 1, display: 'block' }}>
             {viewers} people are viewing this right now - act fast!
          </Typography>
        </motion.div>
      )}

      {/* Location Indicator */}
      {listing.location && (
        <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
          <LocationOn sx={{ fontSize: 14, mr: 0.5, color: 'text.secondary' }} />
          <Typography variant="caption" color="text.secondary">
            Popular in {listing.location}
          </Typography>
        </Box>
      )}
    </Box>
  );
};

// Live User Avatars Component
export const LiveUserAvatars = ({ count = 3 }) => {
  const [users, setUsers] = useState([]);

  useEffect(() => {
    // Generate random user avatars
    const generateUsers = () => {
      const names = ['Abebe', 'Tigist', 'Dawit', 'Sara', 'Mekonnen', 'Hanna'];
      const initials = names.map(name => name.charAt(0));
      
      return Array.from({ length: count }, (_, i) => ({
        id: i,
        name: names[i % names.length],
        initial: initials[i % initials.length],
        color: ['primary', 'secondary', 'success', 'warning', 'error', 'info'][i % 6]
      }));
    };

    setUsers(generateUsers());
  }, [count]);

  return (
    <Box sx={{ display: 'flex', alignItems: 'center' }}>
      {users.map((user, index) => (
        <motion.div
          key={user.id}
          initial={{ scale: 0, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ delay: index * 0.1 }}
          style={{ marginLeft: index > 0 ? -8 : 0 }}
        >
          <Tooltip title={user.name}>
            <Avatar
              sx={{
                width: 32,
                height: 32,
                fontSize: '0.75rem',
                bgcolor: `${user.color}.main`,
                border: '2px solid white'
              }}
            >
              {user.initial}
            </Avatar>
          </Tooltip>
        </motion.div>
      ))}
      
      {count > 3 && (
        <motion.div
          initial={{ scale: 0, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ delay: 0.3 }}
        >
          <Tooltip title={`${count - 3} more viewers`}>
            <Avatar
              sx={{
                width: 32,
                height: 32,
                fontSize: '0.75rem',
                bgcolor: 'grey.300',
                color: 'text.primary',
                border: '2px solid white',
                marginLeft: -8
              }}
            >
              +{count - 3}
            </Avatar>
          </Tooltip>
        </motion.div>
      )}
    </Box>
  );
};

// Real-time Price Updates Component
export const RealTimePriceUpdates = ({ listing }) => {
  const [priceHistory, setPriceHistory] = useState([]);
  const [lastUpdate, setLastUpdate] = useState(null);

  useEffect(() => {
    // Simulate price history (in production, this would come from API)
    const mockPriceHistory = [
      { price: listing.price, timestamp: new Date(), type: 'current' }
    ];

    if (listing.original_price && listing.original_price > listing.price) {
      mockPriceHistory.unshift({
        price: listing.original_price,
        timestamp: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000), // 7 days ago
        type: 'original'
      });
    }

    setPriceHistory(mockPriceHistory);
    setLastUpdate(new Date());
  }, [listing]);

  const hasPriceDrop = listing.original_price && listing.original_price > listing.price;
  const dropPercentage = hasPriceDrop 
    ? ((listing.original_price - listing.price) / listing.original_price * 100).toFixed(1)
    : 0;

  return (
    <Box sx={{ mb: 2 }}>
      <Typography variant="subtitle2" sx={{ mb: 1, display: 'flex', alignItems: 'center' }}>
        <TrendingUp sx={{ mr: 1, fontSize: 20 }} />
        Price Activity
      </Typography>

      {hasPriceDrop && (
        <motion.div
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ type: 'spring', stiffness: 200 }}
        >
          <Box sx={{ 
            p: 1.5, 
            bgcolor: 'success.light', 
            borderRadius: 1, 
            mb: 1,
            border: 1,
            borderColor: 'success.main'
          }}>
            <Typography variant="body2" color="success.dark" sx={{ fontWeight: 'bold' }}>
               Price dropped by {dropPercentage}%!
            </Typography>
            <Typography variant="caption" color="success.dark">
              Save {(listing.original_price - listing.price).toLocaleString()} ETB
            </Typography>
          </Box>
        </motion.div>
      )}

      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
        <Typography variant="body2" color="text.secondary">
          Last updated:
        </Typography>
        <Typography variant="caption" color="primary">
          {lastUpdate ? formatTime(lastUpdate) : 'Just now'}
        </Typography>
      </Box>
    </Box>
  );
};

const formatTime = (date) => {
  const now = new Date();
  const diffInMinutes = Math.floor((now - date) / (1000 * 60));
  
  if (diffInMinutes < 1) return 'Just now';
  if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
  return `${Math.floor(diffInMinutes / 60)}h ago`;
};

export default LiveActivityIndicators;
// Gamification & Rewards Component
import React, { useState, useEffect } from 'react';
import {
  Card, CardContent, Typography, Box, Chip, Button, Grid,
  LinearProgress, Avatar, Dialog, DialogTitle, DialogContent,
  DialogActions, List, ListItem, ListItemText, ListItemIcon,
  Badge, Alert, Tooltip
} from '@mui/material';
import {
  EmojiEvents, Star, TrendingUp, LocalFireDepartment, WorkspacePremium,
  MilitaryTech, CardGiftcard, Leaderboard, Speed, CheckCircle
} from '@mui/icons-material';
import { motion } from 'framer-motion';
import apiService from '../services/api';
import toast from 'react-hot-toast';

const GamificationRewards = ({ userId }) => {
  const [userStats, setUserStats] = useState({});
  const [achievements, setAchievements] = useState([]);
  const [rewards, setRewards] = useState([]);
  const [leaderboard, setLeaderboard] = useState([]);
  const [dialogOpen, setDialogOpen] = useState(false);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchGamificationData();
  }, [userId]);

  const fetchGamificationData = async () => {
    try {
      const [statsRes, achievementsRes, rewardsRes, leaderboardRes] = await Promise.all([
        apiService.getUserGamificationStats(),
        apiService.getUserAchievements(),
        apiService.getAvailableRewards(),
        apiService.getLeaderboard()
      ]);

      setUserStats(statsRes.data || {});
      setAchievements(achievementsRes.data || []);
      setRewards(rewardsRes.data || []);
      setLeaderboard(leaderboardRes.data || []);
    } catch (error) {
    } finally {
      setLoading(false);
    }
  };

  const handleClaimReward = async (rewardId) => {
    try {
      await apiService.claimReward(rewardId);
      toast.success('Reward claimed successfully!');
      fetchGamificationData();
    } catch (error) {
      toast.error('Failed to claim reward');
    }
  };

  const getUserLevel = () => {
    const points = userStats.total_points || 0;
    if (points >= 1000) return { level: 'Expert', color: 'secondary', icon: <WorkspacePremium /> };
    if (points >= 500) return { level: 'Advanced', color: 'warning', icon: <MilitaryTech /> };
    if (points >= 200) return { level: 'Regular', color: 'info', icon: <Star /> };
    return { level: 'Beginner', color: 'primary', icon: <EmojiEvents /> };
  };

  const userLevel = getUserLevel();
  const progressToNextLevel = userStats.points_to_next_level 
    ? (userStats.current_level_points / userStats.points_to_next_level) * 100
    : 100;

  if (loading) {
    return (
      <Card sx={{ mb: 2 }}>
        <CardContent sx={{ textAlign: 'center', py: 4 }}>
          <LinearProgress />
        </CardContent>
      </Card>
    );
  }

  return (
    <Card sx={{ mb: 2 }}>
      <CardContent>
        <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
          <EmojiEvents color="primary" sx={{ mr: 1 }} />
          <Typography variant="h6" sx={{ flexGrow: 1 }}>
            Your Achievements
          </Typography>
          <Button
            variant="outlined"
            startIcon={<Leaderboard />}
            onClick={() => setDialogOpen(true)}
            size="small"
          >
            Leaderboard
          </Button>
        </Box>

        {/* User Level & Progress */}
        <Box sx={{ mb: 3, p: 2, bgcolor: 'grey.50', borderRadius: 2 }}>
          <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
            <Avatar sx={{ bgcolor: `${userLevel.color}.main`, mr: 2 }}>
              {userLevel.icon}
            </Avatar>
            <Box sx={{ flexGrow: 1 }}>
              <Typography variant="h6" color={userLevel.color}>
                {userLevel.level} Level
              </Typography>
              <Typography variant="body2" color="text.secondary">
                {userStats.total_points || 0} Points
              </Typography>
            </Box>
            <Chip
              label={`#${userStats.rank || 'N/A'}`}
              color="primary"
              variant="outlined"
              sx={{ fontWeight: 'bold' }}
            />
          </Box>

          <LinearProgress
            variant="determinate"
            value={progressToNextLevel}
            sx={{ mb: 1, height: 8, borderRadius: 4 }}
          />
          <Typography variant="caption" color="text.secondary">
            {userStats.points_to_next_level - userStats.current_level_points || 0} points to next level
          </Typography>
        </Box>

        {/* Stats Grid */}
        <Grid container spacing={2} sx={{ mb: 3 }}>
          <Grid item xs={6} sm={3}>
            <Box sx={{ textAlign: 'center', p: 1, bgcolor: 'primary.light', borderRadius: 1 }}>
              <Typography variant="h6" color="primary">
                {userStats.listings_posted || 0}
              </Typography>
              <Typography variant="caption">Listings</Typography>
            </Box>
          </Grid>
          <Grid item xs={6} sm={3}>
            <Box sx={{ textAlign: 'center', p: 1, bgcolor: 'success.light', borderRadius: 1 }}>
              <Typography variant="h6" color="success.main">
                {userStats.sales_completed || 0}
              </Typography>
              <Typography variant="caption">Sales</Typography>
            </Box>
          </Grid>
          <Grid item xs={6} sm={3}>
            <Box sx={{ textAlign: 'center', p: 1, bgcolor: 'warning.light', borderRadius: 1 }}>
              <Typography variant="h6" color="warning.main">
                {userStats.reviews_received || 0}
              </Typography>
              <Typography variant="caption">Reviews</Typography>
            </Box>
          </Grid>
          <Grid item xs={6} sm={3}>
            <Box sx={{ textAlign: 'center', p: 1, bgcolor: 'info.light', borderRadius: 1 }}>
              <Typography variant="h6" color="info.main">
                {userStats.days_active || 0}
              </Typography>
              <Typography variant="caption">Days Active</Typography>
            </Box>
          </Grid>
        </Grid>

        {/* Recent Achievements */}
        <Box sx={{ mb: 2 }}>
          <Typography variant="subtitle1" sx={{ mb: 1, display: 'flex', alignItems: 'center' }}>
            <MilitaryTech sx={{ mr: 1 }} />
            Recent Achievements
          </Typography>

          {achievements.length === 0 ? (
            <Alert severity="info">
              <Typography variant="body2">
                Complete actions to unlock achievements and earn rewards!
              </Typography>
            </Alert>
          ) : (
            <Grid container spacing={1}>
              {achievements.slice(0, 4).map((achievement, index) => (
                <Grid item xs={6} sm={3} key={achievement.id}>
                  <motion.div
                    initial={{ scale: 0, opacity: 0 }}
                    animate={{ scale: 1, opacity: 1 }}
                    transition={{ delay: index * 0.1 }}
                  >
                    <Tooltip title={achievement.description}>
                      <Box sx={{ textAlign: 'center' }}>
                        <Avatar
                          sx={{
                            bgcolor: 'success.main',
                            width: 48,
                            height: 48,
                            mx: 'auto',
                            mb: 1
                          }}
                        >
                          {achievement.icon || <CheckCircle />}
                        </Avatar>
                        <Typography variant="caption" sx={{ display: 'block' }}>
                          {achievement.name}
                        </Typography>
                        <Typography variant="caption" color="success.main">
                          +{achievement.points} pts
                        </Typography>
                      </Box>
                    </Tooltip>
                  </motion.div>
                </Grid>
              ))}
            </Grid>
          )}
        </Box>

        {/* Available Rewards */}
        <Box>
          <Typography variant="subtitle1" sx={{ mb: 1, display: 'flex', alignItems: 'center' }}>
            <CardGiftcard sx={{ mr: 1 }} />
            Available Rewards
          </Typography>

          <List sx={{ maxHeight: 200, overflow: 'auto' }}>
            {rewards.length === 0 ? (
              <ListItem>
                <ListItemText
                  primary="No rewards available"
                  secondary="Earn more points to unlock rewards"
                />
              </ListItem>
            ) : (
              rewards.slice(0, 3).map((reward) => (
                <ListItem key={reward.id}>
                  <ListItemIcon>
                    <CardGiftcard color="primary" />
                  </ListItemIcon>
                  <ListItemText
                    primary={reward.name}
                    secondary={`${reward.points_required} points`}
                  />
                  <Button
                    variant="outlined"
                    size="small"
                    onClick={() => handleClaimReward(reward.id)}
                    disabled={(userStats.total_points || 0) < reward.points_required}
                  >
                    Claim
                  </Button>
                </ListItem>
              ))
            )}
          </List>
        </Box>

        {/* Leaderboard Dialog */}
        <Dialog open={dialogOpen} onClose={() => setDialogOpen(false)} maxWidth="sm" fullWidth>
          <DialogTitle>
            <Box sx={{ display: 'flex', alignItems: 'center' }}>
              <Leaderboard sx={{ mr: 1 }} />
              Community Leaderboard
            </Box>
          </DialogTitle>
          <DialogContent>
            <List>
              {leaderboard.map((user, index) => (
                <ListItem key={user.id}>
                  <ListItemIcon>
                    <Avatar sx={{ bgcolor: index < 3 ? 'warning.main' : 'primary.main' }}>
                      {index < 3 ? (
                        index === 0 ? '' : index === 1 ? '' : ''
                      ) : (
                        user.rank || index + 1
                      )}
                    </Avatar>
                  </ListItemIcon>
                  <ListItemText
                    primary={user.name}
                    secondary={`${user.total_points} points`}
                  />
                  <Typography variant="caption" color="text.secondary">
                    Level {user.level}
                  </Typography>
                </ListItem>
              ))}
            </List>
          </DialogContent>
          <DialogActions>
            <Button onClick={() => setDialogOpen(false)}>Close</Button>
          </DialogActions>
        </Dialog>
      </CardContent>
    </Card>
  );
};

export default GamificationRewards;
import React from 'react';
import { Container, Grid, Typography, Link, Box, IconButton } from '@mui/material';
import { Facebook, Twitter, Instagram, Email, Phone, LocationOn } from '@mui/icons-material';

const Footer = () => {
  return (
    <Box component="footer" sx={{ bgcolor: 'background.paper', py: 6, borderTop: '1px solid #e0e0e0', mt: 'auto' }}>
      <Container maxWidth="lg">
        <Grid container spacing={4}>
          <Grid item xs={12} sm={6} md={3}>
            <Typography variant="h6" color="primary" gutterBottom sx={{ fontWeight: 'bold' }}>Yesira Sew</Typography>
            <Typography variant="body2" color="text.secondary">
              Ethiopia's trusted classifieds platform. Buy, sell, and discover amazing deals in your community.
            </Typography>
            <Box sx={{ mt: 2 }}>
              <IconButton color="primary"><Facebook /></IconButton>
              <IconButton color="primary"><Twitter /></IconButton>
              <IconButton color="primary"><Instagram /></IconButton>
            </Box>
          </Grid>
          <Grid item xs={12} sm={6} md={3}>
            <Typography variant="h6" color="text.primary" gutterBottom>Quick Links</Typography>
            <Box display="flex" flexDirection="column" gap={1}>
              <Link href="/" color="text.secondary" underline="hover">Home</Link>
              <Link href="/jobs" color="text.secondary" underline="hover">Jobs</Link>
              <Link href="/tenders" color="text.secondary" underline="hover">Tenders</Link>
            </Box>
          </Grid>
          <Grid item xs={12} sm={6} md={3}>
            <Typography variant="h6" color="text.primary" gutterBottom>Contact</Typography>
            <Box display="flex" flexDirection="column" gap={1}>
              <Box display="flex" alignItems="center" gap={1}><Email fontSize="small" color="primary"/><Typography variant="body2">info@yesrasew.com</Typography></Box>
              <Box display="flex" alignItems="center" gap={1}><Phone fontSize="small" color="primary"/><Typography variant="body2">+251 911 234 567</Typography></Box>
              <Box display="flex" alignItems="center" gap={1}><LocationOn fontSize="small" color="primary"/><Typography variant="body2">Addis Ababa, Ethiopia</Typography></Box>
            </Box>
          </Grid>
        </Grid>
        <Box mt={5} pt={3} borderTop="1px solid #e0e0e0" textAlign="center">
          <Typography variant="body2" color="text.secondary"> {new Date().getFullYear()} Yesira Sew. All rights reserved.</Typography>
        </Box>
      </Container>
    </Box>
  );
};

export default Footer;
import React from 'react';
import { Box, Typography, Button } from '@mui/material';

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false, error: null, errorInfo: null };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    this.setState({
      error: error,
      errorInfo: errorInfo
    });
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <Box
          sx={{
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            minHeight: '100vh',
            p: 3,
            textAlign: 'center'
          }}
        >
          <Typography variant="h4" color="error" gutterBottom>
            Something went wrong
          </Typography>
          <Typography variant="body1" color="text.secondary" sx={{ mb: 3 }}>
            An error occurred while loading this page. Please try refreshing the page.
          </Typography>
          {process.env.NODE_ENV === 'development' && (
            <Box sx={{ mb: 3, p: 2, bgcolor: 'grey.100', borderRadius: 1, textAlign: 'left' }}>
              <Typography variant="h6" gutterBottom>
                Error Details (Development Mode):
              </Typography>
              <Typography variant="body2" component="pre" sx={{ fontSize: '0.75rem' }}>
                {this.state.error && this.state.error.toString()}
              </Typography>
            </Box>
          )}
          <Button
            variant="contained"
            onClick={() => window.location.reload()}
            sx={{ mr: 2 }}
          >
            Refresh Page
          </Button>
          <Button
            variant="outlined"
            onClick={() => this.setState({ hasError: false })}
          >
            Try Again
          </Button>
        </Box>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;
import React, { useState } from 'react';
import {
  Box, Typography, Card, CardContent, Table, TableBody, TableCell,
  TableContainer, TableHead, TableRow, Button, TextField, Select,
  MenuItem, Dialog, DialogTitle, DialogContent, DialogActions,
  Chip, Avatar, IconButton, Grid, Switch, FormControlLabel,
  Accordion, AccordionSummary, AccordionDetails, List, ListItem,
  ListItemText, ListItemIcon, Divider
} from '@mui/material';
import {
  Business, LocationOn, Phone, Email, Person, Edit, Delete,
  Add, Search, Refresh, VerifiedUser, Star, ExpandMore,
  Work, Category, AttachMoney, TrendingUp
} from '@mui/icons-material';

const CompanyManagement = () => {
  const [companies, setCompanies] = useState([
    { 
      id: 1, 
      name: 'Tech Solutions PLC', 
      email: 'info@techsolutions.com', 
      phone: '+251911000000',
      location: 'Addis Ababa, Bole',
      category: 'Technology',
      verified: true,
      status: 'active',
      listings: 12,
      rating: 4.8,
      revenue: 2500000,
      employees: 45,
      joined: '2024-01-01'
    },
    { 
      id: 2, 
      name: 'Real Estate Ethiopia', 
      email: 'contact@realestate.et', 
      phone: '+251922000000',
      location: 'Addis Ababa, Mekane Yesus',
      category: 'Real Estate',
      verified: false,
      status: 'pending',
      listings: 8,
      rating: 4.2,
      revenue: 1800000,
      employees: 15,
      joined: '2024-01-05'
    },
    { 
      id: 3, 
      name: 'Ethio Motors', 
      email: 'sales@ethiomotors.com', 
      phone: '+251933000000',
      location: 'Addis Ababa, CMC',
      category: 'Automotive',
      verified: true,
      status: 'active',
      listings: 25,
      rating: 4.6,
      revenue: 3200000,
      employees: 30,
      joined: '2024-01-03'
    }
  ]);

  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [filterCategory, setFilterCategory] = useState('all');

  const getStatusColor = (status) => {
    const colors = {
      active: 'success',
      pending: 'warning',
      suspended: 'error'
    };
    return colors[status] || 'default';
  };

  const filteredCompanies = companies.filter(company => {
    const matchesSearch = company.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         company.email.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesStatus = filterStatus === 'all' || company.status === filterStatus;
    const matchesCategory = filterCategory === 'all' || company.category === filterCategory;
    return matchesSearch && matchesStatus && matchesCategory;
  });

  return (
    <Box>
      <Typography variant="h6" gutterBottom>Company Management</Typography>
      
      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card sx={{ textAlign: 'center', py: 2 }}>
            <Business sx={{ fontSize: 32, color: 'primary.main', mb: 1 }} />
            <Typography variant="h5">{companies.length}</Typography>
            <Typography variant="caption" color="text.secondary">Total Companies</Typography>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card sx={{ textAlign: 'center', py: 2 }}>
            <VerifiedUser sx={{ fontSize: 32, color: 'success.main', mb: 1 }} />
            <Typography variant="h5">{companies.filter(c => c.verified).length}</Typography>
            <Typography variant="caption" color="text.secondary">Verified</Typography>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card sx={{ textAlign: 'center', py: 2 }}>
            <AttachMoney sx={{ fontSize: 32, color: 'info.main', mb: 1 }} />
            <Typography variant="h5">ETB {(companies.reduce((sum, c) => sum + c.revenue, 0) / 1000000).toFixed(1)}M</Typography>
            <Typography variant="caption" color="text.secondary">Total Revenue</Typography>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card sx={{ textAlign: 'center', py: 2 }}>
            <Work sx={{ fontSize: 32, color: 'warning.main', mb: 1 }} />
            <Typography variant="h5">{companies.reduce((sum, c) => sum + c.employees, 0)}</Typography>
            <Typography variant="caption" color="text.secondary">Total Employees</Typography>
          </Card>
        </Grid>
      </Grid>

      {/* Search and Filter */}
      <Grid container spacing={2} sx={{ mb: 3 }}>
        <Grid item xs={12} md={4}>
          <TextField
            fullWidth
            placeholder="Search companies..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            InputProps={{ startAdornment: <Search /> }}
          />
        </Grid>
        <Grid item xs={12} md={3}>
          <Select fullWidth value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}>
            <MenuItem value="all">All Status</MenuItem>
            <MenuItem value="active">Active</MenuItem>
            <MenuItem value="pending">Pending</MenuItem>
            <MenuItem value="suspended">Suspended</MenuItem>
          </Select>
        </Grid>
        <Grid item xs={12} md={3}>
          <Select fullWidth value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)}>
            <MenuItem value="all">All Categories</MenuItem>
            <MenuItem value="Technology">Technology</MenuItem>
            <MenuItem value="Real Estate">Real Estate</MenuItem>
            <MenuItem value="Automotive">Automotive</MenuItem>
          </Select>
        </Grid>
        <Grid item xs={12} md={2}>
          <Button variant="contained" fullWidth startIcon={<Add />}>Add Company</Button>
        </Grid>
      </Grid>

      {/* Companies Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>Company</TableCell>
                  <TableCell>Category</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Listings</TableCell>
                  <TableCell>Revenue</TableCell>
                  <TableCell>Rating</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredCompanies.map(company => (
                  <TableRow key={company.id}>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center' }}>
                        <Avatar sx={{ mr: 2, bgcolor: 'primary.main' }}>
                          <Business />
                        </Avatar>
                        <Box>
                          <Typography variant="body2" fontWeight="medium">
                            {company.name}
                          </Typography>
                          <Typography variant="caption" color="text.secondary">
                            {company.email}
                          </Typography>
                          <Box sx={{ mt: 0.5, display: 'flex', alignItems: 'center', gap: 1 }}>
                            <LocationOn fontSize="12" />
                            <Typography variant="caption">{company.location}</Typography>
                          </Box>
                          {company.verified && (
                            <Chip size="small" label="Verified" color="success" sx={{ mt: 0.5 }} />
                          )}
                        </Box>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip size="small" label={company.category} />
                    </TableCell>
                    <TableCell>
                      <Chip
                        size="small"
                        label={company.status}
                        color={getStatusColor(company.status)}
                      />
                    </TableCell>
                    <TableCell>{company.listings}</TableCell>
                    <TableCell>ETB {company.revenue.toLocaleString()}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center' }}>
                        <Star sx={{ fontSize: 16, color: 'warning.main', mr: 0.5 }} />
                        <Typography variant="body2">{company.rating}</Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <IconButton size="small"><Edit /></IconButton>
                      <IconButton size="small" color="error"><Delete /></IconButton>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>
    </Box>
  );
};

export default CompanyManagement;
import React, { useState } from 'react';
import {
  Box, Typography, Card, CardContent, Table, TableBody, TableCell,
  TableContainer, TableHead, TableRow, Button, TextField, Select,
  MenuItem, Dialog, DialogTitle, DialogContent, DialogActions,
  Chip, Avatar, IconButton, Tabs, Tab, Grid, Switch, FormControlLabel
} from '@mui/material';
import {
  AdminPanelSettings, Security, Business, Group, Assignment,
  VerifiedUser, Email, Settings, Person, Add, Edit, Delete,
  Visibility, Search, Refresh
} from '@mui/icons-material';

const AdminManagement = () => {
  const [activeTab, setActiveTab] = useState(0);
  const [adminUsers, setAdminUsers] = useState([
    { id: 1, name: 'Super Admin', email: 'admin@yesrasew.com', role: 'SuperAdmin', status: 'active', lastLogin: '2024-01-15' },
    { id: 2, name: 'John Moderator', email: 'john@yesrasew.com', role: 'Moderator', status: 'active', lastLogin: '2024-01-14' },
    { id: 3, name: 'Jane Admin', email: 'jane@yesrasew.com', role: 'Admin', status: 'inactive', lastLogin: '2024-01-10' }
  ]);

  const [auditLogs] = useState([
    { id: 1, user: 'Super Admin', action: 'Created new user', timestamp: '2024-01-15 10:30', ip: '192.168.1.1' },
    { id: 2, user: 'John Moderator', action: 'Approved listing', timestamp: '2024-01-15 09:45', ip: '192.168.1.2' },
    { id: 3, user: 'Jane Admin', action: 'Updated settings', timestamp: '2024-01-14 16:20', ip: '192.168.1.3' }
  ]);

  const [permissions] = useState({
    SuperAdmin: ['All permissions'],
    Moderator: ['Approve listings', 'Manage users', 'View reports'],
    Admin: ['Basic management', 'View analytics']
  });

  const getRoleColor = (role) => {
    const colors = {
      SuperAdmin: 'error',
      Admin: 'primary',
      Moderator: 'success'
    };
    return colors[role] || 'default';
  };

  return (
    <Box>
      <Typography variant="h6" gutterBottom>Admin Management</Typography>
      
      <Tabs value={activeTab} onChange={(e, v) => setActiveTab(v)} sx={{ mb: 3 }}>
        <Tab icon={<Security />} label="Admin Users" />
        <Tab icon={<Assignment />} label="Roles & Permissions" />
        <Tab icon={<Visibility />} label="Audit Log" />
      </Tabs>

      {activeTab === 0 && (
        <Card>
          <CardContent>
            <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 2 }}>
              <Typography variant="h6">Admin Users</Typography>
              <Button variant="contained" startIcon={<Add />}>Add Admin</Button>
            </Box>
            <TableContainer>
              <Table>
                <TableHead>
                  <TableRow>
                    <TableCell>User</TableCell>
                    <TableCell>Role</TableCell>
                    <TableCell>Status</TableCell>
                    <TableCell>Last Login</TableCell>
                    <TableCell>Actions</TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  {adminUsers.map(admin => (
                    <TableRow key={admin.id}>
                      <TableCell>
                        <Box sx={{ display: 'flex', alignItems: 'center' }}>
                          <Avatar sx={{ mr: 2 }}><Person /></Avatar>
                          <Box>
                            <Typography>{admin.name}</Typography>
                            <Typography variant="caption" color="text.secondary">{admin.email}</Typography>
                          </Box>
                        </Box>
                      </TableCell>
                      <TableCell>
                        <Chip label={admin.role} color={getRoleColor(admin.role)} />
                      </TableCell>
                      <TableCell>
                        <Chip label={admin.status} color={admin.status === 'active' ? 'success' : 'default'} />
                      </TableCell>
                      <TableCell>{admin.lastLogin}</TableCell>
                      <TableCell>
                        <IconButton size="small"><Edit /></IconButton>
                        <IconButton size="small" color="error"><Delete /></IconButton>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </TableContainer>
          </CardContent>
        </Card>
      )}

      {activeTab === 1 && (
        <Card>
          <CardContent>
            <Typography variant="h6" gutterBottom>Roles & Permissions</Typography>
            {Object.entries(permissions).map(([role, perms]) => (
              <Card key={role} sx={{ mb: 2 }}>
                <CardContent>
                  <Typography variant="subtitle1" color={getRoleColor(role) + '.main'}>
                    {role}
                  </Typography>
                  <Box sx={{ mt: 1 }}>
                    {perms.map(perm => (
                      <Chip key={perm} label={perm} size="small" sx={{ mr: 1, mb: 1 }} />
                    ))}
                  </Box>
                </CardContent>
              </Card>
            ))}
          </CardContent>
        </Card>
      )}

      {activeTab === 2 && (
        <Card>
          <CardContent>
            <Typography variant="h6" gutterBottom>Audit Log</Typography>
            <TableContainer>
              <Table>
                <TableHead>
                  <TableRow>
                    <TableCell>User</TableCell>
                    <TableCell>Action</TableCell>
                    <TableCell>Timestamp</TableCell>
                    <TableCell>IP Address</TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  {auditLogs.map(log => (
                    <TableRow key={log.id}>
                      <TableCell>{log.user}</TableCell>
                      <TableCell>{log.action}</TableCell>
                      <TableCell>{log.timestamp}</TableCell>
                      <TableCell><code>{log.ip}</code></TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </TableContainer>
          </CardContent>
        </Card>
      )}
    </Box>
  );
};

export default AdminManagement;
import { useTheme, useMediaQuery } from '@mui/material';

// Responsive hooks and utilities
export const useResponsive = () => {
  const theme = useTheme();
  const isMobile = useMediaQuery(theme.breakpoints.down('sm'));
  const isTablet = useMediaQuery(theme.breakpoints.down('md'));
  const isDesktop = useMediaQuery(theme.breakpoints.up('md'));
  const isLargeDesktop = useMediaQuery(theme.breakpoints.up('lg'));

  return {
    isMobile,
    isTablet,
    isDesktop,
    isLargeDesktop,
    breakpoint: {
      xs: 0,
      sm: 600,
      md: 900,
      lg: 1200,
      xl: 1536,
    }
  };
};

// Responsive grid spacing
export const getResponsiveGridSpacing = (isMobile, isTablet) => {
  if (isMobile) return 1;
  if (isTablet) return 2;
  return 3;
};

// Responsive grid item sizes
export const getResponsiveGridItemSize = (baseSize = 12, isMobile, isTablet) => {
  // Default responsive behavior
  const responsiveSizes = {
    // Full width cards
    12: { xs: 12, sm: 12, md: 12, lg: 12, xl: 12 },
    // Half width cards
    6: { xs: 12, sm: 6, md: 6, lg: 6, xl: 6 },
    // Third width cards
    4: { xs: 12, sm: 6, md: 4, lg: 4, xl: 4 },
    // Quarter width cards
    3: { xs: 12, sm: 6, md: 4, lg: 3, xl: 3 },
    // Two-thirds width
    8: { xs: 12, sm: 12, md: 8, lg: 8, xl: 8 },
  };

  return responsiveSizes[baseSize] || responsiveSizes[12];
};

// Responsive typography
export const getResponsiveTypography = (variant, isMobile, isTablet) => {
  const typographyMap = {
    h1: {
      variant: isMobile ? 'h3' : isTablet ? 'h2' : 'h1',
      fontSize: isMobile ? '2rem' : isTablet ? '2.5rem' : '3rem'
    },
    h2: {
      variant: isMobile ? 'h4' : isTablet ? 'h3' : 'h2',
      fontSize: isMobile ? '1.5rem' : isTablet ? '1.75rem' : '2rem'
    },
    h3: {
      variant: isMobile ? 'h5' : isTablet ? 'h4' : 'h3',
      fontSize: isMobile ? '1.25rem' : isTablet ? '1.5rem' : '1.75rem'
    },
    h4: {
      variant: isMobile ? 'h6' : isTablet ? 'h5' : 'h4',
      fontSize: isMobile ? '1.125rem' : isTablet ? '1.25rem' : '1.5rem'
    },
    body1: {
      variant: isMobile ? 'body2' : 'body1',
      fontSize: isMobile ? '0.875rem' : '1rem'
    },
    body2: {
      variant: isMobile ? 'caption' : 'body2',
      fontSize: isMobile ? '0.75rem' : '0.875rem'
    }
  };

  return typographyMap[variant] || typographyMap.body1;
};

// Responsive spacing
export const getResponsiveSpacing = (baseSpacing, isMobile, isTablet) => {
  const spacingMultiplier = isMobile ? 0.5 : isTablet ? 0.75 : 1;
  return baseSpacing * spacingMultiplier;
};

// Responsive card sizing
export const getResponsiveCardProps = (isMobile, isTablet) => ({
  sx: {
    p: isMobile ? 1.5 : isTablet ? 2 : 3,
    m: isMobile ? 0.5 : isTablet ? 1 : 1.5,
    minWidth: isMobile ? 'auto' : isTablet ? 280 : 320,
    maxWidth: isMobile ? '100%' : isTablet ? 400 : 450,
  }
});

// Responsive table props
export const getResponsiveTableProps = (isMobile, isTablet) => ({
  size: isMobile ? 'small' : 'medium',
  sx: {
    '& .MuiTableCell-root': {
      padding: isMobile ? '4px 8px' : isTablet ? '8px 12px' : '12px 16px',
      fontSize: isMobile ? '0.75rem' : isTablet ? '0.875rem' : '1rem',
    },
    '& .MuiTableHead-root .MuiTableCell-root': {
      fontWeight: 600,
      backgroundColor: 'background.paper',
    },
  }
});

// Responsive button props
export const getResponsiveButtonProps = (isMobile, isTablet) => ({
  size: isMobile ? 'small' : 'medium',
  sx: {
    minWidth: isMobile ? 'auto' : isTablet ? 100 : 120,
    fontSize: isMobile ? '0.75rem' : '0.875rem',
  }
});

// Responsive dialog props
export const getResponsiveDialogProps = (isMobile, isTablet) => ({
  fullWidth: true,
  maxWidth: isMobile ? 'sm' : isTablet ? 'md' : 'lg',
  PaperProps: {
    sx: {
      m: isMobile ? 1 : isTablet ? 2 : 3,
      maxHeight: isMobile ? '90vh' : '85vh',
    }
  }
});

// Responsive container props
export const getResponsiveContainerProps = (isMobile, isTablet) => ({
  maxWidth: false,
  sx: {
    px: isMobile ? 1 : isTablet ? 2 : 3,
    py: isMobile ? 1 : isTablet ? 2 : 3,
  }
});

// Responsive chart props
export const getResponsiveChartProps = (isMobile, isTablet) => ({
  height: isMobile ? 200 : isTablet ? 300 : 400,
  width: '100%',
  margin: { top: 20, right: 30, left: 20, bottom: 5 }
});

// Responsive form props
export const getResponsiveFormProps = (isMobile, isTablet) => ({
  sx: {
    '& .MuiFormControl-root': {
      mb: isMobile ? 1 : isTablet ? 1.5 : 2,
    },
    '& .MuiTextField-root, .MuiSelect-root': {
      '& .MuiInputBase-root': {
        fontSize: isMobile ? '0.875rem' : '1rem',
      }
    }
  }
});

// Responsive list props
export const getResponsiveListProps = (isMobile, isTablet) => ({
  dense: isMobile,
  sx: {
    '& .MuiListItem-root': {
      py: isMobile ? 0.5 : isTablet ? 1 : 1.5,
      px: isMobile ? 1 : isTablet ? 2 : 3,
    },
    '& .MuiListItemIcon-root': {
      minWidth: isMobile ? 32 : 40,
    }
  }
});

// Helper function to create responsive styles
export const createResponsiveStyles = (baseStyles, responsiveOverrides = {}, theme, isMobile, isTablet) => {
  const responsiveStyles = {
    ...baseStyles,
    ...(isMobile && responsiveOverrides.mobile),
    ...(isTablet && responsiveOverrides.tablet),
    ...(!isMobile && !isTablet && responsiveOverrides.desktop),
  };

  return responsiveStyles;
};

// Responsive breakpoints object
export const breakpoints = {
  xs: 0,
  sm: 600,
  md: 900,
  lg: 1200,
  xl: 1536,
};

import { STATUS_COLORS } from '../constants/menuItems';

export const getStatusColor = (status) => {
  return STATUS_COLORS[status] || 'default';
};

export const getStatusIcon = (status) => {
  switch (status) {
    case 'pending':
      return 'AccessTime';
    case 'approved':
    case 'completed':
      return 'CheckCircle';
    case 'rejected':
    case 'failed':
      return 'Cancel';
    case 'active':
      return 'CheckCircle';
    case 'inactive':
      return 'Block';
    default:
      return 'Help';
  }
};

export const formatCurrency = (amount, currency = 'ETB') => {
  return `${currency} ${amount.toLocaleString()}`;
};

export const formatDate = (date) => {
  return new Date(date).toLocaleDateString();
};

export const formatNumber = (number) => {
  return number.toLocaleString();
};
export const MENU_ITEMS = [
  // Core Features
  { id: 0, icon: 'Dashboard', label: 'dashboard', category: 'basic' },
  { id: 1, icon: 'Assignment', label: 'tender', category: 'basic' },
  { id: 2, icon: 'Home', label: 'home', category: 'basic' },
  { id: 3, icon: 'DirectionsCar', label: 'cars', category: 'basic' },
  { id: 4, icon: 'Work', label: 'jobs', category: 'basic' },
  { id: 5, icon: 'ManageHome', label: 'homepageManagement', category: 'basic' },
  { id: 6, icon: 'Category', label: 'categories', category: 'basic' },
  { id: 7, icon: 'Business', label: 'companies', category: 'basic' },
  
  // Premium Features
  { id: 8, icon: 'TrendingUp', label: 'analytics', category: 'premium' },
  { id: 9, icon: 'Settings', label: 'systemSettings', category: 'premium' },
    { id: 10, icon: 'Payments', label: 'financial', category: 'premium' },
  { id: 11, icon: 'Email', label: 'communication', category: 'premium' },
  { id: 12, icon: 'Security', label: 'contentModeration', category: 'premium' },
  { id: 13, icon: 'CardMembership', label: 'membership', category: 'premium' },
  { id: 16, icon: 'BarChart', label: 'reports', category: 'premium' },
  { id: 14, icon: 'Gavel', label: 'legalCompliance', category: 'premium' },
  { id: 15, icon: 'Smartphone', label: 'mobileApp', category: 'premium' },
  { id: 17, icon: 'People', label: 'userManagement', category: 'premium' },
  
  // Ultimate Features
  { id: 18, icon: 'Security', label: 'security', category: 'ultimate' },
  { id: 19, icon: 'Backup', label: 'backup', category: 'ultimate' },
  { id: 20, icon: 'Api', label: 'apiManagement', category: 'ultimate' },
  { id: 21, icon: 'Support', label: 'support', category: 'ultimate' },
  { id: 22, icon: 'TrendingUp', label: 'advancedAnalytics', category: 'ultimate' },
  { id: 23, icon: 'PlayArrow', label: 'workflow', category: 'ultimate' },
  { id: 24, icon: 'Email', label: 'notifications', category: 'ultimate' },
  { id: 25, icon: 'Api', label: 'integrations', category: 'ultimate' },
  { id: 26, icon: 'Help', label: 'help', category: 'ultimate' },
];

export const CATEGORIES = {
  basic: { label: 'basic', color: '#4CAF50' },
  premium: { label: 'premium', color: '#2196F3' },
  ultimate: { label: 'ultimate', color: '#FF9800' },
};

export const STATUS_COLORS = {
  pending: 'warning',
  approved: 'success',
  rejected: 'error',
  active: 'success',
  inactive: 'default',
  completed: 'success',
  failed: 'error',
  processing: 'info',
};
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Timeline, PlayArrow, Pause, Stop, Settings, Assessment,
  FilterList, ExpandMore, Warning, Error, Info,
  Schedule, DateRange, CalendarToday, Sync, Loop,
  ArrowForward, ArrowBack, ArrowDownward, SwapVert,
  AccountTree, FlowChart, Schema, Hub, Router,
  Speed, Memory, Storage, DataObject, Code,
  Person, Group, Business, School, Work,
  Email, Message, Phone, Notification,
  Download, Upload, FileCopy
} from '@mui/icons-material';

const WorkflowScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [workflowDialog, setWorkflowDialog] = useState(false);
  const [nodeDialog, setNodeDialog] = useState(false);

  const workflows = [
    {
      id: 1,
      name: 'User Registration Flow',
      description: 'Complete user registration and verification process',
      category: 'user_management',
      status: 'active',
      priority: 'high',
      created_at: '2024-01-01',
      updated_at: '2024-01-15',
      last_run: '2024-01-15 14:30:00',
      total_runs: 12543,
      success_rate: 98.5,
      avg_duration: '2m 30s',
      nodes_count: 8,
      triggers: ['user_signup'],
      created_by: 'admin@yesrasew.com'
    },
    {
      id: 2,
      name: 'Property Listing Approval',
      description: 'Automated property listing review and approval workflow',
      category: 'content_moderation',
      status: 'active',
      priority: 'medium',
      created_at: '2024-01-05',
      updated_at: '2024-01-14',
      last_run: '2024-01-15 12:15:00',
      total_runs: 3456,
      success_rate: 95.2,
      avg_duration: '5m 45s',
      nodes_count: 12,
      triggers: ['property_submission'],
      created_by: 'moderation_team@yesrasew.com'
    },
    {
      id: 3,
      name: 'Payment Processing',
      description: 'Handle payment processing and receipt generation',
      category: 'billing',
      status: 'active',
      priority: 'critical',
      created_at: '2023-12-15',
      updated_at: '2024-01-10',
      last_run: '2024-01-15 16:20:00',
      total_runs: 8765,
      success_rate: 99.8,
      avg_duration: '1m 15s',
      nodes_count: 6,
      triggers: ['payment_initiated'],
      created_by: 'billing_team@yesrasew.com'
    },
    {
      id: 4,
      name: 'Email Notification System',
      description: 'Send automated email notifications to users',
      category: 'communication',
      status: 'paused',
      priority: 'medium',
      created_at: '2023-11-20',
      updated_at: '2024-01-12',
      last_run: '2024-01-14 18:45:00',
      total_runs: 23456,
      success_rate: 92.1,
      avg_duration: '30s',
      nodes_count: 4,
      triggers: ['user_action', 'system_event'],
      created_by: 'communication_team@yesrasew.com'
    },
    {
      id: 5,
      name: 'Data Backup Workflow',
      description: 'Automated daily data backup and verification',
      category: 'system',
      status: 'active',
      priority: 'critical',
      created_at: '2023-10-01',
      updated_at: '2024-01-08',
      last_run: '2024-01-15 02:00:00',
      total_runs: 109,
      success_rate: 97.2,
      avg_duration: '45m 00s',
      nodes_count: 10,
      triggers: ['schedule_daily'],
      created_by: 'system_admin@yesrasew.com'
    }
  ];



  const workflowExecutions = [
    {
      id: 1,
      workflow_id: 1,
      workflow_name: 'User Registration Flow',
      execution_id: 'exec_20240115_143000_001',
      status: 'completed',
      started_at: '2024-01-15 14:30:00',
      completed_at: '2024-01-15 14:32:30',
      duration: '2m 30s',
      triggered_by: 'user_signup',
      trigger_data: { user_id: 12345, email: 'john.doe@email.com' },
      nodes_executed: 8,
      nodes_successful: 8,
      nodes_failed: 0,
      error_count: 0
    },
    {
      id: 2,
      workflow_id: 2,
      workflow_name: 'Property Listing Approval',
      execution_id: 'exec_20240115_121500_002',
      status: 'failed',
      started_at: '2024-01-15 12:15:00',
      completed_at: '2024-01-15 12:18:45',
      duration: '3m 45s',
      triggered_by: 'property_submission',
      trigger_data: { property_id: 67890, user_id: 12346 },
      nodes_executed: 7,
      nodes_successful: 6,
      nodes_failed: 1,
      error_count: 1,
      error_message: 'Image processing service timeout'
    },
    {
      id: 3,
      workflow_id: 3,
      workflow_name: 'Payment Processing',
      execution_id: 'exec_20240115_162000_003',
      status: 'completed',
      started_at: '2024-01-15 16:20:00',
      completed_at: '2024-01-15 16:21:15',
      duration: '1m 15s',
      triggered_by: 'payment_initiated',
      trigger_data: { payment_id: 98765, amount: 29.99, user_id: 12347 },
      nodes_executed: 6,
      nodes_successful: 6,
      nodes_failed: 0,
      error_count: 0
    }
  ];

  const workflowMetrics = [
    {
      id: 1,
      metric: 'Total Workflows',
      value: 15,
      change: '+2',
      trend: 'up',
      status: 'good'
    },
    {
      id: 2,
      metric: 'Active Workflows',
      value: 12,
      change: '+1',
      trend: 'up',
      status: 'good'
    },
    {
      id: 3,
      metric: 'Avg Success Rate',
      value: '96.8%',
      change: '+1.2%',
      trend: 'up',
      status: 'good'
    },
    {
      id: 4,
      metric: 'Executions Today',
      value: 234,
      change: '+15%',
      trend: 'up',
      status: 'good'
    }
  ];

  const nodeTypes = [
    {
      type: 'trigger',
      name: 'Trigger',
      description: 'Start workflow based on events',
      color: '#4CAF50',
      icon: <PlayArrow />
    },
    {
      type: 'validation',
      name: 'Validation',
      description: 'Validate data and conditions',
      color: '#2196F3',
      icon: <CheckCircle />
    },
    {
      type: 'action',
      name: 'Action',
      description: 'Execute specific actions',
      color: '#FF9800',
      icon: <Settings />
    },
    {
      type: 'notification',
      name: 'Notification',
      description: 'Send notifications',
      color: '#9C27B0',
      icon: <Email />
    },
    {
      type: 'condition',
      name: 'Condition',
      description: 'Branch based on conditions',
      color: '#F44336',
      icon: <SwapVert />
    },
    {
      type: 'logging',
      name: 'Logging',
      description: 'Log events and data',
      color: '#607D8B',
      icon: <DataObject />
    }
  ];

  const filteredWorkflows = workflows.filter(workflow => {
    const matchesSearch = workflow.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      workflow.description.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || workflow.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && workflow.category === 'user_management') ||
      (activeTab === 2 && workflow.category === 'content_moderation') ||
      (activeTab === 3 && workflow.category === 'billing');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'paused': return 'warning';
      case 'inactive': return 'default';
      case 'failed': return 'error';
      case 'completed': return 'success';
      default: return 'default';
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'critical': return 'error';
      case 'high': return 'warning';
      case 'medium': return 'info';
      case 'low': return 'success';
      default: return 'default';
    }
  };

  const handleItemSelect = (workflowId) => {
    setSelectedItems(prev =>
      prev.includes(workflowId)
        ? prev.filter(id => id !== workflowId)
        : [...prev, workflowId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on workflows:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleRunWorkflow = (workflowId) => {
    console.log(`Run workflow: ${workflowId}`);
  };

  const handlePauseWorkflow = (workflowId) => {
    console.log(`Pause workflow: ${workflowId}`);
  };

  const handleStopWorkflow = (workflowId) => {
    console.log(`Stop workflow: ${workflowId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Workflow Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<AccountTree />} onClick={() => setNodeDialog(true)}>
            Node Types
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setWorkflowDialog(true)}>
            Create Workflow
          </Button>
        </Box>
      </Box>

      {/* Failed Workflow Alert */}
      {workflowExecutions.filter(exec => exec.status === 'failed').length > 0 && (
        <Alert severity="error" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{workflowExecutions.filter(exec => exec.status === 'failed').length} workflow executions</strong> have failed. Review and resolve issues.
          </Typography>
        </Alert>
      )}

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Timeline sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">15</Typography>
              <Typography variant="body2" color="text.secondary">Total Workflows</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <PlayArrow sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">12</Typography>
              <Typography variant="body2" color="text.secondary">Active Workflows</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">96.8%</Typography>
              <Typography variant="body2" color="text.secondary">Avg Success Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Speed sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">234</Typography>
              <Typography variant="body2" color="text.secondary">Executions Today</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Workflow Metrics Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Workflow Metrics
          </Typography>
          <Grid container spacing={2}>
            {workflowMetrics.map((metric) => (
              <Grid item xs={12} sm={6} md={3} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={metric.change}
                      color={metric.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Chip
                      label={metric.status}
                      color={metric.status === 'good' ? 'success' : 'warning'}
                      size="small"
                      sx={{ ml: 1 }}
                    />
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Workflow Categories */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Workflows" />
          <Tab label="User Management" />
          <Tab label="Content Moderation" />
          <Tab label="Billing" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search workflows..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="paused">Paused</MenuItem>
                  <MenuItem value="inactive">Inactive</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('run')}>
                      Run Selected
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('pause')}>
                      Pause Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('stop')}>
                      Stop Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Workflows Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredWorkflows.map(workflow => workflow.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Workflow</TableCell>
                  <TableCell>Category</TableCell>
                  <TableCell>Priority</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Success Rate</TableCell>
                  <TableCell>Duration</TableCell>
                  <TableCell>Last Run</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredWorkflows.map((workflow) => (
                  <TableRow key={workflow.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(workflow.id)}
                        onChange={() => handleItemSelect(workflow.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {workflow.name}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {workflow.nodes_count} nodes  {workflow.triggers.length} triggers
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={workflow.category.replace('_', ' ')}
                        size="small"
                        variant="outlined"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={workflow.priority}
                        color={getPriorityColor(workflow.priority)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={workflow.status}
                        color={getStatusColor(workflow.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {workflow.success_rate}%
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {workflow.avg_duration}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {workflow.last_run.split(' ')[0]}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        {workflow.status === 'active' ? (
                          <Tooltip title="Pause Workflow">
                            <IconButton size="small" color="warning" onClick={() => handlePauseWorkflow(workflow.id)}>
                              <Pause />
                            </IconButton>
                          </Tooltip>
                        ) : (
                          <Tooltip title="Run Workflow">
                            <IconButton size="small" color="success" onClick={() => handleRunWorkflow(workflow.id)}>
                              <PlayArrow />
                            </IconButton>
                          </Tooltip>
                        )}
                        <Tooltip title="Stop Workflow">
                          <IconButton size="small" color="error" onClick={() => handleStopWorkflow(workflow.id)}>
                            <Stop />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Workflow Executions Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Recent Executions
          </Typography>
          <List>
            {workflowExecutions.map((execution) => (
              <ListItem key={execution.id} divider>
                <ListItemIcon>
                  {execution.status === 'completed' ? (
                    <CheckCircle sx={{ color: 'success.main' }} />
                  ) : execution.status === 'failed' ? (
                    <Error sx={{ color: 'error.main' }} />
                  ) : (
                    <Sync sx={{ color: 'info.main' }} />
                  )}
                </ListItemIcon>
                <ListItemText
                  primary={execution.workflow_name}
                  secondary={`${execution.execution_id}  Duration: ${execution.duration}  Nodes: ${execution.nodes_successful}/${execution.nodes_executed}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={execution.status}
                      color={getStatusColor(execution.status)}
                      size="small"
                    />
                    {execution.error_count > 0 && (
                      <Chip
                        label={`${execution.error_count} errors`}
                        color="error"
                        size="small"
                      />
                    )}
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Node Types Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Available Node Types
          </Typography>
          <Grid container spacing={2}>
            {nodeTypes.map((nodeType, index) => (
              <Grid item xs={12} sm={6} md={2} key={index}>
                <Paper variant="outlined" sx={{ p: 2, textAlign: 'center' }}>
                  <Box sx={{ color: nodeType.color, mb: 1 }}>
                    {nodeType.icon}
                  </Box>
                  <Typography variant="h6" fontWeight="bold">
                    {nodeType.name}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {nodeType.description}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Create Workflow Dialog */}
      <Dialog open={workflowDialog} onClose={() => setWorkflowDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Create New Workflow</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Design and create a new automated workflow with custom nodes and triggers.
          </Typography>
          {/* Workflow creation form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setWorkflowDialog(false)}>Cancel</Button>
          <Button variant="contained">Create Workflow</Button>
        </DialogActions>
      </Dialog>

      {/* Node Types Dialog */}
      <Dialog open={nodeDialog} onClose={() => setNodeDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Workflow Node Types</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure and manage different types of workflow nodes.
          </Typography>
          {/* Node types configuration here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setNodeDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default WorkflowScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, People, Person, PersonAdd, PersonRemove, Block, Lock,
  Security, Email, Phone, LocationOn, CalendarToday, ExpandMore,
  Star, TrendingUp, Assessment, FilterList, MoreVert,
  Verified, Pending, Error, AdminPanelSettings, SupervisorAccount,
  Group, Business, School, Work, AssignmentInd
} from '@mui/icons-material';

const UserManagementScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [userDialog, setUserDialog] = useState(false);
  const [roleDialog, setRoleDialog] = useState(false);

  const users = [
    {
      id: 1,
      name: 'John Doe',
      email: 'john.doe@email.com',
      phone: '+251911234567',
      role: 'admin',
      status: 'active',
      joined_at: '2024-01-01',
      last_login: '2024-01-15 14:30',
      location: 'Addis Ababa, Ethiopia',
      verification_status: 'verified',
      membership_plan: 'Premium',
      listings_count: 12,
      messages_count: 89,
      profile_completion: 95
    },
    {
      id: 2,
      name: 'Sarah Wilson',
      email: 'sarah.wilson@email.com',
      phone: '+251911234568',
      role: 'premium_user',
      status: 'active',
      joined_at: '2023-12-15',
      last_login: '2024-01-15 12:15',
      location: 'Bahir Dar, Ethiopia',
      verification_status: 'verified',
      membership_plan: 'Professional',
      listings_count: 45,
      messages_count: 234,
      profile_completion: 100
    },
    {
      id: 3,
      name: 'Mike Johnson',
      email: 'mike.johnson@email.com',
      phone: '+251911234569',
      role: 'user',
      status: 'active',
      joined_at: '2023-11-20',
      last_login: '2024-01-14 18:45',
      location: 'Hawassa, Ethiopia',
      verification_status: 'pending',
      membership_plan: 'Basic',
      listings_count: 3,
      messages_count: 12,
      profile_completion: 60
    },
    {
      id: 4,
      name: 'Emily Brown',
      email: 'emily.brown@email.com',
      phone: '+251911234570',
      role: 'user',
      status: 'suspended',
      joined_at: '2023-10-01',
      last_login: '2024-01-10 09:30',
      location: 'Mekelle, Ethiopia',
      verification_status: 'verified',
      membership_plan: 'Basic',
      listings_count: 8,
      messages_count: 34,
      profile_completion: 75
    },
    {
      id: 5,
      name: 'David Lee',
      email: 'david.lee@email.com',
      phone: '+251911234571',
      role: 'moderator',
      status: 'active',
      joined_at: '2023-09-15',
      last_login: '2024-01-15 16:20',
      location: 'Dire Dawa, Ethiopia',
      verification_status: 'verified',
      membership_plan: 'Premium',
      listings_count: 156,
      messages_count: 892,
      profile_completion: 100
    }
  ];

  const userRoles = [
    {
      id: 1,
      name: 'Super Admin',
      description: 'Full system access and control',
      permissions: ['all'],
      user_count: 2,
      color: '#F44336'
    },
    {
      id: 2,
      name: 'Admin',
      description: 'Administrative access to most features',
      permissions: ['users', 'content', 'analytics', 'reports'],
      user_count: 5,
      color: '#FF9800'
    },
    {
      id: 3,
      name: 'Moderator',
      description: 'Content moderation and user support',
      permissions: ['content_moderation', 'user_support'],
      user_count: 12,
      color: '#2196F3'
    },
    {
      id: 4,
      name: 'Premium User',
      description: 'Enhanced features and priority support',
      permissions: ['premium_features'],
      user_count: 450,
      color: '#4CAF50'
    },
    {
      id: 5,
      name: 'User',
      description: 'Standard platform access',
      permissions: ['basic_features'],
      user_count: 1250,
      color: '#9C27B0'
    }
  ];

  const userActivity = [
    {
      id: 1,
      metric: 'Daily Active Users',
      value: 12543,
      change: '+12.5%',
      trend: 'up',
      date_range: 'Last 30 days'
    },
    {
      id: 2,
      metric: 'New Registrations',
      value: 234,
      change: '+8.2%',
      trend: 'up',
      date_range: 'Last 7 days'
    },
    {
      id: 3,
      metric: 'Profile Completion',
      value: '78.5%',
      change: '+3.1%',
      trend: 'up',
      date_range: 'Current'
    },
    {
      id: 4,
      metric: 'Verification Rate',
      value: '89.2%',
      change: '+1.5%',
      trend: 'up',
      date_range: 'Last 30 days'
    }
  ];

  const filteredUsers = users.filter(user => {
    const matchesSearch = user.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      user.email.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      user.role.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || user.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && user.role === 'admin') ||
      (activeTab === 2 && user.role === 'moderator') ||
      (activeTab === 3 && user.role === 'premium_user') ||
      (activeTab === 4 && user.role === 'user');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'suspended': return 'error';
      case 'pending': return 'warning';
      case 'inactive': return 'default';
      default: return 'default';
    }
  };

  const getRoleIcon = (role) => {
    switch (role) {
      case 'admin': return <AdminPanelSettings sx={{ fontSize: 20 }} />;
      case 'moderator': return <SupervisorAccount sx={{ fontSize: 20 }} />;
      case 'premium_user': return <Star sx={{ fontSize: 20 }} />;
      case 'user': return <Person sx={{ fontSize: 20 }} />;
      default: return <Person sx={{ fontSize: 20 }} />;
    }
  };

  const getVerificationIcon = (status) => {
    switch (status) {
      case 'verified': return <CheckCircle sx={{ fontSize: 20, color: 'success.main' }} />;
      case 'pending': return <Pending sx={{ fontSize: 20, color: 'warning.main' }} />;
      case 'rejected': return <Error sx={{ fontSize: 20, color: 'error.main' }} />;
      default: return <Pending sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (userId) => {
    setSelectedItems(prev =>
      prev.includes(userId)
        ? prev.filter(id => id !== userId)
        : [...prev, userId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on users:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleSuspendUser = (userId) => {
    console.log(`Suspend user: ${userId}`);
  };

  const handleActivateUser = (userId) => {
    console.log(`Activate user: ${userId}`);
  };

  const handleVerifyUser = (userId) => {
    console.log(`Verify user: ${userId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          User Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<AssignmentInd />} onClick={() => setRoleDialog(true)}>
            Manage Roles
          </Button>
          <Button variant="contained" startIcon={<PersonAdd />} onClick={() => setUserDialog(true)}>
            Add User
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <People sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">1,719</Typography>
              <Typography variant="body2" color="text.secondary">Total Users</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <TrendingUp sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">12.5%</Typography>
              <Typography variant="body2" color="text.secondary">Growth Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Verified sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">89.2%</Typography>
              <Typography variant="body2" color="text.secondary">Verified Users</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Assessment sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">78.5%</Typography>
              <Typography variant="body2" color="text.secondary">Profile Completion</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* User Activity Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            User Activity Overview
          </Typography>
          <Grid container spacing={2}>
            {userActivity.map((activity) => (
              <Grid item xs={12} sm={6} md={3} key={activity.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {activity.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {activity.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={activity.change}
                      color={activity.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Typography variant="caption" color="text.secondary" sx={{ ml: 1 }}>
                      {activity.date_range}
                    </Typography>
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for User Roles */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Users" />
          <Tab label="Admins" />
          <Tab label="Moderators" />
          <Tab label="Premium Users" />
          <Tab label="Regular Users" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search users..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="suspended">Suspended</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="inactive">Inactive</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('suspend')}>
                      Suspend
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('delete')}>
                      Delete
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Users Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredUsers.map(user => user.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>User</TableCell>
                  <TableCell>Role</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Verification</TableCell>
                  <TableCell>Location</TableCell>
                  <TableCell>Joined</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredUsers.map((user) => (
                  <TableRow key={user.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(user.id)}
                        onChange={() => handleItemSelect(user.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                        <Avatar>{user.name.charAt(0)}</Avatar>
                        <Box>
                          <Typography variant="body2" fontWeight="medium">
                            {user.name}
                          </Typography>
                          <Typography variant="caption" color="text.secondary">
                            {user.email}
                          </Typography>
                        </Box>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getRoleIcon(user.role)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {user.role.replace('_', ' ')}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={user.status}
                        color={getStatusColor(user.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getVerificationIcon(user.verification_status)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {user.verification_status}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 0.5 }}>
                        <LocationOn sx={{ fontSize: 16, color: 'text.secondary' }} />
                        <Typography variant="body2">
                          {user.location}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {user.joined_at}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Profile">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Edit User">
                          <IconButton size="small" color="info">
                            <Edit />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="More Actions">
                          <IconButton size="small">
                            <MoreVert />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Add User Dialog */}
      <Dialog open={userDialog} onClose={() => setUserDialog(false)} maxWidth="sm" fullWidth>
        <DialogTitle>Add New User</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create a new user account with specific roles and permissions.
          </Typography>
          {/* Add user form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setUserDialog(false)}>Cancel</Button>
          <Button variant="contained">Create User</Button>
        </DialogActions>
      </Dialog>

      {/* Manage Roles Dialog */}
      <Dialog open={roleDialog} onClose={() => setRoleDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Manage User Roles</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure user roles, permissions, and access levels.
          </Typography>
          {/* Role management interface here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setRoleDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default UserManagementScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Assignment
} from '@mui/icons-material';

const TenderScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus, tenders = [] }) => {
  const [selectedItems, setSelectedItems] = useState([]);

  const filteredTenders = tenders.filter(tender => {
    const matchesSearch = tender.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      tender.category.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || tender.status === filterStatus;
    return matchesSearch && matchesFilter;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'approved': return 'success';
      case 'pending': return 'warning';
      case 'rejected': return 'error';
      default: return 'default';
    }
  };

  const handleItemSelect = (tenderId) => {
    setSelectedItems(prev =>
      prev.includes(tenderId)
        ? prev.filter(id => id !== tenderId)
        : [...prev, tenderId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on tenders:`, selectedItems);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Tender Management
        </Typography>
        <Button variant="contained" startIcon={<Add />}>
          Add New Tender
        </Button>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Assignment sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">89</Typography>
              <Typography variant="body2" color="text.secondary">Total Tenders</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">45</Typography>
              <Typography variant="body2" color="text.secondary">Approved</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Visibility sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">8.2K</Typography>
              <Typography variant="body2" color="text.secondary">Total Views</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Search sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">234</Typography>
              <Typography variant="body2" color="text.secondary">Applications</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search tenders..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="approved">Approved</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="rejected">Rejected</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('approve')}>
                      Approve Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('reject')}>
                      Reject Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Tenders Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredTenders.map(tender => tender.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Title</TableCell>
                  <TableCell>Category</TableCell>
                  <TableCell>Budget</TableCell>
                  <TableCell>Deadline</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Views</TableCell>
                  <TableCell>Applications</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredTenders.map((tender) => (
                  <TableRow key={tender.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(tender.id)}
                        onChange={() => handleItemSelect(tender.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontWeight="medium">
                        {tender.title}
                      </Typography>
                    </TableCell>
                    <TableCell>{tender.category}</TableCell>
                    <TableCell>Birr {tender.budget.toLocaleString()}</TableCell>
                    <TableCell>{tender.deadline}</TableCell>
                    <TableCell>
                      <Chip
                        label={tender.status}
                        color={getStatusColor(tender.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>{tender.views}</TableCell>
                    <TableCell>{tender.applications}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <IconButton size="small" color="primary">
                          <Visibility />
                        </IconButton>
                        <IconButton size="small" color="success">
                          <Edit />
                        </IconButton>
                        <IconButton size="small" color="error">
                          <Delete />
                        </IconButton>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>
    </Box>
  );
};

export default TenderScreen;
import React from 'react';
import {
  Box, Grid, Card, CardContent, Typography, TextField, Button,
  FormControlLabel, Switch, Box as MuiBox
} from '@mui/material';

const SystemSettingsScreen = ({ t }) => {
  return (
    <Box>
      <Grid container spacing={3}>
        <Grid item xs={12} md={8}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('generalSettings')}
              </Typography>
              <MuiBox sx={{ display: 'flex', flexDirection: 'column', gap: 3 }}>
                <MuiBox>
                  <Typography variant="subtitle2" gutterBottom>
                    {t('siteMaintenance')}
                  </Typography>
                  <FormControlLabel
                    control={<Switch defaultChecked />}
                    label={t('siteOnline')}
                  />
                  <MuiBox sx={{ mt: 2 }}>
                    <TextField
                      fullWidth
                      label={t('maintenanceMessage')}
                      multiline
                      rows={2}
                      defaultValue="Site is under maintenance. Please check back later."
                    />
                  </MuiBox>
                </MuiBox>

                <MuiBox>
                  <Typography variant="subtitle2" gutterBottom>
                    {t('userRegistration')}
                  </Typography>
                  <FormControlLabel
                    control={<Switch defaultChecked />}
                    label={t('allowNewRegistrations')}
                  />
                  <FormControlLabel
                    control={<Switch />}
                    label={t('requireEmailVerification')}
                  />
                  <FormControlLabel
                    control={<Switch defaultChecked />}
                    label={t('allowSocialLogin')}
                  />
                </MuiBox>

                <MuiBox>
                  <Typography variant="subtitle2" gutterBottom>
                    {t('listingSettings')}
                  </Typography>
                  <FormControlLabel
                    control={<Switch />}
                    label={t('requireAdminApproval')}
                  />
                  <FormControlLabel
                    control={<Switch defaultChecked />}
                    label={t('allowFeaturedListings')}
                  />
                  <MuiBox sx={{ mt: 2 }}>
                    <TextField
                      fullWidth
                      label={t('maxListingsPerUser')}
                      type="number"
                      defaultValue="10"
                    />
                  </MuiBox>
                </MuiBox>

                <MuiBox>
                  <Typography variant="subtitle2" gutterBottom>
                    {t('siteInformation')}
                  </Typography>
                  <TextField
                    fullWidth
                    label={t('siteName')}
                    defaultValue="YesraSew"
                    sx={{ mb: 2 }}
                  />
                  <TextField
                    fullWidth
                    multiline
                    rows={3}
                    label={t('siteDescription')}
                    defaultValue="Quality Gold Marketplace for Ethiopia"
                  />
                  <TextField
                    fullWidth
                    label={t('contactEmail')}
                    type="email"
                    defaultValue="info@yesrasew.com"
                    sx={{ mt: 2 }}
                  />
                  <TextField
                    fullWidth
                    label={t('phoneNumber')}
                    defaultValue="+251 911 234 567"
                    sx={{ mt: 2 }}
                  />
                </MuiBox>

                <Button variant="contained" color="primary">
                  {t('saveSettings')}
                </Button>
              </MuiBox>
            </CardContent>
          </Card>
        </Grid>

        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('systemInfo')}
              </Typography>
              <MuiBox sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                <MuiBox>
                  <Typography variant="body2" color="text.secondary">
                    {t('serverStatus')}
                  </Typography>
                  <Typography variant="body2" component="span" sx={{ ml: 1 }}>
                    Online
                  </Typography>
                </MuiBox>
                <MuiBox>
                  <Typography variant="body2" color="text.secondary">
                    {t('databaseStatus')}
                  </Typography>
                  <Typography variant="body2" component="span" sx={{ ml: 1 }}>
                    Connected
                  </Typography>
                </MuiBox>
                <MuiBox>
                  <Typography variant="body2" color="text.secondary">
                    {t('lastBackup')}
                  </Typography>
                  <Typography variant="body2" component="span" sx={{ ml: 1 }}>
                    2 hours ago
                  </Typography>
                </MuiBox>
                <MuiBox>
                  <Typography variant="body2" color="text.secondary">
                    {t('storageUsed')}
                  </Typography>
                  <Typography variant="body2" component="span" sx={{ ml: 1 }}>
                    2.3 GB / 10 GB
                  </Typography>
                </MuiBox>
                <MuiBox>
                  <Typography variant="body2" color="text.secondary">
                    {t('systemVersion')}
                  </Typography>
                  <Typography variant="body2" component="span" sx={{ ml: 1 }}>
                    v2.1.0
                  </Typography>
                </MuiBox>
                <MuiBox>
                  <Typography variant="body2" color="text.secondary">
                    {t('uptime')}
                  </Typography>
                  <Typography variant="body2" component="span" sx={{ ml: 1 }}>
                    45 days, 12 hours
                  </Typography>
                </MuiBox>
              </MuiBox>
            </CardContent>
          </Card>

          <Card sx={{ mt: 2 }}>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('performanceSettings')}
              </Typography>
              <MuiBox sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                <FormControlLabel
                  control={<Switch defaultChecked />}
                  label={t('enableCaching')}
                />
                <FormControlLabel
                  control={<Switch defaultChecked />}
                  label={t('enableCompression')}
                />
                <FormControlLabel
                  control={<Switch />}
                  label={t('debugMode')}
                />
                <MuiBox sx={{ mt: 2 }}>
                  <TextField
                    fullWidth
                    label={t('cacheTimeout')}
                    type="number"
                    defaultValue="3600"
                    helperText={t('seconds')}
                  />
                </MuiBox>
              </MuiBox>
            </CardContent>
          </Card>

          <Card sx={{ mt: 2 }}>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('securitySettings')}
              </Typography>
              <MuiBox sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                <FormControlLabel
                  control={<Switch defaultChecked />}
                  label={t('enableTwoFactor')}
                />
                <FormControlLabel
                  control={<Switch defaultChecked />}
                  label={t('forceSSL')}
                />
                <FormControlLabel
                  control={<Switch />}
                  label={t('enableCaptcha')}
                />
                <MuiBox sx={{ mt: 2 }}>
                  <TextField
                    fullWidth
                    label={t('sessionTimeout')}
                    type="number"
                    defaultValue="30"
                    helperText={t('minutes')}
                  />
                </MuiBox>
              </MuiBox>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
};

export default SystemSettingsScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Support, Help, ContactSupport, QuestionAnswer, Chat,
  Phone, Email, Message, Assignment, Assessment,
  FilterList, ExpandMore, Warning, Info,
  Timeline, Schedule, PriorityHigh, Star, TrendingUp,
  Person, PersonAdd, PersonRemove, Block, Lock,
  Security, LocationOn, CalendarToday, MoreVert,
  Verified, Pending, AdminPanelSettings, SupervisorAccount,
  Group, Business, School, Work, AssignmentInd,
  Reply, Forward, Archive, Flag, ThumbUp, ThumbDown,
  Send, AttachFile, OpenInNew
} from '@mui/icons-material';

const SupportScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [ticketDialog, setTicketDialog] = useState(false);
  const [replyDialog, setReplyDialog] = useState(false);

  const supportTickets = [
    {
      id: 1,
      ticket_number: 'SUP-2024-001',
      subject: 'Unable to upload property images',
      description: 'User is experiencing issues uploading images to property listings',
      category: 'technical',
      priority: 'high',
      status: 'open',
      user: {
        name: 'John Doe',
        email: 'john.doe@email.com',
        phone: '+251911234567'
      },
      assigned_to: 'support_agent@yesrasew.com',
      created_at: '2024-01-15 10:30:00',
      updated_at: '2024-01-15 14:45:23',
      due_date: '2024-01-17',
      replies_count: 3,
      satisfaction_rating: null,
      tags: ['bug', 'upload', 'images']
    },
    {
      id: 2,
      ticket_number: 'SUP-2024-002',
      subject: 'Account verification pending',
      description: 'User has submitted documents for verification but status not updated',
      category: 'account',
      priority: 'medium',
      status: 'in_progress',
      user: {
        name: 'Sarah Wilson',
        email: 'sarah.wilson@email.com',
        phone: '+251911234568'
      },
      assigned_to: 'verification_team@yesrasew.com',
      created_at: '2024-01-14 15:20:00',
      updated_at: '2024-01-15 09:15:10',
      due_date: '2024-01-18',
      replies_count: 5,
      satisfaction_rating: null,
      tags: ['verification', 'account', 'documents']
    },
    {
      id: 3,
      ticket_number: 'SUP-2024-003',
      subject: 'Payment processing failed',
      description: 'User unable to complete payment for premium subscription',
      category: 'billing',
      priority: 'high',
      status: 'resolved',
      user: {
        name: 'Mike Johnson',
        email: 'mike.johnson@email.com',
        phone: '+251911234569'
      },
      assigned_to: 'billing_support@yesrasew.com',
      created_at: '2024-01-13 11:45:00',
      updated_at: '2024-01-14 16:30:45',
      due_date: '2024-01-15',
      replies_count: 8,
      satisfaction_rating: 5,
      tags: ['payment', 'billing', 'subscription']
    },
    {
      id: 4,
      ticket_number: 'SUP-2024-004',
      subject: 'Mobile app crash on login',
      description: 'Android app crashes when user tries to login',
      category: 'mobile',
      priority: 'critical',
      status: 'open',
      user: {
        name: 'Emily Brown',
        email: 'emily.brown@email.com',
        phone: '+251911234570'
      },
      assigned_to: 'mobile_team@yesrasew.com',
      created_at: '2024-01-15 08:15:00',
      updated_at: '2024-01-15 12:20:30',
      due_date: '2024-01-16',
      replies_count: 2,
      satisfaction_rating: null,
      tags: ['mobile', 'crash', 'android', 'login']
    },
    {
      id: 5,
      ticket_number: 'SUP-2024-005',
      subject: 'Feature request: Advanced search filters',
      description: 'User requesting more advanced search options for property listings',
      category: 'feature_request',
      priority: 'low',
      status: 'pending',
      user: {
        name: 'David Lee',
        email: 'david.lee@email.com',
        phone: '+251911234571'
      },
      assigned_to: 'product_team@yesrasew.com',
      created_at: '2024-01-12 14:30:00',
      updated_at: '2024-01-12 14:30:00',
      due_date: '2024-01-30',
      replies_count: 1,
      satisfaction_rating: null,
      tags: ['feature', 'search', 'enhancement']
    }
  ];

  const supportAgents = [
    {
      id: 1,
      name: 'Alice Johnson',
      email: 'alice.johnson@yesrasew.com',
      role: 'Senior Support Agent',
      status: 'online',
      tickets_assigned: 12,
      tickets_resolved: 45,
      response_time_avg: '15 min',
      satisfaction_rate: 4.8,
      specialization: ['technical', 'billing']
    },
    {
      id: 2,
      name: 'Bob Smith',
      email: 'bob.smith@yesrasew.com',
      role: 'Support Agent',
      status: 'busy',
      tickets_assigned: 8,
      tickets_resolved: 32,
      response_time_avg: '22 min',
      satisfaction_rate: 4.6,
      specialization: ['account', 'verification']
    },
    {
      id: 3,
      name: 'Carol Davis',
      email: 'carol.davis@yesrasew.com',
      role: 'Support Agent',
      status: 'offline',
      tickets_assigned: 5,
      tickets_resolved: 28,
      response_time_avg: '18 min',
      satisfaction_rate: 4.7,
      specialization: ['mobile', 'general']
    }
  ];

  const supportMetrics = [
    {
      id: 1,
      metric: 'Open Tickets',
      value: 23,
      change: '+5',
      trend: 'up',
      status: 'warning'
    },
    {
      id: 2,
      metric: 'Avg Response Time',
      value: '18 min',
      change: '-3 min',
      trend: 'down',
      status: 'good'
    },
    {
      id: 3,
      metric: 'Satisfaction Rate',
      value: '4.7/5',
      change: '+0.2',
      trend: 'up',
      status: 'good'
    },
    {
      id: 4,
      metric: 'Tickets Resolved Today',
      value: 15,
      change: '+3',
      trend: 'up',
      status: 'good'
    }
  ];

  const knowledgeBase = [
    {
      id: 1,
      title: 'How to upload property photos',
      category: 'user_guide',
      views: 1234,
      helpful_count: 89,
      last_updated: '2024-01-10',
      status: 'published'
    },
    {
      id: 2,
      title: 'Account verification process',
      category: 'account',
      views: 856,
      helpful_count: 67,
      last_updated: '2024-01-08',
      status: 'published'
    },
    {
      id: 3,
      title: 'Payment methods and billing',
      category: 'billing',
      views: 678,
      helpful_count: 45,
      last_updated: '2024-01-05',
      status: 'published'
    },
    {
      id: 4,
      title: 'Mobile app installation guide',
      category: 'mobile',
      views: 432,
      helpful_count: 34,
    }
  ];

  const filteredTickets = supportTickets.filter(ticket => {
    const matchesSearch = ticket.subject.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      ticket.ticket_number.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || ticket.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && ticket.priority === 'critical') ||
      (activeTab === 2 && ticket.priority === 'high') ||
      (activeTab === 3 && ticket.status === 'open');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'open': return 'error';
      case 'in_progress': return 'warning';
      case 'resolved': return 'success';
      case 'closed': return 'default';
      case 'pending': return 'info';
      default: return 'default';
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'critical': return 'error';
      case 'high': return 'warning';
      case 'medium': return 'info';
      case 'low': return 'success';
      default: return 'default';
    }
  };

  const getCategoryIcon = (category) => {
    switch (category) {
      case 'technical': return <Help sx={{ fontSize: 20 }} />;
      case 'account': return <Person sx={{ fontSize: 20 }} />;
      case 'billing': return <Assignment sx={{ fontSize: 20 }} />;
      case 'mobile': return <Phone sx={{ fontSize: 20 }} />;
      case 'feature_request': return <Star sx={{ fontSize: 20 }} />;
      default: return <Support sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (ticketId) => {
    setSelectedItems(prev =>
      prev.includes(ticketId)
        ? prev.filter(id => id !== ticketId)
        : [...prev, ticketId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on tickets:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleAssignTicket = (ticketId, agent) => {
    console.log(`Assign ticket ${ticketId} to ${agent}`);
  };

  const handleReplyTicket = (ticketId) => {
    console.log(`Reply to ticket: ${ticketId}`);
    setReplyDialog(true);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Support Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Chat />} onClick={() => setReplyDialog(true)}>
            Quick Reply
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setTicketDialog(true)}>
            Create Ticket
          </Button>
        </Box>
      </Box>

      {/* Critical Alert */}
      {supportTickets.filter(ticket => ticket.priority === 'critical' && ticket.status === 'open').length > 0 && (
        <Alert severity="error" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{supportTickets.filter(ticket => ticket.priority === 'critical' && ticket.status === 'open').length} critical tickets</strong> require immediate attention!
          </Typography>
        </Alert>
      )}

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Support sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">23</Typography>
              <Typography variant="body2" color="text.secondary">Open Tickets</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Schedule sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">18 min</Typography>
              <Typography variant="body2" color="text.secondary">Avg Response Time</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Star sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">4.7/5</Typography>
              <Typography variant="body2" color="text.secondary">Satisfaction Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">15</Typography>
              <Typography variant="body2" color="text.secondary">Resolved Today</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Support Metrics Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Support Metrics
          </Typography>
          <Grid container spacing={2}>
            {supportMetrics.map((metric) => (
              <Grid item xs={12} sm={6} md={3} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={metric.change}
                      color={metric.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Chip
                      label={metric.status}
                      color={metric.status === 'good' ? 'success' : 'warning'}
                      size="small"
                      sx={{ ml: 1 }}
                    />
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Ticket Priority */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Tickets" />
          <Tab label="Critical" />
          <Tab label="High Priority" />
          <Tab label="Open" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search tickets..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="open">Open</MenuItem>
                  <MenuItem value="in_progress">In Progress</MenuItem>
                  <MenuItem value="resolved">Resolved</MenuItem>
                  <MenuItem value="closed">Closed</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('assign')}>
                      Assign Selected
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('escalate')}>
                      Escalate Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('close')}>
                      Close Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Support Tickets Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredTickets.map(ticket => ticket.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Ticket</TableCell>
                  <TableCell>User</TableCell>
                  <TableCell>Category</TableCell>
                  <TableCell>Priority</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Assigned To</TableCell>
                  <TableCell>Created</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredTickets.map((ticket) => (
                  <TableRow key={ticket.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(ticket.id)}
                        onChange={() => handleItemSelect(ticket.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {ticket.ticket_number}
                        </Typography>
                        <Typography variant="body2" sx={{ maxWidth: 200, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                          {ticket.subject}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {ticket.replies_count} replies
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          {ticket.user.name}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {ticket.user.email}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getCategoryIcon(ticket.category)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {ticket.category.replace('_', ' ')}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={ticket.priority}
                        color={getPriorityColor(ticket.priority)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={ticket.status.replace('_', ' ')}
                        color={getStatusColor(ticket.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {ticket.assigned_to.split('@')[0]}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          {ticket.created_at.split(' ')[0]}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          Due: {ticket.due_date}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Reply">
                          <IconButton size="small" color="info" onClick={() => handleReplyTicket(ticket.id)}>
                            <Reply />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Assign">
                          <IconButton size="small" color="success" onClick={() => handleAssignTicket(ticket.id)}>
                            <PersonAdd />
                          </IconButton>
                        </Tooltip>
                        {ticket.satisfaction_rating && (
                          <Tooltip title={`Satisfaction: ${ticket.satisfaction_rating}/5`}>
                            <IconButton size="small" color="warning">
                              <Star />
                            </IconButton>
                          </Tooltip>
                        )}
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Support Agents Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Support Agents
          </Typography>
          <Grid container spacing={2}>
            {supportAgents.map((agent) => (
              <Grid item xs={12} md={4} key={agent.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    <Avatar sx={{ bgcolor: '#2196F3', mr: 1 }}>
                      {agent.name.split(' ').map(n => n[0]).join('')}
                    </Avatar>
                    <Box>
                      <Typography variant="h6" fontWeight="bold">
                        {agent.name}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        {agent.role}
                      </Typography>
                    </Box>
                  </Box>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    <Chip
                      label={agent.status}
                      color={agent.status === 'online' ? 'success' : agent.status === 'busy' ? 'warning' : 'default'}
                      size="small"
                    />
                    <Typography variant="caption" color="text.secondary" sx={{ ml: 1 }}>
                      {agent.tickets_assigned} assigned
                    </Typography>
                  </Box>
                  <Typography variant="body2">
                    Response: {agent.response_time_avg}  Rating: {agent.satisfaction_rate}/5
                  </Typography>
                  <Box sx={{ mt: 1 }}>
                    {agent.specialization.map((spec, index) => (
                      <Chip key={index} label={spec} size="small" sx={{ mr: 0.5 }} />
                    ))}
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Knowledge Base Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Knowledge Base
          </Typography>
          <List>
            {knowledgeBase.map((article) => (
              <ListItem key={article.id} divider>
                <ListItemIcon>
                  <Help sx={{ color: '#2196F3' }} />
                </ListItemIcon>
                <ListItemText
                  primary={article.title}
                  secondary={`${article.views} views  ${article.helpful_count} helpful  Updated: ${article.last_updated}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={article.status}
                      color={article.status === 'published' ? 'success' : 'warning'}
                      size="small"
                    />
                    <Tooltip title="View Article">
                      <IconButton size="small" color="primary">
                        <OpenInNew />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Create Ticket Dialog */}
      <Dialog open={ticketDialog} onClose={() => setTicketDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Create Support Ticket</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create a new support ticket and assign it to the appropriate team.
          </Typography>
          {/* Create ticket form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setTicketDialog(false)}>Cancel</Button>
          <Button variant="contained">Create Ticket</Button>
        </DialogActions>
      </Dialog>

      {/* Reply Dialog */}
      <Dialog open={replyDialog} onClose={() => setReplyDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Reply to Ticket</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Compose and send a reply to the selected support ticket.
          </Typography>
          {/* Reply form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setReplyDialog(false)}>Cancel</Button>
          <Button variant="contained" startIcon={<Send />}>Send Reply</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default SupportScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Security, Shield, Lock, Key, Password, Warning, Error,
  Block, Person, Devices, Router, Wifi, Email, Phone,
  Timeline, Assessment, FilterList, ExpandMore,
  Verified, Pending, Info, Schedule, History,
  Fingerprint, Face, SecurityUpdate, GppGood, GppBad,
  AdminPanelSettings, Privacy, Cookie, DataObject, LockOpen
} from '@mui/icons-material';

const SecurityScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [policyDialog, setPolicyDialog] = useState(false);
  const [threatDialog, setThreatDialog] = useState(false);

  const securityEvents = [
    {
      id: 1,
      type: 'login_attempt',
      severity: 'medium',
      user: 'john.doe@email.com',
      ip_address: '192.168.1.100',
      location: 'Addis Ababa, Ethiopia',
      device: 'Chrome on Windows',
      status: 'failed',
      description: 'Failed login attempt - incorrect password',
      timestamp: '2024-01-15 14:30:25',
      action_taken: 'none'
    },
    {
      id: 2,
      type: 'password_change',
      severity: 'low',
      user: 'sarah.wilson@email.com',
      ip_address: '192.168.1.101',
      location: 'Bahir Dar, Ethiopia',
      device: 'Safari on iPhone',
      status: 'success',
      description: 'Password changed successfully',
      timestamp: '2024-01-15 12:15:10',
      action_taken: 'verified'
    },
    {
      id: 3,
      type: 'suspicious_activity',
      severity: 'high',
      user: 'unknown',
      ip_address: '45.123.45.67',
      location: 'Unknown',
      device: 'Unknown',
      status: 'blocked',
      description: 'Multiple failed login attempts from unusual location',
      timestamp: '2024-01-15 10:45:33',
      action_taken: 'ip_blocked'
    },
    {
      id: 4,
      type: 'account_locked',
      severity: 'high',
      user: 'mike.johnson@email.com',
      ip_address: '192.168.1.102',
      location: 'Hawassa, Ethiopia',
      device: 'Firefox on Android',
      status: 'resolved',
      description: 'Account automatically locked after multiple failed attempts',
      timestamp: '2024-01-14 18:20:15',
      action_taken: 'account_unlocked'
    },
    {
      id: 5,
      type: 'data_access',
      severity: 'medium',
      user: 'admin@yesrasew.com',
      ip_address: '192.168.1.10',
      location: 'Addis Ababa, Ethiopia',
      device: 'Chrome on macOS',
      status: 'success',
      description: 'Admin accessed sensitive user data',
      timestamp: '2024-01-14 15:30:45',
      action_taken: 'logged'
    }
  ];

  const securityPolicies = [
    {
      id: 1,
      name: 'Password Policy',
      category: 'authentication',
      status: 'active',
      description: 'Minimum 8 characters, uppercase, lowercase, numbers, special chars',
      enforcement_level: 'strict',
      last_updated: '2024-01-10',
      compliance_rate: 94.5,
      violations: 23
    },
    {
      id: 2,
      name: 'Two-Factor Authentication',
      category: 'authentication',
      status: 'active',
      description: '2FA required for admin and premium users',
      enforcement_level: 'moderate',
      last_updated: '2024-01-08',
      compliance_rate: 78.2,
      violations: 45
    },
    {
      id: 3,
      name: 'Session Timeout',
      category: 'session',
      status: 'active',
      description: 'Automatic logout after 30 minutes of inactivity',
      enforcement_level: 'strict',
      last_updated: '2024-01-05',
      compliance_rate: 100.0,
      violations: 0
    },
    {
      id: 4,
      name: 'IP Whitelisting',
      category: 'network',
      status: 'partial',
      description: 'Whitelist allowed IP addresses for admin access',
      enforcement_level: 'moderate',
      last_updated: '2024-01-03',
      compliance_rate: 67.8,
      violations: 12
    },
    {
      id: 5,
      name: 'Data Encryption',
      category: 'data',
      status: 'active',
      description: 'All sensitive data encrypted at rest and in transit',
      enforcement_level: 'strict',
      last_updated: '2024-01-01',
      compliance_rate: 100.0,
      violations: 0
    }
  ];

  const securityMetrics = [
    {
      id: 1,
      metric: 'Security Score',
      value: '87.5%',
      change: '+2.3%',
      trend: 'up',
      status: 'good'
    },
    {
      id: 2,
      metric: 'Failed Login Attempts',
      value: 156,
      change: '-12.5%',
      trend: 'down',
      status: 'good'
    },
    {
      id: 3,
      metric: 'Blocked IPs',
      value: 23,
      change: '+5',
      trend: 'up',
      status: 'warning'
    },
    {
      id: 4,
      metric: 'Security Incidents',
      value: 8,
      change: '-3',
      trend: 'down',
      status: 'good'
    }
  ];

  const activeThreats = [
    {
      id: 1,
      type: 'brute_force_attack',
      severity: 'high',
      source_ip: '45.123.45.67',
      target: 'login_endpoint',
      status: 'active',
      started_at: '2024-01-15 10:30',
      attempts: 234,
      blocked: true,
      description: 'Brute force attack on login endpoint'
    },
    {
      id: 2,
      type: 'sql_injection',
      severity: 'critical',
      source_ip: '78.90.123.45',
      target: 'api_endpoint',
      status: 'mitigated',
      started_at: '2024-01-14 15:45',
      attempts: 12,
      blocked: true,
      description: 'SQL injection attempt blocked by WAF'
    },
    {
      id: 3,
      type: 'ddos_attack',
      severity: 'medium',
      source_ip: 'multiple',
      target: 'web_server',
      status: 'active',
      started_at: '2024-01-13 09:15',
      attempts: 5678,
      blocked: true,
      description: 'DDoS attack attempt blocked by firewall'
    }
  ];

  const filteredEvents = securityEvents.filter(event => {
    const matchesSearch = event.type.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      event.description.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || event.severity === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && event.severity === 'high') ||
      (activeTab === 2 && event.severity === 'medium') ||
      (activeTab === 3 && event.severity === 'low');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getSeverityColor = (severity) => {
    switch (severity) {
      case 'critical': return 'error';
      case 'high': return 'error';
      case 'medium': return 'warning';
      case 'low': return 'success';
      case 'info': return 'info';
      default: return 'default';
    }
  };

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'blocked': return 'error';
      case 'failed': return 'error';
      case 'success': return 'success';
      case 'resolved': return 'success';
      case 'partial': return 'warning';
      default: return 'default';
    }
  };

  const getEventIcon = (type) => {
    switch (type) {
      case 'login_attempt': return <Person sx={{ fontSize: 20 }} />;
      case 'password_change': return <Password sx={{ fontSize: 20 }} />;
      case 'suspicious_activity': return <Warning sx={{ fontSize: 20 }} />;
      case 'account_locked': return <Lock sx={{ fontSize: 20 }} />;
      case 'data_access': return <DataObject sx={{ fontSize: 20 }} />;
      default: return <Security sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (eventId) => {
    setSelectedItems(prev =>
      prev.includes(eventId)
        ? prev.filter(id => id !== eventId)
        : [...prev, eventId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on events:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleBlockIP = (ipAddress) => {
    console.log(`Block IP: ${ipAddress}`);
  };

  const handleUnlockAccount = (userId) => {
    console.log(`Unlock account: ${userId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Security Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Shield />} onClick={() => setPolicyDialog(true)}>
            Security Policies
          </Button>
          <Button variant="contained" startIcon={<SecurityUpdate />} onClick={() => setThreatDialog(true)}>
            Threat Detection
          </Button>
        </Box>
      </Box>

      {/* Security Alert */}
      {activeThreats.filter(threat => threat.severity === 'critical').length > 0 && (
        <Alert severity="error" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{activeThreats.filter(threat => threat.severity === 'critical').length} critical threats</strong> detected! Immediate action required.
          </Typography>
        </Alert>
      )}

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Security sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">87.5%</Typography>
              <Typography variant="body2" color="text.secondary">Security Score</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Error sx={{ fontSize: 40, color: '#F44336', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">8</Typography>
              <Typography variant="body2" color="text.secondary">Security Incidents</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Block sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">23</Typography>
              <Typography variant="body2" color="text.secondary">Blocked IPs</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <GppGood sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">156</Typography>
              <Typography variant="body2" color="text.secondary">Failed Attempts</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Security Metrics Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Security Metrics
          </Typography>
          <Grid container spacing={2}>
            {securityMetrics.map((metric) => (
              <Grid item xs={12} sm={6} md={3} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={metric.change}
                      color={metric.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Chip
                      label={metric.status}
                      color={metric.status === 'good' ? 'success' : 'warning'}
                      size="small"
                      sx={{ ml: 1 }}
                    />
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Active Threats Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Active Threats
          </Typography>
          <List>
            {activeThreats.map((threat) => (
              <ListItem key={threat.id} divider>
                <ListItemIcon>
                  {threat.severity === 'critical' ? (
                    <Error sx={{ color: 'error.main' }} />
                  ) : threat.severity === 'high' ? (
                    <Warning sx={{ color: 'warning.main' }} />
                  ) : (
                    <Info sx={{ color: 'info.main' }} />
                  )}
                </ListItemIcon>
                <ListItemText
                  primary={threat.type.replace('_', ' ').toUpperCase()}
                  secondary={`${threat.description}  Source: ${threat.source_ip}  Attempts: ${threat.attempts}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={threat.severity}
                      color={getSeverityColor(threat.severity)}
                      size="small"
                    />
                    <Chip
                      label={threat.status}
                      color={getStatusColor(threat.status)}
                      size="small"
                    />
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Tabs for Event Severity */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Events" />
          <Tab label="High Severity" />
          <Tab label="Medium Severity" />
          <Tab label="Low Severity" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search security events..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Severity</InputLabel>
                <Select
                  value={filterStatus}
                  label="Severity"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Severity</MenuItem>
                  <MenuItem value="critical">Critical</MenuItem>
                  <MenuItem value="high">High</MenuItem>
                  <MenuItem value="medium">Medium</MenuItem>
                  <MenuItem value="low">Low</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('resolve')}>
                      Mark Resolved
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('investigate')}>
                      Investigate
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Security Events Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredEvents.map(event => event.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Event</TableCell>
                  <TableCell>User</TableCell>
                  <TableCell>Location</TableCell>
                  <TableCell>Severity</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Timestamp</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredEvents.map((event) => (
                  <TableRow key={event.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(event.id)}
                        onChange={() => handleItemSelect(event.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getEventIcon(event.type)}
                        <Box>
                          <Typography variant="body2" fontWeight="medium">
                            {event.type.replace('_', ' ').toUpperCase()}
                          </Typography>
                          <Typography variant="caption" color="text.secondary">
                            {event.description}
                          </Typography>
                        </Box>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {event.user}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        {event.ip_address}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {event.location}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        {event.device}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={event.severity}
                        color={getSeverityColor(event.severity)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={event.status}
                        color={getStatusColor(event.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {event.timestamp}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        {event.type === 'suspicious_activity' && (
                          <Tooltip title="Block IP">
                            <IconButton size="small" color="error" onClick={() => handleBlockIP(event.ip_address)}>
                              <Block />
                            </IconButton>
                          </Tooltip>
                        )}
                        {event.type === 'account_locked' && (
                          <Tooltip title="Unlock Account">
                            <IconButton size="small" color="success" onClick={() => handleUnlockAccount(event.user)}>
                              <LockOpen />
                            </IconButton>
                          </Tooltip>
                        )}
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Security Policies Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Security Policies
          </Typography>
          <List>
            {securityPolicies.map((policy) => (
              <ListItem key={policy.id} divider>
                <ListItemIcon>
                  {policy.status === 'active' ? (
                    <CheckCircle sx={{ color: 'success.main' }} />
                  ) : (
                    <Pending sx={{ color: 'warning.main' }} />
                  )}
                </ListItemIcon>
                <ListItemText
                  primary={policy.name}
                  secondary={`${policy.description}  Compliance: ${policy.compliance_rate}%  Violations: ${policy.violations}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={policy.enforcement_level}
                      color={policy.enforcement_level === 'strict' ? 'error' : 'warning'}
                      size="small"
                    />
                    <Chip
                      label={policy.status}
                      color={getStatusColor(policy.status)}
                      size="small"
                    />
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Security Policies Dialog */}
      <Dialog open={policyDialog} onClose={() => setPolicyDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Security Policies Management</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure and manage security policies and enforcement levels.
          </Typography>
          {/* Security policies management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setPolicyDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>

      {/* Threat Detection Dialog */}
      <Dialog open={threatDialog} onClose={() => setThreatDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Threat Detection & Response</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Monitor and respond to security threats in real-time.
          </Typography>
          {/* Threat detection configuration here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setThreatDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default SecurityScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails, DatePicker, LoadingButton
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Assessment, BarChart, PieChart, Timeline, TrendingUp,
  Download, FileDownload, Print, Share, Email, Schedule,
  FilterList, DateRange, CalendarToday, ExpandMore,
  Description, Summarize, Analytics, Report, DataUsage,
  People, AttachMoney, ShoppingCart, LocalOffer, Star,
  Warning, Info, Error, CheckCircleOutline, ArrowUpward,
  ArrowDownward, Remove, MoreVert, Settings, PlayArrow
} from '@mui/icons-material';

const ReportsScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [reportDialog, setReportDialog] = useState(false);
  const [scheduleDialog, setScheduleDialog] = useState(false);

  const predefinedReports = [
    {
      id: 1,
      name: 'Monthly Performance Report',
      type: 'performance',
      category: 'business',
      description: 'Comprehensive overview of platform performance metrics',
      frequency: 'monthly',
      last_generated: '2024-01-15',
      next_scheduled: '2024-02-15',
      format: 'pdf',
      size_kb: 1250,
      status: 'active',
      recipients: ['admin@yesrasew.com', 'manager@yesrasew.com'],
      metrics: ['user_growth', 'revenue', 'engagement', 'listings']
    },
    {
      id: 2,
      name: 'User Activity Analysis',
      type: 'analytics',
      category: 'users',
      description: 'Detailed user behavior and engagement patterns',
      frequency: 'weekly',
      last_generated: '2024-01-14',
      next_scheduled: '2024-01-21',
      format: 'excel',
      size_kb: 890,
      status: 'active',
      recipients: ['analytics@yesrasew.com'],
      metrics: ['daily_active_users', 'session_duration', 'page_views', 'conversion_rate']
    },
    {
      id: 3,
      name: 'Financial Summary',
      type: 'financial',
      category: 'business',
      description: 'Revenue, expenses, and financial performance indicators',
      frequency: 'monthly',
      last_generated: '2024-01-10',
      next_scheduled: '2024-02-10',
      format: 'pdf',
      size_kb: 450,
      status: 'active',
      recipients: ['finance@yesrasew.com', 'ceo@yesrasew.com'],
      metrics: ['revenue', 'costs', 'profit_margin', 'growth_rate']
    },
    {
      id: 4,
      name: 'Content Moderation Report',
      type: 'moderation',
      category: 'safety',
      description: 'Content moderation activities and policy violations',
      frequency: 'daily',
      last_generated: '2024-01-15',
      next_scheduled: '2024-01-16',
      format: 'csv',
      size_kb: 234,
      status: 'active',
      recipients: ['moderation@yesrasew.com'],
      metrics: ['reports_processed', 'actions_taken', 'response_time', 'escalations']
    },
    {
      id: 5,
      name: 'System Health Check',
      type: 'technical',
      category: 'infrastructure',
      description: 'System performance, uptime, and resource utilization',
      frequency: 'daily',
      last_generated: '2024-01-15',
      next_scheduled: '2024-01-16',
      format: 'json',
      size_kb: 567,
      status: 'active',
      recipients: ['devops@yesrasew.com'],
      metrics: ['uptime', 'response_time', 'error_rate', 'resource_usage']
    }
  ];

  const customReports = [
    {
      id: 1,
      name: 'Q4 2023 Sales Analysis',
      type: 'custom',
      category: 'business',
      description: 'Custom sales analysis for Q4 2023',
      created_by: 'john.doe',
      created_at: '2024-01-05',
      last_modified: '2024-01-12',
      format: 'excel',
      size_kb: 2340,
      status: 'completed',
      parameters: {
        date_range: '2023-10-01 to 2023-12-31',
        categories: ['homes', 'cars', 'jobs'],
        include_charts: true
      }
    },
    {
      id: 2,
      name: 'User Retention Study',
      type: 'custom',
      category: 'users',
      description: 'Analysis of user retention and churn patterns',
      created_by: 'sarah.wilson',
      created_at: '2024-01-08',
      last_modified: '2024-01-14',
      format: 'pdf',
      size_kb: 1876,
      status: 'in_progress',
      parameters: {
        cohort_analysis: true,
        date_range: '2023-01-01 to 2023-12-31',
        user_segments: ['new', 'returning', 'premium']
      }
    }
  ];

  const scheduledReports = [
    {
      id: 1,
      report_name: 'Monthly Performance Report',
      schedule: 'cron',
      schedule_expression: '0 9 15 * *',
      next_run: '2024-02-15 09:00',
      last_run: '2024-01-15 09:00',
      status: 'active',
      enabled: true,
      recipients: ['admin@yesrasew.com', 'manager@yesrasew.com'],
      delivery_method: 'email'
    },
    {
      id: 2,
      report_name: 'Daily System Health',
      schedule: 'cron',
      schedule_expression: '0 8 * * *',
      next_run: '2024-01-16 08:00',
      last_run: '2024-01-15 08:00',
      status: 'active',
      enabled: true,
      recipients: ['devops@yesrasew.com'],
      delivery_method: 'email'
    },
    {
      id: 3,
      report_name: 'Weekly User Analytics',
      schedule: 'cron',
      schedule_expression: '0 10 * * 1',
      next_run: '2024-01-22 10:00',
      last_run: '2024-01-15 10:00',
      status: 'paused',
      enabled: false,
      recipients: ['analytics@yesrasew.com'],
      delivery_method: 'email'
    }
  ];

  const reportTemplates = [
    {
      id: 1,
      name: 'Business Performance Dashboard',
      description: 'Comprehensive business metrics and KPIs',
      category: 'business',
      metrics: ['revenue', 'users', 'engagement', 'conversion'],
      visualizations: ['line_chart', 'bar_chart', 'pie_chart'],
      usage_count: 45
    },
    {
      id: 2,
      name: 'User Behavior Analysis',
      description: 'User activity and engagement patterns',
      category: 'users',
      metrics: ['active_users', 'session_duration', 'page_views', 'retention'],
      visualizations: ['heatmap', 'funnel_chart', 'cohort_analysis'],
      usage_count: 32
    },
    {
      id: 3,
      name: 'Financial Summary',
      description: 'Revenue, costs, and profitability metrics',
      category: 'financial',
      metrics: ['revenue', 'expenses', 'profit', 'growth_rate'],
    }
  ];

  const filteredReports = predefinedReports.filter(report => {
    const matchesSearch = report.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      report.description.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || report.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && report.category === 'business') ||
      (activeTab === 2 && report.category === 'users') ||
      (activeTab === 3 && report.category === 'technical') ||
      (activeTab === 4 && report.category === 'safety');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'completed': return 'success';
      case 'in_progress': return 'warning';
      case 'paused': return 'warning';
      case 'failed': return 'error';
      case 'disabled': return 'default';
      default: return 'default';
    }
  };

  const getTypeIcon = (type) => {
    switch (type) {
      case 'performance': return <TrendingUp sx={{ fontSize: 20 }} />;
      case 'analytics': return <Analytics sx={{ fontSize: 20 }} />;
      case 'financial': return <AttachMoney sx={{ fontSize: 20 }} />;
      case 'moderation': return <Warning sx={{ fontSize: 20 }} />;
      case 'technical': return <DataUsage sx={{ fontSize: 20 }} />;
      case 'custom': return <Description sx={{ fontSize: 20 }} />;
      default: return <Assessment sx={{ fontSize: 20 }} />;
    }
  };

  const getFrequencyIcon = (frequency) => {
    switch (frequency) {
      case 'daily': return <CalendarToday sx={{ fontSize: 20 }} />;
      case 'weekly': return <DateRange sx={{ fontSize: 20 }} />;
      case 'monthly': return <CalendarToday sx={{ fontSize: 20 }} />;
      default: return <Schedule sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (reportId) => {
    setSelectedItems(prev =>
      prev.includes(reportId)
        ? prev.filter(id => id !== reportId)
        : [...prev, reportId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on reports:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleGenerateReport = (reportId) => {
    console.log(`Generate report: ${reportId}`);
  };

  const handleDownloadReport = (reportId) => {
    console.log(`Download report: ${reportId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Reports & Analytics
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Schedule />} onClick={() => setScheduleDialog(true)}>
            Manage Schedules
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setReportDialog(true)}>
            Create Report
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Assessment sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">7</Typography>
              <Typography variant="body2" color="text.secondary">Active Reports</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <FileDownload sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">156</Typography>
              <Typography variant="body2" color="text.secondary">Reports Generated</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Schedule sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">3</Typography>
              <Typography variant="body2" color="text.secondary">Scheduled Reports</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Description sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">3</Typography>
              <Typography variant="body2" color="text.secondary">Report Templates</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Tabs for Report Categories */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Reports" />
          <Tab label="Business" />
          <Tab label="Users" />
          <Tab label="Technical" />
          <Tab label="Safety" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search reports..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="completed">Completed</MenuItem>
                  <MenuItem value="in_progress">In Progress</MenuItem>
                  <MenuItem value="failed">Failed</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('generate')}>
                      Generate Selected
                    </Button>
                    <Button variant="contained" color="info" onClick={() => handleBulkAction('download')}>
                      Download Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Reports Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredReports.map(report => report.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Report Name</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Frequency</TableCell>
                  <TableCell>Last Generated</TableCell>
                  <TableCell>Next Scheduled</TableCell>
                  <TableCell>Format</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredReports.map((report) => (
                  <TableRow key={report.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(report.id)}
                        onChange={() => handleItemSelect(report.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {report.name}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {report.description}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getTypeIcon(report.type)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {report.type}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getFrequencyIcon(report.frequency)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {report.frequency}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>{report.last_generated}</TableCell>
                    <TableCell>{report.next_scheduled}</TableCell>
                    <TableCell>
                      <Chip
                        label={report.format.toUpperCase()}
                        color="primary"
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={report.status}
                        color={getStatusColor(report.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="Generate Now">
                          <IconButton size="small" color="success" onClick={() => handleGenerateReport(report.id)}>
                            <PlayArrow />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Download">
                          <IconButton size="small" color="info" onClick={() => handleDownloadReport(report.id)}>
                            <Download />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Edit">
                          <IconButton size="small" color="warning">
                            <Edit />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Custom Reports Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Custom Reports
          </Typography>
          <List>
            {customReports.map((report) => (
              <ListItem key={report.id} divider>
                <ListItemIcon>
                  {getTypeIcon(report.type)}
                </ListItemIcon>
                <ListItemText
                  primary={report.name}
                  secondary={`Created by ${report.created_by}  ${report.created_at}  ${report.description}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={report.status.replace('_', ' ')}
                      color={getStatusColor(report.status)}
                      size="small"
                    />
                    <Tooltip title="Download">
                      <IconButton size="small" color="info">
                        <Download />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Scheduled Reports Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Scheduled Reports
          </Typography>
          <List>
            {scheduledReports.map((schedule) => (
              <ListItem key={schedule.id} divider>
                <ListItemIcon>
                  <Schedule />
                </ListItemIcon>
                <ListItemText
                  primary={schedule.report_name}
                  secondary={`Next: ${schedule.next_run}  Last: ${schedule.last_run}  ${schedule.delivery_method}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={schedule.status}
                      color={getStatusColor(schedule.status)}
                      size="small"
                    />
                    <Switch
                      checked={schedule.enabled}
                      size="small"
                    />
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Report Templates Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Report Templates
          </Typography>
          <Grid container spacing={2}>
            {reportTemplates.map((template) => (
              <Grid item xs={12} md={4} key={template.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    <Assessment sx={{ mr: 1, color: '#2196F3' }} />
                    <Typography variant="h6" fontWeight="bold">
                      {template.name}
                    </Typography>
                  </Box>
                  <Typography variant="body2" color="text.secondary" gutterBottom>
                    {template.description}
                  </Typography>
                  <Box sx={{ mb: 1 }}>
                    <Typography variant="caption" color="text.secondary">
                      {template.metrics.length} metrics  {template.visualizations.length} visualizations
                    </Typography>
                  </Box>
                  <Typography variant="caption" color="text.secondary">
                    Used {template.usage_count} times
                  </Typography>
                  <Box sx={{ mt: 1 }}>
                    <Button variant="outlined" size="small" fullWidth>
                      Use Template
                    </Button>
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Create Report Dialog */}
      <Dialog open={reportDialog} onClose={() => setReportDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Create New Report</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create a custom report with specific metrics and visualizations.
          </Typography>
          {/* Create report form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setReportDialog(false)}>Cancel</Button>
          <Button variant="contained">Create Report</Button>
        </DialogActions>
      </Dialog>

      {/* Manage Schedules Dialog */}
      <Dialog open={scheduleDialog} onClose={() => setScheduleDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Manage Report Schedules</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure automated report generation and delivery schedules.
          </Typography>
          {/* Schedule management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setScheduleDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default ReportsScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  Checkbox,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Notifications, Email, Sms, Phone, Message,
  Send, Schedule, DateRange, CalendarToday, FilterList,
  ExpandMore, Warning, Error, Info, PriorityHigh,
  People, Person, Group, Business, School, Work,
  Settings, MoreVert, Campaign, MarkEmailRead, MarkEmailUnread,
  VolumeUp, VolumeOff, VolumeDown, Push, MailOutline
} from '@mui/icons-material';

const NotificationScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [notificationDialog, setNotificationDialog] = useState(false);
  const [templateDialog, setTemplateDialog] = useState(false);

  const notifications = [
    {
      id: 1,
      title: 'Welcome to Yesra Sew!',
      message: 'Thank you for joining our platform. Start exploring amazing properties today.',
      type: 'email',
      category: 'welcome',
      priority: 'medium',
      status: 'sent',
      recipients: 1234,
      sent_at: '2024-01-15 14:30:00',
      scheduled_at: '2024-01-15 14:30:00',
      created_by: 'system@yesrasew.com',
      template_id: 1,
      open_rate: 45.6,
      click_rate: 12.3,
      bounce_rate: 2.1
    }
  ];

  const channels = [
    {
      id: 1,
      name: 'Email',
      type: 'email',
      status: 'active',
      provider: 'SendGrid',
      daily_limit: 10000,
      daily_sent: 5678,
      success_rate: 98.5,
      avg_delivery_time: '2.3s',
      cost_per_message: 0.01
    }
  ];

  const notificationMetrics = [
    {
      id: 1,
      metric: 'Total Sent Today',
      value: 45678,
      change: '+12.5%',
      trend: 'up',
      status: 'good'
    }
  ];

  const userPreferences = [
    {
      id: 1,
      user_segment: 'All Users',
      email_notifications: true,
      push_notifications: true,
      sms_notifications: false,
      marketing_emails: false,
      listing_updates: true,
      payment_reminders: true,
      system_updates: true,
      user_count: 15678
    }
  ];

  const filteredNotifications = notifications.filter(notification => {
    const matchesSearch = notification.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      notification.message.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || notification.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && notification.type === 'email') ||
      (activeTab === 2 && notification.type === 'push') ||
      (activeTab === 3 && notification.type === 'sms');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'sent': return 'success';
      case 'delivered': return 'success';
      case 'pending': return 'warning';
      case 'scheduled': return 'info';
      case 'failed': return 'error';
      case 'cancelled': return 'default';
      default: return 'default';
    }
  };

  const getTypeIcon = (type) => {
    switch (type) {
      case 'email': return <Email sx={{ fontSize: 20 }} />;
      case 'push': return <Notifications sx={{ fontSize: 20 }} />;
      case 'sms': return <Sms sx={{ fontSize: 20 }} />;
      case 'in_app': return <Message sx={{ fontSize: 20 }} />;
      default: return <MailOutline sx={{ fontSize: 20 }} />;
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'high': return 'error';
      case 'medium': return 'warning';
      case 'low': return 'success';
      default: return 'default';
    }
  };

  const handleItemSelect = (notificationId) => {
    setSelectedItems(prev =>
      prev.includes(notificationId)
        ? prev.filter(id => id !== notificationId)
        : [...prev, notificationId]
    );
  };

  const handleSelectAll = () => {
    if (selectedItems.length === filteredNotifications.length) {
      setSelectedItems([]);
    } else {
      setSelectedItems(filteredNotifications.map(n => n.id));
    }
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on notifications:`, selectedItems);
  };

  const handleSendNotification = (notificationId) => {
    console.log(`Send notification: ${notificationId}`);
  };

  const handleScheduleNotification = (notificationId) => {
    console.log(`Schedule notification: ${notificationId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Notification Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Campaign />} onClick={() => setTemplateDialog(true)}>
            Templates
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setNotificationDialog(true)}>
            Send Notification
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        {notificationMetrics.map((metric) => (
          <Grid item xs={12} sm={6} md={3} key={metric.id}>
            <Card>
              <CardContent sx={{ textAlign: 'center' }}>
                <Typography variant="h5" fontWeight="bold">{metric.value}</Typography>
                <Typography variant="body2" color="text.secondary">{metric.metric}</Typography>
                <Chip
                  size="small"
                  label={metric.change}
                  color={metric.status === 'good' ? 'success' : metric.status === 'warning' ? 'warning' : 'error'}
                  sx={{ mt: 1 }}
                />
              </CardContent>
            </Card>
          </Grid>
        ))}
      </Grid>

      {/* Tabs */}
      <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 3 }}>
        <Tabs value={activeTab} onChange={(e, v) => setActiveTab(v)}>
          <Tab label="All Notifications" />
          <Tab label="Email" />
          <Tab label="Push" />
          <Tab label="SMS" />
        </Tabs>
      </Box>

      {/* Search and Filters */}
      <Box sx={{ display: 'flex', gap: 2, mb: 3, flexWrap: 'wrap' }}>
        <TextField
          placeholder="Search notifications..."
          value={searchTerm || ''}
          onChange={(e) => setSearchTerm(e.target.value)}
          size="small"
          sx={{ minWidth: 300 }}
          InputProps={{
            startAdornment: <Search sx={{ mr: 1, color: 'text.secondary' }} />
          }}
        />
        <FormControl size="small" sx={{ minWidth: 150 }}>
          <InputLabel>Status</InputLabel>
          <Select
            value={filterStatus || 'all'}
            onChange={(e) => setFilterStatus(e.target.value)}
            label="Status"
          >
            <MenuItem value="all">All Status</MenuItem>
            <MenuItem value="sent">Sent</MenuItem>
            <MenuItem value="pending">Pending</MenuItem>
            <MenuItem value="scheduled">Scheduled</MenuItem>
            <MenuItem value="failed">Failed</MenuItem>
          </Select>
        </FormControl>
      </Box>

      {/* Notifications Table */}
      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell padding="checkbox">
                <Checkbox
                  indeterminate={selectedItems.length > 0 && selectedItems.length < filteredNotifications.length}
                  checked={selectedItems.length === filteredNotifications.length}
                  onChange={handleSelectAll}
                />
              </TableCell>
              <TableCell>Title</TableCell>
              <TableCell>Type</TableCell>
              <TableCell>Recipients</TableCell>
              <TableCell>Status</TableCell>
              <TableCell>Sent At</TableCell>
              <TableCell>Performance</TableCell>
              <TableCell>Actions</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {filteredNotifications.map((notification) => (
              <TableRow key={notification.id}>
                <TableCell padding="checkbox">
                  <Checkbox
                    checked={selectedItems.includes(notification.id)}
                    onChange={() => handleItemSelect(notification.id)}
                  />
                </TableCell>
                <TableCell>
                  <Box>
                    <Typography variant="body2" fontWeight="medium">
                      {notification.title}
                    </Typography>
                    <Typography variant="caption" color="text.secondary">
                      {notification.message.substring(0, 50)}...
                    </Typography>
                  </Box>
                </TableCell>
                <TableCell>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    {getTypeIcon(notification.type)}
                    <Typography variant="body2">{notification.type}</Typography>
                  </Box>
                </TableCell>
                <TableCell>{notification.recipients.toLocaleString()}</TableCell>
                <TableCell>
                  <Chip
                    size="small"
                    label={notification.status}
                    color={getStatusColor(notification.status)}
                  />
                </TableCell>
                <TableCell>{notification.sent_at}</TableCell>
                <TableCell>
                  <Box sx={{ display: 'flex', gap: 1, flexWrap: 'wrap' }}>
                    <Typography variant="caption" color="text.secondary">
                      Open: {notification.open_rate}%
                    </Typography>
                    <Typography variant="caption" color="text.secondary">
                      Click: {notification.click_rate}%
                    </Typography>
                  </Box>
                </TableCell>
                <TableCell>
                  <IconButton size="small">
                    <Visibility />
                  </IconButton>
                  <IconButton size="small">
                    <Edit />
                  </IconButton>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </TableContainer>

      {/* Bulk Actions */}
      {selectedItems.length > 0 && (
        <Box sx={{ display: 'flex', gap: 2, mt: 2 }}>
          <Button variant="contained" color="success" onClick={() => handleBulkAction('send')}>
            Send Selected
          </Button>
          <Button variant="contained" color="warning" onClick={() => handleBulkAction('schedule')}>
            Schedule Selected
          </Button>
          <Button variant="contained" color="error" onClick={() => handleBulkAction('delete')}>
            Delete Selected
          </Button>
        </Box>
      )}

      {/* Send Notification Dialog */}
      <Dialog open={notificationDialog} onClose={() => setNotificationDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Send New Notification</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create and send a new notification to selected user segments.
          </Typography>
          {/* Notification form here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setNotificationDialog(false)}>Cancel</Button>
          <Button variant="contained">Send Notification</Button>
        </DialogActions>
      </Dialog>

      {/* Templates Dialog */}
      <Dialog open={templateDialog} onClose={() => setTemplateDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Notification Templates</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Manage and create notification templates for different communication channels.
          </Typography>
          {/* Templates management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setTemplateDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default NotificationScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Notifications, Email, Sms, Phone, Message,
  Send, Schedule, DateRange, CalendarToday, FilterList,
  ExpandMore, Warning, Error, Info, PriorityHigh,
  People, Person, Group, Business, School, Work,
  Settings, MoreVert, Campaign, MarkEmailRead, MarkEmailUnread,
  VolumeUp, VolumeOff, VolumeDown, Push, MailOutline
} from '@mui/icons-material';

const NotificationScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [notificationDialog, setNotificationDialog] = useState(false);
  const [templateDialog, setTemplateDialog] = useState(false);

  const notifications = [
    {
      id: 1,
      title: 'Welcome to Yesra Sew!',
      message: 'Thank you for joining our platform. Start exploring amazing properties today.',
      type: 'email',
      category: 'welcome',
      priority: 'medium',
      status: 'sent',
      recipients: 1234,
      sent_at: '2024-01-15 14:30:00',
      scheduled_at: '2024-01-15 14:30:00',
      created_by: 'system@yesrasew.com',
      template_id: 1,
      open_rate: 45.6,
      click_rate: 12.3,
      bounce_rate: 2.1
    },
    {
      id: 2,
      title: 'Property Listing Approved',
      message: 'Your property listing has been approved and is now live on our platform.',
      type: 'push',
      category: 'listing',
      priority: 'high',
      status: 'pending',
      recipients: 567,
      sent_at: null,
      scheduled_at: '2024-01-16 09:00:00',
      created_by: 'moderation_team@yesrasew.com',
      template_id: 2,
      open_rate: null,
      click_rate: null,
      bounce_rate: null
    },
    {
      id: 3,
      title: 'Payment Successful',
      message: 'Your premium subscription payment has been processed successfully.',
      type: 'sms',
      category: 'billing',
      priority: 'high',
      status: 'sent',
      recipients: 234,
      sent_at: '2024-01-15 12:15:00',
      scheduled_at: '2024-01-15 12:15:00',
      created_by: 'billing_system@yesrasew.com',
      template_id: 3,
      open_rate: null,
      click_rate: null,
      bounce_rate: 1.2
    },
    {
      id: 4,
      title: 'System Maintenance',
      message: 'Platform will undergo scheduled maintenance on January 20, 2024.',
      type: 'email',
      category: 'system',
      priority: 'high',
      status: 'scheduled',
      recipients: 15678,
      sent_at: null,
      scheduled_at: '2024-01-19 18:00:00',
      created_by: 'admin@yesrasew.com',
      template_id: 4,
      open_rate: null,
      click_rate: null,
      bounce_rate: null
    },
    {
      id: 5,
      title: 'New Property Matching Your Search',
      message: 'We found new properties that match your search criteria. Check them out!',
      type: 'push',
      category: 'marketing',
      priority: 'low',
      status: 'failed',
      recipients: 890,
      sent_at: '2024-01-14 16:45:00',
      scheduled_at: '2024-01-14 16:45:00',
      created_by: 'marketing_team@yesrasew.com',
      template_id: 5,
      open_rate: null,
      click_rate: null,
      bounce_rate: 8.9
    }
  ];

  const notificationTemplates = [
    {
      id: 1,
      name: 'Welcome Email',
      type: 'email',
      category: 'welcome',
      subject: 'Welcome to Yesra Sew!',
      content: 'Thank you for joining our platform. Start exploring amazing properties today.',
      variables: ['user_name', 'signup_date'],
      status: 'active',
      usage_count: 1234,
      last_used: '2024-01-15',
      created_at: '2024-01-01',
      updated_at: '2024-01-10'
    },
    {
      id: 2,
      name: 'Listing Approval',
      type: 'push',
      category: 'listing',
      subject: 'Property Listing Approved',
      content: 'Your property listing has been approved and is now live.',
      variables: ['property_title', 'listing_id'],
      status: 'active',
      usage_count: 567,
      last_used: '2024-01-15',
      created_at: '2023-12-15',
      updated_at: '2024-01-05'
    },
    {
      id: 3,
      name: 'Payment Confirmation',
      type: 'sms',
      category: 'billing',
      subject: 'Payment Successful',
      content: 'Your payment of ${{amount}} has been processed successfully.',
      variables: ['amount', 'payment_date'],
      status: 'active',
      usage_count: 890,
      last_used: '2024-01-15',
      created_at: '2023-11-20',
      updated_at: '2024-01-08'
    },
    {
      id: 4,
      name: 'Maintenance Notice',
      type: 'email',
      category: 'system',
      subject: 'System Maintenance',
      content: 'Platform maintenance scheduled for {{date}} from {{start_time}} to {{end_time}}.',
      variables: ['date', 'start_time', 'end_time'],
      status: 'active',
      usage_count: 12,
      last_used: '2024-01-10',
      created_at: '2023-10-01',
      updated_at: '2024-01-12'
    }
  ];

  const notificationChannels = [
    {
      id: 1,
      name: 'Email',
      type: 'email',
      status: 'active',
      provider: 'SendGrid',
      daily_limit: 10000,
      daily_sent: 3456,
      success_rate: 98.5,
      avg_delivery_time: '2.5s',
      cost_per_message: 0.01,
      settings: {
        api_key: 'configured',
        bounce_handling: 'enabled',
        tracking: 'enabled'
      }
    },
    {
      id: 2,
      name: 'Push Notifications',
      type: 'push',
      status: 'active',
      provider: 'Firebase Cloud Messaging',
      daily_limit: 50000,
      daily_sent: 12345,
      success_rate: 96.2,
      avg_delivery_time: '1.2s',
      cost_per_message: 0,
      settings: {
        api_key: 'configured',
        badge_count: 'enabled',
        sound: 'enabled'
      }
    },
    {
      id: 3,
      name: 'SMS',
      type: 'sms',
      status: 'active',
      provider: 'Twilio',
      daily_limit: 5000,
      daily_sent: 789,
      success_rate: 95.8,
      avg_delivery_time: '5.8s',
      cost_per_message: 0.05,
      settings: {
        api_key: 'configured',
        phone_number: 'configured',
        alpha_sender: 'enabled'
      }
    },
    {
      id: 4,
      name: 'In-App Notifications',
      type: 'in_app',
      status: 'active',
      provider: 'Internal',
      daily_limit: 'unlimited',
      daily_sent: 23456,
      success_rate: 99.9,
      avg_delivery_time: '0.1s',
      cost_per_message: 0,
      settings: {
        real_time: 'enabled',
        batching: 'enabled',
        expiration: '30 days'
      }
    }
  ];

  const notificationMetrics = [
    {
      id: 1,
      metric: 'Total Sent Today',
      value: 45678,
      change: '+12.5%',
      trend: 'up',
      status: 'good'
    },
    {
      id: 2,
      metric: 'Avg Delivery Rate',
      value: '97.2%',
      change: '+0.8%',
      trend: 'up',
      status: 'good'
    },
    {
      id: 3,
      metric: 'Open Rate (Email)',
      value: '45.6%',
      change: '-2.1%',
      trend: 'down',
      status: 'warning'
    },
    {
      id: 4,
      metric: 'Click Rate',
      value: '12.3%',
      change: '+1.5%',
      trend: 'up',
      status: 'good'
    }
  ];

  const userPreferences = [
    {
      id: 1,
      user_segment: 'All Users',
      email_notifications: true,
      push_notifications: true,
      sms_notifications: false,
      marketing_emails: false,
      listing_updates: true,
      payment_reminders: true,
      system_updates: true,
      user_count: 15678
    },
    {
      id: 2,
      user_segment: 'Premium Users',
      email_notifications: true,
      push_notifications: true,
      sms_notifications: true,
      marketing_emails: true,
      listing_updates: true,
      payment_reminders: true,
      system_updates: true,
      user_count: 1234
    },
    {
      id: 3,
      user_segment: 'Property Owners',
      email_notifications: true,
      push_notifications: true,
      sms_notifications: false,
      marketing_emails: false,
      listing_updates: true,
      payment_reminders: true,
      system_updates: false,
      user_count: 3456
    },
    {
      id: 4,
      user_segment: 'New Users',
      email_notifications: true,
      push_notifications: true,
      sms_notifications: false,
      marketing_emails: false,
      listing_updates: true,
      payment_reminders: false,
      system_updates: true,
      user_count: 2345
    }
  ];

  const filteredNotifications = notifications.filter(notification => {
    const matchesSearch = notification.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      notification.message.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || notification.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && notification.type === 'email') ||
      (activeTab === 2 && notification.type === 'push') ||
      (activeTab === 3 && notification.type === 'sms');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'sent': return 'success';
      case 'pending': return 'warning';
      case 'scheduled': return 'info';
      case 'failed': return 'error';
      case 'draft': return 'default';
      default: return 'default';
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'high': return 'error';
      case 'medium': return 'warning';
      case 'low': return 'success';
      default: return 'default';
    }
  };

  const getTypeIcon = (type) => {
    switch (type) {
      case 'email': return <Email sx={{ fontSize: 20 }} />;
      case 'push': return <Notifications sx={{ fontSize: 20 }} />;
      case 'sms': return <Sms sx={{ fontSize: 20 }} />;
      case 'in_app': return <Message sx={{ fontSize: 20 }} />;
      default: return <Notifications sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (notificationId) => {
    setSelectedItems(prev =>
      prev.includes(notificationId)
        ? prev.filter(id => id !== notificationId)
        : [...prev, notificationId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on notifications:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleSendNotification = (notificationId) => {
    console.log(`Send notification: ${notificationId}`);
  };

  const handleScheduleNotification = (notificationId) => {
    console.log(`Schedule notification: ${notificationId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Notification Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Campaign />} onClick={() => setTemplateDialog(true)}>
            Templates
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setNotificationDialog(true)}>
            Send Notification
          </Button>
        </Box>
      </Box>

      {/* Failed Notification Alert */}
      {notifications.filter(notification => notification.status === 'failed').length > 0 && (
        <Alert severity="error" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{notifications.filter(notification => notification.status === 'failed').length} notifications</strong> have failed to send. Review and resolve issues.
          </Typography>
        </Alert>
      )}

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Send sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">45,678</Typography>
              <Typography variant="body2" color="text.secondary">Sent Today</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">97.2%</Typography>
              <Typography variant="body2" color="text.secondary">Delivery Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <MarkEmailRead sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">45.6%</Typography>
              <Typography variant="body2" color="text.secondary">Open Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Campaign sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">12.3%</Typography>
              <Typography variant="body2" color="text.secondary">Click Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Notification Metrics Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Notification Metrics
          </Typography>
          <Grid container spacing={2}>
            {notificationMetrics.map((metric) => (
              <Grid item xs={12} sm={6} md={3} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={metric.change}
                      color={metric.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Chip
                      label={metric.status}
                      color={metric.status === 'good' ? 'success' : 'warning'}
                      size="small"
                      sx={{ ml: 1 }}
                    />
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Notification Types */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Notifications" />
          <Tab label="Email" />
          <Tab label="Push" />
          <Tab label="SMS" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search notifications..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="sent">Sent</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="scheduled">Scheduled</MenuItem>
                  <MenuItem value="failed">Failed</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('send')}>
                      Send Selected
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('schedule')}>
                      Schedule Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('delete')}>
                      Delete Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Notifications Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredNotifications.map(notification => notification.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Notification</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Category</TableCell>
                  <TableCell>Priority</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Recipients</TableCell>
                  <TableCell>Scheduled</TableCell>
                  <TableCell>Performance</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredNotifications.map((notification) => (
                  <TableRow key={notification.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(notification.id)}
                        onChange={() => handleItemSelect(notification.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {notification.title}
                        </Typography>
                        <Typography variant="caption" color="text.secondary" sx={{ maxWidth: 200, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>
                          {notification.message}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getTypeIcon(notification.type)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {notification.type.replace('_', ' ')}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={notification.category}
                        size="small"
                        variant="outlined"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={notification.priority}
                        color={getPriorityColor(notification.priority)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={notification.status}
                        color={getStatusColor(notification.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {notification.recipients.toLocaleString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {notification.scheduled_at.split(' ')[0]}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      {notification.open_rate && (
                        <Box>
                          <Typography variant="caption" color="text.secondary">
                            Open: {notification.open_rate}%
                          </Typography>
                          <Typography variant="caption" color="text.secondary" sx={{ ml: 1 }}>
                            Click: {notification.click_rate}%
                          </Typography>
                        </Box>
                      )}
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        {notification.status === 'pending' && (
                          <Tooltip title="Send Now">
                            <IconButton size="small" color="success" onClick={() => handleSendNotification(notification.id)}>
                              <Send />
                            </IconButton>
                          </Tooltip>
                        )}
                        <Tooltip title="Schedule">
                          <IconButton size="small" color="info" onClick={() => handleScheduleNotification(notification.id)}>
                            <Schedule />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Notification Channels Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Notification Channels
          </Typography>
          <Grid container spacing={2}>
            {notificationChannels.map((channel) => (
              <Grid item xs={12} md={3} key={channel.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    {getTypeIcon(channel.type)}
                    <Typography variant="h6" fontWeight="bold" sx={{ ml: 1 }}>
                      {channel.name}
                    </Typography>
                  </Box>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    <Chip
                      label={channel.status}
                      color={channel.status === 'active' ? 'success' : 'error'}
                      size="small"
                    />
                    <Typography variant="caption" color="text.secondary" sx={{ ml: 1 }}>
                      {channel.provider}
                    </Typography>
                  </Box>
                  <Typography variant="body2">
                    {channel.daily_sent.toLocaleString()} / {channel.daily_limit.toLocaleString()} sent
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Success: {channel.success_rate}%  {channel.avg_delivery_time}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Templates Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Notification Templates
          </Typography>
          <List>
            {notificationTemplates.map((template) => (
              <ListItem key={template.id} divider>
                <ListItemIcon>
                  {getTypeIcon(template.type)}
                </ListItemIcon>
                <ListItemText
                  primary={template.name}
                  secondary={`${template.type}  Used ${template.usage_count} times  Last: ${template.last_used}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={template.status}
                      color={template.status === 'active' ? 'success' : 'default'}
                      size="small"
                    />
                    <Tooltip title="Edit Template">
                      <IconButton size="small" color="primary">
                        <Edit />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* User Preferences Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            User Notification Preferences
          </Typography>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>User Segment</TableCell>
                  <TableCell>Email</TableCell>
                  <TableCell>Push</TableCell>
                  <TableCell>SMS</TableCell>
                  <TableCell>Marketing</TableCell>
                  <TableCell>Users</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {userPreferences.map((segment) => (
                  <TableRow key={segment.id}>
                    <TableCell>
                      <Typography variant="body2" fontWeight="medium">
                        {segment.user_segment}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Switch checked={segment.email_notifications} size="small" />
                    </TableCell>
                    <TableCell>
                      <Switch checked={segment.push_notifications} size="small" />
                    </TableCell>
                    <TableCell>
                      <Switch checked={segment.sms_notifications} size="small" />
                    </TableCell>
                    <TableCell>
                      <Switch checked={segment.marketing_emails} size="small" />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {segment.user_count.toLocaleString()}
                      </Typography>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Send Notification Dialog */}
      <Dialog open={notificationDialog} onClose={() => setNotificationDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Send Notification</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create and send a new notification to users or user segments.
          </Typography>
          {/* Send notification form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setNotificationDialog(false)}>Cancel</Button>
          <Button variant="contained" startIcon={<Send />}>Send Notification</Button>
        </DialogActions>
      </Dialog>

      {/* Templates Dialog */}
      <Dialog open={templateDialog} onClose={() => setTemplateDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Notification Templates</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Manage and create notification templates for different communication channels.
          </Typography>
          {/* Templates management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setTemplateDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default NotificationScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Smartphone, Android, Apple, Download, Upload, Settings,
  Build, Launch, Update, BugReport, Assessment, Analytics,
  Speed, Memory, Battery, Wifi, Signal, Storage, ExpandMore,
  Code, Api, Security, Notifications, Place, Camera,
  Mic, Contacts, Sms, Phone, Email, Web, Star
} from '@mui/icons-material';

const MobileAppScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [buildDialog, setBuildDialog] = useState(false);
  const [versionDialog, setVersionDialog] = useState(false);

  const appVersions = [
    {
      id: 1,
      platform: 'android',
      version: '2.1.0',
      build_number: '210',
      status: 'published',
      release_date: '2024-01-15',
      download_count: 15420,
      rating: 4.6,
      size_mb: 45.2,
      min_os_version: 'Android 7.0',
      features: ['Push notifications', 'Offline mode', 'Dark theme'],
      bug_fixes: 12,
      improvements: 8
    },
    {
      id: 2,
      platform: 'ios',
      version: '2.1.0',
      build_number: '210',
      status: 'published',
      release_date: '2024-01-14',
      download_count: 12890,
      rating: 4.7,
      size_mb: 52.8,
      min_os_version: 'iOS 14.0',
      features: ['Face ID support', 'Widget support', 'Apple Watch'],
      bug_fixes: 12,
      improvements: 8
    },
    {
      id: 3,
      platform: 'android',
      version: '2.0.5',
      build_number: '205',
      status: 'deprecated',
      release_date: '2023-12-01',
      download_count: 8234,
      rating: 4.4,
      size_mb: 44.1,
      min_os_version: 'Android 7.0',
      features: ['Basic functionality'],
      bug_fixes: 5,
      improvements: 3
    },
    {
      id: 4,
      platform: 'ios',
      version: '2.0.5',
      build_number: '205',
      status: 'deprecated',
      release_date: '2023-11-30',
      download_count: 7891,
      rating: 4.5,
      size_mb: 51.2,
      min_os_version: 'iOS 13.0',
      features: ['Basic functionality'],
      bug_fixes: 5,
      improvements: 3
    }
  ];

  const appAnalytics = [
    {
      id: 1,
      metric: 'Daily Active Users',
      value: 12543,
      change: '+12.5%',
      trend: 'up',
      platform: 'all',
      date_range: 'Last 30 days'
    },
    {
      id: 2,
      metric: 'Session Duration',
      value: '8m 32s',
      change: '+5.2%',
      trend: 'up',
      platform: 'all',
      date_range: 'Last 30 days'
    },
    {
      id: 3,
      metric: 'Crash Rate',
      value: '0.12%',
      change: '-0.03%',
      trend: 'down',
      platform: 'android',
      date_range: 'Last 30 days'
    },
    {
      id: 4,
      metric: 'App Store Rating',
      value: 4.65,
      change: '+0.1',
      trend: 'up',
      platform: 'ios',
      date_range: 'Current'
    }
  ];

  const permissions = [
    {
      id: 1,
      name: 'Camera',
      platform: 'both',
      required: false,
      purpose: 'Upload listing photos',
      status: 'granted',
      usage_rate: 78.5,
      last_updated: '2024-01-15'
    },
    {
      id: 2,
      name: 'Location',
      platform: 'both',
      required: true,
      purpose: 'Show nearby listings',
      status: 'granted',
      usage_rate: 92.1,
      last_updated: '2024-01-15'
    },
    {
      id: 3,
      name: 'Notifications',
      platform: 'both',
      required: false,
      purpose: 'Message alerts',
      status: 'granted',
      usage_rate: 67.3,
      last_updated: '2024-01-15'
    },
    {
      id: 4,
      name: 'Contacts',
      platform: 'both',
      required: false,
      purpose: 'Share listings',
      status: 'granted',
      usage_rate: 45.2,
      last_updated: '2024-01-15'
    },
    {
      id: 5,
      name: 'Storage',
      platform: 'both',
      required: true,
      purpose: 'Save offline data',
      status: 'granted',
      usage_rate: 100.0,
      last_updated: '2024-01-15'
    }
  ];

  const buildStatus = [
    {
      id: 1,
      platform: 'android',
      version: '2.2.0',
      build_number: '215',
      status: 'building',
      progress: 75,
      started_at: '2024-01-15 14:30',
      estimated_completion: '2024-01-15 15:00',
      build_type: 'release',
      triggered_by: 'auto'
    },
    {
      id: 2,
      platform: 'ios',
      version: '2.2.0',
      build_number: '215',
      status: 'queued',
      progress: 0,
      started_at: null,
      estimated_completion: '2024-01-15 16:00',
      build_type: 'release',
    }
  ];

  const filteredVersions = appVersions.filter(version => {
    const matchesSearch = version.version.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      version.platform.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || version.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && version.platform === 'android') ||
      (activeTab === 2 && version.platform === 'ios');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'published': return 'success';
      case 'building': return 'warning';
      case 'queued': return 'info';
      case 'failed': return 'error';
      case 'deprecated': return 'default';
      default: return 'default';
    }
  };

  const getPlatformIcon = (platform) => {
    switch (platform) {
      case 'android': return <Android sx={{ fontSize: 20 }} />;
      case 'ios': return <Apple sx={{ fontSize: 20 }} />;
      case 'both': return <Smartphone sx={{ fontSize: 20 }} />;
      default: return <Smartphone sx={{ fontSize: 20 }} />;
    }
  };

  const getPermissionIcon = (name) => {
    switch (name.toLowerCase()) {
      case 'camera': return <Camera sx={{ fontSize: 20 }} />;
      case 'location': return <Place sx={{ fontSize: 20 }} />;
      case 'notifications': return <Notifications sx={{ fontSize: 20 }} />;
      case 'contacts': return <Contacts sx={{ fontSize: 20 }} />;
      case 'storage': return <Storage sx={{ fontSize: 20 }} />;
      default: return <Settings sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (versionId) => {
    setSelectedItems(prev =>
      prev.includes(versionId)
        ? prev.filter(id => id !== versionId)
        : [...prev, versionId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on versions:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Mobile App Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Build />} onClick={() => setBuildDialog(true)}>
            Build New Version
          </Button>
          <Button variant="contained" startIcon={<Upload />}>
            Deploy to Store
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Smartphone sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">28,310</Typography>
              <Typography variant="body2" color="text.secondary">Total Downloads</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Assessment sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">4.65</Typography>
              <Typography variant="body2" color="text.secondary">Average Rating</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Speed sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">2.1.0</Typography>
              <Typography variant="body2" color="text.secondary">Latest Version</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <BugReport sx={{ fontSize: 40, color: '#F44336', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">0.12%</Typography>
              <Typography variant="body2" color="text.secondary">Crash Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Build Status Alert */}
      {buildStatus.filter(build => build.status === 'building').length > 0 && (
        <Alert severity="info" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{buildStatus.filter(build => build.status === 'building').length} builds</strong> in progress. Check build status below.
          </Typography>
        </Alert>
      )}

      {/* Tabs for Platforms */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Versions" />
          <Tab label="Android" />
          <Tab label="iOS" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search versions..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="published">Published</MenuItem>
                  <MenuItem value="building">Building</MenuItem>
                  <MenuItem value="queued">Queued</MenuItem>
                  <MenuItem value="failed">Failed</MenuItem>
                  <MenuItem value="deprecated">Deprecated</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('publish')}>
                      Publish Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('deprecate')}>
                      Deprecate Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* App Versions Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredVersions.map(version => version.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Version</TableCell>
                  <TableCell>Platform</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Downloads</TableCell>
                  <TableCell>Rating</TableCell>
                  <TableCell>Size</TableCell>
                  <TableCell>Release Date</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredVersions.map((version) => (
                  <TableRow key={version.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(version.id)}
                        onChange={() => handleItemSelect(version.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          v{version.version}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          Build {version.build_number}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getPlatformIcon(version.platform)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {version.platform}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={version.status}
                        color={getStatusColor(version.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {version.download_count.toLocaleString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        <Typography variant="body2">
                          {version.rating}
                        </Typography>
                        <Star sx={{ fontSize: 16, color: '#FFD700' }} />
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {version.size_mb} MB
                      </Typography>
                    </TableCell>
                    <TableCell>{version.release_date}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Edit Version">
                          <IconButton size="small" color="success">
                            <Edit />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Download">
                          <IconButton size="small" color="info">
                            <Download />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* App Analytics Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            App Analytics
          </Typography>
          <Grid container spacing={2}>
            {appAnalytics.map((metric) => (
              <Grid item xs={12} sm={6} md={3} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={metric.change}
                      color={metric.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Typography variant="caption" color="text.secondary" sx={{ ml: 1 }}>
                      {metric.date_range}
                    </Typography>
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Build Status Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Build Status
          </Typography>
          <List>
            {buildStatus.map((build) => (
              <ListItem key={build.id} divider>
                <ListItemIcon>
                  {getPlatformIcon(build.platform)}
                </ListItemIcon>
                <ListItemText
                  primary={`v${build.version} (Build ${build.build_number})`}
                  secondary={`${build.build_type}  ${build.status}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, minWidth: 200 }}>
                    {build.status === 'building' && (
                      <>
                        <LinearProgress
                          variant="determinate"
                          value={build.progress}
                          sx={{ flex: 1, mr: 1 }}
                        />
                        <Typography variant="caption">
                          {build.progress}%
                        </Typography>
                      </>
                    )}
                    <Chip
                      label={build.status}
                      color={getStatusColor(build.status)}
                      size="small"
                    />
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Permissions Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            App Permissions
          </Typography>
          <List>
            {permissions.map((permission) => (
              <ListItem key={permission.id} divider>
                <ListItemIcon>
                  {getPermissionIcon(permission.name)}
                </ListItemIcon>
                <ListItemText
                  primary={permission.name}
                  secondary={`${permission.purpose}  ${permission.platform}  Usage: ${permission.usage_rate}%`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    {permission.required && (
                      <Chip
                        label="Required"
                        color="error"
                        size="small"
                      />
                    )}
                    <Chip
                      label={permission.status}
                      color="success"
                      size="small"
                    />
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Build New Version Dialog */}
      <Dialog open={buildDialog} onClose={() => setBuildDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Build New Version</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure and trigger a new build for Android and iOS platforms.
          </Typography>
          {/* Build configuration form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setBuildDialog(false)}>Cancel</Button>
          <Button variant="contained">Start Build</Button>
        </DialogActions>
      </Dialog>

      {/* Version Details Dialog */}
      <Dialog open={versionDialog} onClose={() => setVersionDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Version Details</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            View detailed information about app version and release notes.
          </Typography>
          {/* Version details here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setVersionDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default MobileAppScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, CardMembership, Star, Diamond, WorkspacePremium, People,
  TrendingUp, Payments, CreditCard, Receipt, Schedule,
  Upgrade, ArrowDownward, Block, Verified, Pending, NotInterested,
  Settings, History, Assessment, Loyalty, GiftCard, LocalOffer
} from '@mui/icons-material';

const MembershipScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [planDialog, setPlanDialog] = useState(false);
  const [memberDialog, setMemberDialog] = useState(false);

  const membershipPlans = [
    {
      id: 1,
      name: 'Basic',
      type: 'free',
      price: 0,
      duration: 'lifetime',
      features: ['Browse listings', 'Basic search', 'Contact sellers'],
      limits: { listings: 5, messages: 50, views: 100 },
      status: 'active',
      member_count: 1250,
      revenue: 0,
      color: '#4CAF50'
    },
    {
      id: 2,
      name: 'Premium',
      type: 'paid',
      price: 29.99,
      duration: 'monthly',
      features: ['Everything in Basic', 'Unlimited listings', 'Priority support', 'Advanced search', 'Featured listings'],
      limits: { listings: -1, messages: 500, views: 1000 },
      status: 'active',
      member_count: 450,
      revenue: 13495.50,
      color: '#2196F3'
    },
    {
      id: 3,
      name: 'Professional',
      type: 'paid',
      price: 79.99,
      duration: 'monthly',
      features: ['Everything in Premium', 'Analytics dashboard', 'Bulk operations', 'API access', 'Custom branding'],
      limits: { listings: -1, messages: -1, views: -1 },
      status: 'active',
      member_count: 125,
      revenue: 9998.75,
      color: '#FF9800'
    },
    {
      id: 4,
      name: 'Enterprise',
      type: 'paid',
      price: 199.99,
      duration: 'monthly',
      features: ['Everything in Professional', 'Dedicated support', 'Custom integrations', 'White label', 'SLA guarantee'],
      limits: { listings: -1, messages: -1, views: -1 },
      status: 'active',
      member_count: 25,
      revenue: 4999.75,
      color: '#9C27B0'
    },
    {
      id: 5,
      name: 'Trial',
      type: 'trial',
      price: 0,
      duration: '14 days',
      features: ['Premium features', 'Full access', 'No credit card required'],
      limits: { listings: 10, messages: 100, views: 500 },
      status: 'active',
      member_count: 89,
      revenue: 0,
      color: '#F44336'
    }
  ];

  const members = [
    {
      id: 1,
      name: 'John Doe',
      email: 'john.doe@email.com',
      plan: 'Premium',
      status: 'active',
      joined_at: '2024-01-01',
      expires_at: '2024-02-01',
      auto_renew: true,
      total_spent: 29.99,
      last_payment: '2024-01-01',
      payment_method: 'credit_card',
      usage: { listings: 12, messages: 67, views: 234 }
    },
    {
      id: 2,
      name: 'Sarah Wilson',
      email: 'sarah.wilson@email.com',
      plan: 'Professional',
      status: 'active',
      joined_at: '2023-12-15',
      expires_at: '2024-01-15',
      auto_renew: true,
      total_spent: 239.97,
      last_payment: '2024-01-01',
      payment_method: 'paypal',
      usage: { listings: 45, messages: 234, views: 1567 }
    },
    {
      id: 3,
      name: 'Mike Johnson',
      email: 'mike.johnson@email.com',
      plan: 'Basic',
      status: 'active',
      joined_at: '2023-11-20',
      expires_at: null,
      auto_renew: false,
      total_spent: 0,
      last_payment: null,
      payment_method: null,
      usage: { listings: 3, messages: 12, views: 45 }
    },
    {
      id: 4,
      name: 'Emily Brown',
      email: 'emily.brown@email.com',
      plan: 'Trial',
      status: 'trial',
      joined_at: '2024-01-10',
      expires_at: '2024-01-24',
      auto_renew: false,
      total_spent: 0,
      last_payment: null,
      payment_method: null,
      usage: { listings: 8, messages: 34, views: 123 }
    },
    {
      id: 5,
      name: 'David Lee',
      email: 'david.lee@email.com',
      plan: 'Enterprise',
      status: 'expired',
      joined_at: '2023-10-01',
      expires_at: '2024-01-01',
      auto_renew: false,
      total_spent: 1999.90,
      last_payment: '2023-12-01',
      payment_method: 'credit_card',
      usage: { listings: 156, messages: 892, views: 4567 }
    }
  ];

  const transactions = [
    {
      id: 1,
      member: 'John Doe',
      plan: 'Premium',
      amount: 29.99,
      type: 'subscription',
      status: 'completed',
      payment_method: 'credit_card',
      transaction_id: 'TXN-1234',
      created_at: '2024-01-01 00:00'
    },
    {
      id: 2,
      member: 'Sarah Wilson',
      plan: 'Professional',
      amount: 79.99,
      type: 'subscription',
      status: 'completed',
      payment_method: 'paypal',
      transaction_id: 'TXN-1235',
      created_at: '2024-01-01 00:15'
    },
    {
      id: 3,
      member: 'David Lee',
      plan: 'Enterprise',
      amount: 199.99,
      type: 'subscription',
      status: 'failed',
      payment_method: 'credit_card',
      transaction_id: 'TXN-1236',
      created_at: '2024-01-01 01:00'
    },
    {
      id: 4,
      member: 'Emily Brown',
      plan: 'Trial',
      amount: 0,
      type: 'trial_start',
      status: 'completed',
      payment_method: null,
    }
  ];

  const filteredMembers = members.filter(member => {
    const matchesSearch = member.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      member.email.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || member.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && member.plan === 'Basic') ||
      (activeTab === 2 && member.plan === 'Premium') ||
      (activeTab === 3 && member.plan === 'Professional') ||
      (activeTab === 4 && member.plan === 'Enterprise') ||
      (activeTab === 5 && member.plan === 'Trial');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'trial': return 'info';
      case 'expired': return 'error';
      case 'cancelled': return 'warning';
      default: return 'default';
    }
  };

  const getPlanIcon = (plan) => {
    switch (plan) {
      case 'Basic': return <CardMembership sx={{ fontSize: 20 }} />;
      case 'Premium': return <Star sx={{ fontSize: 20 }} />;
      case 'Professional': return <Diamond sx={{ fontSize: 20 }} />;
      case 'Enterprise': return <WorkspacePremium sx={{ fontSize: 20 }} />;
      case 'Trial': return <Pending sx={{ fontSize: 20 }} />;
      default: return <CardMembership sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (memberId) => {
    setSelectedItems(prev =>
      prev.includes(memberId)
        ? prev.filter(id => id !== memberId)
        : [...prev, memberId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on members:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleUpgrade = (memberId) => {
    console.log(`Upgrade member: ${memberId}`);
  };

  const handleDowngrade = (memberId) => {
    console.log(`Downgrade member: ${memberId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Membership Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Settings />} onClick={() => setPlanDialog(true)}>
            Manage Plans
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setMemberDialog(true)}>
            Add Member
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <People sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">1,939</Typography>
              <Typography variant="body2" color="text.secondary">Total Members</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <TrendingUp sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">28.5%</Typography>
              <Typography variant="body2" color="text.secondary">Premium Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Payments sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">$28,493</Typography>
              <Typography variant="body2" color="text.secondary">Monthly Revenue</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Loyalty sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">89</Typography>
              <Typography variant="body2" color="text.secondary">Trial Users</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Membership Plans Overview */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Membership Plans Overview
          </Typography>
          <Grid container spacing={2}>
            {membershipPlans.map((plan) => (
              <Grid item xs={12} sm={6} md={2.4} key={plan.id}>
                <Paper variant="outlined" sx={{ p: 2, borderLeft: `4px solid ${plan.color}` }}>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    {getPlanIcon(plan.name)}
                    <Typography variant="h6" fontWeight="bold" sx={{ ml: 1 }}>
                      {plan.name}
                    </Typography>
                  </Box>
                  <Typography variant="h5" color={plan.color} fontWeight="bold">
                    {plan.price === 0 ? 'Free' : `$${plan.price}`}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {plan.duration}
                  </Typography>
                  <Box sx={{ mt: 1 }}>
                    <Typography variant="body2">
                      {plan.member_count} members
                    </Typography>
                    {plan.revenue > 0 && (
                      <Typography variant="caption" color="success.main">
                        ${plan.revenue.toLocaleString()}/mo
                      </Typography>
                    )}
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Plans */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Members" />
          <Tab label="Basic" />
          <Tab label="Premium" />
          <Tab label="Professional" />
          <Tab label="Enterprise" />
          <Tab label="Trial" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search members..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="trial">Trial</MenuItem>
                  <MenuItem value="expired">Expired</MenuItem>
                  <MenuItem value="cancelled">Cancelled</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('upgrade')}>
                      Upgrade Selected
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('downgrade')}>
                      Downgrade Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('cancel')}>
                      Cancel Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Members Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredMembers.map(member => member.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Member</TableCell>
                  <TableCell>Plan</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Usage</TableCell>
                  <TableCell>Revenue</TableCell>
                  <TableCell>Auto Renew</TableCell>
                  <TableCell>Expires</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredMembers.map((member) => (
                  <TableRow key={member.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(member.id)}
                        onChange={() => handleItemSelect(member.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {member.name}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {member.email}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getPlanIcon(member.plan)}
                        <Typography variant="body2">
                          {member.plan}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={member.status}
                        color={getStatusColor(member.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          {member.usage.listings} listings
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {member.usage.messages} msgs  {member.usage.views} views
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" color="success.main">
                        ${member.total_spent.toFixed(2)}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Switch
                        checked={member.auto_renew}
                        size="small"
                        disabled={member.plan === 'Basic'}
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {member.expires_at || 'Never'}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Edit Member">
                          <IconButton size="small" color="success">
                            <Edit />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Upgrade">
                          <IconButton size="small" color="info" onClick={() => handleUpgrade(member.id)}>
                            <Upgrade />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Downgrade">
                          <IconButton size="small" color="warning" onClick={() => handleDowngrade(member.id)}>
                            <ArrowDownward />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Recent Transactions */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Recent Transactions
          </Typography>
          <List>
            {transactions.slice(0, 5).map((transaction) => (
              <ListItem key={transaction.id} divider>
                <ListItemIcon>
                  <Receipt />
                </ListItemIcon>
                <ListItemText
                  primary={`${transaction.member} - ${transaction.plan}`}
                  secondary={`${transaction.amount > 0 ? '$' + transaction.amount : 'Free'}  ${transaction.type}  ${transaction.created_at}`}
                />
                <ListItemSecondaryAction>
                  <Chip
                    label={transaction.status}
                    color={transaction.status === 'completed' ? 'success' : 'error'}
                    size="small"
                  />
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Add Member Dialog */}
      <Dialog open={memberDialog} onClose={() => setMemberDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Add New Member</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Add a new member to the platform and assign a membership plan.
          </Typography>
          {/* Add member form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setMemberDialog(false)}>Cancel</Button>
          <Button variant="contained">Add Member</Button>
        </DialogActions>
      </Dialog>

      {/* Manage Plans Dialog */}
      <Dialog open={planDialog} onClose={() => setPlanDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Manage Membership Plans</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure membership plans, pricing, and features.
          </Typography>
          {/* Plans management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setPlanDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default MembershipScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Gavel, Policy, Security, Warning, Info, ExpandMore,
  FileCopy, Description, Assignment, LibraryBooks, Bookmark,
  Verified, Pending, Error, Schedule, History, Assessment,
  Shield, Cookie, DataObject, Language, Public,
  Domain, Copyright, Trademark, Patent, AccountBalance
} from '@mui/icons-material';

const LegalComplianceScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [policyDialog, setPolicyDialog] = useState(false);
  const [complianceDialog, setComplianceDialog] = useState(false);

  const legalDocuments = [
    {
      id: 1,
      title: 'Terms of Service',
      type: 'terms',
      category: 'user_agreement',
      version: '2.1.0',
      status: 'active',
      last_updated: '2024-01-15',
      effective_date: '2024-01-01',
      required_acceptance: true,
      acceptance_rate: 98.5,
      priority: 'high',
      file_url: '/legal/terms-of-service-v2.1.0.pdf'
    },
    {
      id: 2,
      title: 'Privacy Policy',
      type: 'privacy',
      category: 'data_protection',
      version: '3.2.1',
      status: 'active',
      last_updated: '2024-01-10',
      effective_date: '2024-01-01',
      required_acceptance: true,
      acceptance_rate: 96.2,
      priority: 'high',
      file_url: '/legal/privacy-policy-v3.2.1.pdf'
    },
    {
      id: 3,
      title: 'Cookie Policy',
      type: 'cookies',
      category: 'data_protection',
      version: '1.5.0',
      status: 'active',
      last_updated: '2024-01-08',
      effective_date: '2024-01-01',
      required_acceptance: false,
      acceptance_rate: 89.7,
      priority: 'medium',
      file_url: '/legal/cookie-policy-v1.5.0.pdf'
    },
    {
      id: 4,
      title: 'GDPR Compliance',
      type: 'gdpr',
      category: 'regulation',
      version: '1.0.0',
      status: 'active',
      last_updated: '2024-01-05',
      effective_date: '2024-01-01',
      required_acceptance: true,
      acceptance_rate: 94.1,
      priority: 'high',
      file_url: '/legal/gdpr-compliance-v1.0.0.pdf'
    },
    {
      id: 5,
      title: 'User Content Guidelines',
      type: 'guidelines',
      category: 'content_policy',
      version: '1.3.0',
      status: 'draft',
      last_updated: '2024-01-12',
      effective_date: null,
      required_acceptance: false,
      acceptance_rate: 0,
      priority: 'medium',
      file_url: '/legal/content-guidelines-v1.3.0.pdf'
    }
  ];

  const complianceChecks = [
    {
      id: 1,
      name: 'GDPR Compliance',
      category: 'data_protection',
      status: 'compliant',
      last_check: '2024-01-15',
      next_check: '2024-02-15',
      issues: 0,
      severity: 'high',
      automated: true,
      description: 'EU General Data Protection Regulation compliance'
    },
    {
      id: 2,
      name: 'CCPA Compliance',
      category: 'data_protection',
      status: 'compliant',
      last_check: '2024-01-14',
      next_check: '2024-02-14',
      issues: 0,
      severity: 'high',
      automated: true,
      description: 'California Consumer Privacy Act compliance'
    },
    {
      id: 3,
      name: 'Accessibility Standards',
      category: 'accessibility',
      status: 'warning',
      last_check: '2024-01-13',
      next_check: '2024-01-20',
      issues: 3,
      severity: 'medium',
      automated: false,
      description: 'WCAG 2.1 AA accessibility standards'
    },
    {
      id: 4,
      name: 'Payment Security (PCI DSS)',
      category: 'payment',
      status: 'compliant',
      last_check: '2024-01-12',
      next_check: '2024-02-12',
      issues: 0,
      severity: 'high',
      automated: true,
      description: 'Payment Card Industry Data Security Standard'
    },
    {
      id: 5,
      name: 'Data Retention Policy',
      category: 'data_management',
      status: 'non_compliant',
      last_check: '2024-01-11',
      next_check: '2024-01-18',
      issues: 5,
      severity: 'medium',
      automated: false,
      description: 'Data retention and deletion policies'
    }
  ];

  const regulatoryFrameworks = [
    {
      id: 1,
      name: 'General Data Protection Regulation (GDPR)',
      jurisdiction: 'European Union',
      type: 'data_protection',
      status: 'active',
      implementation_date: '2024-01-01',
      last_review: '2024-01-15',
      next_review: '2024-07-01',
      compliance_score: 98,
      requirements: 15,
      implemented: 14
    },
    {
      id: 2,
      name: 'California Consumer Privacy Act (CCPA)',
      jurisdiction: 'California, USA',
      type: 'data_protection',
      status: 'active',
      implementation_date: '2024-01-01',
      last_review: '2024-01-14',
      next_review: '2024-04-01',
      compliance_score: 95,
      requirements: 12,
      implemented: 11
    },
    {
      id: 3,
      name: 'Payment Card Industry Data Security Standard (PCI DSS)',
      jurisdiction: 'Global',
      type: 'payment_security',
      status: 'active',
      implementation_date: '2023-12-01',
      last_review: '2024-01-12',
      next_review: '2024-04-12',
      compliance_score: 100,
    }
  ];

  const filteredDocuments = legalDocuments.filter(doc => {
    const matchesSearch = doc.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      doc.category.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || doc.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && (doc.category === 'user_agreement' || doc.type === 'terms')) ||
      (activeTab === 2 && (doc.category === 'data_protection' || doc.type === 'privacy')) ||
      (activeTab === 3 && (doc.category === 'regulation' || doc.type === 'gdpr')) ||
      (activeTab === 4 && doc.category === 'content_policy');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'draft': return 'warning';
      case 'archived': return 'error';
      case 'compliant': return 'success';
      case 'warning': return 'warning';
      case 'non_compliant': return 'error';
      default: return 'default';
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'high': return 'error';
      case 'medium': return 'warning';
      case 'low': return 'success';
      default: return 'default';
    }
  };

  const getTypeIcon = (type) => {
    switch (type) {
      case 'terms': return <Gavel sx={{ fontSize: 20 }} />;
      case 'privacy': return <Security sx={{ fontSize: 20 }} />;
      case 'cookies': return <Cookie sx={{ fontSize: 20 }} />;
      case 'gdpr': return <Shield sx={{ fontSize: 20 }} />;
      case 'guidelines': return <LibraryBooks sx={{ fontSize: 20 }} />;
      default: return <Description sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (docId) => {
    setSelectedItems(prev =>
      prev.includes(docId)
        ? prev.filter(id => id !== docId)
        : [...prev, docId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on documents:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Legal Compliance
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Assessment />} onClick={() => setComplianceDialog(true)}>
            Run Compliance Check
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setPolicyDialog(true)}>
            Add Legal Document
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Policy sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">5</Typography>
              <Typography variant="body2" color="text.secondary">Legal Documents</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">95.2%</Typography>
              <Typography variant="body2" color="text.secondary">Overall Compliance</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Warning sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">8</Typography>
              <Typography variant="body2" color="text.secondary">Issues Found</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Security sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">3</Typography>
              <Typography variant="body2" color="text.secondary">Regulatory Frameworks</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Compliance Alert */}
      {complianceChecks.filter(check => check.status === 'non_compliant').length > 0 && (
        <Alert severity="error" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{complianceChecks.filter(check => check.status === 'non_compliant').length} compliance issues</strong> require immediate attention. Click "Run Compliance Check" for details.
          </Typography>
        </Alert>
      )}

      {/* Tabs for Document Categories */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Documents" />
          <Tab label="User Agreements" />
          <Tab label="Data Protection" />
          <Tab label="Regulations" />
          <Tab label="Content Policy" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search legal documents..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="draft">Draft</MenuItem>
                  <MenuItem value="archived">Archived</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('activate')}>
                      Activate Selected
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('archive')}>
                      Archive Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Legal Documents Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredDocuments.map(doc => doc.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Document</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Version</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Acceptance Rate</TableCell>
                  <TableCell>Priority</TableCell>
                  <TableCell>Last Updated</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredDocuments.map((doc) => (
                  <TableRow key={doc.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(doc.id)}
                        onChange={() => handleItemSelect(doc.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {doc.title}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {doc.category.replace('_', ' ')}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getTypeIcon(doc.type)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {doc.type}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        v{doc.version}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={doc.status}
                        color={getStatusColor(doc.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          {doc.acceptance_rate}%
                        </Typography>
                        {doc.required_acceptance && (
                          <Typography variant="caption" color="text.secondary">
                            Required
                          </Typography>
                        )}
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={doc.priority}
                        color={getPriorityColor(doc.priority)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>{doc.last_updated}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Document">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Edit Document">
                          <IconButton size="small" color="success">
                            <Edit />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Download">
                          <IconButton size="small" color="info">
                            <FileCopy />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Compliance Checks Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Compliance Checks
          </Typography>
          <List>
            {complianceChecks.map((check) => (
              <ListItem key={check.id} divider>
                <ListItemIcon>
                  {check.status === 'compliant' ? (
                    <CheckCircle sx={{ color: 'success.main' }} />
                  ) : check.status === 'warning' ? (
                    <Warning sx={{ color: 'warning.main' }} />
                  ) : (
                    <Error sx={{ color: 'error.main' }} />
                  )}
                </ListItemIcon>
                <ListItemText
                  primary={check.name}
                  secondary={`${check.description}  Last: ${check.last_check}  Next: ${check.next_check}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    {check.issues > 0 && (
                      <Badge badgeContent={check.issues} color="error">
                        <Info />
                      </Badge>
                    )}
                    <Chip
                      label={check.status.replace('_', ' ')}
                      color={getStatusColor(check.status)}
                      size="small"
                    />
                    <Switch
                      checked={check.automated}
                      size="small"
                    />
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Regulatory Frameworks Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Regulatory Frameworks
          </Typography>
          <Grid container spacing={2}>
            {regulatoryFrameworks.map((framework) => (
              <Grid item xs={12} md={4} key={framework.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    <Public sx={{ mr: 1, color: '#2196F3' }} />
                    <Typography variant="h6" fontWeight="bold">
                      {framework.name}
                    </Typography>
                  </Box>
                  <Typography variant="body2" color="text.secondary" gutterBottom>
                    {framework.jurisdiction}
                  </Typography>
                  <Box sx={{ mb: 1 }}>
                    <Typography variant="body2">
                      Compliance Score: {framework.compliance_score}%
                    </Typography>
                    <LinearProgress
                      variant="determinate"
                      value={framework.compliance_score}
                      sx={{ mt: 0.5 }}
                    />
                  </Box>
                  <Typography variant="caption" color="text.secondary">
                    {framework.implemented}/{framework.requirements} requirements implemented
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Add Legal Document Dialog */}
      <Dialog open={policyDialog} onClose={() => setPolicyDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Add Legal Document</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Add a new legal document to the platform compliance framework.
          </Typography>
          {/* Add legal document form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setPolicyDialog(false)}>Cancel</Button>
          <Button variant="contained">Add Document</Button>
        </DialogActions>
      </Dialog>

      {/* Compliance Check Dialog */}
      <Dialog open={complianceDialog} onClose={() => setComplianceDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Run Compliance Check</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Run automated compliance checks against regulatory frameworks and internal policies.
          </Typography>
          {/* Compliance check configuration here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setComplianceDialog(false)}>Cancel</Button>
          <Button variant="contained">Run Check</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default LegalComplianceScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Work
} from '@mui/icons-material';

const JobsScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus, jobs = [] }) => {
  const [selectedItems, setSelectedItems] = useState([]);

  const filteredJobs = jobs.filter(job => {
    const matchesSearch = job.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      job.company.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || job.status === filterStatus;
    return matchesSearch && matchesFilter;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'approved': return 'success';
      case 'pending': return 'warning';
      case 'rejected': return 'error';
      default: return 'default';
    }
  };

  const handleItemSelect = (jobId) => {
    setSelectedItems(prev =>
      prev.includes(jobId)
        ? prev.filter(id => id !== jobId)
        : [...prev, jobId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on jobs:`, selectedItems);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Jobs Management
        </Typography>
        <Button variant="contained" startIcon={<Add />}>
          Add New Job
        </Button>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Work sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">312</Typography>
              <Typography variant="body2" color="text.secondary">Total Jobs</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">234</Typography>
              <Typography variant="body2" color="text.secondary">Active Jobs</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Visibility sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">25.6K</Typography>
              <Typography variant="body2" color="text.secondary">Total Views</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Search sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">1,847</Typography>
              <Typography variant="body2" color="text.secondary">Applications</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search jobs..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="approved">Approved</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="rejected">Rejected</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('approve')}>
                      Approve Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('reject')}>
                      Reject Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Jobs Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredJobs.map(job => job.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Title</TableCell>
                  <TableCell>User</TableCell>
                  <TableCell>Salary</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Views</TableCell>
                  <TableCell>Applications</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredJobs.map((job) => (
                  <TableRow key={job.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(job.id)}
                        onChange={() => handleItemSelect(job.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontWeight="medium">
                        {job.title}
                      </Typography>
                    </TableCell>
                    <TableCell>{job.user}</TableCell>
                    <TableCell>{job.price}</TableCell>
                    <TableCell>
                      <Chip
                        label={job.status}
                        color={getStatusColor(job.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>{job.views}</TableCell>
                    <TableCell>{job.applications}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <IconButton size="small" color="primary">
                          <Visibility />
                        </IconButton>
                        <IconButton size="small" color="success">
                          <Edit />
                        </IconButton>
                        <IconButton size="small" color="error">
                          <Delete />
                        </IconButton>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>
    </Box>
  );
};

export default JobsScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Api, Sync, Link, Settings, Assessment,
  FilterList, ExpandMore, Warning, Error, Info,
  Timeline, Schedule, DateRange, CalendarToday,
  Cloud, CloudUpload, CloudDownload, Storage,
  Security, Lock, Key, Password,
  Code, DataObject, Hub, Router, Wifi,
  Phone, Email, Message, Notifications,
  Business, Group, Person, Payments,
  Download, Upload, FileCopy, Save, MoreVert,
  Connect, Disconnect, Check, Close,
  PlayArrow, Stop, Pause, Speed, Memory,
  AssessmentOutlined, TrendingUp, TrendingDown
} from '@mui/icons-material';

const IntegrationScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [integrationDialog, setIntegrationDialog] = useState(false);
  const [configDialog, setConfigDialog] = useState(false);

  const integrations = [
    {
      id: 1,
      name: 'Google Analytics',
      type: 'analytics',
      category: 'marketing',
      status: 'active',
      priority: 'high',
      description: 'Track website traffic and user behavior',
      provider: 'Google',
      version: 'v4',
      created_at: '2024-01-01',
      updated_at: '2024-01-15',
      last_sync: '2024-01-15 14:30:00',
      sync_frequency: 'hourly',
      data_points: 12345,
      error_count: 0,
      config: {
        tracking_id: 'GA-123456789',
        api_key: 'configured',
        webhook_url: 'https://api.google.com/analytics'
      },
      features: ['traffic_tracking', 'conversion_tracking', 'custom_events']
    },
    {
      id: 2,
      name: 'Stripe Payment Gateway',
      type: 'payment',
      category: 'billing',
      status: 'active',
      priority: 'critical',
      description: 'Process online payments and subscriptions',
      provider: 'Stripe',
      version: 'v2',
      created_at: '2023-12-15',
      updated_at: '2024-01-14',
      last_sync: '2024-01-15 12:15:00',
      sync_frequency: 'real_time',
      data_points: 5678,
      error_count: 1,
      config: {
        api_key: 'configured',
        webhook_secret: 'configured',
        sandbox_mode: false
      },
      features: ['payments', 'subscriptions', 'refunds', 'webhooks']
    },
    {
      id: 3,
      name: 'SendGrid Email Service',
      type: 'communication',
      category: 'marketing',
      status: 'active',
      priority: 'medium',
      description: 'Send transactional and marketing emails',
      provider: 'SendGrid',
      version: 'v3',
      created_at: '2023-11-20',
      updated_at: '2024-01-10',
      last_sync: '2024-01-15 16:20:00',
      sync_frequency: 'on_demand',
      data_points: 23456,
      error_count: 0,
      config: {
        api_key: 'configured',
        from_email: 'noreply@yesrasew.com',
        templates: 'configured'
      },
      features: ['email_sending', 'templates', 'analytics', 'bounce_handling']
    },
    {
      id: 4,
      name: 'AWS S3 Storage',
      type: 'storage',
      category: 'infrastructure',
      status: 'active',
      priority: 'critical',
      description: 'Cloud storage for files and media',
      provider: 'Amazon Web Services',
      version: 'v1',
      created_at: '2023-10-01',
      updated_at: '2024-01-08',
      last_sync: '2024-01-15 18:45:00',
      sync_frequency: 'continuous',
      data_points: 89012,
      error_count: 0,
      config: {
        access_key: 'configured',
        bucket_name: 'yesrasew-storage',
        region: 'us-east-1'
      },
      features: ['file_storage', 'cdn', 'backup', 'versioning']
    },
    {
      id: 5,
      name: 'Twilio SMS Gateway',
      type: 'communication',
      category: 'support',
      status: 'inactive',
      priority: 'medium',
      description: 'Send SMS notifications and alerts',
      provider: 'Twilio',
      version: 'v2',
      created_at: '2023-09-15',
      updated_at: '2024-01-05',
      last_sync: '2024-01-10 09:30:00',
      sync_frequency: 'on_demand',
      data_points: 3456,
      error_count: 3,
      config: {
        account_sid: 'configured',
        auth_token: 'configured',
        phone_number: 'configured'
      },
      features: ['sms_sending', 'mms', 'phone_verification']
    }
  ];

  const webhooks = [
    {
      id: 1,
      name: 'User Registration Webhook',
      endpoint: 'https://api.yesrasew.com/webhooks/user-registration',
      event_type: 'user.created',
      status: 'active',
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer token123'
      },
      payload_template: '{"user_id": "{{user_id}}", "email": "{{email}}"}',
      retry_count: 3,
      timeout: 30,
      success_rate: 98.5,
      last_triggered: '2024-01-15 14:30:00',
      total_calls: 1234
    },
    {
      id: 2,
      name: 'Payment Confirmation Webhook',
      endpoint: 'https://billing.yesrasew.com/webhooks/payment',
      event_type: 'payment.completed',
      status: 'active',
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Signature': '{{signature}}'
      },
      payload_template: '{"payment_id": "{{payment_id}}", "amount": "{{amount}}"}',
      retry_count: 5,
      timeout: 60,
      success_rate: 99.2,
      last_triggered: '2024-01-15 12:15:00',
      total_calls: 567
    },
    {
      id: 3,
      name: 'Property Listing Webhook',
      endpoint: 'https://crm.yesrasew.com/webhooks/listing',
      event_type: 'listing.created',
      status: 'failed',
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      payload_template: '{"listing_id": "{{listing_id}}", "title": "{{title}}"}',
      retry_count: 3,
      timeout: 30,
      success_rate: 85.3,
      last_triggered: '2024-01-14 16:45:00',
      total_calls: 234
    }
  ];

  const apiKeys = [
    {
      id: 1,
      name: 'Production API Key',
      service: 'Google Analytics',
      key_type: 'api_key',
      permissions: ['read', 'write'],
      usage_count: 12345,
      last_used: '2024-01-15 14:30:00',
      expires_at: '2024-12-31',
      status: 'active',
      created_by: 'admin@yesrasew.com'
    },
    {
      id: 2,
      name: 'Stripe Secret Key',
      service: 'Stripe Payment Gateway',
      key_type: 'secret_key',
      permissions: ['read', 'write'],
      usage_count: 5678,
      last_used: '2024-01-15 12:15:00',
      expires_at: '2025-01-01',
      status: 'active',
      created_by: 'billing_team@yesrasew.com'
    },
    {
      id: 3,
      name: 'SendGrid API Key',
      service: 'SendGrid Email Service',
      key_type: 'api_key',
      permissions: ['read', 'write'],
      usage_count: 23456,
      last_used: '2024-01-15 16:20:00',
      expires_at: '2024-06-30',
      status: 'active',
      created_by: 'marketing_team@yesrasew.com'
    }
  ];

  const integrationMetrics = [
    {
      id: 1,
      metric: 'Active Integrations',
      value: 4,
      change: '+1',
      trend: 'up',
      status: 'good'
    },
    {
      id: 2,
      metric: 'Total API Calls Today',
      value: 45678,
      change: '+15.2%',
      trend: 'up',
      status: 'good'
    },
    {
      id: 3,
      metric: 'Success Rate',
      value: '97.8%',
      change: '+0.5%',
      trend: 'up',
      status: 'good'
    },
    {
      id: 4,
      metric: 'Failed Webhooks',
      value: 3,
      change: '-2',
      trend: 'down',
      status: 'warning'
    }
  ];

  const filteredIntegrations = integrations.filter(integration => {
    const matchesSearch = integration.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      integration.provider.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || integration.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && integration.category === 'marketing') ||
      (activeTab === 2 && integration.category === 'billing') ||
      (activeTab === 3 && integration.category === 'infrastructure');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'inactive': return 'default';
      case 'failed': return 'error';
      case 'pending': return 'warning';
      default: return 'default';
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'critical': return 'error';
      case 'high': return 'warning';
      case 'medium': return 'info';
      case 'low': return 'success';
      default: return 'default';
    }
  };

  const getTypeIcon = (type) => {
    switch (type) {
      case 'analytics': return <Assessment sx={{ fontSize: 20 }} />;
      case 'payment': return <Payments sx={{ fontSize: 20 }} />;
      case 'communication': return <Message sx={{ fontSize: 20 }} />;
      case 'storage': return <Cloud sx={{ fontSize: 20 }} />;
      case 'crm': return <Business sx={{ fontSize: 20 }} />;
      default: return <Hub sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (integrationId) => {
    setSelectedItems(prev =>
      prev.includes(integrationId)
        ? prev.filter(id => id !== integrationId)
        : [...prev, integrationId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on integrations:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleTestIntegration = (integrationId) => {
    console.log(`Test integration: ${integrationId}`);
  };

  const handleSyncIntegration = (integrationId) => {
    console.log(`Sync integration: ${integrationId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Integration Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Code />} onClick={() => setConfigDialog(true)}>
            API Keys
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setIntegrationDialog(true)}>
            Add Integration
          </Button>
        </Box>
      </Box>

      {/* Failed Integration Alert */}
      {integrations.filter(integration => integration.status === 'failed').length > 0 && (
        <Alert severity="error" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{integrations.filter(integration => integration.status === 'failed').length} integrations</strong> have failed. Review and resolve issues.
          </Typography>
        </Alert>
      )}

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Hub sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">4</Typography>
              <Typography variant="body2" color="text.secondary">Active Integrations</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Api sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">45,678</Typography>
              <Typography variant="body2" color="text.secondary">API Calls Today</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">97.8%</Typography>
              <Typography variant="body2" color="text.secondary">Success Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Sync sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">3</Typography>
              <Typography variant="body2" color="text.secondary">Failed Webhooks</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Integration Metrics Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Integration Metrics
          </Typography>
          <Grid container spacing={2}>
            {integrationMetrics.map((metric) => (
              <Grid item xs={12} sm={6} md={3} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={metric.change}
                      color={metric.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Chip
                      label={metric.status}
                      color={metric.status === 'good' ? 'success' : 'warning'}
                      size="small"
                      sx={{ ml: 1 }}
                    />
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Integration Categories */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Integrations" />
          <Tab label="Marketing" />
          <Tab label="Billing" />
          <Tab label="Infrastructure" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search integrations..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="inactive">Inactive</MenuItem>
                  <MenuItem value="failed">Failed</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('test')}>
                      Test Selected
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('sync')}>
                      Sync Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('disable')}>
                      Disable Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Integrations Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredIntegrations.map(integration => integration.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Integration</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Provider</TableCell>
                  <TableCell>Priority</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Last Sync</TableCell>
                  <TableCell>Data Points</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredIntegrations.map((integration) => (
                  <TableRow key={integration.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(integration.id)}
                        onChange={() => handleItemSelect(integration.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {integration.name}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {integration.description}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getTypeIcon(integration.type)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {integration.type}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {integration.provider}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        v{integration.version}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={integration.priority}
                        color={getPriorityColor(integration.priority)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={integration.status}
                        color={getStatusColor(integration.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {integration.last_sync.split(' ')[0]}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        {integration.sync_frequency}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {integration.data_points.toLocaleString()}
                      </Typography>
                      {integration.error_count > 0 && (
                        <Typography variant="caption" color="error">
                          {integration.error_count} errors
                        </Typography>
                      )}
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Test Connection">
                          <IconButton size="small" color="success" onClick={() => handleTestIntegration(integration.id)}>
                            <PlayArrow />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Sync Now">
                          <IconButton size="small" color="info" onClick={() => handleSyncIntegration(integration.id)}>
                            <Sync />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Webhooks Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Webhook Configurations
          </Typography>
          <List>
            {webhooks.map((webhook) => (
              <ListItem key={webhook.id} divider>
                <ListItemIcon>
                  {webhook.status === 'active' ? (
                    <CheckCircle sx={{ color: 'success.main' }} />
                  ) : (
                    <Error sx={{ color: 'error.main' }} />
                  )}
                </ListItemIcon>
                <ListItemText
                  primary={webhook.name}
                  secondary={`${webhook.event_type}  ${webhook.method}  Success: ${webhook.success_rate}%`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={webhook.status}
                      color={getStatusColor(webhook.status)}
                      size="small"
                    />
                    <Tooltip title="View Details">
                      <IconButton size="small" color="primary">
                        <Visibility />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* API Keys Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            API Keys Management
          </Typography>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>Key Name</TableCell>
                  <TableCell>Service</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Usage</TableCell>
                  <TableCell>Last Used</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {apiKeys.map((apiKey) => (
                  <TableRow key={apiKey.id}>
                    <TableCell>
                      <Typography variant="body2" fontWeight="medium">
                        {apiKey.name}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {apiKey.service}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={apiKey.key_type.replace('_', ' ')}
                        size="small"
                        variant="outlined"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {apiKey.usage_count.toLocaleString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {apiKey.last_used.split(' ')[0]}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={apiKey.status}
                        color={getStatusColor(apiKey.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Regenerate Key">
                          <IconButton size="small" color="warning">
                            <Refresh />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Add Integration Dialog */}
      <Dialog open={integrationDialog} onClose={() => setIntegrationDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Add New Integration</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure and connect a new third-party service integration.
          </Typography>
          {/* Add integration form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setIntegrationDialog(false)}>Cancel</Button>
          <Button variant="contained">Add Integration</Button>
        </DialogActions>
      </Dialog>

      {/* API Keys Dialog */}
      <Dialog open={configDialog} onClose={() => setConfigDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>API Keys Management</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Manage API keys for all integrated services and third-party applications.
          </Typography>
          {/* API keys management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setConfigDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default IntegrationScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Home
} from '@mui/icons-material';

const HomeScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus, homes = [] }) => {
  const [selectedItems, setSelectedItems] = useState([]);

  const filteredHomes = homes.filter(home => {
    const matchesSearch = home.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      home.user.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || home.status === filterStatus;
    return matchesSearch && matchesFilter;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'approved': return 'success';
      case 'pending': return 'warning';
      case 'rejected': return 'error';
      default: return 'default';
    }
  };

  const handleItemSelect = (homeId) => {
    setSelectedItems(prev =>
      prev.includes(homeId)
        ? prev.filter(id => id !== homeId)
        : [...prev, homeId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on homes:`, selectedItems);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          {t('homes')} Management
        </Typography>
        <Button variant="contained" startIcon={<Add />}>
          Add New Home
        </Button>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Home sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">156</Typography>
              <Typography variant="body2" color="text.secondary">Total Homes</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">89</Typography>
              <Typography variant="body2" color="text.secondary">Approved</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Visibility sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">12.5K</Typography>
              <Typography variant="body2" color="text.secondary">Total Views</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Search sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">342</Typography>
              <Typography variant="body2" color="text.secondary">Inquiries</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search homes..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="approved">Approved</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="rejected">Rejected</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('approve')}>
                      Approve Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('reject')}>
                      Reject Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Homes Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredHomes.map(home => home.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Title</TableCell>
                  <TableCell>User</TableCell>
                  <TableCell>Price</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Views</TableCell>
                  <TableCell>Inquiries</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredHomes.map((home) => (
                  <TableRow key={home.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(home.id)}
                        onChange={() => handleItemSelect(home.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontWeight="medium">
                        {home.title}
                      </Typography>
                    </TableCell>
                    <TableCell>{home.user}</TableCell>
                    <TableCell>Birr {home.price.toLocaleString()}</TableCell>
                    <TableCell>
                      <Chip
                        label={home.status}
                        color={getStatusColor(home.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>{home.views}</TableCell>
                    <TableCell>{home.inquiries}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <IconButton size="small" color="primary">
                          <Visibility />
                        </IconButton>
                        <IconButton size="small" color="success">
                          <Edit />
                        </IconButton>
                        <IconButton size="small" color="error">
                          <Delete />
                        </IconButton>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>
    </Box>
  );
};

export default HomeScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Help, Support, QuestionAnswer, Book, Description,
  FilterList, ExpandMore, Warning, Error, Info,
  Timeline, Schedule, DateRange, CalendarToday,
  PlayArrow, Download, FileDownload,
  Email, Phone, Message, Chat,
  Person, Group, Business, Work,
  Settings, MoreVert, Star, ThumbUp, ThumbDown,
  OpenInNew, Link,
  Assessment, TrendingUp, TrendingDown,
  Feedback, RateReview, ContactSupport,
  MenuBook, Lightbulb, TipsAndUpdates,
  Bookmark, BookmarkBorder, Share,
  Search as SearchIcon, FilterList as FilterIcon
} from '@mui/icons-material';

const HelpScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [articleDialog, setArticleDialog] = useState(false);
  const [videoDialog, setVideoDialog] = useState(false);

  const helpArticles = [
    {
      id: 1,
      title: 'Getting Started with Yesra Sew',
      content: 'Complete guide to getting started with the Yesra Sew platform',
      category: 'getting_started',
      status: 'published',
      author: 'admin@yesrasew.com',
      views: 12345,
      helpful_count: 89,
      not_helpful_count: 5,
      last_updated: '2024-01-15',
      reading_time: '5 min',
      difficulty: 'beginner',
      tags: ['basics', 'tutorial', 'guide'],
      featured: true
    },
    {
      id: 2,
      title: 'How to Create Property Listings',
      content: 'Step-by-step guide to creating and managing property listings',
      category: 'property_management',
      status: 'published',
      author: 'content_team@yesrasew.com',
      views: 8765,
      helpful_count: 234,
      not_helpful_count: 12,
      last_updated: '2024-01-14',
      reading_time: '8 min',
      difficulty: 'intermediate',
      tags: ['properties', 'listings', 'tutorial'],
      featured: false
    },
    {
      id: 3,
      title: 'Premium Membership Benefits',
      content: 'Understanding the benefits and features of premium membership',
      category: 'membership',
      status: 'published',
      author: 'marketing_team@yesrasew.com',
      views: 5678,
      helpful_count: 156,
      not_helpful_count: 8,
      last_updated: '2024-01-12',
      reading_time: '6 min',
      difficulty: 'beginner',
      tags: ['membership', 'premium', 'features'],
      featured: true
    },
    {
      id: 4,
      title: 'Mobile App Installation Guide',
      content: 'How to install and set up the Yesra Sew mobile application',
      category: 'mobile',
      status: 'draft',
      author: 'mobile_team@yesrasew.com',
      views: 2345,
      helpful_count: 67,
      not_helpful_count: 3,
      last_updated: '2024-01-10',
      reading_time: '4 min',
      difficulty: 'beginner',
      tags: ['mobile', 'app', 'installation'],
      featured: false
    },
    {
      id: 5,
      title: 'Troubleshooting Common Issues',
      content: 'Solutions to common problems and issues users may encounter',
      category: 'troubleshooting',
      status: 'published',
      author: 'support_team@yesrasew.com',
      views: 9876,
      helpful_count: 345,
      not_helpful_count: 23,
      last_updated: '2024-01-08',
      reading_time: '10 min',
      difficulty: 'intermediate',
      tags: ['troubleshooting', 'issues', 'solutions'],
      featured: false
    }
  ];

  const videoTutorials = [
    {
      id: 1,
      title: 'Platform Overview',
      description: 'Complete overview of the Yesra Sew platform features',
      category: 'getting_started',
      duration: '12:30',
      views: 5678,
      thumbnail: '/videos/thumbnails/platform-overview.jpg',
      video_url: 'https://videos.yesrasew.com/platform-overview',
      status: 'published',
      published_at: '2024-01-15',
      presenter: 'John Doe',
      difficulty: 'beginner',
      tags: ['overview', 'features', 'tutorial']
    },
    {
      id: 2,
      title: 'Creating Your First Listing',
      description: 'Step-by-step video guide to creating property listings',
      category: 'property_management',
      duration: '8:45',
      views: 3456,
      thumbnail: '/videos/thumbnails/first-listing.jpg',
      video_url: 'https://videos.yesrasew.com/first-listing',
      status: 'published',
      published_at: '2024-01-14',
      presenter: 'Jane Smith',
      difficulty: 'beginner',
      tags: ['listing', 'tutorial', 'properties']
    },
    {
      id: 3,
      title: 'Advanced Search Techniques',
      description: 'Learn advanced search and filtering techniques',
      category: 'search',
      duration: '6:20',
      views: 2345,
      thumbnail: '/videos/thumbnails/advanced-search.jpg',
      video_url: 'https://videos.yesrasew.com/advanced-search',
      status: 'published',
      published_at: '2024-01-12',
      presenter: 'Mike Johnson',
      difficulty: 'intermediate',
      tags: ['search', 'advanced', 'techniques']
    }
  ];

  const faqItems = [
    {
      id: 1,
      question: 'How do I create a property listing?',
      answer: 'To create a property listing, click on the "Add Property" button in your dashboard. Fill in all required information including property details, photos, and contact information. Once complete, submit for review.',
      category: 'property_management',
      views: 1234,
      helpful_count: 89,
      last_updated: '2024-01-15',
      priority: 'high'
    },
    {
      id: 2,
      question: 'What are the benefits of premium membership?',
      answer: 'Premium membership includes unlimited property listings, featured placement, advanced analytics, priority support, and access to exclusive features. Premium members also get reduced commission rates.',
      category: 'membership',
      views: 987,
      helpful_count: 67,
      last_updated: '2024-01-14',
      priority: 'medium'
    },
    {
      id: 3,
      question: 'How do I reset my password?',
      answer: 'Click on "Forgot Password" on the login page. Enter your registered email address and we will send you a password reset link. Follow the instructions in the email to create a new password.',
      category: 'account',
      views: 654,
      helpful_count: 45,
      last_updated: '2024-01-12',
      priority: 'high'
    },
    {
      id: 4,
      question: 'What payment methods are accepted?',
      answer: 'We accept credit/debit cards, bank transfers, and mobile money payments. All payments are processed securely through our payment partners.',
      category: 'billing',
      views: 432,
      helpful_count: 34,
      last_updated: '2024-01-10',
      priority: 'medium'
    }
  ];

  const helpMetrics = [
    {
      id: 1,
      metric: 'Total Articles',
      value: 156,
      change: '+12',
      trend: 'up',
      status: 'good'
    },
    {
      id: 2,
      metric: 'Video Tutorials',
      value: 23,
      change: '+3',
      trend: 'up',
      status: 'good'
    },
    {
      id: 3,
      metric: 'Helpful Rating',
      value: '87.5%',
      change: '+2.1%',
      trend: 'up',
      status: 'good'
    },
    {
      id: 4,
      metric: 'Support Tickets Reduced',
      value: '23%',
      change: '+5%',
      trend: 'up',
      status: 'excellent'
    }
  ];

  const categories = [
    {
      name: 'Getting Started',
      icon: <Lightbulb />,
      article_count: 15,
      video_count: 5,
      color: '#4CAF50'
    },
    {
      name: 'Property Management',
      icon: <Business />,
      article_count: 23,
      video_count: 8,
      color: '#2196F3'
    },
    {
      name: 'Membership',
      icon: <Star />,
      article_count: 12,
      video_count: 3,
      color: '#FF9800'
    },
    {
      name: 'Mobile App',
      icon: <Phone />,
      article_count: 8,
      video_count: 4,
      color: '#9C27B0'
    },
    {
      name: 'Troubleshooting',
      icon: <Settings />,
      article_count: 18,
      video_count: 6,
      color: '#F44336'
    },
    {
      name: 'Billing',
      icon: <Assessment />,
      article_count: 10,
      video_count: 2,
      color: '#607D8B'
    }
  ];

  const filteredArticles = helpArticles.filter(article => {
    const matchesSearch = article.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      article.description.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || article.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && article.featured) ||
      (activeTab === 2 && article.category === 'getting_started') ||
      (activeTab === 3 && article.category === 'property_management');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'published': return 'success';
      case 'draft': return 'warning';
      case 'archived': return 'default';
      default: return 'default';
    }
  };

  const getDifficultyColor = (difficulty) => {
    switch (difficulty) {
      case 'beginner': return 'success';
      case 'intermediate': return 'warning';
      case 'advanced': return 'error';
      default: return 'default';
    }
  };

  const getCategoryIcon = (category) => {
    const categoryData = categories.find(cat => cat.name.toLowerCase().replace(' ', '_') === category);
    return categoryData ? categoryData.icon : <Description />;
  };

  const handleItemSelect = (articleId) => {
    setSelectedItems(prev =>
      prev.includes(articleId)
        ? prev.filter(id => id !== articleId)
        : [...prev, articleId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on articles:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleRateArticle = (articleId, rating) => {
    console.log(`Rate article ${articleId} as ${rating}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Help & Documentation
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<PlayArrow />} onClick={() => setVideoDialog(true)}>
            Video Tutorials
          </Button>
          <Button variant="contained" startIcon={<Add />} onClick={() => setArticleDialog(true)}>
            Create Article
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Book sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">156</Typography>
              <Typography variant="body2" color="text.secondary">Total Articles</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <PlayArrow sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">23</Typography>
              <Typography variant="body2" color="text.secondary">Video Tutorials</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <ThumbUp sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">87.5%</Typography>
              <Typography variant="body2" color="text.secondary">Helpful Rating</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <TrendingDown sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">23%</Typography>
              <Typography variant="body2" color="text.secondary">Tickets Reduced</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Help Metrics Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Help Center Metrics
          </Typography>
          <Grid container spacing={2}>
            {helpMetrics.map((metric) => (
              <Grid item xs={12} sm={6} md={3} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={metric.change}
                      color={metric.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Chip
                      label={metric.status}
                      color={metric.status === 'excellent' ? 'success' : metric.status === 'good' ? 'info' : 'warning'}
                      size="small"
                      sx={{ ml: 1 }}
                    />
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Categories Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Help Categories
          </Typography>
          <Grid container spacing={2}>
            {categories.map((category, index) => (
              <Grid item xs={12} sm={6} md={2} key={index}>
                <Paper variant="outlined" sx={{ p: 2, textAlign: 'center', cursor: 'pointer' }}>
                  <Box sx={{ color: category.color, mb: 1 }}>
                    {category.icon}
                  </Box>
                  <Typography variant="h6" fontWeight="bold">
                    {category.name}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {category.article_count} articles  {category.video_count} videos
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Content Types */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Articles" />
          <Tab label="Featured" />
          <Tab label="Getting Started" />
          <Tab label="Property Management" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search help articles..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <SearchIcon sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="published">Published</MenuItem>
                  <MenuItem value="draft">Draft</MenuItem>
                  <MenuItem value="archived">Archived</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('publish')}>
                      Publish Selected
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('feature')}>
                      Feature Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('delete')}>
                      Delete Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Help Articles Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredArticles.map(article => article.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Article</TableCell>
                  <TableCell>Category</TableCell>
                  <TableCell>Difficulty</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Views</TableCell>
                  <TableCell>Helpful</TableCell>
                  <TableCell>Last Updated</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredArticles.map((article) => (
                  <TableRow key={article.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(article.id)}
                        onChange={() => handleItemSelect(article.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {article.title}
                          {article.featured && <Star sx={{ fontSize: 16, color: 'gold', ml: 1 }} />}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {article.reading_time} read  by {article.author.split('@')[0]}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getCategoryIcon(article.category)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {article.category.replace('_', ' ')}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={article.difficulty}
                        color={getDifficultyColor(article.difficulty)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={article.status}
                        color={getStatusColor(article.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {article.views.toLocaleString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        <Typography variant="body2">
                          {article.helpful_count}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          /{article.helpful_count + article.not_helpful_count}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {article.last_updated}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Article">
                          <IconButton size="small" color="primary">
                            <OpenInNew />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Edit">
                          <IconButton size="small" color="info">
                            <Edit />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Helpful">
                          <IconButton size="small" color="success" onClick={() => handleRateArticle(article.id, 'helpful')}>
                            <ThumbUp />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Video Tutorials Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Video Tutorials
          </Typography>
          <Grid container spacing={2}>
            {videoTutorials.map((video) => (
              <Grid item xs={12} md={4} key={video.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    <PlayArrow sx={{ fontSize: 40, color: '#4CAF50', mr: 1 }} />
                    <Box>
                      <Typography variant="h6" fontWeight="bold">
                        {video.title}
                      </Typography>
                      <Typography variant="caption" color="text.secondary">
                        {video.duration}  {video.views.toLocaleString()} views
                      </Typography>
                    </Box>
                  </Box>
                  <Typography variant="body2" color="text.secondary">
                    {video.description}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={video.difficulty}
                      color={getDifficultyColor(video.difficulty)}
                      size="small"
                      sx={{ mr: 1 }}
                    />
                    <Typography variant="caption" color="text.secondary">
                      {video.presenter}
                    </Typography>
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* FAQ Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Frequently Asked Questions
          </Typography>
          {faqItems.map((faq) => (
            <Accordion key={faq.id}>
              <AccordionSummary expandIcon={<ExpandMore />}>
                <Box sx={{ display: 'flex', alignItems: 'center', width: '100%' }}>
                  <QuestionAnswer sx={{ mr: 1, color: '#2196F3' }} />
                  <Typography variant="h6" fontWeight="medium">
                    {faq.question}
                  </Typography>
                  <Box sx={{ ml: 'auto', display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={faq.priority}
                      color={faq.priority === 'high' ? 'error' : 'default'}
                      size="small"
                    />
                    <Typography variant="caption" color="text.secondary">
                      {faq.views} views
                    </Typography>
                  </Box>
                </Box>
              </AccordionSummary>
              <AccordionDetails>
                <Typography variant="body2" color="text.secondary">
                  {faq.answer}
                </Typography>
                <Box sx={{ display: 'flex', alignItems: 'center', mt: 2 }}>
                  <Typography variant="caption" color="text.secondary">
                    Helpful: {faq.helpful_count}  Updated: {faq.last_updated}
                  </Typography>
                </Box>
              </AccordionDetails>
            </Accordion>
          ))}
        </CardContent>
      </Card>

      {/* Create Article Dialog */}
      <Dialog open={articleDialog} onClose={() => setArticleDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Create Help Article</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create a new help article with rich content and multimedia support.
          </Typography>
          {/* Create article form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setArticleDialog(false)}>Cancel</Button>
          <Button variant="contained">Create Article</Button>
        </DialogActions>
      </Dialog>

      {/* Video Tutorials Dialog */}
      <Dialog open={videoDialog} onClose={() => setVideoDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Video Tutorials</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Manage video tutorials, transcripts, and learning resources.
          </Typography>
          {/* Video tutorials management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setVideoDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default HelpScreen;
import React from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Chip, IconButton
} from '@mui/material';
import {
  Payments, AccessTime, TrendingUp, People, Visibility, CheckCircle, Cancel
} from '@mui/icons-material';

const StatCard = ({ title, value, icon, color }) => (
  <Card>
    <CardContent sx={{ textAlign: 'center', py: 3 }}>
      <Box sx={{ color, mb: 1 }}>{icon}</Box>
      <Typography variant="h4" fontWeight="bold" color={color}>
        {value}
      </Typography>
      <Typography variant="body2" color="text.secondary">
        {title}
      </Typography>
    </CardContent>
  </Card>
);

const FinancialScreen = ({ t, stats }) => {
  const transactions = [
    { id: 'TRX001', user: 'John Doe', type: 'Listing Fee', amount: 'ETB 500', status: 'completed', date: '2024-01-15' },
    { id: 'TRX002', user: 'Jane Smith', type: 'Premium Subscription', amount: 'ETB 2,500', status: 'completed', date: '2024-01-15' },
    { id: 'TRX003', user: 'Mike Johnson', type: 'Featured Listing', amount: 'ETB 1,000', status: 'pending', date: '2024-01-14' },
    { id: 'TRX004', user: 'Sarah Williams', type: 'Commission', amount: 'ETB 250', status: 'completed', date: '2024-01-14' },
    { id: 'TRX005', user: 'David Brown', type: 'Refund', amount: 'ETB -500', status: 'processed', date: '2024-01-13' },
    { id: 'TRX006', user: 'Lisa Anderson', type: 'Listing Fee', amount: 'ETB 750', status: 'failed', date: '2024-01-13' }
  ];

  const payouts = [
    { user: 'Alice Cooper', amount: 'ETB 5,000', requested: '2 days ago' },
    { user: 'Bob Martin', amount: 'ETB 3,500', requested: '3 days ago' },
    { user: 'Carol White', amount: 'ETB 7,200', requested: '5 days ago' }
  ];

  const revenueByCategory = [
    { category: 'Cars', transactions: 89, revenue: 'ETB 445,000', growth: '+12.5%' },
    { category: 'Jobs', transactions: 156, revenue: 'ETB 312,000', growth: '+8.3%' },
    { category: 'Homes', transactions: 67, revenue: 'ETB 502,500', growth: '+15.7%' },
    { category: 'Tender', transactions: 23, revenue: 'ETB 345,000', growth: '+22.1%' },
    { category: 'Home', transactions: 45, revenue: 'ETB 112,500', growth: '+5.2%' }
  ];

  return (
    <Box>
      <Grid container spacing={3}>
        {/* Revenue Overview */}
        <Grid item xs={12} md={3}>
          <StatCard 
            title="totalRevenue" 
            value={`ETB ${stats.revenue.toLocaleString()}`} 
            icon={<Payments />}
            color="#2e7d32"
          />
        </Grid>
        <Grid item xs={12} md={3}>
          <StatCard 
            title="pendingPayouts" 
            value="ETB 45,000" 
            icon={<AccessTime />}
            color="#ed6c02"
          />
        </Grid>
        <Grid item xs={12} md={3}>
          <StatCard 
            title="commissionEarned" 
            value="ETB 12,500" 
            icon={<TrendingUp />}
            color="#1976d2"
          />
        </Grid>
        <Grid item xs={12} md={3}>
          <StatCard 
            title="activeSubscriptions" 
            value="234" 
            icon={<People />}
            color="#9c27b0"
          />
        </Grid>

        {/* Revenue Chart */}
        <Grid item xs={12} md={8}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('revenueOverview')}
              </Typography>
              <Box sx={{ height: 300, display: 'flex', alignItems: 'center', justifyContent: 'center', bgcolor: 'grey.100', borderRadius: 1 }}>
                <Box sx={{ textAlign: 'center' }}>
                  <TrendingUp sx={{ fontSize: 48, color: 'success.main', mb: 2 }} />
                  <Typography variant="h4" color="success.main" gutterBottom>
                    ETB 2,456,789
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {t('totalRevenue')} - {t('last30Days')}
                  </Typography>
                  <Typography variant="body2" color="success.main" sx={{ mt: 1 }}>
                     23.5% {t('fromLastMonth')}
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Quick Stats */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('financialStats')}
              </Typography>
              <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('avgTransaction')}</Typography>
                  <Typography variant="h6" color="primary.main">ETB 2,345</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('commissionRate')}</Typography>
                  <Typography variant="h6" color="success.main">5.2%</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('refundRate')}</Typography>
                  <Typography variant="h6" color="error.main">1.8%</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('successRate')}</Typography>
                  <Typography variant="h6" color="info.main">98.2%</Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Transactions Table */}
        <Grid item xs={12}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('recentTransactions')}
              </Typography>
              <TableContainer>
                <Table>
                  <TableHead>
                    <TableRow>
                      <TableCell>{t('transactionId')}</TableCell>
                      <TableCell>{t('user')}</TableCell>
                      <TableCell>{t('type')}</TableCell>
                      <TableCell>{t('amount')}</TableCell>
                      <TableCell>{t('status')}</TableCell>
                      <TableCell>{t('date')}</TableCell>
                      <TableCell>{t('actions')}</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {transactions.map((transaction, i) => (
                      <TableRow key={i}>
                        <TableCell>
                          <Typography variant="body2" fontWeight="medium">
                            {transaction.id}
                          </Typography>
                        </TableCell>
                        <TableCell>{transaction.user}</TableCell>
                        <TableCell>
                          <Chip size="small" label={transaction.type} />
                        </TableCell>
                        <TableCell>
                          <Typography variant="body2" color={transaction.amount.startsWith('-') ? 'error.main' : 'success.main'} fontWeight="medium">
                            {transaction.amount}
                          </Typography>
                        </TableCell>
                        <TableCell>
                          <Chip 
                            size="small" 
                            label={transaction.status} 
                            color={
                              transaction.status === 'completed' ? 'success' : 
                              transaction.status === 'pending' ? 'warning' : 
                              transaction.status === 'processed' ? 'info' : 'error'
                            }
                          />
                        </TableCell>
                        <TableCell>{transaction.date}</TableCell>
                        <TableCell>
                          <Box sx={{ display: 'flex', gap: 1 }}>
                            <IconButton size="small">
                              <Visibility />
                            </IconButton>
                            {transaction.status === 'pending' && (
                              <IconButton size="small" color="success">
                                <CheckCircle />
                              </IconButton>
                            )}
                          </Box>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </TableContainer>
            </CardContent>
          </Card>
        </Grid>

        {/* Payout Management */}
        <Grid item xs={12} md={6}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('pendingPayouts')}
              </Typography>
              <TableContainer>
                <Table size="small">
                  <TableHead>
                    <TableRow>
                      <TableCell>{t('user')}</TableCell>
                      <TableCell>{t('amount')}</TableCell>
                      <TableCell>{t('requested')}</TableCell>
                      <TableCell>{t('actions')}</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {payouts.map((payout, i) => (
                      <TableRow key={i}>
                        <TableCell>{payout.user}</TableCell>
                        <TableCell>
                          <Typography variant="body2" color="success.main" fontWeight="medium">
                            {payout.amount}
                          </Typography>
                        </TableCell>
                        <TableCell>{payout.requested}</TableCell>
                        <TableCell>
                          <Box sx={{ display: 'flex', gap: 1 }}>
                            <IconButton size="small" color="success">
                              <CheckCircle />
                            </IconButton>
                            <IconButton size="small" color="error">
                              <Cancel />
                            </IconButton>
                          </Box>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </TableContainer>
            </CardContent>
          </Card>
        </Grid>

        {/* Revenue by Category */}
        <Grid item xs={12} md={6}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('revenueByCategory')}
              </Typography>
              <TableContainer>
                <Table size="small">
                  <TableHead>
                    <TableRow>
                      <TableCell>{t('category')}</TableCell>
                      <TableCell>{t('transactions')}</TableCell>
                      <TableCell>{t('revenue')}</TableCell>
                      <TableCell>{t('growth')}</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {revenueByCategory.map((cat, i) => (
                      <TableRow key={i}>
                        <TableCell>{cat.category}</TableCell>
                        <TableCell>{cat.transactions}</TableCell>
                        <TableCell>
                          <Typography variant="body2" color="success.main" fontWeight="medium">
                            {cat.revenue}
                          </Typography>
                        </TableCell>
                        <TableCell>
                          <Typography variant="body2" color="success.main">
                            {cat.growth}
                          </Typography>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </TableContainer>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
};

export default FinancialScreen;
import React from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  useTheme, useMediaQuery, Container, Paper, Avatar, IconButton
} from '@mui/material';
import {
  Add, People, TrendingUp, Settings, Assignment, AccessTime,
  Payments, CheckCircle, Person, Home, DirectionsCar, Work,
  Visibility, Edit, Delete
} from '@mui/icons-material';
import { 
  useResponsive, 
  getResponsiveGridItemSize, 
  getResponsiveCardProps,
  getResponsiveTableProps,
  getResponsiveTypography
} from '../utils/responsive';

const StatCard = ({ title, value, icon, color, isMobile, isTablet }) => {
  const cardProps = getResponsiveCardProps(isMobile, isTablet);
  const typography = getResponsiveTypography('h4', isMobile, isTablet);
  
  return (
    <Card {...cardProps}>
      <CardContent sx={{ 
        textAlign: 'center', 
        py: { xs: 2, sm: 2.5, md: 3 },
        px: { xs: 1, sm: 2, md: 3 }
      }}>
        <Box sx={{ color, mb: 1, fontSize: { xs: '2rem', sm: '2.5rem', md: '3rem' } }}>
          {icon}
        </Box>
        <Typography 
          variant={typography.variant} 
          fontWeight="bold" 
          color={color}
          sx={{ fontSize: typography.fontSize }}
        >
          {value}
        </Typography>
        <Typography 
          variant={isMobile ? "caption" : "body2"} 
          color="text.secondary"
          sx={{ fontSize: { xs: '0.75rem', sm: '0.875rem', md: '1rem' } }}
        >
          {title}
        </Typography>
      </CardContent>
    </Card>
  );
};

const ActivityItem = ({ activity, isMobile, isTablet }) => (
  <Box
    sx={{
      display: 'flex',
      alignItems: 'center',
      py: { xs: 1, sm: 1.5, md: 2 },
      px: { xs: 1, sm: 2, md: 3 },
      borderBottom: '1px solid',
      borderColor: 'divider',
      '&:hover': {
        backgroundColor: 'action.hover',
      }
    }}
  >
    <Avatar sx={{ mr: { xs: 1, sm: 2 }, width: { xs: 32, sm: 40 }, height: { xs: 32, sm: 40 } }}>
      <Person />
    </Avatar>
    <Box sx={{ flex: 1, minWidth: 0 }}>
      <Typography 
        variant={isMobile ? "body2" : "body1"}
        sx={{ 
          fontWeight: 500,
          overflow: 'hidden',
          textOverflow: 'ellipsis',
          whiteSpace: 'nowrap'
        }}
      >
        {activity.activity}
      </Typography>
      <Box sx={{ display: 'flex', alignItems: 'center', mt: 0.5 }}>
        <Typography 
          variant={isMobile ? "caption" : "body2"} 
          color="text.secondary"
          sx={{ mr: 1 }}
        >
          {activity.user}
        </Typography>
        <Typography 
          variant={isMobile ? "caption" : "caption"} 
          color="text.secondary"
        >
          {activity.timestamp}
        </Typography>
      </Box>
    </Box>
    <Chip
      label={activity.status}
      size={isMobile ? "small" : "medium"}
      color={
        activity.status === 'success' ? 'success' :
        activity.status === 'warning' ? 'warning' : 'default'
      }
      sx={{ ml: { xs: 1, sm: 2 } }}
    />
  </Box>
);

const DashboardScreen = ({ t, showBackendWarning, stats = {} }) => {
  const { isMobile, isTablet, isDesktop } = useResponsive();
  const theme = useTheme();
  
  // Default stats to prevent undefined errors
  const safeStats = {
    totalListings: stats.totalListings || 0,
    pendingReview: stats.pendingReview || 0,
    approvedListings: stats.approvedListings || 0,
    rejectedListings: stats.rejectedListings || 0,
    totalUsers: stats.totalUsers || 0,
    activeUsers: stats.activeUsers || 0,
    revenue: stats.revenue || 0,
    pendingReviews: stats.pendingReview || 0
  };

  const activities = [
    { activity: 'New tender posted', user: 'John Doe', timestamp: '2 hours ago', status: 'success' },
    { activity: 'Home listing approved', user: 'Admin', timestamp: '3 hours ago', status: 'success' },
    { activity: 'Car listing rejected', user: 'Admin', timestamp: '5 hours ago', status: 'warning' },
    { activity: 'New user registered', user: 'Jane Smith', timestamp: '6 hours ago', status: 'success' },
    { activity: 'Job posting updated', user: 'Mike Johnson', timestamp: '8 hours ago', status: 'info' }
  ];

  const recentListings = [
    { id: 1, title: 'Modern Apartment', type: 'Home', price: '$450,000', status: 'pending', user: 'John Doe' },
    { id: 2, title: 'Toyota Camry 2020', type: 'Car', price: '$25,000', status: 'approved', user: 'Jane Smith' },
    { id: 3, title: 'Software Developer', type: 'Job', price: '$80,000/year', status: 'pending', user: 'Mike Johnson' },
    { id: 4, title: 'Luxury Villa', type: 'Home', price: '$1,200,000', status: 'approved', user: 'Sarah Wilson' },
  ];

  const statCards = [
    { title: 'Total Listings', value: safeStats.totalListings, icon: <Home />, color: '#2196F3' },
    { title: 'Pending Review', value: safeStats.pendingReview, icon: <AccessTime />, color: '#FF9800' },
    { title: 'Approved', value: safeStats.approvedListings, icon: <CheckCircle />, color: '#4CAF50' },
    { title: 'Total Users', value: safeStats.totalUsers, icon: <People />, color: '#9C27B0' },
    { title: 'Active Users', value: safeStats.activeUsers, icon: <TrendingUp />, color: '#00BCD4' },
    { title: 'Revenue', value: `$${safeStats.revenue.toLocaleString()}`, icon: <Payments />, color: '#FF5722' },
  ];

  const tableProps = getResponsiveTableProps(isMobile, isTablet);

  return (
    <Box>
      {showBackendWarning && (
        <Card sx={{ mb: { xs: 2, sm: 3 } }}>
          <CardContent sx={{ px: { xs: 2, sm: 3 }, py: { xs: 1.5, sm: 2 } }}>
            <Typography 
              variant={isMobile ? "h6" : "h5"} 
              color="warning.main"
              sx={{ fontSize: { xs: '1rem', sm: '1.25rem', md: '1.5rem' } }}
            >
              Backend Connection Warning
            </Typography>
            <Typography 
              variant={isMobile ? "body2" : "body1"} 
              sx={{ mt: 1, fontSize: { xs: '0.875rem', sm: '1rem' } }}
            >
              Backend services are currently unavailable. Some features may not work as expected.
            </Typography>
          </CardContent>
        </Card>
      )}

      {/* Stats Cards */}
      <Grid 
        container 
        spacing={{ xs: 1, sm: 2, md: 3 }} 
        sx={{ mb: { xs: 2, sm: 3 } }}
      >
        {statCards.map((card, index) => {
          const gridProps = getResponsiveGridItemSize(index < 3 ? 6 : 12, isMobile, isTablet);
          return (
            <Grid item {...gridProps} key={index}>
              <StatCard {...card} isMobile={isMobile} isTablet={isTablet} />
            </Grid>
          );
        })}
      </Grid>

      {/* Main Content Grid */}
      <Grid container spacing={{ xs: 2, sm: 3 }}>
        {/* Recent Activities */}
        <Grid item xs={12} md={6}>
          <Paper sx={{ height: '100%' }}>
            <Box sx={{ p: { xs: 2, sm: 3 } }}>
              <Typography 
                variant={isMobile ? "h6" : "h5"} 
                fontWeight="bold"
                sx={{ fontSize: { xs: '1.125rem', sm: '1.25rem', md: '1.5rem' } }}
              >
                Recent Activities
              </Typography>
            </Box>
            <Box sx={{ maxHeight: { xs: 300, sm: 400 }, overflow: 'auto' }}>
              {activities.map((activity, index) => (
                <ActivityItem 
                  key={index} 
                  activity={activity} 
                  isMobile={isMobile} 
                  isTablet={isTablet} 
                />
              ))}
            </Box>
          </Paper>
        </Grid>

        {/* Recent Listings */}
        <Grid item xs={12} md={6}>
          <Paper sx={{ height: '100%' }}>
            <Box sx={{ p: { xs: 2, sm: 3 } }}>
              <Typography 
                variant={isMobile ? "h6" : "h5"} 
                fontWeight="bold"
                sx={{ fontSize: { xs: '1.125rem', sm: '1.25rem', md: '1.5rem' } }}
              >
                Recent Listings
              </Typography>
            </Box>
            <TableContainer sx={{ maxHeight: { xs: 300, sm: 400 } }}>
              <Table {...tableProps}>
                <TableHead>
                  <TableRow>
                    <TableCell>Title</TableCell>
                    {!isMobile && <TableCell>Type</TableCell>}
                    <TableCell>Price</TableCell>
                    <TableCell>Status</TableCell>
                    <TableCell>Actions</TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  {recentListings.map((listing) => (
                    <TableRow key={listing.id}>
                      <TableCell>
                        <Box>
                          <Typography 
                            variant={isMobile ? "caption" : "body2"}
                            sx={{ fontWeight: 500 }}
                          >
                            {listing.title}
                          </Typography>
                          {!isMobile && (
                            <Typography variant="caption" color="text.secondary">
                              {listing.user}
                            </Typography>
                          )}
                        </Box>
                      </TableCell>
                      {!isMobile && <TableCell>{listing.type}</TableCell>}
                      <TableCell>{listing.price}</TableCell>
                      <TableCell>
                        <Chip
                          label={listing.status}
                          size="small"
                          color={listing.status === 'approved' ? 'success' : 'warning'}
                        />
                      </TableCell>
                      <TableCell>
                        <Box sx={{ display: 'flex', gap: 0.5 }}>
                          <IconButton size="small" color="primary">
                            <Visibility fontSize="small" />
                          </IconButton>
                          {!isMobile && (
                            <IconButton size="small" color="info">
                              <Edit fontSize="small" />
                            </IconButton>
                          )}
                        </Box>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </TableContainer>
          </Paper>
        </Grid>
      </Grid>
    </Box>
  );
};

export default DashboardScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Security, Warning, Report, Flag, ThumbUp, ThumbDown,
  Block, Person, Comment, Image, Article, Link,
  PriorityHigh, Schedule, History, FilterList, Shield,
  Gavel, Policy, Verified, Pending, NotInterested
} from '@mui/icons-material';

const ContentModerationScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [reviewDialog, setReviewDialog] = useState(false);
  const [rulesDialog, setRulesDialog] = useState(false);

  const reportedContent = [
    {
      id: 1,
      type: 'listing',
      title: 'Luxury Apartment in Bole',
      category: 'real_estate',
      reporter: 'user123',
      reason: 'misleading_information',
      description: 'Photos do not match actual property',
      status: 'pending',
      severity: 'medium',
      reported_at: '2024-01-15 14:30',
      content_id: 'L-1234',
      reports_count: 3
    },
    {
      id: 2,
      type: 'comment',
      title: 'Comment on Tender #567',
      category: 'tender',
      reporter: 'admin_user',
      reason: 'inappropriate_language',
      description: 'Contains offensive language',
      status: 'under_review',
      severity: 'high',
      reported_at: '2024-01-15 12:15',
      content_id: 'C-567',
      reports_count: 5
    },
    {
      id: 3,
      type: 'user_profile',
      title: 'User Profile: john_doe',
      category: 'user',
      reporter: 'system',
      reason: 'fake_account',
      description: 'Suspicious activity detected',
      status: 'pending',
      severity: 'high',
      reported_at: '2024-01-15 10:45',
      content_id: 'U-789',
      reports_count: 2
    },
    {
      id: 4,
      type: 'image',
      title: 'Image in Car Listing',
      category: 'vehicles',
      reporter: 'user456',
      reason: 'inappropriate_content',
      description: 'Image contains offensive material',
      status: 'resolved',
      severity: 'high',
      reported_at: '2024-01-14 16:20',
      content_id: 'I-1011',
      reports_count: 8
    },
    {
      id: 5,
      type: 'listing',
      title: 'Job Posting: Software Developer',
      category: 'jobs',
      reporter: 'user789',
      reason: 'spam',
      description: 'Repeated posting of same job',
      status: 'pending',
      severity: 'low',
      reported_at: '2024-01-14 09:30',
      content_id: 'L-1213',
      reports_count: 1
    }
  ];

  const moderationRules = [
    {
      id: 1,
      name: 'No Inappropriate Language',
      category: 'content',
      type: 'automatic',
      severity: 'medium',
      action: 'flag_for_review',
      status: 'active',
      matches_count: 45,
      last_triggered: '2024-01-15 12:15'
    },
    {
      id: 2,
      name: 'Duplicate Listings Detection',
      category: 'listings',
      type: 'automatic',
      severity: 'low',
      action: 'flag_for_review',
      status: 'active',
      matches_count: 12,
      last_triggered: '2024-01-14 09:30'
    },
    {
      id: 3,
      name: 'Spam Detection',
      category: 'content',
      type: 'automatic',
      severity: 'high',
      action: 'auto_reject',
      status: 'active',
      matches_count: 89,
      last_triggered: '2024-01-15 14:30'
    },
    {
      id: 4,
      name: 'Image Content Filter',
      category: 'media',
      type: 'automatic',
      severity: 'high',
      action: 'flag_for_review',
      status: 'active',
      matches_count: 3,
      last_triggered: '2024-01-14 16:20'
    }
  ];

  const filteredReports = reportedContent.filter(report => {
    const matchesSearch = report.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      report.reason.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || report.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && report.status === 'pending') ||
      (activeTab === 2 && report.status === 'under_review') ||
      (activeTab === 3 && report.status === 'resolved');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'pending': return 'warning';
      case 'under_review': return 'info';
      case 'resolved': return 'success';
      case 'rejected': return 'error';
      default: return 'default';
    }
  };

  const getSeverityColor = (severity) => {
    switch (severity) {
      case 'high': return 'error';
      case 'medium': return 'warning';
      case 'low': return 'success';
      default: return 'default';
    }
  };

  const getTypeIcon = (type) => {
    switch (type) {
      case 'listing': return <Article sx={{ fontSize: 20 }} />;
      case 'comment': return <Comment sx={{ fontSize: 20 }} />;
      case 'user_profile': return <Person sx={{ fontSize: 20 }} />;
      case 'image': return <Image sx={{ fontSize: 20 }} />;
      case 'link': return <Link sx={{ fontSize: 20 }} />;
      default: return <Report sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (reportId) => {
    setSelectedItems(prev =>
      prev.includes(reportId)
        ? prev.filter(id => id !== reportId)
        : [...prev, reportId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on reports:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleApprove = (reportId) => {
    console.log(`Approve report: ${reportId}`);
  };

  const handleReject = (reportId) => {
    console.log(`Reject report: ${reportId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Content Moderation
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Policy />} onClick={() => setRulesDialog(true)}>
            Manage Rules
          </Button>
          <Button variant="contained" startIcon={<Security />}>
            Review Queue
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Report sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">19</Typography>
              <Typography variant="body2" color="text.secondary">Pending Reviews</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Security sx={{ fontSize: 40, color: '#F44336', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">8</Typography>
              <Typography variant="body2" color="text.secondary">High Priority</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">156</Typography>
              <Typography variant="body2" color="text.secondary">Resolved Today</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Shield sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">4</Typography>
              <Typography variant="body2" color="text.secondary">Active Rules</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Alert for High Priority Items */}
      <Alert severity="warning" sx={{ mb: 3 }}>
        <Typography variant="body2">
          <strong>8 high priority items</strong> require immediate attention. Click "Review Queue" to handle them first.
        </Typography>
      </Alert>

      {/* Tabs for Status */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Reports" />
          <Tab label="Pending" />
          <Tab label="Under Review" />
          <Tab label="Resolved" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search reports..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="under_review">Under Review</MenuItem>
                  <MenuItem value="resolved">Resolved</MenuItem>
                  <MenuItem value="rejected">Rejected</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('approve')}>
                      Approve Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('reject')}>
                      Reject Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Reports Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredReports.map(report => report.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Content</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Reporter</TableCell>
                  <TableCell>Reason</TableCell>
                  <TableCell>Severity</TableCell>
                  <TableCell>Reports</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Reported At</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredReports.map((report) => (
                  <TableRow key={report.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(report.id)}
                        onChange={() => handleItemSelect(report.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {report.title}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          ID: {report.content_id}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getTypeIcon(report.type)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {report.type.replace('_', ' ')}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>{report.reporter}</TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {report.reason.replace('_', ' ')}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {report.description}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={report.severity}
                        color={getSeverityColor(report.severity)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Badge badgeContent={report.reports_count} color="error">
                        <Flag sx={{ fontSize: 20 }} />
                      </Badge>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={report.status.replace('_', ' ')}
                        color={getStatusColor(report.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>{report.reported_at}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <IconButton size="small" color="primary">
                          <Visibility />
                        </IconButton>
                        <IconButton size="small" color="success" onClick={() => handleApprove(report.id)}>
                          <ThumbUp />
                        </IconButton>
                        <IconButton size="small" color="error" onClick={() => handleReject(report.id)}>
                          <ThumbDown />
                        </IconButton>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Moderation Rules Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Active Moderation Rules
          </Typography>
          <List>
            {moderationRules.map((rule) => (
              <ListItem key={rule.id} divider>
                <ListItemIcon>
                  <Policy sx={{ color: rule.status === 'active' ? 'success.main' : 'text.secondary' }} />
                </ListItemIcon>
                <ListItemText
                  primary={rule.name}
                  secondary={`${rule.category}  ${rule.type}  ${rule.matches_count} matches  Last: ${rule.last_triggered}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={rule.severity}
                      color={getSeverityColor(rule.severity)}
                      size="small"
                    />
                    <Chip
                      label={rule.status}
                      color={rule.status === 'active' ? 'success' : 'default'}
                      size="small"
                    />
                    <Switch
                      checked={rule.status === 'active'}
                      size="small"
                    />
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Review Dialog */}
      <Dialog open={reviewDialog} onClose={() => setReviewDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Review Content</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Review the reported content and take appropriate action.
          </Typography>
          {/* Review form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setReviewDialog(false)}>Cancel</Button>
          <Button variant="contained" color="error">Reject Content</Button>
          <Button variant="contained" color="success">Approve Content</Button>
        </DialogActions>
      </Dialog>

      {/* Rules Dialog */}
      <Dialog open={rulesDialog} onClose={() => setRulesDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Manage Moderation Rules</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure automatic content moderation rules and policies.
          </Typography>
          {/* Rules management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setRulesDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default ContentModerationScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails, InputAdornment, Rating, CircularProgress
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Business, LocationOn, Phone, Email, CalendarToday, ExpandMore,
  Star, TrendingUp, Assessment, FilterList, MoreVert,
  Verified, Pending, Error, AdminPanelSettings, SupervisorAccount,
  Group, Work, AssignmentInd, AccountBalance, Storefront, CorporateFare,
  Domain, GpsFixed, Language, Public, Lock, Security, Warning,
  Block, Unblock, Schedule, History, Analytics, AttachFile
} from '@mui/icons-material';

const CompaniesScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [companyDialog, setCompanyDialog] = useState(false);
  const [verificationDialog, setVerificationDialog] = useState(false);
  const [selectedCompany, setSelectedCompany] = useState(null);

  // Mock companies data
  const companies = [
    {
      id: 1,
      name: 'EthioTech Solutions PLC',
      business_type: 'Technology',
      registration_number: 'ETH/2023/001234',
      email: 'info@ethiotech.com',
      phone: '+251118765432',
      website: 'www.ethiotech.com',
      location: 'Addis Ababa, Bole District',
      status: 'active',
      verification_status: 'verified',
      subscription_plan: 'Premium',
      registration_date: '2023-01-15',
      last_active: '2024-01-15 14:30',
      employees_count: 45,
      listings_count: 23,
      revenue: 'ETB 2,500,000',
      rating: 4.8,
      reviews_count: 156,
      contact_person: 'Abebe Kebede',
      contact_position: 'CEO',
      description: 'Leading technology solutions provider in Ethiopia',
      services: ['Software Development', 'IT Consulting', 'Cloud Services'],
      documents_count: 12,
      compliance_score: 92,
      membership_tier: 'Gold'
    },
    {
      id: 2,
      name: 'Addis Construction Group',
      business_type: 'Construction',
      registration_number: 'ETH/2022/005678',
      email: 'contact@addisconstruction.et',
      phone: '+251116543210',
      website: 'www.addisconstruction.et',
      location: 'Addis Ababa, Kirkos District',
      status: 'active',
      verification_status: 'verified',
      subscription_plan: 'Professional',
      registration_date: '2022-06-20',
      last_active: '2024-01-14 09:15',
      employees_count: 120,
      listings_count: 45,
      revenue: 'ETB 8,750,000',
      rating: 4.6,
      reviews_count: 89,
      contact_person: 'Dawit Haile',
      contact_position: 'Managing Director',
      description: 'Premier construction and real estate development company',
      services: ['Building Construction', 'Infrastructure', 'Real Estate'],
      documents_count: 28,
      compliance_score: 88,
      membership_tier: 'Platinum'
    },
    {
      id: 3,
      name: 'Mega Import Export LLC',
      business_type: 'Trading',
      registration_number: 'ETH/2023/009012',
      email: 'info@megaimpex.com',
      phone: '+251112345678',
      website: 'www.megaimpex.com',
      location: 'Dire Dawa, Industrial Zone',
      status: 'pending',
      verification_status: 'pending',
      subscription_plan: 'Basic',
      registration_date: '2023-11-10',
      last_active: '2024-01-13 16:45',
      employees_count: 15,
      listings_count: 8,
      revenue: 'ETB 450,000',
      rating: 4.2,
      reviews_count: 23,
      contact_person: 'Fatima Ahmed',
      contact_position: 'General Manager',
      description: 'International trading company specializing in imports and exports',
      services: ['Import Services', 'Export Services', 'Logistics'],
      documents_count: 6,
      compliance_score: 65,
      membership_tier: 'Silver'
    },
    {
      id: 4,
      name: 'Ethiopian Agricultural Cooperative',
      business_type: 'Agriculture',
      registration_number: 'ETH/2021/003456',
      email: 'coop@ethiagri.et',
      phone: '+251119876543',
      website: 'www.ethiagri.et',
      location: 'Bishoftu, Oromia Region',
      status: 'active',
      verification_status: 'verified',
      subscription_plan: 'Professional',
      registration_date: '2021-03-25',
      last_active: '2024-01-15 11:20',
      employees_count: 85,
      listings_count: 34,
      revenue: 'ETB 3,200,000',
      rating: 4.7,
      reviews_count: 112,
      contact_person: 'Chala Bekele',
      contact_position: 'Cooperative Manager',
      description: 'Large-scale agricultural production and distribution',
      services: ['Crop Production', 'Agricultural Equipment', 'Farm Supplies'],
      documents_count: 18,
      compliance_score: 95,
      membership_tier: 'Gold'
    },
    {
      id: 5,
      name: 'Digital Marketing Hub',
      business_type: 'Marketing',
      registration_number: 'ETH/2023/007890',
      email: 'hello@digitalhub.et',
      phone: '+251911234567',
      website: 'www.digitalhub.et',
      location: 'Addis Ababa, Mekelle Avenue',
      status: 'suspended',
      verification_status: 'rejected',
      subscription_plan: 'Basic',
      registration_date: '2023-09-05',
      last_active: '2023-12-20 14:00',
      employees_count: 8,
      listings_count: 3,
      revenue: 'ETB 125,000',
      rating: 3.1,
      reviews_count: 7,
      contact_person: 'Selam Tesfaye',
      contact_position: 'Director',
      description: 'Digital marketing and advertising agency',
      services: ['Social Media Marketing', 'SEO', 'Content Creation'],
      documents_count: 4,
      compliance_score: 42,
      membership_tier: 'Bronze'
    }
  ];

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'pending': return 'warning';
      case 'suspended': return 'error';
      case 'inactive': return 'default';
      default: return 'default';
    }
  };

  const getVerificationColor = (status) => {
    switch (status) {
      case 'verified': return 'success';
      case 'pending': return 'warning';
      case 'rejected': return 'error';
      default: return 'default';
    }
  };

  const getSubscriptionColor = (plan) => {
    switch (plan) {
      case 'Premium': return 'error';
      case 'Professional': return 'warning';
      case 'Basic': return 'info';
      default: return 'default';
    }
  };

  const handleSelectItem = (id) => {
    setSelectedItems(prev =>
      prev.includes(id) ? prev.filter(item => item !== id) : [...prev, id]
    );
  };

  const handleSelectAll = () => {
    if (selectedItems.length === companies.length) {
      setSelectedItems([]);
    } else {
      setSelectedItems(companies.map(company => company.id));
    }
  };

  const handleViewCompany = (company) => {
    setSelectedCompany(company);
    setCompanyDialog(true);
  };

  const handleVerifyCompany = (company) => {
    setSelectedCompany(company);
    setVerificationDialog(true);
  };

  const filteredCompanies = companies.filter(company => {
    const matchesSearch = company.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      company.business_type.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      company.email.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || company.status === filterStatus;
    return matchesSearch && matchesFilter;
  });

  const renderTabContent = () => {
    switch (activeTab) {
      case 0:
        return (
          <TableContainer component={Paper} sx={{ borderRadius: 2, boxShadow: 1 }}>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <Switch
                      checked={selectedItems.length === companies.length}
                      onChange={handleSelectAll}
                      size="small"
                    />
                  </TableCell>
                  <TableCell>Company</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Verification</TableCell>
                  <TableCell>Plan</TableCell>
                  <TableCell>Rating</TableCell>
                  <TableCell>Revenue</TableCell>
                  <TableCell align="center">Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredCompanies.map((company) => (
                  <TableRow key={company.id} hover>
                    <TableCell padding="checkbox">
                      <Switch
                        checked={selectedItems.includes(company.id)}
                        onChange={() => handleSelectItem(company.id)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                        <Avatar sx={{ bgcolor: 'primary.main' }}>
                          <Business />
                        </Avatar>
                        <Box>
                          <Typography variant="body2" fontWeight={600}>
                            {company.name}
                          </Typography>
                          <Typography variant="caption" color="text.secondary">
                            {company.registration_number}
                          </Typography>
                        </Box>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={company.business_type}
                        size="small"
                        variant="outlined"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={company.status}
                        color={getStatusColor(company.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={company.verification_status}
                        color={getVerificationColor(company.verification_status)}
                        size="small"
                        icon={company.verification_status === 'verified' ? <Verified fontSize="small" /> : null}
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={company.subscription_plan}
                        color={getSubscriptionColor(company.subscription_plan)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        <Rating value={company.rating} readOnly size="small" precision={0.1} />
                        <Typography variant="caption">({company.reviews_count})</Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontWeight={500}>
                        {company.revenue}
                      </Typography>
                    </TableCell>
                    <TableCell align="center">
                      <Stack direction="row" spacing={1} justifyContent="center">
                        <Tooltip title="View Details">
                          <IconButton size="small" onClick={() => handleViewCompany(company)}>
                            <Visibility fontSize="small" />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Edit">
                          <IconButton size="small">
                            <Edit fontSize="small" />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Verify">
                          <IconButton size="small" onClick={() => handleVerifyCompany(company)}>
                            <CheckCircle fontSize="small" />
                          </IconButton>
                        </Tooltip>
                      </Stack>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        );

      case 1:
        return (
          <Grid container spacing={3}>
            {filteredCompanies.map((company) => (
              <Grid item xs={12} sm={6} lg={4} key={company.id}>
                <Card sx={{ height: '100%', display: 'flex', flexDirection: 'column' }}>
                  <CardContent sx={{ flexGrow: 1 }}>
                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 2, mb: 2 }}>
                      <Avatar sx={{ bgcolor: 'primary.main', width: 56, height: 56 }}>
                        <Business />
                      </Avatar>
                      <Box sx={{ flexGrow: 1 }}>
                        <Typography variant="h6" fontWeight={600}>
                          {company.name}
                        </Typography>
                        <Typography variant="body2" color="text.secondary">
                          {company.business_type}
                        </Typography>
                      </Box>
                      <Chip
                        label={company.status}
                        color={getStatusColor(company.status)}
                        size="small"
                      />
                    </Box>

                    <Typography variant="body2" sx={{ mb: 2 }}>
                      {company.description}
                    </Typography>

                    <Box sx={{ mb: 2 }}>
                      <Typography variant="caption" color="text.secondary">
                        Contact: {company.contact_person} ({company.contact_position})
                      </Typography>
                    </Box>

                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                      <LocationOn fontSize="small" color="action" />
                      <Typography variant="caption">{company.location}</Typography>
                    </Box>

                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 1 }}>
                      <Phone fontSize="small" color="action" />
                      <Typography variant="caption">{company.phone}</Typography>
                    </Box>

                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mb: 2 }}>
                      <Email fontSize="small" color="action" />
                      <Typography variant="caption">{company.email}</Typography>
                    </Box>

                    <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        <Rating value={company.rating} readOnly size="small" precision={0.1} />
                        <Typography variant="caption">({company.reviews_count})</Typography>
                      </Box>
                      <Typography variant="body2" fontWeight={600} color="primary">
                        {company.revenue}
                      </Typography>
                    </Box>
                  </CardContent>
                  <Box sx={{ p: 2, pt: 0 }}>
                    <Stack direction="row" spacing={1}>
                      <Button size="small" variant="outlined" onClick={() => handleViewCompany(company)}>
                        View
                      </Button>
                      <Button size="small" onClick={() => handleVerifyCompany(company)}>
                        Verify
                      </Button>
                    </Stack>
                  </Box>
                </Card>
              </Grid>
            ))}
          </Grid>
        );

      default:
        return null;
    }
  };

  return (
    <Box sx={{ flexGrow: 1 }}>
      {/* Header */}
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight={600}>
          Companies Management
        </Typography>
        <Stack direction="row" spacing={2}>
          <Button
            variant="outlined"
            startIcon={<Refresh />}
            onClick={handleRefresh}
            disabled={refreshing}
          >
            Refresh
          </Button>
          <Button
            variant="contained"
            startIcon={<Add />}
          >
            Add Company
          </Button>
        </Stack>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent>
              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                <Avatar sx={{ bgcolor: 'primary.main' }}>
                  <Business />
                </Avatar>
                <Box>
                  <Typography variant="h6" fontWeight={600}>
                    {companies.length}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Total Companies
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent>
              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                <Avatar sx={{ bgcolor: 'success.main' }}>
                  <CheckCircle />
                </Avatar>
                <Box>
                  <Typography variant="h6" fontWeight={600}>
                    {companies.filter(c => c.verification_status === 'verified').length}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Verified
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent>
              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                <Avatar sx={{ bgcolor: 'warning.main' }}>
                  <Pending />
                </Avatar>
                <Box>
                  <Typography variant="h6" fontWeight={600}>
                    {companies.filter(c => c.verification_status === 'pending').length}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Pending
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent>
              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                <Avatar sx={{ bgcolor: 'error.main' }}>
                  <TrendingUp />
                </Avatar>
                <Box>
                  <Typography variant="h6" fontWeight={600}>
                    ETB {companies.reduce((sum, c) => sum + parseInt(c.revenue.replace(/[^0-9]/g, '')), 0).toLocaleString()}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    Total Revenue
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Filters */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search companies..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{
                  startAdornment: (
                    <InputAdornment position="start">
                      <Search />
                    </InputAdornment>
                  ),
                }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  onChange={(e) => setFilterStatus(e.target.value)}
                  label="Status"
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="suspended">Suspended</MenuItem>
                  <MenuItem value="inactive">Inactive</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Stack direction="row" spacing={2}>
                <Button
                  variant="outlined"
                  startIcon={<FilterList />}
                  sx={{ flexGrow: 1 }}
                >
                  Advanced Filters
                </Button>
                <Button
                  variant="outlined"
                  startIcon={<Assessment />}
                  sx={{ flexGrow: 1 }}
                >
                  Export Data
                </Button>
              </Stack>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs */}
      <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 3 }}>
        <Tabs value={activeTab} onChange={(e, newValue) => setActiveTab(newValue)}>
          <Tab label="List View" />
          <Tab label="Card View" />
          <Tab label="Analytics" />
        </Tabs>
      </Box>

      {/* Content */}
      {refreshing ? (
        <Box sx={{ display: 'flex', justifyContent: 'center', p: 4 }}>
          <CircularProgress />
        </Box>
      ) : (
        renderTabContent()
      )}

      {/* Company Details Dialog */}
      <Dialog
        open={companyDialog}
        onClose={() => setCompanyDialog(false)}
        maxWidth="md"
        fullWidth
      >
        {selectedCompany && (
          <>
            <DialogTitle>
              <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                <Avatar sx={{ bgcolor: 'primary.main', width: 48, height: 48 }}>
                  <Business />
                </Avatar>
                <Box>
                  <Typography variant="h6">{selectedCompany.name}</Typography>
                  <Typography variant="caption" color="text.secondary">
                    {selectedCompany.registration_number}
                  </Typography>
                </Box>
              </Box>
            </DialogTitle>
            <DialogContent>
              <Grid container spacing={3}>
                <Grid item xs={12} md={6}>
                  <Typography variant="subtitle2" gutterBottom>
                    Company Information
                  </Typography>
                  <List dense>
                    <ListItem>
                      <ListItemText
                        primary="Business Type"
                        secondary={selectedCompany.business_type}
                      />
                    </ListItem>
                    <ListItem>
                      <ListItemText
                        primary="Registration Date"
                        secondary={selectedCompany.registration_date}
                      />
                    </ListItem>
                    <ListItem>
                      <ListItemText
                        primary="Subscription Plan"
                        secondary={selectedCompany.subscription_plan}
                      />
                    </ListItem>
                    <ListItem>
                      <ListItemText
                        primary="Membership Tier"
                        secondary={selectedCompany.membership_tier}
                      />
                    </ListItem>
                  </List>
                </Grid>
                <Grid item xs={12} md={6}>
                  <Typography variant="subtitle2" gutterBottom>
                    Contact Information
                  </Typography>
                  <List dense>
                    <ListItem>
                      <ListItemText
                        primary="Contact Person"
                        secondary={`${selectedCompany.contact_person} (${selectedCompany.contact_position})`}
                      />
                    </ListItem>
                    <ListItem>
                      <ListItemText
                        primary="Email"
                        secondary={selectedCompany.email}
                      />
                    </ListItem>
                    <ListItem>
                      <ListItemText
                        primary="Phone"
                        secondary={selectedCompany.phone}
                      />
                    </ListItem>
                    <ListItem>
                      <ListItemText
                        primary="Website"
                        secondary={selectedCompany.website}
                      />
                    </ListItem>
                  </List>
                </Grid>
                <Grid item xs={12}>
                  <Typography variant="subtitle2" gutterBottom>
                    Description
                  </Typography>
                  <Typography variant="body2">
                    {selectedCompany.description}
                  </Typography>
                </Grid>
                <Grid item xs={12}>
                  <Typography variant="subtitle2" gutterBottom>
                    Services
                  </Typography>
                  <Stack direction="row" spacing={1} flexWrap="wrap">
                    {selectedCompany.services.map((service, index) => (
                      <Chip key={index} label={service} size="small" variant="outlined" />
                    ))}
                  </Stack>
                </Grid>
              </Grid>
            </DialogContent>
            <DialogActions>
              <Button onClick={() => setCompanyDialog(false)}>Close</Button>
              <Button variant="outlined">Edit Company</Button>
              <Button variant="contained">Save Changes</Button>
            </DialogActions>
          </>
        )}
      </Dialog>

      {/* Verification Dialog */}
      <Dialog
        open={verificationDialog}
        onClose={() => setVerificationDialog(false)}
        maxWidth="sm"
        fullWidth
      >
        {selectedCompany && (
          <>
            <DialogTitle>Verify Company</DialogTitle>
            <DialogContent>
              <Typography variant="body1" gutterBottom>
                Do you want to verify "{selectedCompany.name}"?
              </Typography>
              <Typography variant="body2" color="text.secondary">
                This action will mark the company as verified and grant them additional privileges.
              </Typography>
              {selectedCompany.verification_status === 'pending' && (
                <Alert severity="info" sx={{ mt: 2 }}>
                  Please review all company documents before verification.
                </Alert>
              )}
            </DialogContent>
            <DialogActions>
              <Button onClick={() => setVerificationDialog(false)}>Cancel</Button>
              <Button variant="contained" color="success">
                Verify Company
              </Button>
            </DialogActions>
          </>
        )}
      </Dialog>
    </Box>
  );
};

export default CompaniesScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Email, Send, Schedule, MarkEmailRead, MarkEmailUnread,
  PriorityHigh, People, Campaign, Notifications, Announcement,
  Sms, Phone, Mail, Drafts, SendTime, Report, Warning
} from '@mui/icons-material';

const CommunicationScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [composeDialog, setComposeDialog] = useState(false);
  const [templateDialog, setTemplateDialog] = useState(false);

  const communications = [
    {
      id: 1,
      type: 'email',
      subject: 'Welcome to Yesra Sew Platform',
      recipient: 'All Users',
      category: 'announcement',
      status: 'sent',
      sent_at: '2024-01-15 10:30',
      opens: 1250,
      clicks: 89,
      priority: 'normal',
      scheduled: false
    },
    {
      id: 2,
      type: 'sms',
      subject: 'New Tender Opportunities Available',
      recipient: 'Premium Users',
      category: 'tender_alert',
      status: 'sent',
      sent_at: '2024-01-14 15:45',
      opens: 567,
      clicks: 45,
      priority: 'high',
      scheduled: false
    },
    {
      id: 3,
      type: 'email',
      subject: 'Platform Maintenance Notice',
      recipient: 'All Users',
      category: 'system',
      status: 'scheduled',
      sent_at: '2024-01-16 02:00',
      opens: 0,
      clicks: 0,
      priority: 'high',
      scheduled: true
    },
    {
      id: 4,
      type: 'notification',
      subject: 'Your listing has been approved',
      recipient: 'john.doe@email.com',
      category: 'listing_update',
      status: 'sent',
      sent_at: '2024-01-13 09:15',
      opens: 1,
      clicks: 1,
      priority: 'normal',
      scheduled: false
    },
    {
      id: 5,
      type: 'email',
      subject: 'Monthly Newsletter - January 2024',
      recipient: 'Subscribed Users',
      category: 'newsletter',
      status: 'draft',
      sent_at: null,
      opens: 0,
      clicks: 0,
      priority: 'normal',
      scheduled: false
    },
    {
      id: 6,
      type: 'sms',
      subject: 'Urgent: Account Security Alert',
      recipient: 'sarah.wilson@email.com',
      category: 'security',
      status: 'sent',
      sent_at: '2024-01-12 18:30',
      opens: 1,
      clicks: 1,
      priority: 'urgent',
      scheduled: false
    }
  ];

  const templates = [
    {
      id: 1,
      name: 'Welcome Email',
      type: 'email',
      category: 'onboarding',
      usage_count: 1250,
      last_used: '2024-01-15',
      status: 'active'
    },
    {
      id: 2,
      name: 'Tender Alert SMS',
      type: 'sms',
      category: 'tender',
      usage_count: 567,
      last_used: '2024-01-14',
      status: 'active'
    },
    {
      id: 3,
      name: 'Listing Approved',
      type: 'notification',
      category: 'listing',
      usage_count: 89,
      last_used: '2024-01-13',
      status: 'active'
    },
    {
      id: 4,
      name: 'Security Alert',
      type: 'email',
      category: 'security',
      usage_count: 45,
      last_used: '2024-01-12',
      status: 'active'
    }
  ];

  const filteredCommunications = communications.filter(comm => {
    const matchesSearch = comm.subject.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      comm.recipient.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || comm.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && comm.type === 'email') ||
      (activeTab === 2 && comm.type === 'sms') ||
      (activeTab === 3 && comm.type === 'notification');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'sent': return 'success';
      case 'scheduled': return 'warning';
      case 'draft': return 'info';
      case 'failed': return 'error';
      default: return 'default';
    }
  };

  const getPriorityColor = (priority) => {
    switch (priority) {
      case 'urgent': return 'error';
      case 'high': return 'warning';
      case 'normal': return 'success';
      case 'low': return 'default';
      default: return 'default';
    }
  };

  const getTypeIcon = (type) => {
    switch (type) {
      case 'email': return <Email sx={{ fontSize: 20 }} />;
      case 'sms': return <Sms sx={{ fontSize: 20 }} />;
      case 'notification': return <Notifications sx={{ fontSize: 20 }} />;
      default: return <Mail sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (commId) => {
    setSelectedItems(prev =>
      prev.includes(commId)
        ? prev.filter(id => id !== commId)
        : [...prev, commId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on communications:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Communication Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Add />} onClick={() => setTemplateDialog(true)}>
            Manage Templates
          </Button>
          <Button variant="contained" startIcon={<Send />} onClick={() => setComposeDialog(true)}>
            Compose Message
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Email sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">1,824</Typography>
              <Typography variant="body2" color="text.secondary">Total Sent</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <MarkEmailRead sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">1,819</Typography>
              <Typography variant="body2" color="text.secondary">Open Rate: 99.7%</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <People sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">15.2K</Typography>
              <Typography variant="body2" color="text.secondary">Recipients Reached</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Campaign sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">4</Typography>
              <Typography variant="body2" color="text.secondary">Active Templates</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Tabs for Communication Types */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Communications" />
          <Tab label="Email" />
          <Tab label="SMS" />
          <Tab label="Notifications" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search communications..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="sent">Sent</MenuItem>
                  <MenuItem value="scheduled">Scheduled</MenuItem>
                  <MenuItem value="draft">Draft</MenuItem>
                  <MenuItem value="failed">Failed</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('resend')}>
                      Resend Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('delete')}>
                      Delete Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Communications Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredCommunications.map(comm => comm.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Subject</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Recipient</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Priority</TableCell>
                  <TableCell>Performance</TableCell>
                  <TableCell>Sent At</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredCommunications.map((comm) => (
                  <TableRow key={comm.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(comm.id)}
                        onChange={() => handleItemSelect(comm.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {comm.subject}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {comm.category}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getTypeIcon(comm.type)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {comm.type}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>{comm.recipient}</TableCell>
                    <TableCell>
                      <Chip
                        label={comm.status}
                        color={getStatusColor(comm.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={comm.priority}
                        color={getPriorityColor(comm.priority)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          {comm.opens} opens / {comm.clicks} clicks
                        </Typography>
                        {comm.opens > 0 && (
                          <Typography variant="caption" color="text.secondary">
                            {((comm.clicks / comm.opens) * 100).toFixed(1)}% CTR
                          </Typography>
                        )}
                      </Box>
                    </TableCell>
                    <TableCell>
                      {comm.scheduled ? (
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                          <Schedule sx={{ fontSize: 16, color: 'warning.main' }} />
                          <Typography variant="body2">{comm.sent_at}</Typography>
                        </Box>
                      ) : (
                        <Typography variant="body2">{comm.sent_at}</Typography>
                      )}
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <IconButton size="small" color="primary">
                          <Visibility />
                        </IconButton>
                        <IconButton size="small" color="success">
                          <Edit />
                        </IconButton>
                        <IconButton size="small" color="error">
                          <Delete />
                        </IconButton>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Templates Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Communication Templates
          </Typography>
          <List>
            {templates.map((template) => (
              <ListItem key={template.id} divider>
                <ListItemIcon>
                  {getTypeIcon(template.type)}
                </ListItemIcon>
                <ListItemText
                  primary={template.name}
                  secondary={`${template.category}  Used ${template.usage_count} times  Last: ${template.last_used}`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={template.status}
                      color={template.status === 'active' ? 'success' : 'default'}
                      size="small"
                    />
                    <IconButton size="small" color="success">
                      <Edit />
                    </IconButton>
                    <IconButton size="small" color="error">
                      <Delete />
                    </IconButton>
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Compose Message Dialog */}
      <Dialog open={composeDialog} onClose={() => setComposeDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Compose New Message</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
            Create and send a new communication to users.
          </Typography>
          {/* Compose form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setComposeDialog(false)}>Cancel</Button>
          <Button variant="contained">Send Message</Button>
        </DialogActions>
      </Dialog>

      {/* Templates Dialog */}
      <Dialog open={templateDialog} onClose={() => setTemplateDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Manage Templates</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create and manage communication templates for different message types.
          </Typography>
          {/* Templates management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setTemplateDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default CommunicationScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Category, Home, DirectionsCar, Work, Assignment,
  TrendingUp, Devices, ShoppingBag, LocalOffer, Business,
  School, Spa, Build, Restaurant, Pets, MoreHoriz
} from '@mui/icons-material';

const CategoriesScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [addCategoryDialog, setAddCategoryDialog] = useState(false);
  const [editCategoryDialog, setEditCategoryDialog] = useState(false);
  const [editingCategory, setEditingCategory] = useState(null);

  const categories = [
    // Core Categories
    {
      id: 1,
      name: 'Real Estate',
      type: 'homes',
      description: 'Homes, apartments, and commercial properties',
      listings: 245,
      status: 'active',
      views: 12500,
      icon: 'home',
      color: '#2196F3',
      featured: true,
      order: 1,
      created_at: '2024-01-01',
      updated_at: '2024-01-15'
    },
    {
      id: 2,
      name: 'Vehicles',
      type: 'cars',
      description: 'Cars, motorcycles, and automotive parts',
      listings: 189,
      status: 'active',
      views: 8900,
      icon: 'directions_car',
      color: '#4CAF50',
      featured: true,
      order: 2,
      created_at: '2024-01-01',
      updated_at: '2024-01-14'
    },
    {
      id: 3,
      name: 'Jobs',
      type: 'jobs',
      description: 'Employment opportunities and career services',
      listings: 312,
      status: 'active',
      views: 15600,
      icon: 'work',
      color: '#FF9800',
      featured: true,
      order: 3,
      created_at: '2024-01-01',
      updated_at: '2024-01-13'
    },
    {
      id: 4,
      name: 'Tenders',
      type: 'tenders',
      description: 'Government and private tender opportunities',
      listings: 89,
      status: 'active',
      views: 6700,
      icon: 'assignment',
      color: '#9C27B0',
      featured: true,
      order: 4,
      created_at: '2024-01-01',
      updated_at: '2024-01-12'
    },
    // Additional Categories
    {
      id: 5,
      name: 'Electronics',
      type: 'electronics',
      description: 'Gadgets, computers, and electronic devices',
      listings: 156,
      status: 'active',
      views: 8900,
      icon: 'devices',
      color: '#F44336',
      featured: false,
      order: 5,
      created_at: '2024-01-02',
      updated_at: '2024-01-11'
    },
    {
      id: 6,
      name: 'Services',
      type: 'services',
      description: 'Professional and personal services',
      listings: 98,
      status: 'active',
      views: 4500,
      icon: 'build',
      color: '#795548',
      featured: false,
      order: 6,
      created_at: '2024-01-02',
      updated_at: '2024-01-10'
    },
    {
      id: 7,
      name: 'Fashion',
      type: 'fashion',
      description: 'Clothing, accessories, and personal care',
      listings: 234,
      status: 'active',
      views: 11200,
      icon: 'shopping_bag',
      color: '#E91E63',
      featured: false,
      order: 7,
      created_at: '2024-01-03',
      updated_at: '2024-01-09'
    },
    {
      id: 8,
      name: 'Education',
      type: 'education',
      description: 'Learning materials and educational services',
      listings: 67,
      status: 'inactive',
      views: 3400,
      icon: 'school',
      color: '#009688',
      featured: false,
      order: 8,
      created_at: '2024-01-03',
      updated_at: '2024-01-08'
    },
    {
      id: 9,
      name: 'Health & Beauty',
      type: 'health',
      description: 'Healthcare products and beauty services',
      listings: 145,
      status: 'active',
      views: 8900,
      icon: 'spa',
      color: '#3F51B5',
      featured: false,
      order: 9,
      created_at: '2024-01-04',
      updated_at: '2024-01-07'
    },
    {
      id: 10,
      name: 'Food & Restaurants',
      type: 'food',
      description: 'Restaurants, cafes, and food services',
      listings: 89,
      status: 'pending',
      views: 5600,
      icon: 'restaurant',
      color: '#FF5722',
      featured: false,
      order: 10,
      created_at: '2024-01-04',
      updated_at: '2024-01-06'
    },
    {
      id: 11,
      name: 'Business',
      type: 'business',
      description: 'Business services and opportunities',
      listings: 123,
      status: 'active',
      views: 7800,
      icon: 'business',
      color: '#607D8B',
      featured: false,
      order: 11,
      created_at: '2024-01-05',
      updated_at: '2024-01-05'
    },
    {
      id: 12,
      name: 'Pets & Animals',
      type: 'pets',
      description: 'Pet products and services',
      listings: 45,
      status: 'pending',
      views: 2300,
      icon: 'pets',
      color: '#8BC34A',
      featured: false,
      order: 12,
      created_at: '2024-01-05',
      updated_at: '2024-01-04'
    }
  ];

  const filteredCategories = categories.filter(category => {
    const matchesSearch = category.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      category.description.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      category.type.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || category.status === filterStatus;
    return matchesSearch && matchesFilter;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'pending': return 'warning';
      case 'inactive': return 'error';
      default: return 'default';
    }
  };

  const getCategoryIcon = (iconName) => {
    const iconMap = {
      'home': <Home sx={{ fontSize: 20 }} />,
      'directions_car': <DirectionsCar sx={{ fontSize: 20 }} />,
      'work': <Work sx={{ fontSize: 20 }} />,
      'assignment': <Assignment sx={{ fontSize: 20 }} />,
      'devices': <Devices sx={{ fontSize: 20 }} />,
      'build': <Build sx={{ fontSize: 20 }} />,
      'shopping_bag': <ShoppingBag sx={{ fontSize: 20 }} />,
      'school': <School sx={{ fontSize: 20 }} />,
      'spa': <Spa sx={{ fontSize: 20 }} />,
      'restaurant': <Restaurant sx={{ fontSize: 20 }} />,
      'business': <Business sx={{ fontSize: 20 }} />,
      'pets': <Pets sx={{ fontSize: 20 }} />,
      'trending_up': <TrendingUp sx={{ fontSize: 20 }} />,
      'local_offer': <LocalOffer sx={{ fontSize: 20 }} />,
      'more_horiz': <MoreHoriz sx={{ fontSize: 20 }} />
    };
    return iconMap[iconName] || <Category sx={{ fontSize: 20 }} />;
  };

  const handleItemSelect = (categoryId) => {
    setSelectedItems(prev =>
      prev.includes(categoryId)
        ? prev.filter(id => id !== categoryId)
        : [...prev, categoryId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on categories:`, selectedItems);
  };

  const handleEditCategory = (category) => {
    setEditingCategory(category);
    setEditCategoryDialog(true);
  };

  const handleStatusToggle = (categoryId) => {
    console.log(`Toggle status for category: ${categoryId}`);
  };

  const handleFeaturedToggle = (categoryId) => {
    console.log(`Toggle featured for category: ${categoryId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Categories Management
        </Typography>
        <Button variant="contained" startIcon={<Add />} onClick={() => setAddCategoryDialog(true)}>
          Add New Category
        </Button>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Category sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">12</Typography>
              <Typography variant="body2" color="text.secondary">Total Categories</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">9</Typography>
              <Typography variant="body2" color="text.secondary">Active Categories</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <TrendingUp sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">1,597</Typography>
              <Typography variant="body2" color="text.secondary">Total Listings</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <LocalOffer sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">4</Typography>
              <Typography variant="body2" color="text.secondary">Featured Categories</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Category Overview Cards */}
      <Grid container spacing={2} sx={{ mb: 3 }}>
        {categories.filter(cat => cat.featured).map((category) => (
          <Grid item xs={12} sm={6} md={3} key={category.id}>
            <Card variant="outlined" sx={{ borderLeft: `4px solid ${category.color}` }}>
              <CardContent sx={{ pb: 2 }}>
                <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
                  <Avatar sx={{ bgcolor: category.color, mr: 2 }}>
                    {getCategoryIcon(category.icon)}
                  </Avatar>
                  <Box sx={{ flex: 1 }}>
                    <Typography variant="h6" fontWeight="bold">
                      {category.name}
                    </Typography>
                    <Typography variant="caption" color="text.secondary">
                      {category.listings} listings
                    </Typography>
                  </Box>
                  <Badge badgeContent={category.views.toLocaleString()} color="primary">
                    <Visibility sx={{ fontSize: 20 }} />
                  </Badge>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Chip
                    label={category.status}
                    color={getStatusColor(category.status)}
                    size="small"
                  />
                  <Typography variant="caption" color="text.secondary">
                    {category.type}
                  </Typography>
                </Box>
              </CardContent>
            </Card>
          </Grid>
        ))}
      </Grid>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search categories..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="inactive">Inactive</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('activate')}>
                      Activate Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('deactivate')}>
                      Deactivate Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Categories Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredCategories.map(category => category.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Category</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Listings</TableCell>
                  <TableCell>Views</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Featured</TableCell>
                  <TableCell>Order</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredCategories.map((category) => (
                  <TableRow key={category.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(category.id)}
                        onChange={() => handleItemSelect(category.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center' }}>
                        <Avatar sx={{ bgcolor: category.color, mr: 2, width: 32, height: 32 }}>
                          {getCategoryIcon(category.icon)}
                        </Avatar>
                        <Box>
                          <Typography variant="body2" fontWeight="medium">
                            {category.name}
                          </Typography>
                          <Typography variant="caption" color="text.secondary" sx={{ maxWidth: 200 }}>
                            {category.description}
                          </Typography>
                        </Box>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                        {category.type}
                      </Typography>
                    </TableCell>
                    <TableCell>{category.listings}</TableCell>
                    <TableCell>{category.views.toLocaleString()}</TableCell>
                    <TableCell>
                      <Chip
                        label={category.status}
                        color={getStatusColor(category.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <FormControlLabel
                        control={
                          <Switch
                            checked={category.featured}
                            onChange={() => handleFeaturedToggle(category.id)}
                            size="small"
                          />
                        }
                        label=""
                      />
                    </TableCell>
                    <TableCell>{category.order}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <IconButton size="small" color="primary">
                          <Visibility />
                        </IconButton>
                        <IconButton size="small" color="success" onClick={() => handleEditCategory(category)}>
                          <Edit />
                        </IconButton>
                        <IconButton size="small" color="error">
                          <Delete />
                        </IconButton>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Add Category Dialog */}
      <Dialog open={addCategoryDialog} onClose={() => setAddCategoryDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Add New Category</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure a new category for the platform. This will allow users to post and browse listings in this category.
          </Typography>
          {/* Add category form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setAddCategoryDialog(false)}>Cancel</Button>
          <Button variant="contained">Add Category</Button>
        </DialogActions>
      </Dialog>

      {/* Edit Category Dialog */}
      <Dialog open={editCategoryDialog} onClose={() => setEditCategoryDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Edit Category: {editingCategory?.name}</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Modify category settings and configuration.
          </Typography>
          {/* Edit category form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setEditCategoryDialog(false)}>Cancel</Button>
          <Button variant="contained">Save Changes</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default CategoriesScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, DirectionsCar
} from '@mui/icons-material';

const CarsScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus, cars = [] }) => {
  const [selectedItems, setSelectedItems] = useState([]);

  const filteredCars = cars.filter(car => {
    const matchesSearch = car.title.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      car.user.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || car.status === filterStatus;
    return matchesSearch && matchesFilter;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'approved': return 'success';
      case 'pending': return 'warning';
      case 'rejected': return 'error';
      default: return 'default';
    }
  };

  const handleItemSelect = (carId) => {
    setSelectedItems(prev =>
      prev.includes(carId)
        ? prev.filter(id => id !== carId)
        : [...prev, carId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on cars:`, selectedItems);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          {t('cars')} Management
        </Typography>
        <Button variant="contained" startIcon={<Add />}>
          Add New Car
        </Button>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <DirectionsCar sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">234</Typography>
              <Typography variant="body2" color="text.secondary">Total Cars</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">156</Typography>
              <Typography variant="body2" color="text.secondary">Approved</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Visibility sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">18.7K</Typography>
              <Typography variant="body2" color="text.secondary">Total Views</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Search sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">567</Typography>
              <Typography variant="body2" color="text.secondary">Inquiries</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search cars..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="approved">Approved</MenuItem>
                  <MenuItem value="pending">Pending</MenuItem>
                  <MenuItem value="rejected">Rejected</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('approve')}>
                      Approve Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('reject')}>
                      Reject Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Cars Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredCars.map(car => car.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Title</TableCell>
                  <TableCell>User</TableCell>
                  <TableCell>Price</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Views</TableCell>
                  <TableCell>Inquiries</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredCars.map((car) => (
                  <TableRow key={car.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(car.id)}
                        onChange={() => handleItemSelect(car.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontWeight="medium">
                        {car.title}
                      </Typography>
                    </TableCell>
                    <TableCell>{car.user}</TableCell>
                    <TableCell>Birr {car.price.toLocaleString()}</TableCell>
                    <TableCell>
                      <Chip
                        label={car.status}
                        color={getStatusColor(car.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>{car.views}</TableCell>
                    <TableCell>{car.inquiries}</TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <IconButton size="small" color="primary">
                          <Visibility />
                        </IconButton>
                        <IconButton size="small" color="success">
                          <Edit />
                        </IconButton>
                        <IconButton size="small" color="error">
                          <Delete />
                        </IconButton>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>
    </Box>
  );
};

export default CarsScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Backup, Restore, Download, Upload, Schedule, CloudUpload,
  CloudDownload, Storage, History, Assessment,
  FilterList, ExpandMore, Warning, Error, Info,
  Settings, SystemUpdate, Security, DataObject, Save,
  Folder, FolderOpen, Archive, FileCopy, Sync, PlayArrow
} from '@mui/icons-material';

const BackupScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [backupDialog, setBackupDialog] = useState(false);
  const [restoreDialog, setRestoreDialog] = useState(false);

  const backupJobs = [
    {
      id: 1,
      name: 'Daily Full Backup',
      type: 'full',
      frequency: 'daily',
      status: 'completed',
      size_gb: 45.2,
      duration: '2h 15m',
      started_at: '2024-01-15 02:00:00',
      completed_at: '2024-01-15 04:15:23',
      next_run: '2024-01-16 02:00:00',
      location: 'cloud_storage',
      compression: true,
      encryption: true,
      retention_days: 30
    },
    {
      id: 2,
      name: 'Weekly Incremental Backup',
      type: 'incremental',
      frequency: 'weekly',
      status: 'running',
      size_gb: 12.8,
      duration: '45m',
      started_at: '2024-01-15 03:00:00',
      completed_at: null,
      next_run: '2024-01-22 03:00:00',
      location: 'cloud_storage',
      compression: true,
      encryption: true,
      retention_days: 90
    },
    {
      id: 3,
      name: 'Database Backup',
      type: 'database',
      frequency: 'daily',
      status: 'scheduled',
      size_gb: 8.5,
      duration: '30m',
      started_at: null,
      completed_at: null,
      next_run: '2024-01-16 01:00:00',
      location: 'local_storage',
      compression: true,
      encryption: true,
      retention_days: 7
    },
    {
      id: 4,
      name: 'Files Backup',
      type: 'files',
      frequency: 'daily',
      status: 'failed',
      size_gb: 0,
      duration: '0m',
      started_at: '2024-01-14 02:00:00',
      completed_at: null,
      next_run: '2024-01-16 02:00:00',
      location: 'cloud_storage',
      compression: true,
      encryption: false,
      retention_days: 14
    },
    {
      id: 5,
      name: 'Configuration Backup',
      type: 'config',
      frequency: 'weekly',
      status: 'completed',
      size_gb: 0.5,
      duration: '5m',
      started_at: '2024-01-14 01:00:00',
      completed_at: '2024-01-14 01:05:12',
      next_run: '2024-01-21 01:00:00',
      location: 'cloud_storage',
      compression: true,
      encryption: true,
      retention_days: 30
    }
  ];

  const restoreOperations = [
    {
      id: 1,
      backup_id: 1,
      backup_name: 'Daily Full Backup',
      type: 'full',
      status: 'completed',
      initiated_by: 'admin@yesrasew.com',
      started_at: '2024-01-10 14:30:00',
      completed_at: '2024-01-10 16:45:23',
      duration: '2h 15m',
      size_restored_gb: 45.2,
      target_location: 'production_server',
      verification_status: 'verified'
    },
    {
      id: 2,
      backup_id: 3,
      backup_name: 'Database Backup',
      type: 'database',
      status: 'failed',
      initiated_by: 'system',
      started_at: '2024-01-08 10:15:00',
      completed_at: null,
      duration: '0m',
      size_restored_gb: 0,
      target_location: 'staging_server',
      verification_status: 'failed',
      error_message: 'Connection timeout to database server'
    },
    {
      id: 3,
      backup_id: 5,
      backup_name: 'Configuration Backup',
      type: 'config',
      status: 'completed',
      initiated_by: 'admin@yesrasew.com',
      started_at: '2024-01-05 09:00:00',
      completed_at: '2024-01-05 09:05:45',
      duration: '5m',
      size_restored_gb: 0.5,
      target_location: 'development_server',
      verification_status: 'verified'
    }
  ];

  const backupStorage = [
    {
      id: 1,
      location: 'AWS S3 Cloud Storage',
      type: 'cloud',
      total_capacity_gb: 1000,
      used_capacity_gb: 678.5,
      available_capacity_gb: 321.5,
      status: 'active',
      last_accessed: '2024-01-15 04:15:23',
      backup_count: 45,
      encryption_enabled: true,
      compression_enabled: true
    },
    {
      id: 2,
      location: 'Local Server Storage',
      type: 'local',
      total_capacity_gb: 500,
      used_capacity_gb: 234.7,
      available_capacity_gb: 265.3,
      status: 'active',
      last_accessed: '2024-01-15 02:00:00',
      backup_count: 23,
      encryption_enabled: true,
      compression_enabled: true
    },
    {
      id: 3,
      location: 'Google Drive',
      type: 'cloud',
      total_capacity_gb: 100,
      used_capacity_gb: 45.2,
      available_capacity_gb: 54.8,
      status: 'active',
      last_accessed: '2024-01-14 18:30:00',
      backup_count: 12,
      encryption_enabled: false,
      compression_enabled: true
    }
  ];

  const backupMetrics = [
    {
      id: 1,
      metric: 'Total Storage Used',
      value: '958.4 GB',
      change: '+12.5%',
      trend: 'up',
      status: 'warning'
    },
    {
      id: 2,
      metric: 'Backup Success Rate',
      value: '94.2%',
      change: '+2.1%',
      trend: 'up',
      status: 'good'
    },
    {
      id: 3,
      metric: 'Average Backup Time',
      value: '1h 23m',
      change: '-8.5%',
      trend: 'down',
      status: 'good'
    },
    {
      id: 4,
      metric: 'Restore Success Rate',
      value: '88.9%',
      change: '+5.3%',
      trend: 'up',
      status: 'good'
    }
  ];

  const filteredBackups = backupJobs.filter(backup => {
    const matchesSearch = backup.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      backup.type.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || backup.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && backup.type === 'full') ||
      (activeTab === 2 && backup.type === 'incremental') ||
      (activeTab === 3 && backup.type === 'database');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'completed': return 'success';
      case 'running': return 'info';
      case 'scheduled': return 'warning';
      case 'failed': return 'error';
      case 'cancelled': return 'default';
      default: return 'default';
    }
  };

  const getTypeIcon = (type) => {
    switch (type) {
      case 'full': return <Storage sx={{ fontSize: 20 }} />;
      case 'incremental': return <Sync sx={{ fontSize: 20 }} />;
      case 'database': return <DataObject sx={{ fontSize: 20 }} />;
      case 'files': return <Folder sx={{ fontSize: 20 }} />;
      case 'config': return <Settings sx={{ fontSize: 20 }} />;
      default: return <Backup sx={{ fontSize: 20 }} />;
    }
  };

  const getLocationIcon = (location) => {
    switch (location) {
      case 'cloud_storage': return <CloudUpload sx={{ fontSize: 20 }} />;
      case 'local_storage': return <FolderOpen sx={{ fontSize: 20 }} />;
      default: return <Storage sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (backupId) => {
    setSelectedItems(prev =>
      prev.includes(backupId)
        ? prev.filter(id => id !== backupId)
        : [...prev, backupId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on backups:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleRunBackup = (backupId) => {
    console.log(`Run backup: ${backupId}`);
  };

  const handleRestoreBackup = (backupId) => {
    console.log(`Restore backup: ${backupId}`);
  };

  const handleDownloadBackup = (backupId) => {
    console.log(`Download backup: ${backupId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Backup & Recovery
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Restore />} onClick={() => setRestoreDialog(true)}>
            Restore Data
          </Button>
          <Button variant="contained" startIcon={<Backup />} onClick={() => setBackupDialog(true)}>
            Create Backup
          </Button>
        </Box>
      </Box>

      {/* Backup Alert */}
      {backupJobs.filter(backup => backup.status === 'failed').length > 0 && (
        <Alert severity="error" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{backupJobs.filter(backup => backup.status === 'failed').length} backup jobs</strong> have failed. Review and resolve issues.
          </Typography>
        </Alert>
      )}

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Storage sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">958.4 GB</Typography>
              <Typography variant="body2" color="text.secondary">Total Storage Used</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">94.2%</Typography>
              <Typography variant="body2" color="text.secondary">Backup Success Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <History sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">1h 23m</Typography>
              <Typography variant="body2" color="text.secondary">Avg Backup Time</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Restore sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">88.9%</Typography>
              <Typography variant="body2" color="text.secondary">Restore Success Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Backup Metrics Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Backup Metrics
          </Typography>
          <Grid container spacing={2}>
            {backupMetrics.map((metric) => (
              <Grid item xs={12} sm={6} md={3} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={metric.change}
                      color={metric.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Chip
                      label={metric.status}
                      color={metric.status === 'good' ? 'success' : 'warning'}
                      size="small"
                      sx={{ ml: 1 }}
                    />
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Backup Types */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Backups" />
          <Tab label="Full Backups" />
          <Tab label="Incremental" />
          <Tab label="Database" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search backups..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="completed">Completed</MenuItem>
                  <MenuItem value="running">Running</MenuItem>
                  <MenuItem value="scheduled">Scheduled</MenuItem>
                  <MenuItem value="failed">Failed</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('run')}>
                      Run Selected
                    </Button>
                    <Button variant="contained" color="info" onClick={() => handleBulkAction('download')}>
                      Download Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('delete')}>
                      Delete Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Backup Jobs Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredBackups.map(backup => backup.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Backup Job</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Size</TableCell>
                  <TableCell>Duration</TableCell>
                  <TableCell>Next Run</TableCell>
                  <TableCell>Location</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredBackups.map((backup) => (
                  <TableRow key={backup.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(backup.id)}
                        onChange={() => handleItemSelect(backup.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {backup.name}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {backup.frequency}  Retention: {backup.retention_days} days
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getTypeIcon(backup.type)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {backup.type}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        <Chip
                          label={backup.status}
                          color={getStatusColor(backup.status)}
                          size="small"
                        />
                        {backup.status === 'running' && (
                          <LinearProgress
                            variant="indeterminate"
                            sx={{ width: 50, height: 6 }}
                          />
                        )}
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {backup.size_gb} GB
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {backup.duration}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {backup.next_run}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getLocationIcon(backup.location)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {backup.location.replace('_', ' ')}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        {backup.status !== 'running' && (
                          <Tooltip title="Run Backup">
                            <IconButton size="small" color="success" onClick={() => handleRunBackup(backup.id)}>
                              <PlayArrow />
                            </IconButton>
                          </Tooltip>
                        )}
                        {backup.status === 'completed' && (
                          <Tooltip title="Restore">
                            <IconButton size="small" color="info" onClick={() => handleRestoreBackup(backup.id)}>
                              <Restore />
                            </IconButton>
                          </Tooltip>
                        )}
                        {backup.status === 'completed' && (
                          <Tooltip title="Download">
                            <IconButton size="small" color="warning" onClick={() => handleDownloadBackup(backup.id)}>
                              <Download />
                            </IconButton>
                          </Tooltip>
                        )}
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Restore Operations Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Recent Restore Operations
          </Typography>
          <List>
            {restoreOperations.map((restore) => (
              <ListItem key={restore.id} divider>
                <ListItemIcon>
                  {restore.status === 'completed' ? (
                    <CheckCircle sx={{ color: 'success.main' }} />
                  ) : restore.status === 'failed' ? (
                    <Error sx={{ color: 'error.main' }} />
                  ) : (
                    <Sync sx={{ color: 'info.main' }} />
                  )}
                </ListItemIcon>
                <ListItemText
                  primary={restore.backup_name}
                  secondary={`Initiated by ${restore.initiated_by}  Target: ${restore.target_location}  Size: ${restore.size_restored_gb} GB`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={restore.status}
                      color={getStatusColor(restore.status)}
                      size="small"
                    />
                    <Chip
                      label={restore.verification_status}
                      color={restore.verification_status === 'verified' ? 'success' : 'error'}
                      size="small"
                    />
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Storage Locations Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Backup Storage Locations
          </Typography>
          <Grid container spacing={2}>
            {backupStorage.map((storage) => (
              <Grid item xs={12} md={4} key={storage.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                    {storage.type === 'cloud' ? (
                      <CloudUpload sx={{ mr: 1, color: '#2196F3' }} />
                    ) : (
                      <FolderOpen sx={{ mr: 1, color: '#4CAF50' }} />
                    )}
                    <Typography variant="h6" fontWeight="bold">
                      {storage.location}
                    </Typography>
                  </Box>
                  <Box sx={{ mb: 1 }}>
                    <Typography variant="body2">
                      {storage.used_capacity_gb} GB / {storage.total_capacity_gb} GB used
                    </Typography>
                    <LinearProgress
                      variant="determinate"
                      value={(storage.used_capacity_gb / storage.total_capacity_gb) * 100}
                      sx={{ mt: 0.5 }}
                    />
                  </Box>
                  <Typography variant="caption" color="text.secondary">
                    {storage.backup_count} backups  {storage.encryption_enabled ? 'Encrypted' : 'Not Encrypted'}
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Create Backup Dialog */}
      <Dialog open={backupDialog} onClose={() => setBackupDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Create New Backup</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure and create a new backup job with custom settings.
          </Typography>
          {/* Create backup form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setBackupDialog(false)}>Cancel</Button>
          <Button variant="contained">Create Backup</Button>
        </DialogActions>
      </Dialog>

      {/* Restore Data Dialog */}
      <Dialog open={restoreDialog} onClose={() => setRestoreDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Restore Data from Backup</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Select a backup to restore data from and configure restore options.
          </Typography>
          {/* Restore configuration here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setRestoreDialog(false)}>Cancel</Button>
          <Button variant="contained">Start Restore</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default BackupScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Api, Code, Key, Security, Settings, Assessment,
  FilterList, ExpandMore, Warning, Error, Info,
  Timeline, DataObject, Cloud, Sync, Lock, LockOpen,
  Https, Public, Private, Group, Person, Business,
  Speed, Memory, Storage, Schedule, History,
  FileCopy, Download, Upload, Share, Monitor, Smartphone
} from '@mui/icons-material';

const ApiManagementScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [keyDialog, setKeyDialog] = useState(false);
  const [endpointDialog, setEndpointDialog] = useState(false);

  const apiKeys = [
    {
      id: 1,
      name: 'Production API Key',
      key: 'ak_live_1234567890abcdef1234567890abcdef',
      type: 'production',
      status: 'active',
      created_at: '2024-01-01',
      expires_at: '2024-12-31',
      last_used: '2024-01-15 14:30:25',
      usage_count: 15420,
      rate_limit: 1000,
      permissions: ['read', 'write'],
      allowed_ips: ['192.168.1.0/24'],
      created_by: 'admin@yesrasew.com'
    },
    {
      id: 2,
      name: 'Development API Key',
      key: 'ak_test_0987654321fedcba0987654321fedcba',
      type: 'development',
      status: 'active',
      created_at: '2024-01-05',
      expires_at: '2024-06-30',
      last_used: '2024-01-15 12:15:10',
      usage_count: 890,
      rate_limit: 100,
      permissions: ['read'],
      allowed_ips: ['127.0.0.1'],
      created_by: 'developer@yesrasew.com'
    },
    {
      id: 3,
      name: 'Mobile App API Key',
      key: 'ak_mobile_56789012345678905678901234567890',
      type: 'mobile',
      status: 'active',
      created_at: '2023-12-15',
      expires_at: '2024-12-15',
      last_used: '2024-01-15 16:20:45',
      usage_count: 23456,
      rate_limit: 500,
      permissions: ['read', 'write'],
      allowed_ips: ['*'],
      created_by: 'admin@yesrasew.com'
    },
    {
      id: 4,
      name: 'Partner Integration Key',
      key: 'ak_partner_abcdef1234567890abcdef12345678',
      type: 'partner',
      status: 'suspended',
      created_at: '2023-11-01',
      expires_at: '2024-11-01',
      last_used: '2024-01-10 09:30:15',
      usage_count: 4567,
      rate_limit: 200,
      permissions: ['read'],
      allowed_ips: ['203.0.113.0/24'],
      created_by: 'admin@yesrasew.com'
    },
    {
      id: 5,
      name: 'Analytics API Key',
      key: 'ak_analytics_1234567890abcdef1234567890abcd',
      type: 'analytics',
      status: 'expired',
      created_at: '2023-06-01',
      expires_at: '2024-01-01',
      last_used: '2023-12-31 23:59:59',
      usage_count: 1234,
      rate_limit: 50,
      permissions: ['read'],
      allowed_ips: ['*'],
      created_by: 'admin@yesrasew.com'
    }
  ];

  const apiEndpoints = [
    {
      id: 1,
      path: '/api/v1/listings',
      method: 'GET',
      status: 'active',
      description: 'Retrieve all listings with optional filters',
      version: 'v1',
      authentication: 'required',
      rate_limit: 1000,
      response_time_ms: 125,
      success_rate: 99.5,
      daily_calls: 4567,
      parameters: ['page', 'limit', 'category', 'location']
    },
    {
      id: 2,
      path: '/api/v1/listings',
      method: 'POST',
      status: 'active',
      description: 'Create a new listing',
      version: 'v1',
      authentication: 'required',
      rate_limit: 100,
      response_time_ms: 250,
      success_rate: 98.2,
      daily_calls: 234,
      parameters: ['title', 'description', 'category', 'price']
    },
    {
      id: 3,
      path: '/api/v1/users',
      method: 'GET',
      status: 'active',
      description: 'Get user profile information',
      version: 'v1',
      authentication: 'required',
      rate_limit: 500,
      response_time_ms: 95,
      success_rate: 99.8,
      daily_calls: 789,
      parameters: ['user_id', 'include_profile']
    },
    {
      id: 4,
      path: '/api/v1/search',
      method: 'GET',
      status: 'active',
      description: 'Search listings with advanced filters',
      version: 'v1',
      authentication: 'optional',
      rate_limit: 2000,
      response_time_ms: 180,
      success_rate: 99.1,
      daily_calls: 12345,
      parameters: ['query', 'category', 'location', 'price_range']
    },
    {
      id: 5,
      path: '/api/v1/analytics',
      method: 'GET',
      status: 'deprecated',
      description: 'Get platform analytics (deprecated)',
      version: 'v1',
      authentication: 'required',
      rate_limit: 50,
      response_time_ms: 450,
      success_rate: 95.2,
      daily_calls: 12,
      parameters: ['date_range', 'metrics']
    }
  ];

  const apiUsage = [
    {
      id: 1,
      metric: 'Total API Calls',
      value: '45,678',
      change: '+15.2%',
      trend: 'up',
      date_range: 'Last 30 days'
    },
    {
      id: 2,
      metric: 'Average Response Time',
      value: '156 ms',
      change: '-8.5%',
      trend: 'down',
      date_range: 'Last 30 days'
    },
    {
      id: 3,
      metric: 'Success Rate',
      value: '98.9%',
      change: '+0.3%',
      trend: 'up',
      date_range: 'Last 30 days'
    },
    {
      id: 4,
      metric: 'Active API Keys',
      value: 12,
      change: '+2',
      trend: 'up',
      date_range: 'Current'
    }
  ];

  const apiLogs = [
    {
      id: 1,
      timestamp: '2024-01-15 14:30:25',
      method: 'GET',
      endpoint: '/api/v1/listings',
      status_code: 200,
      response_time_ms: 125,
      api_key: 'ak_live_1234567890abcdef',
      ip_address: '192.168.1.100',
      user_agent: 'Mozilla/5.0 (compatible; MyApp/1.0)',
      request_size_bytes: 1024,
      response_size_bytes: 8192
    },
    {
      id: 2,
      timestamp: '2024-01-15 14:28:15',
      method: 'POST',
      endpoint: '/api/v1/listings',
      status_code: 201,
      response_time_ms: 250,
      api_key: 'ak_live_1234567890abcdef',
      ip_address: '192.168.1.101',
      user_agent: 'curl/7.68.0',
      request_size_bytes: 2048,
      response_size_bytes: 512
    },
    {
      id: 3,
      timestamp: '2024-01-15 14:25:45',
      method: 'GET',
      endpoint: '/api/v1/search',
      status_code: 200,
      response_time_ms: 180,
      api_key: 'ak_mobile_5678901234567890',
      ip_address: '203.0.113.45',
      user_agent: 'MyApp/2.0 (Android)',
      request_size_bytes: 512,
      response_size_bytes: 16384
    },
    {
      id: 4,
      timestamp: '2024-01-15 14:22:30',
      method: 'GET',
      endpoint: '/api/v1/users',
      status_code: 401,
      response_time_ms: 45,
      api_key: 'invalid_key',
      ip_address: '198.51.100.22',
      user_agent: 'Python/3.8 requests/2.25.1',
      request_size_bytes: 256,
      response_size_bytes: 128
    },
    {
      id: 5,
      timestamp: '2024-01-15 14:20:12',
      method: 'DELETE',
      endpoint: '/api/v1/listings/12345',
      status_code: 204,
      response_time_ms: 95,
      api_key: 'ak_live_1234567890abcdef',
      ip_address: '192.168.1.100',
      user_agent: 'Mozilla/5.0 (compatible; AdminPanel/1.0)',
      request_size_bytes: 64,
      response_size_bytes: 0
    }
  ];

  const filteredKeys = apiKeys.filter(key => {
    const matchesSearch = key.name.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      key.type.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || key.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && key.type === 'production') ||
      (activeTab === 2 && key.type === 'development') ||
      (activeTab === 3 && key.type === 'mobile');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'active': return 'success';
      case 'suspended': return 'warning';
      case 'expired': return 'error';
      case 'deprecated': return 'default';
      default: return 'default';
    }
  };

  const getMethodColor = (method) => {
    switch (method) {
      case 'GET': return 'success';
      case 'POST': return 'info';
      case 'PUT': return 'warning';
      case 'DELETE': return 'error';
      default: return 'default';
    }
  };

  const getKeyIcon = (type) => {
    switch (type) {
      case 'production': return <Business sx={{ fontSize: 20 }} />;
      case 'development': return <Code sx={{ fontSize: 20 }} />;
      case 'mobile': return <Smartphone sx={{ fontSize: 20 }} />;
      case 'partner': return <Group sx={{ fontSize: 20 }} />;
      case 'analytics': return <Assessment sx={{ fontSize: 20 }} />;
      default: return <Key sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (keyId) => {
    setSelectedItems(prev =>
      prev.includes(keyId)
        ? prev.filter(id => id !== keyId)
        : [...prev, keyId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on keys:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleRegenerateKey = (keyId) => {
    console.log(`Regenerate key: ${keyId}`);
  };

  const handleSuspendKey = (keyId) => {
    console.log(`Suspend key: ${keyId}`);
  };

  const handleActivateKey = (keyId) => {
    console.log(`Activate key: ${keyId}`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          API Management
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Code />} onClick={() => setEndpointDialog(true)}>
            Manage Endpoints
          </Button>
          <Button variant="contained" startIcon={<Key />} onClick={() => setKeyDialog(true)}>
            Generate API Key
          </Button>
        </Box>
      </Box>

      {/* Stats Cards */}
      <Grid container spacing={3} sx={{ mb: 3 }}>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Api sx={{ fontSize: 40, color: '#2196F3', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">45,678</Typography>
              <Typography variant="body2" color="text.secondary">Total API Calls</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Speed sx={{ fontSize: 40, color: '#4CAF50', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">156 ms</Typography>
              <Typography variant="body2" color="text.secondary">Avg Response Time</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <CheckCircle sx={{ fontSize: 40, color: '#FF9800', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">98.9%</Typography>
              <Typography variant="body2" color="text.secondary">Success Rate</Typography>
            </CardContent>
          </Card>
        </Grid>
        <Grid item xs={12} sm={6} md={3}>
          <Card>
            <CardContent sx={{ textAlign: 'center' }}>
              <Key sx={{ fontSize: 40, color: '#9C27B0', mb: 1 }} />
              <Typography variant="h5" fontWeight="bold">12</Typography>
              <Typography variant="body2" color="text.secondary">Active Keys</Typography>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* API Usage Section */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            API Usage Overview
          </Typography>
          <Grid container spacing={2}>
            {apiUsage.map((usage) => (
              <Grid item xs={12} sm={6} md={3} key={usage.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {usage.value}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {usage.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <Chip
                      label={usage.change}
                      color={usage.trend === 'up' ? 'success' : 'error'}
                      size="small"
                    />
                    <Typography variant="caption" color="text.secondary" sx={{ ml: 1 }}>
                      {usage.date_range}
                    </Typography>
                  </Box>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Key Types */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Keys" />
          <Tab label="Production" />
          <Tab label="Development" />
          <Tab label="Mobile" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search API keys..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="active">Active</MenuItem>
                  <MenuItem value="suspended">Suspended</MenuItem>
                  <MenuItem value="expired">Expired</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                {selectedItems.length > 0 && (
                  <>
                    <Button variant="contained" color="success" onClick={() => handleBulkAction('activate')}>
                      Activate Selected
                    </Button>
                    <Button variant="contained" color="warning" onClick={() => handleBulkAction('suspend')}>
                      Suspend Selected
                    </Button>
                    <Button variant="contained" color="error" onClick={() => handleBulkAction('delete')}>
                      Delete Selected
                    </Button>
                  </>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* API Keys Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredKeys.map(key => key.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>API Key</TableCell>
                  <TableCell>Type</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Usage</TableCell>
                  <TableCell>Rate Limit</TableCell>
                  <TableCell>Expires</TableCell>
                  <TableCell>Last Used</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredKeys.map((key) => (
                  <TableRow key={key.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(key.id)}
                        onChange={() => handleItemSelect(key.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {key.name}
                        </Typography>
                        <Typography variant="caption" color="text.secondary" sx={{ fontFamily: 'monospace' }}>
                          {key.key.substring(0, 20)}...
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getKeyIcon(key.type)}
                        <Typography variant="body2" sx={{ textTransform: 'capitalize' }}>
                          {key.type}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={key.status}
                        color={getStatusColor(key.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Box>
                        <Typography variant="body2">
                          {key.usage_count.toLocaleString()}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          calls
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {key.rate_limit}/hour
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {key.expires_at}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {key.last_used}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Regenerate Key">
                          <IconButton size="small" color="warning" onClick={() => handleRegenerateKey(key.id)}>
                            <Sync />
                          </IconButton>
                        </Tooltip>
                        {key.status === 'active' ? (
                          <Tooltip title="Suspend Key">
                            <IconButton size="small" color="warning" onClick={() => handleSuspendKey(key.id)}>
                              <Lock />
                            </IconButton>
                          </Tooltip>
                        ) : (
                          <Tooltip title="Activate Key">
                            <IconButton size="small" color="success" onClick={() => handleActivateKey(key.id)}>
                              <LockOpen />
                            </IconButton>
                          </Tooltip>
                        )}
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* API Endpoints Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            API Endpoints
          </Typography>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>Endpoint</TableCell>
                  <TableCell>Method</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Response Time</TableCell>
                  <TableCell>Success Rate</TableCell>
                  <TableCell>Daily Calls</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {apiEndpoints.map((endpoint) => (
                  <TableRow key={endpoint.id}>
                    <TableCell>
                      <Box>
                        <Typography variant="body2" fontWeight="medium">
                          {endpoint.path}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {endpoint.description}
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={endpoint.method}
                        color={getMethodColor(endpoint.method)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={endpoint.status}
                        color={getStatusColor(endpoint.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {endpoint.response_time_ms} ms
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {endpoint.success_rate}%
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {endpoint.daily_calls.toLocaleString()}
                      </Typography>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* API Logs Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Recent API Logs
          </Typography>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>Timestamp</TableCell>
                  <TableCell>Method</TableCell>
                  <TableCell>Endpoint</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Response Time</TableCell>
                  <TableCell>API Key</TableCell>
                  <TableCell>IP Address</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {apiLogs.map((log) => (
                  <TableRow key={log.id}>
                    <TableCell>
                      <Typography variant="body2">
                        {log.timestamp}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={log.method}
                        color={getMethodColor(log.method)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {log.endpoint}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={log.status_code}
                        color={log.status_code >= 200 && log.status_code < 300 ? 'success' : 'error'}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {log.response_time_ms} ms
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" sx={{ fontFamily: 'monospace' }}>
                        {log.api_key.substring(0, 12)}...
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {log.ip_address}
                      </Typography>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Generate API Key Dialog */}
      <Dialog open={keyDialog} onClose={() => setKeyDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Generate New API Key</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create a new API key with custom permissions and restrictions.
          </Typography>
          {/* Generate API key form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setKeyDialog(false)}>Cancel</Button>
          <Button variant="contained">Generate Key</Button>
        </DialogActions>
      </Dialog>

      {/* Manage Endpoints Dialog */}
      <Dialog open={endpointDialog} onClose={() => setEndpointDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>Manage API Endpoints</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Configure and manage API endpoints, methods, and access controls.
          </Typography>
          {/* Endpoint management here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setEndpointDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default ApiManagementScreen;
import React from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Chip
} from '@mui/material';
import {
  TrendingUp, People
} from '@mui/icons-material';

const AnalyticsScreen = ({ t }) => {
  const categoryData = [
    { category: 'Cars', listings: 189, views: 45678, conversion: '8.5%' },
    { category: 'Jobs', listings: 267, views: 34234, conversion: '12.3%' },
    { category: 'Homes', listings: 156, views: 28901, conversion: '6.7%' },
    { category: 'Tender', listings: 45, views: 12345, conversion: '15.2%' },
    { category: 'Home', listings: 32, views: 8765, conversion: '9.8%' }
  ];

  const topListings = [
    { title: 'Luxury Villa in Bole', category: 'Homes', views: 12345, inquiries: 234, conversion: '1.9%', revenue: 'ETB 450,000' },
    { title: 'Toyota Land Cruiser 2023', category: 'Cars', views: 9876, inquiries: 156, conversion: '1.6%', revenue: 'ETB 2,100,000' },
    { title: 'Senior Developer Position', category: 'Jobs', views: 8765, inquiries: 321, conversion: '3.7%', revenue: 'ETB 75,000' },
    { title: 'Construction Tender - Road Project', category: 'Tender', views: 6543, inquiries: 89, conversion: '1.4%', revenue: 'ETB 5,000,000' }
  ];

  return (
    <Box>
      <Grid container spacing={3}>
        {/* Revenue Chart */}
        <Grid item xs={12} md={8}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('revenueAnalytics')}
              </Typography>
              <Box sx={{ height: 300, display: 'flex', alignItems: 'center', justifyContent: 'center', bgcolor: 'grey.100', borderRadius: 1 }}>
                <Box sx={{ textAlign: 'center' }}>
                  <TrendingUp sx={{ fontSize: 48, color: 'primary.main', mb: 2 }} />
                  <Typography variant="h4" color="primary.main" gutterBottom>
                    ETB 2,456,789
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {t('totalRevenue')} - {t('last30Days')}
                  </Typography>
                  <Typography variant="body2" color="success.main" sx={{ mt: 1 }}>
                     23.5% {t('fromLastMonth')}
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        {/* Quick Stats */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('quickStats')}
              </Typography>
              <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('avgListingPrice')}</Typography>
                  <Typography variant="h6" color="primary.main">ETB 25,000</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('conversionRate')}</Typography>
                  <Typography variant="h6" color="success.main">12.5%</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('activeCategories')}</Typography>
                  <Typography variant="h6" color="info.main">8</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('avgTimeOnSite')}</Typography>
                  <Typography variant="h6" color="warning.main">4m 32s</Typography>
                </Box>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <Typography variant="body2">{t('bounceRate')}</Typography>
                  <Typography variant="h6" color="error.main">32.4%</Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* User Growth */}
        <Grid item xs={12} md={6}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('userGrowth')}
              </Typography>
              <Box sx={{ height: 250, display: 'flex', alignItems: 'center', justifyContent: 'center', bgcolor: 'grey.100', borderRadius: 1 }}>
                <Box sx={{ textAlign: 'center' }}>
                  <People sx={{ fontSize: 48, color: 'success.main', mb: 2 }} />
                  <Typography variant="h4" color="success.main" gutterBottom>
                    15,234
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {t('totalUsers')} - {t('last30Days')}
                  </Typography>
                  <Typography variant="body2" color="success.main" sx={{ mt: 1 }}>
                     18.2% {t('fromLastMonth')}
                  </Typography>
                </Box>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Category Performance */}
        <Grid item xs={12} md={6}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('categoryPerformance')}
              </Typography>
              <Box sx={{ height: 250, overflow: 'auto' }}>
                <TableContainer>
                  <Table size="small">
                    <TableHead>
                      <TableRow>
                        <TableCell>{t('category')}</TableCell>
                        <TableCell>{t('listings')}</TableCell>
                        <TableCell>{t('views')}</TableCell>
                        <TableCell>{t('conversion')}</TableCell>
                      </TableRow>
                    </TableHead>
                    <TableBody>
                      {categoryData.map((cat, i) => (
                        <TableRow key={i}>
                          <TableCell>{cat.category}</TableCell>
                          <TableCell>{cat.listings}</TableCell>
                          <TableCell>{cat.views.toLocaleString()}</TableCell>
                          <TableCell>
                            <Chip size="small" label={cat.conversion} color="success" />
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </TableContainer>
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Top Performing Listings */}
        <Grid item xs={12}>
          <Card>
            <CardContent>
              <Typography variant="h6" gutterBottom>
                {t('topPerformingListings')}
              </Typography>
              <TableContainer>
                <Table>
                  <TableHead>
                    <TableRow>
                      <TableCell>{t('title')}</TableCell>
                      <TableCell>{t('category')}</TableCell>
                      <TableCell>{t('views')}</TableCell>
                      <TableCell>{t('inquiries')}</TableCell>
                      <TableCell>{t('conversionRate')}</TableCell>
                      <TableCell>{t('revenue')}</TableCell>
                    </TableRow>
                  </TableHead>
                  <TableBody>
                    {topListings.map((listing, i) => (
                      <TableRow key={i}>
                        <TableCell>
                          <Typography variant="body2" fontWeight="medium">
                            {listing.title}
                          </Typography>
                        </TableCell>
                        <TableCell>
                          <Chip size="small" label={listing.category} />
                        </TableCell>
                        <TableCell>{listing.views.toLocaleString()}</TableCell>
                        <TableCell>{listing.inquiries}</TableCell>
                        <TableCell>
                          <Chip size="small" label={listing.conversion} color="success" />
                        </TableCell>
                        <TableCell>
                          <Typography variant="body2" color="success.main" fontWeight="medium">
                            {listing.revenue}
                          </Typography>
                        </TableCell>
                      </TableRow>
                    ))}
                  </TableBody>
                </Table>
              </TableContainer>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
};

export default AnalyticsScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  TextField, FormControl, InputLabel, Select, MenuItem, IconButton,
  Switch, FormControlLabel, Dialog, DialogTitle, DialogContent,
  DialogActions, Avatar, Badge, Tabs, Tab, Divider, List, ListItem,
  ListItemText, ListItemIcon, ListItemSecondaryAction, Alert,
  LinearProgress, Paper, Stack, Tooltip, Accordion, AccordionSummary,
  AccordionDetails
} from '@mui/material';
import {
  Search, Refresh, Visibility, Edit, Delete, CheckCircle, Cancel,
  Add, Assessment, BarChart, PieChart, Timeline, TrendingUp,
  TrendingDown, FilterList, ExpandMore, Warning, Error, Info,
  DateRange, CalendarToday, Schedule, Analytics, DataUsage,
  People, AttachMoney, ShoppingCart, LocalOffer, Star,
  Speed, Memory, Battery, Wifi, Signal, Storage,
  Download, FileDownload, Print, Share, Email,
  Settings, MoreVert, Report, Dashboard, Insights
} from '@mui/icons-material';

const AdvancedAnalyticsScreen = ({ t, handleRefresh, refreshing, searchTerm, setSearchTerm, filterStatus, setFilterStatus }) => {
  const [selectedItems, setSelectedItems] = useState([]);
  const [activeTab, setActiveTab] = useState(0);
  const [reportDialog, setReportDialog] = useState(false);
  const [insightDialog, setInsightDialog] = useState(false);

  const analyticsMetrics = [
    {
      id: 1,
      category: 'user_engagement',
      metric: 'Daily Active Users',
      value: 12543,
      change: 12.5,
      trend: 'up',
      target: 15000,
      period: 'Last 30 days',
      status: 'good'
    },
    {
      id: 2,
      category: 'user_engagement',
      metric: 'Session Duration',
      value: '8m 45s',
      change: -5.2,
      trend: 'down',
      target: '10m 00s',
      period: 'Last 30 days',
      status: 'warning'
    },
    {
      id: 3,
      category: 'business',
      metric: 'Revenue Growth',
      value: '$45,678',
      change: 18.3,
      trend: 'up',
      target: '$50,000',
      period: 'Last 30 days',
      status: 'good'
    },
    {
      id: 4,
      category: 'business',
      metric: 'Conversion Rate',
      value: '3.2%',
      change: 0.8,
      trend: 'up',
      target: '4.0%',
      period: 'Last 30 days',
      status: 'good'
    },
    {
      id: 5,
      category: 'performance',
      metric: 'Page Load Time',
      value: '1.8s',
      change: -15.4,
      trend: 'down',
      target: '2.0s',
      period: 'Last 30 days',
      status: 'excellent'
    },
    {
      id: 6,
      category: 'performance',
      metric: 'Server Uptime',
      value: '99.9%',
      change: 0.1,
      trend: 'up',
      target: '99.5%',
      period: 'Last 30 days',
      status: 'excellent'
    }
  ];

  const userBehavior = [
    {
      id: 1,
      user_segment: 'New Users',
      total_users: 2345,
      avg_session_duration: '5m 30s',
      bounce_rate: 45.2,
      conversion_rate: 2.1,
      retention_rate: 12.5,
      revenue_per_user: '$12.50'
    },
    {
      id: 2,
      user_segment: 'Returning Users',
      total_users: 8765,
      avg_session_duration: '12m 15s',
      bounce_rate: 23.8,
      conversion_rate: 4.8,
      retention_rate: 78.9,
      revenue_per_user: '$45.30'
    },
    {
      id: 3,
      user_segment: 'Premium Users',
      total_users: 1234,
      avg_session_duration: '18m 45s',
      bounce_rate: 12.3,
      conversion_rate: 8.9,
      retention_rate: 95.2,
      revenue_per_user: '$125.00'
    },
    {
      id: 4,
      user_segment: 'Mobile Users',
      total_users: 5678,
      avg_session_duration: '6m 20s',
      bounce_rate: 38.7,
      conversion_rate: 2.8,
      retention_rate: 45.6,
      revenue_per_user: '$18.75'
    }
  ];

  const contentAnalytics = [
    {
      id: 1,
      content_type: 'Property Listings',
      total_items: 12345,
      views: 456789,
      engagement_rate: 15.2,
      shares: 5678,
      avg_time_on_page: '3m 45s',
      conversion_to_lead: 3.4
    },
    {
      id: 2,
      content_type: 'Blog Posts',
      total_items: 234,
      views: 123456,
      engagement_rate: 8.7,
      shares: 2345,
      avg_time_on_page: '4m 20s',
      conversion_to_lead: 1.2
    },
    {
      id: 3,
      content_type: 'User Profiles',
      total_items: 8765,
      views: 234567,
      engagement_rate: 23.4,
      shares: 1234,
      avg_time_on_page: '2m 15s',
      conversion_to_lead: 0
    },
    {
      id: 4,
      content_type: 'Help Articles',
      total_items: 456,
      views: 78901,
      engagement_rate: 12.1,
      shares: 567,
      avg_time_on_page: '5m 30s',
      conversion_to_lead: 0
    }
  ];

  const conversionFunnel = [
    {
      id: 1,
      stage: 'Visit',
      users: 100000,
      percentage: 100,
      dropoff_rate: 0,
      avg_time: '0m 00s'
    },
    {
      id: 2,
      stage: 'Browse',
      users: 75000,
      percentage: 75,
      dropoff_rate: 25,
      avg_time: '2m 30s'
    },
    {
      id: 3,
      stage: 'Search',
      users: 45000,
      percentage: 45,
      dropoff_rate: 40,
      avg_time: '5m 15s'
    },
    {
      id: 4,
      stage: 'View Details',
      users: 23000,
      percentage: 23,
      dropoff_rate: 48.9,
      avg_time: '8m 45s'
    },
    {
      id: 5,
      stage: 'Contact',
      users: 8900,
      percentage: 8.9,
      dropoff_rate: 61.3,
      avg_time: '12m 20s'
    },
    {
      id: 6,
      stage: 'Convert',
      users: 3200,
      percentage: 3.2,
      dropoff_rate: 64.0,
      avg_time: '15m 00s'
    }
  ];

  const revenueAnalytics = [
    {
      id: 1,
      revenue_stream: 'Premium Subscriptions',
      current_month: '$12,345',
      previous_month: '$10,234',
      growth: 20.6,
      yearly_total: '$145,678',
      forecast: '$15,000',
      contribution: 45.2
    },
    {
      id: 2,
      revenue_stream: 'Featured Listings',
      current_month: '$8,901',
      previous_month: '$7,890',
      growth: 12.8,
      yearly_total: '$98,765',
      forecast: '$9,500',
      contribution: 32.7
    },
    {
      id: 3,
      revenue_stream: 'Advertising',
      current_month: '$5,678',
      previous_month: '$4,567',
      growth: 24.3,
      yearly_total: '$67,890',
      forecast: '$6,000',
      contribution: 20.8
    },
    {
      id: 4,
      revenue_stream: 'Transaction Fees',
      current_month: '$2,345',
      previous_month: '$2,100',
      growth: 11.7,
      yearly_total: '$28,901',
      forecast: '$2,500',
      contribution: 8.6
    }
  ];

  const aiInsights = [
    {
      id: 1,
      type: 'opportunity',
      title: 'Mobile User Engagement Drop',
      description: 'Mobile user session duration decreased by 15% this week. Consider optimizing mobile experience.',
      impact: 'high',
      confidence: 0.89,
      category: 'user_behavior',
      recommended_actions: ['Review mobile UI', 'Optimize page speed', 'Test new features'],
      created_at: '2024-01-15 10:30:00'
    },
    {
      id: 2,
      type: 'warning',
      title: 'Premium Conversion Rate Plateau',
      description: 'Premium subscription conversion rate has stabilized at 3.2%. Consider new pricing tiers.',
      impact: 'medium',
      confidence: 0.76,
      category: 'revenue',
      recommended_actions: ['A/B test pricing', 'Add premium features', 'Review competitor pricing'],
      created_at: '2024-01-14 15:45:00'
    },
    {
      id: 3,
      type: 'success',
      title: 'Content Engagement Surge',
      description: 'Blog post engagement increased by 45% after implementing video content.',
      impact: 'medium',
      confidence: 0.92,
      category: 'content',
      recommended_actions: ['Scale video content', 'Promote top performers', 'Create video series'],
      created_at: '2024-01-13 09:20:00'
    }
  ];

  const filteredMetrics = analyticsMetrics.filter(metric => {
    const matchesSearch = metric.metric.toLowerCase().includes((searchTerm || '').toLowerCase()) ||
      metric.category.toLowerCase().includes((searchTerm || '').toLowerCase());
    const matchesFilter = filterStatus === 'all' || metric.status === filterStatus;
    const matchesTab = activeTab === 0 ||
      (activeTab === 1 && metric.category === 'user_engagement') ||
      (activeTab === 2 && metric.category === 'business') ||
      (activeTab === 3 && metric.category === 'performance');
    return matchesSearch && matchesFilter && matchesTab;
  });

  const getStatusColor = (status) => {
    switch (status) {
      case 'excellent': return 'success';
      case 'good': return 'success';
      case 'warning': return 'warning';
      case 'critical': return 'error';
      default: return 'default';
    }
  };

  const getTrendIcon = (trend) => {
    switch (trend) {
      case 'up': return <TrendingUp sx={{ fontSize: 20, color: 'success.main' }} />;
      case 'down': return <TrendingDown sx={{ fontSize: 20, color: 'error.main' }} />;
      default: return <Timeline sx={{ fontSize: 20 }} />;
    }
  };

  const getInsightIcon = (type) => {
    switch (type) {
      case 'opportunity': return <TrendingUp sx={{ fontSize: 20, color: 'success.main' }} />;
      case 'warning': return <Warning sx={{ fontSize: 20, color: 'warning.main' }} />;
      case 'success': return <CheckCircle sx={{ fontSize: 20, color: 'success.main' }} />;
      default: return <Info sx={{ fontSize: 20 }} />;
    }
  };

  const handleItemSelect = (metricId) => {
    setSelectedItems(prev =>
      prev.includes(metricId)
        ? prev.filter(id => id !== metricId)
        : [...prev, metricId]
    );
  };

  const handleBulkAction = (action) => {
    console.log(`Bulk action: ${action} on metrics:`, selectedItems);
  };

  const handleTabChange = (event, newValue) => {
    setActiveTab(newValue);
  };

  const handleExportReport = (format) => {
    console.log(`Export report in ${format} format`);
  };

  return (
    <Box>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
        <Typography variant="h4" fontWeight="bold">
          Advanced Analytics
        </Typography>
        <Box sx={{ display: 'flex', gap: 1 }}>
          <Button variant="outlined" startIcon={<Insights />} onClick={() => setInsightDialog(true)}>
            AI Insights
          </Button>
          <Button variant="contained" startIcon={<Report />} onClick={() => setReportDialog(true)}>
            Generate Report
          </Button>
        </Box>
      </Box>

      {/* AI Insights Alert */}
      {aiInsights.filter(insight => insight.impact === 'high').length > 0 && (
        <Alert severity="warning" sx={{ mb: 3 }}>
          <Typography variant="body2">
            <strong>{aiInsights.filter(insight => insight.impact === 'high').length} high-impact insights</strong> require attention.
          </Typography>
        </Alert>
      )}

      {/* Key Metrics Overview */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Key Performance Metrics
          </Typography>
          <Grid container spacing={2}>
            {analyticsMetrics.slice(0, 6).map((metric) => (
              <Grid item xs={12} sm={6} md={2} key={metric.id}>
                <Paper variant="outlined" sx={{ p: 2, textAlign: 'center' }}>
                  <Typography variant="h6" fontWeight="bold">
                    {metric.value}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {metric.metric}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center', mt: 1 }}>
                    {getTrendIcon(metric.trend)}
                    <Typography variant="caption" sx={{ ml: 0.5 }}>
                      {metric.change > 0 ? '+' : ''}{metric.change}%
                    </Typography>
                  </Box>
                  <Chip
                    label={metric.status}
                    color={getStatusColor(metric.status)}
                    size="small"
                    sx={{ mt: 1 }}
                  />
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* Tabs for Categories */}
      <Card sx={{ mb: 3 }}>
        <Tabs value={activeTab} onChange={handleTabChange} variant="scrollable">
          <Tab label="All Metrics" />
          <Tab label="User Engagement" />
          <Tab label="Business" />
          <Tab label="Performance" />
        </Tabs>
      </Card>

      {/* Filters and Search */}
      <Card sx={{ mb: 3 }}>
        <CardContent>
          <Grid container spacing={2} alignItems="center">
            <Grid item xs={12} md={4}>
              <TextField
                fullWidth
                placeholder="Search metrics..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                InputProps={{ startAdornment: <Search sx={{ mr: 1 }} /> }}
              />
            </Grid>
            <Grid item xs={12} md={3}>
              <FormControl fullWidth>
                <InputLabel>Status</InputLabel>
                <Select
                  value={filterStatus}
                  label="Status"
                  onChange={(e) => setFilterStatus(e.target.value)}
                >
                  <MenuItem value="all">All Status</MenuItem>
                  <MenuItem value="excellent">Excellent</MenuItem>
                  <MenuItem value="good">Good</MenuItem>
                  <MenuItem value="warning">Warning</MenuItem>
                  <MenuItem value="critical">Critical</MenuItem>
                </Select>
              </FormControl>
            </Grid>
            <Grid item xs={12} md={5}>
              <Box sx={{ display: 'flex', gap: 1 }}>
                <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
                  Refresh
                </Button>
                <Button variant="contained" color="success" onClick={() => handleExportReport('pdf')}>
                  <FileDownload sx={{ mr: 1 }} />PDF
                </Button>
                <Button variant="contained" color="info" onClick={() => handleExportReport('excel')}>
                  <FileDownload sx={{ mr: 1 }} />Excel
                </Button>
                {selectedItems.length > 0 && (
                  <Button variant="contained" color="warning" onClick={() => handleBulkAction('export')}>
                    Export Selected
                  </Button>
                )}
              </Box>
            </Grid>
          </Grid>
        </CardContent>
      </Card>

      {/* Detailed Metrics Table */}
      <Card>
        <CardContent>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell padding="checkbox">
                    <input
                      type="checkbox"
                      onChange={(e) => {
                        if (e.target.checked) {
                          setSelectedItems(filteredMetrics.map(metric => metric.id));
                        } else {
                          setSelectedItems([]);
                        }
                      }}
                    />
                  </TableCell>
                  <TableCell>Metric</TableCell>
                  <TableCell>Category</TableCell>
                  <TableCell>Current Value</TableCell>
                  <TableCell>Change</TableCell>
                  <TableCell>Target</TableCell>
                  <TableCell>Status</TableCell>
                  <TableCell>Period</TableCell>
                  <TableCell>Actions</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {filteredMetrics.map((metric) => (
                  <TableRow key={metric.id}>
                    <TableCell padding="checkbox">
                      <input
                        type="checkbox"
                        checked={selectedItems.includes(metric.id)}
                        onChange={() => handleItemSelect(metric.id)}
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontWeight="medium">
                        {metric.metric}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={metric.category.replace('_', ' ')}
                        size="small"
                        variant="outlined"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2" fontWeight="bold">
                        {metric.value}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                        {getTrendIcon(metric.trend)}
                        <Typography variant="body2">
                          {metric.change > 0 ? '+' : ''}{metric.change}%
                        </Typography>
                      </Box>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {metric.target}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Chip
                        label={metric.status}
                        color={getStatusColor(metric.status)}
                        size="small"
                      />
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {metric.period}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Box sx={{ display: 'flex', gap: 1 }}>
                        <Tooltip title="View Details">
                          <IconButton size="small" color="primary">
                            <Visibility />
                          </IconButton>
                        </Tooltip>
                        <Tooltip title="Export">
                          <IconButton size="small" color="info">
                            <Download />
                          </IconButton>
                        </Tooltip>
                      </Box>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* User Behavior Analytics */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            User Behavior Analytics
          </Typography>
          <TableContainer>
            <Table>
              <TableHead>
                <TableRow>
                  <TableCell>User Segment</TableCell>
                  <TableCell>Total Users</TableCell>
                  <TableCell>Avg Session</TableCell>
                  <TableCell>Bounce Rate</TableCell>
                  <TableCell>Conversion Rate</TableCell>
                  <TableCell>Retention Rate</TableCell>
                  <TableCell>Revenue/User</TableCell>
                </TableRow>
              </TableHead>
              <TableBody>
                {userBehavior.map((segment) => (
                  <TableRow key={segment.id}>
                    <TableCell>
                      <Typography variant="body2" fontWeight="medium">
                        {segment.user_segment}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {segment.total_users.toLocaleString()}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {segment.avg_session_duration}
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {segment.bounce_rate}%
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {segment.conversion_rate}%
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {segment.retention_rate}%
                      </Typography>
                    </TableCell>
                    <TableCell>
                      <Typography variant="body2">
                        {segment.revenue_per_user}
                      </Typography>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          </TableContainer>
        </CardContent>
      </Card>

      {/* Conversion Funnel */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Conversion Funnel Analysis
          </Typography>
          <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', mb: 2 }}>
            {conversionFunnel.map((stage, index) => (
              <Box key={stage.id} sx={{ textAlign: 'center', flex: 1 }}>
                <Paper
                  variant="outlined"
                  sx={{
                    p: 2,
                    backgroundColor: '#f5f5f5',
                    position: 'relative',
                    mx: index > 0 ? -1 : 0
                  }}
                >
                  <Typography variant="h6" fontWeight="bold">
                    {stage.users.toLocaleString()}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {stage.stage}
                  </Typography>
                  <Typography variant="body2" color="primary">
                    {stage.percentage}%
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {stage.dropoff_rate > 0 && `-${stage.dropoff_rate}%`}
                  </Typography>
                </Paper>
              </Box>
            ))}
          </Box>
        </CardContent>
      </Card>

      {/* Revenue Analytics */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            Revenue Analytics
          </Typography>
          <Grid container spacing={2}>
            {revenueAnalytics.map((revenue) => (
              <Grid item xs={12} md={3} key={revenue.id}>
                <Paper variant="outlined" sx={{ p: 2 }}>
                  <Typography variant="h6" fontWeight="bold">
                    {revenue.current_month}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    {revenue.revenue_stream}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <TrendingUp sx={{ fontSize: 16, color: 'success.main', mr: 0.5 }} />
                    <Typography variant="body2" color="success.main">
                      +{revenue.growth}%
                    </Typography>
                  </Box>
                  <Typography variant="caption" color="text.secondary">
                    {revenue.contribution}% of total
                  </Typography>
                </Paper>
              </Grid>
            ))}
          </Grid>
        </CardContent>
      </Card>

      {/* AI Insights Section */}
      <Card sx={{ mt: 3 }}>
        <CardContent>
          <Typography variant="h6" fontWeight="bold" gutterBottom>
            AI-Powered Insights
          </Typography>
          <List>
            {aiInsights.map((insight) => (
              <ListItem key={insight.id} divider>
                <ListItemIcon>
                  {getInsightIcon(insight.type)}
                </ListItemIcon>
                <ListItemText
                  primary={insight.title}
                  secondary={`${insight.description}  Confidence: ${(insight.confidence * 100).toFixed(0)}%`}
                />
                <ListItemSecondaryAction>
                  <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                    <Chip
                      label={insight.impact}
                      color={insight.impact === 'high' ? 'error' : insight.impact === 'medium' ? 'warning' : 'success'}
                      size="small"
                    />
                    <Tooltip title="View Actions">
                      <IconButton size="small" color="primary">
                        <Visibility />
                      </IconButton>
                    </Tooltip>
                  </Box>
                </ListItemSecondaryAction>
              </ListItem>
            ))}
          </List>
        </CardContent>
      </Card>

      {/* Generate Report Dialog */}
      <Dialog open={reportDialog} onClose={() => setReportDialog(false)} maxWidth="md" fullWidth>
        <DialogTitle>Generate Analytics Report</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Create a comprehensive analytics report with custom metrics and insights.
          </Typography>
          {/* Report generation form fields here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setReportDialog(false)}>Cancel</Button>
          <Button variant="contained">Generate Report</Button>
        </DialogActions>
      </Dialog>

      {/* AI Insights Dialog */}
      <Dialog open={insightDialog} onClose={() => setInsightDialog(false)} maxWidth="lg" fullWidth>
        <DialogTitle>AI-Powered Insights</DialogTitle>
        <DialogContent>
          <Typography variant="body2" color="text.secondary">
            Advanced AI-driven insights and recommendations for platform optimization.
          </Typography>
          {/* AI insights details here */}
        </DialogContent>
        <DialogActions>
          <Button onClick={() => setInsightDialog(false)}>Close</Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
};

export default AdvancedAnalyticsScreen;
import React, { useState } from 'react';
import {
  Box, Grid, Card, CardContent, Typography, Table, TableBody,
  TableCell, TableContainer, TableHead, TableRow, Button, Chip,
  LinearProgress, Avatar, IconButton
} from '@mui/material';
import {
  TrendingUp, People, Assignment, DirectionsCar, Work, Home,
  Visibility, Edit, Delete, CheckCircle, Cancel, Search,
  Refresh, Add, Analytics, Settings, AttachMoney, Notifications
} from '@mui/icons-material';

const AdminHomepage = ({ t, handleRefresh, refreshing, stats, listings, users, tenders }) => {
  const recentActivity = [
    { 
      id: 1, 
      action: 'New tender posted', 
      user: 'John Doe', 
      details: 'Government Construction Project',
      timestamp: '2 hours ago', 
      status: 'success',
      avatar: 'JD'
    },
    { 
      id: 2, 
      action: 'Home listing approved', 
      user: 'Admin', 
      details: 'Modern Apartment in Bole',
      timestamp: '3 hours ago', 
      status: 'success',
      avatar: 'AD'
    },
    { 
      id: 3, 
      action: 'Car listing rejected', 
      user: 'Admin', 
      details: 'Toyota Corolla 2018',
      timestamp: '5 hours ago', 
      status: 'warning',
      avatar: 'AD'
    },
    { 
      id: 4, 
      action: 'New user registered', 
      user: 'Jane Smith', 
      details: 'jane.smith@email.com',
      timestamp: '6 hours ago', 
      status: 'success',
      avatar: 'JS'
    },
    { 
      id: 5, 
      action: 'Job posting updated', 
      user: 'Mike Johnson', 
      details: 'Senior Software Developer',
      timestamp: '8 hours ago', 
      status: 'info',
      avatar: 'MJ'
    }
  ];

  const quickStats = [
    { 
      title: 'Total Listings', 
      value: stats.totalListings || 150, 
      icon: <Assignment />, 
      color: '#2196F3',
      change: '+12%',
      changeType: 'increase'
    },
    { 
      title: 'Active Users', 
      value: stats.activeUsers || 320, 
      icon: <People />, 
      color: '#4CAF50',
      change: '+8%',
      changeType: 'increase'
    },
    { 
      title: 'Revenue', 
      value: `ETB ${(stats.revenue || 25000).toLocaleString()}`, 
      icon: <AttachMoney />, 
      color: '#FF9800',
      change: '+15%',
      changeType: 'increase'
    },
    { 
      title: 'Pending Reviews', 
      value: stats.pendingReview || 23, 
      icon: <Notifications />, 
      color: '#9C27B0',
      change: '-5%',
      changeType: 'decrease'
    }
  ];

  const categoryStats = [
    { name: 'Homes', icon: <Home />, count: listings?.filter(l => l.category === 'home').length || 45, color: '#2196F3' },
    { name: 'Cars', icon: <DirectionsCar />, count: listings?.filter(l => l.category === 'car').length || 32, color: '#4CAF50' },
    { name: 'Jobs', icon: <Work />, count: listings?.filter(l => l.category === 'job').length || 67, color: '#FF9800' },
    { name: 'Tenders', icon: <Assignment />, count: tenders?.length || 23, color: '#9C27B0' }
  ];

  const getStatusColor = (status) => {
    switch (status) {
      case 'success': return 'success';
      case 'warning': return 'warning';
      case 'error': return 'error';
      case 'info': return 'info';
      default: return 'default';
    }
  };

  const getStatusIcon = (status) => {
    switch (status) {
      case 'success': return <CheckCircle sx={{ fontSize: 16 }} />;
      case 'warning': return <Cancel sx={{ fontSize: 16 }} />;
      case 'error': return <Delete sx={{ fontSize: 16 }} />;
      case 'info': return <Search sx={{ fontSize: 16 }} />;
      default: return null;
    }
  };

  return (
    <Box>
      {/* Header */}
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 4 }}>
        <Box>
          <Typography variant="h3" fontWeight="bold" gutterBottom>
            Admin Dashboard
          </Typography>
          <Typography variant="body1" color="text.secondary">
            Welcome back! Here's what's happening with your platform today.
          </Typography>
        </Box>
        <Box sx={{ display: 'flex', gap: 2 }}>
          <Button variant="outlined" startIcon={<Refresh />} onClick={handleRefresh} disabled={refreshing}>
            Refresh
          </Button>
          <Button variant="contained" startIcon={<Add />}>
            Quick Actions
          </Button>
        </Box>
      </Box>

      {/* Quick Stats */}
      <Grid container spacing={3} sx={{ mb: 4 }}>
        {quickStats.map((stat, index) => (
          <Grid item xs={12} sm={6} md={3} key={index}>
            <Card>
              <CardContent sx={{ pb: 2 }}>
                <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
                  <Box sx={{ color: stat.color, mr: 2 }}>
                    {stat.icon}
                  </Box>
                  <Box sx={{ flex: 1 }}>
                    <Typography variant="h4" fontWeight="bold">
                      {stat.value}
                    </Typography>
                    <Typography variant="body2" color="text.secondary">
                      {stat.title}
                    </Typography>
                  </Box>
                </Box>
                <Box sx={{ display: 'flex', alignItems: 'center' }}>
                  <Typography 
                    variant="body2" 
                    color={stat.changeType === 'increase' ? 'success.main' : 'error.main'}
                    sx={{ mr: 1 }}
                  >
                    {stat.change}
                  </Typography>
                  <Typography variant="body2" color="text.secondary">
                    from last month
                  </Typography>
                </Box>
              </CardContent>
            </Card>
          </Grid>
        ))}
      </Grid>

      {/* Category Overview and Recent Activity */}
      <Grid container spacing={3} sx={{ mb: 4 }}>
        {/* Category Overview */}
        <Grid item xs={12} md={8}>
          <Card>
            <CardContent>
              <Typography variant="h6" fontWeight="bold" gutterBottom>
                Category Overview
              </Typography>
              <Grid container spacing={2}>
                {categoryStats.map((category, index) => (
                  <Grid item xs={12} sm={6} md={3} key={index}>
                    <Card variant="outlined">
                      <CardContent sx={{ textAlign: 'center', py: 2 }}>
                        <Box sx={{ color: category.color, mb: 1 }}>
                          {category.icon}
                        </Box>
                        <Typography variant="h5" fontWeight="bold">
                          {category.count}
                        </Typography>
                        <Typography variant="body2" color="text.secondary">
                          {category.name}
                        </Typography>
                      </CardContent>
                    </Card>
                  </Grid>
                ))}
              </Grid>
            </CardContent>
          </Card>
        </Grid>

        {/* Recent Activity */}
        <Grid item xs={12} md={4}>
          <Card>
            <CardContent>
              <Typography variant="h6" fontWeight="bold" gutterBottom>
                Recent Activity
              </Typography>
              <Box sx={{ maxHeight: 300, overflowY: 'auto' }}>
                {recentActivity.map((activity) => (
                  <Box key={activity.id} sx={{ mb: 2 }}>
                    <Box sx={{ display: 'flex', alignItems: 'flex-start' }}>
                      <Avatar sx={{ width: 32, height: 32, mr: 2, fontSize: 14 }}>
                        {activity.avatar}
                      </Avatar>
                      <Box sx={{ flex: 1 }}>
                        <Typography variant="body2" fontWeight="medium">
                          {activity.action}
                        </Typography>
                        <Typography variant="caption" color="text.secondary">
                          {activity.details}
                        </Typography>
                        <Box sx={{ display: 'flex', alignItems: 'center', mt: 0.5 }}>
                          <Chip
                            icon={getStatusIcon(activity.status)}
                            label={activity.timestamp}
                            color={getStatusColor(activity.status)}
                            size="small"
                            variant="outlined"
                          />
                        </Box>
                      </Box>
                    </Box>
                  </Box>
                ))}
              </Box>
            </CardContent>
          </Card>
        </Grid>
      </Grid>

      {/* Performance Metrics */}
      <Grid container spacing={3}>
        {/* Platform Performance */}
        <Grid item xs={12} md={6}>
          <Card>
            <CardContent>
              <Typography variant="h6" fontWeight="bold" gutterBottom>
                Platform Performance
              </Typography>
              <Box sx={{ mb: 3 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                  <Typography variant="body2">Server Uptime</Typography>
                  <Typography variant="body2" fontWeight="medium">99.9%</Typography>
                </Box>
                <LinearProgress variant="determinate" value={99.9} sx={{ height: 8, borderRadius: 4 }} />
              </Box>
              <Box sx={{ mb: 3 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                  <Typography variant="body2">API Response Time</Typography>
                  <Typography variant="body2" fontWeight="medium">120ms</Typography>
                </Box>
                <LinearProgress variant="determinate" value={85} sx={{ height: 8, borderRadius: 4 }} />
              </Box>
              <Box sx={{ mb: 3 }}>
                <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 1 }}>
                  <Typography variant="body2">Database Performance</Typography>
                  <Typography variant="body2" fontWeight="medium">92%</Typography>
                </Box>
                <LinearProgress variant="determinate" value={92} sx={{ height: 8, borderRadius: 4 }} />
              </Box>
            </CardContent>
          </Card>
        </Grid>

        {/* Quick Actions */}
        <Grid item xs={12} md={6}>
          <Card>
            <CardContent>
              <Typography variant="h6" fontWeight="bold" gutterBottom>
                Quick Actions
              </Typography>
              <Grid container spacing={2}>
                <Grid item xs={12} sm={6}>
                  <Button variant="outlined" fullWidth startIcon={<Assignment />} sx={{ justifyContent: 'flex-start' }}>
                    Manage Tenders
                  </Button>
                </Grid>
                <Grid item xs={12} sm={6}>
                  <Button variant="outlined" fullWidth startIcon={<Home />} sx={{ justifyContent: 'flex-start' }}>
                    Manage Homes
                  </Button>
                </Grid>
                <Grid item xs={12} sm={6}>
                  <Button variant="outlined" fullWidth startIcon={<DirectionsCar />} sx={{ justifyContent: 'flex-start' }}>
                    Manage Cars
                  </Button>
                </Grid>
                <Grid item xs={12} sm={6}>
                  <Button variant="outlined" fullWidth startIcon={<Work />} sx={{ justifyContent: 'flex-start' }}>
                    Manage Jobs
                  </Button>
                </Grid>
                <Grid item xs={12} sm={6}>
                  <Button variant="outlined" fullWidth startIcon={<People />} sx={{ justifyContent: 'flex-start' }}>
                    User Management
                  </Button>
                </Grid>
                <Grid item xs={12} sm={6}>
                  <Button variant="outlined" fullWidth startIcon={<Settings />} sx={{ justifyContent: 'flex-start' }}>
                    System Settings
                  </Button>
                </Grid>
              </Grid>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
};

export default AdminHomepage;
